var newCaseFormDialogId="newCaseFormDialog",refreshNotificationsIntervalId,refreshRemindersIntervalId,newCaseFormDialog=jQuery("#"+newCaseFormDialogId),caseFormElement=jQuery("form#legalCaseAddForm",newCaseFormDialog),gridActionIconHTML='<a class="dropdown-toggle dropdown-toggle-new btn btn-default btn-sm dms-action-wheel" data-toggle="dropdown" href="##"><i class="fa-solid fa-gear purple_color"></i> <span class="caret no-margin"></span></a>',notificationsTemplate="",$timeTrackingGrid=null,$tasksGrid=null,$legalCaseGrid=null,$moneyTimeTrackingGrid=null,$bulkTimeTrackingGrid=null,reminderPopoverAnchor=null,notificationPopoverAnchor=null,csrfName="",csrfValue="",disableBlurEventToCheckLookupValidity=!1,AllowedFilesToDisplay=["jpg","png","gif","jpeg","bmp","html","htm","txt","jfif"],loggedUserIsAdminForGrids=!1,gridSavedFiltersParams=!1,gridSavedPageSize=!1,gridAdvancedSearchLinkState=!1,authIdLoggedIn="",getSystemRateValue=!1,hearingFixedFilters=["judged_hearings","my_hearings","verified_hearings","non_verified_hearings","all_todays_hearings","my_todays_hearings","all_hearings_for_tomorrow","my_hearings_for_tomorrow","all_hearings_for_this_week","my_hearings_for_this_week","all_hearings_for_this_month","my_hearings_for_this_month"],gridActionIconHTMLV2='<a class="btn btn-default dropdown-items btn-sm dms-action-wheel" data-toggle="dropdown" href="##"><i class="icon fa fa-fw fa-ellipsis-v"></i> <span class="caret no-margin"></span></a>',datePickerOptionsBottom={weekStart:1,todayHighlight:!0,format:"yyyy-mm-dd",autoclose:!0,showOnFocus:!1,language:_lang.languageSettings.langName,startDate:-1/0,endDate:1/0,viewMode:"days",minViewMode:"days",orientation:"bottom"},gridDefaultPageSize=20,scheduler=null,userLoggedInName,hearingGlobalData,activeOrganizations,REGEX_EMAIL,hearingAttachmentCount=0,saveHtml='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>';function copyHearingSummaryFromLawyerToClient(){jQuery("#summary","#hearing-form").val()&&jQuery("#summary-to-client","#hearing-form").val(jQuery("#summary","#hearing-form").val())}function rejectHearing(e,t){}function verifyHearingSubmitWindow(t,e){var a=new FormData(document.getElementById(jQuery("form",t).attr("id")));jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".modal-save-btn",t).attr("disabled","disabled")},data:a,type:"POST",url:getBaseURL()+"cases/hearings/"+e,contentType:!1,cache:!1,processData:!1,success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(jQuery("#hearingsGrid").length&&jQuery("#hearingsGrid").data("kendoGrid").dataSource.read(),jQuery(".modal",t).modal("hide"),pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),jQuery("#case-events-container").length&&legalCaseEvents.goToPage("stages",{id:e.caseId})):void 0!==e.validationErrors&&e.validationErrors?displayValidationErrors(e.validationErrors,t):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function fillHearingSummary(a,r){r=r||!1,jQuery.ajax({url:getBaseURL()+"cases/fill_hearing_summary/"+a,type:"POST",dataType:"JSON",data:{action:"return_html"},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?(jQuery('<div id="hearing-summary-form-container"></div>').appendTo("body"),(t=jQuery("#hearing-summary-form-container")).html(e.html),commonModalDialogEvents(t),initializeModalSize(t),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery("#form-summary-submit",t).click(function(){summaryHearingSubmitWindow(t,a,r)}),jQuery(t).find("input").keypress(function(e){13==e.which&&summaryHearingSubmitWindow(t,a,r)})):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function summaryHearingSubmitWindow(t,e,a){a=a||!1;var r=new FormData(document.getElementById(jQuery("form",t).attr("id")));jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".modal-save-btn",t).attr("disabled","disabled")},data:r,type:"POST",url:getBaseURL()+"cases/fill_hearing_summary/"+e,contentType:!1,cache:!1,processData:!1,success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(jQuery("#hearingsGrid").length&&jQuery("#hearingsGrid").data("kendoGrid").dataSource.read(),jQuery(".modal",t).modal("hide"),pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),a&&isFunction(a)&&a()):void 0!==e.validationErrors&&e.validationErrors?displayValidationErrors(e.validationErrors,t):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function verifyHearingWindow(e,a){a=a||0,(e=e||0)&&a?jQuery.ajax({url:getBaseURL()+"cases/hearings/"+a,type:"POST",dataType:"JSON",data:{hearingId:e,action:"hearingVerifySummaryWindow"},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?(jQuery('<div id="hearing-verify-form-container"></div>').appendTo("body"),(t=jQuery("#hearing-verify-form-container")).html(e.html),commonModalDialogEvents(t),initializeModalSize(t),void 0!==e.stage_html&&e.stage_html?(litigationStageDataEvents(e.stage_html,t),jQuery("#relate-to-case-stage-link",t).remove(),jQuery("#remove-related-stage",t).remove(),jQuery(".stage-name-container",t).addClass("padding-top7")):jQuery("#stage-div",t).html(""),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery("#form-submit",t).click(function(){verifyHearingSubmitWindow(t,a)}),jQuery(t).find("input").keypress(function(e){13==e.which&&verifyHearingSubmitWindow(t,a)})):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler}):pinesMessage({ty:"error",m:_lang.invalid_record})}function verifyHearingSummary(){var t=jQuery("#hearing-form"),e=jQuery("#legal_case_id",t).val();jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".modal-save-btn",t).attr("disabled","disabled")},dataType:"JSON",data:{id:jQuery("#id",t).val(),summary:jQuery("#summary",t).val(),summaryToClient:jQuery("#summary-to-client",t).val(),judgment:jQuery("#judgment",t).val(),action:"hearingSubmitVerifiedSummary"},type:"POST",url:getBaseURL()+"cases/hearings/"+e,success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(jQuery("#copy-summary-id").hide(),jQuery("#verify-summary-id").hide(),jQuery("#unverified-summary-label").tooltipster("destroy").removeAttr("title").html(_lang.hearingVerifiedTooltip),jQuery("#unverified-summary-icon").attr("src","assets/images/icons/verified-hearing.svg"),pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully})):void 0!==e.validationErrors&&e.validationErrors?displayValidationErrors(e.validationErrors,t):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function switchLang(e){jQuery("#top-links-navbar-collapse-2").removeClass("in"),jQuery.ajax({url:getBaseURL()+"home/switch_lang/",type:"POST",dataType:"JSON",data:{lang:e},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery("#loader-global").hide(),setTimeout(function(){switch(e.status){case"user_not_logged_in":window.location=getBaseURL()+"users/login";break;case"lang_not_exists":pinesMessage({ty:"warning",m:_lang.invalid_request});break;case"success":document.location.reload(!0)}},400)}})}function legalCaseHearingForm(a,r,o,n,i,s,l){a=a||0,r=r||!1,i=i||!1,s=s||!1,l=l||!1,o=!0===(n=n||!1)?jQuery("#legal-case","#case-events-container").val():""===o||null==o?"":o,jQuery.ajax({url:getBaseURL()+"cases/hearings/"+o,type:"POST",dataType:"JSON",data:{hearingId:a,action:"getHearingForm"},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?(jQuery('<div id="hearing-form-container"></div>').appendTo("body"),(t=jQuery("#hearing-form-container")).html(e.html),commonModalDialogEvents(t),hearingFormEvents(t,a,n),r&&(jQuery("#id",t).val(""),jQuery("#start-date-input",t).val(""),jQuery("#sTime",t).val(""),jQuery("#postponed-date-input",t).val(""),jQuery("#postponedTime",t).val(""),jQuery("#event-id",t).val(""),jQuery(".modal-title",t).html(_lang.addHearing)),jQuery("#form-submit",t).click(function(){hearingFormSubmit(t,o,i),hearingGlobalData={hearingsDialog:t,isCaseHearing:n,caseId:o}}),jQuery(t).find("input").keypress(function(e){13==e.which&&(hearingFormSubmit(t,o,i),hearingGlobalData={hearingsDialog:t,isCaseHearing:n,caseId:o})}),a||!n||l||matterStageMetadata(t,jQuery("#legal_case_id",t).val(),s||!1),void 0!==e.stage_html&&e.stage_html?litigationStageDataEvents(e.stage_html,t):jQuery("#stage-div",t).html("")):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error}),jQuery(".effort-time-tooltip",t).tooltipster()},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function hearingFormEvents(a,e,t){initializeModalSize(a),checkBoxContainersValues({"attendees-container":jQuery("#selected-assignees",a)},a),jQuery(".select-picker",a).selectpicker({dropupAuto:!1}),setDatePicker("#start-date",a),setDatePicker("#postponed-date",a),jQuery("#postponed-date",a).bootstrapDP("setStartDate",jQuery("#start-date-input",a).val()),jQuery("#postponed-date",a).bootstrapDP("defaultViewDate",jQuery("#start-date-input",a).val()),jQuery("#sTime",a).timepicker({timeFormat:"H:i"}),jQuery("#postponedTime",a).timepicker({timeFormat:"H:i"}),setDatePicker("#judgment-date",a),makeFieldsHijriDatePicker({fields:["start-date-hijri","postponed-date-hijri","judgment-date-hijri"]}),jQuery("#start-date-hijri","#start-date-hijri-container").val(gregorianToHijri(jQuery("#start-date-gregorian","#start-date-hijri-container").val())),jQuery("#postponed-date-hijri").val(gregorianToHijri(jQuery("#postponed-date-gregorian","#postponed-date-hijri-container").val())),jQuery("#judgment-date-hijri").val(gregorianToHijri(jQuery("#judgment-date-gregorian","#judgment-date-hijri-container").val()));datesCombination(a,{"postponed-date":{minOf:"start-date",maxOf:""},"postponed-date-hijri":{minOf:"start-date-hijri",maxOf:""}}),jQuery("#postponed-date-input").length&&jQuery("#postponed-date-input, #postponedTime",a).on("change paste",function(){handlePostponeHearing(jQuery("#postponed-date-input",a).val(),jQuery("#start-date-input",a).val(),jQuery("#postponedTime",a).val(),jQuery("#sTime",a).val(),a)}),jQuery("#postponed-date-hijri").length&&jQuery("#postponedTime",a).on("change paste",function(){handlePostponeHearing(jQuery("#postponed-date-hijri",a).val(),jQuery("#start-date-hijri",a).val(),jQuery("#postponedTime",a).val(),jQuery("#sTime",a).val(),a)}),0==e&&(jQuery("#postponed-date-input",a).attr("disabled","disabled"),jQuery("#postponed-date-hijri",a).attr("disabled","disabled"),jQuery("#postponedTime",a).attr("disabled","disabled")),0<jQuery(".visualize-hijri-date",a).length&&(getHijriDate(jQuery("#start-date-input",a),jQuery("#start-date-container",a),!0),getHijriDate(jQuery("#postponed-date-input",a),jQuery("#postponed-date-container",a),!0)),jQuery("#start-date-input",a).change(function(){var e=new Date(jQuery("#start-date-input",a).val()),t=new Date;jQuery("#id","#hearing-form").val()||(t<e?jQuery(".hide-on-add-future-hearing").addClass("d-none"):jQuery(".hide-on-add-future-hearing").removeClass("d-none")),e<=t?(jQuery("#time-spent-container").removeClass("d-none"),jQuery("#hearing-time-spent-value").val("1:00")):(jQuery("#time-spent-container").addClass("d-none"),jQuery("#hearing-time-spent-value").val(""))}),lookupPrivateUsers(jQuery("#lookupHearingLawyers",a),"Hearing_Lawyers","#selected-assignees","assignees-container",a),resizeLookupDropDownWidth(jQuery(".assignees-container",a)),!1===t?(e={keyName:"category",value:"Litigation",resultHandler:fetchCaseRelatedDataToHearingFrom},lookUpCases(jQuery("#caseLookup",a),jQuery("#legal_case_id",a),"legal_case_id",a,e,{callback:function(e){jQuery("#latest_development",a).val(e.latest_development)}})):jQuery("#caseLookup").attr("readonly","readonly"),jQuery("#create-hearing-task",a).click(function(){jQuery("#trigger-create-task",a).val("yes"),jQuery("#form-submit").click()}),jQuery("#create-another-hearing",a).click(function(){jQuery("#trigger-create-another",a).val("yes"),jQuery("#form-submit").click()})}function handlePostponeHearing(e,t,a,r,o){a=a||"00:00",r=r||"00:00",moment.locale("en");t=moment(t+" "+r).format("YYYY/MM/DD hh:mm:ss UTC"),r=e?moment(e+" "+a).format("YYYY/MM/DD hh:mm:ss UTC"):null;r&&t<r?(jQuery("#new-hearing-div",o).removeClass("d-none"),jQuery("#add-new-hearing",o).attr("checked","checked")):r&&r<t&&(pinesMessage({ty:"error",m:_lang.feedback_messages.postponedDateGreaterThanStartDate}),jQuery("#postponed-date-input",o).val(null),jQuery("#postponed-date-hijri",o).val(null),jQuery("#postponedTime",o).val(null),jQuery("#add-new-hearing",o).removeAttr("checked"),jQuery("#new-hearing-div",o).addClass("d-none"))}function convertToGregorianPrePost(e,t){e.val()?"Invalid date"!==(m=moment(e.val(),"iYYYY-iM-iD")).locale("en").format("YYYY-M-D")&&t.val(m.format("YYYY-M-D")):t.val("")}function hearingFormSubmit(t,e,a){var r=new FormData(document.getElementById(jQuery("form",t).attr("id")));r.append("action","submitHearingForm"),a=a||!1,jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".modal-save-btn",t).attr("disabled","disabled")},data:r,type:"POST",url:getBaseURL()+"cases/hearings/"+e,contentType:!1,cache:!1,processData:!1,success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(jQuery("#hearingsGrid").length&&jQuery("#hearingsGrid").data("kendoGrid").dataSource.read(),(0<jQuery("#my-dashboard").length||0<jQuery("#litigation-dashboard").length)&&loadDashboardData("hearings"),e.triggerCreateAnother?(jQuery(jQuery("#hearing-form").prop("elements")).each(function(){-1!==jQuery.inArray(jQuery(this).attr("id"),["start-date-gregorian","start-date-hijri","start-date-input","sTime","comments","summary","summary-to-client"])&&(jQuery(this).val(""),jQuery("input[type=file]","#hearing-attachments").each(function(){jQuery(this).attr("value","")}),jQuery("#judged-checkbox").is(":checked"))&&jQuery("#judged-checkbox").trigger("click")}),jQuery("#trigger-create-another","#hearing-form").val(""),jQuery("#id","#hearing-form").val(""),jQuery(".modal-title","#hearing-form-container").html(_lang.addHearing),jQuery("#verified-hearing-icon","#hearing-form").remove(),jQuery("#verify-summary-id","#hearing-form").remove(),jQuery("#unverified-summary-label","#hearing-form").remove(),jQuery("#unverified-summary-icon","#hearing-form").remove(),jQuery("#verified-hearing-text","#hearing-form").remove(),jQuery("#postponed-date-container","#hearing-form").remove(),jQuery("#reasons-of-postponement-container","#hearing-form").remove()):jQuery(".modal",t).modal("hide"),pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),null!==e.postponed&&e.postponed&&pinesMessage({ty:"success",m:_lang.feedback_messages.reminderPostponed}),void 0!==e.message&&e.message&&pinesMessage({ty:e.message.type,m:e.message.text}),e.triggerCreateTask?setTimeout(function(){taskForm(!1,e.case_id,e.id,jQuery("#stage-id","#hearing-form").val()?jQuery("#stage-id","#hearing-form").val():null,a)},200):isFunction(a)&&a(jQuery("#stage-id",t).val()),void 0!==e.validationErrors&&e.validationErrors&&displayValidationErrors(e.validationErrors,t)):void 0!==e.validationErrors&&e.validationErrors?displayValidationErrors(e.validationErrors,t):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function fixCaseDueDate(e){void 0===e||""===e?(jQuery("#dueDate").val(""),jQuery("#closedOn").val("")):(jQuery("#dueDate").datepicker("destroy"),jQuery("#closedOn").datepicker("destroy"),makeFieldsDatePicker({fields:["dueDate","closedOn"],minDate:e}))}function fixCaseArrivalDate(e){void 0===e||""===e?jQuery("#arrivalDate").val(""):(jQuery("#arrivalDate").datepicker("destroy"),makeFieldsDatePicker({fields:["arrivalDate"],maxDate:e}))}function bindNewCaseFormEvents(e,t){e||caseFormElement.submit(function(){return jQuery("#legalCaseDialogSave",newCaseFormDialog.parent()).is(":disabled")||jQuery("#legalCaseDialogSave",newCaseFormDialog.parent()).click(),!1}),jQuery("#userId",newCaseFormDialog).change(function(){"quick_add"==jQuery("#userId",newCaseFormDialog).val()&&(jQuery("#userId",newCaseFormDialog).val("").trigger("chosen:updated"),addUserToTheProviderGroup(jQuery("#provider_group_id",newCaseFormDialog).val(),"userId"))}).chosen({no_results_text:_lang.no_results_matched,placeholder_text:_lang.chooseUsers,height:130,width:"100%"}),jQuery("#provider_group_id",newCaseFormDialog).change(function(){""!=jQuery("#provider_group_id",newCaseFormDialog).val()?(jQuery("#userId",newCaseFormDialog).removeAttr("disabled"),reloadUsersListByProviderGroupSelected(jQuery("#provider_group_id",newCaseFormDialog).val(),jQuery("#userId",newCaseFormDialog))):(jQuery("#userId",newCaseFormDialog).html("").attr("disabled","disabled").trigger("chosen:updated"),jQuery("#user_id",newCaseFormDialog).val(""))}).chosen({no_results_text:_lang.no_results_matched,placeholder_text:_lang.chooseProviderGroup,height:"150px",width:"100%"});e="#"+t;makeFieldsDatePicker({fields:["arrivalDate"],hiddenField:"arrivalDate_Hidden",container:t}),makeFieldsDatePicker({fields:["caseArrivalDate"],hiddenField:"caseArrivalDate_Hidden",container:t}),makeFieldsDatePicker({fields:["dueDate"],hiddenField:"dueDate_Hidden",container:t}),makeFieldsDatePicker({fields:["closedOn"],hiddenField:"closedOn_Hidden",container:t}),0<jQuery(".visualize-hijri-date",e).length&&(getHijriDate(jQuery("#arrivalDate",e),jQuery("#filed-on-date-container",e),!0),getHijriDate(jQuery("#dueDate",e),jQuery("#due-date-container",e),!0),getHijriDate(jQuery("#caseArrivalDate",e),jQuery("#arrival-date-container",e),!0),getHijriDate(jQuery("#closedOn",e),jQuery("#closed-on-date-container",e),!0)),newCaseFormValidation(),caseFormWatchersUsersLookUp(),caseFormWatchersEventsHandler(),ctrlS(function(){caseFormElement.submit()}),contactAutocompleteMultiOption("lookupCaseContact",2,setContactToCaseForm),companyAutocompleteMultiOption(jQuery("#lookupCaseCompany","#legalCaseAddForm"),setCompanyToCaseForm,!0),userLookup(jQuery("#assigneeValue","#legalCaseAddForm"),"user_id"),clientInitialization(jQuery("#legalCaseAddForm"),{onselect:onCaseClientSelect}),lookUpLegalCaseContainers({lookupField:jQuery("#legal-case-related-container-lookup",e),errorDiv:"legalCaseRelatedContainerId",hiddenId:"#legal-case-related-container-id",resultHandler:setLegalCaseContainerToCaseForm,callback:{onEraseLookup:function(){jQuery("#legal-case-related-container-link").addClass("d-none")},onSelect:function(e){jQuery("#legal-case-related-container-link").length&&jQuery("#legal-case-related-container-link").removeClass("d-none").html('<i class="fa fa-external-link"></i>').attr("href",getBaseURL()+"case_containers/edit/"+e.id).attr("title","MC"+e.id)},onChange:function(){return!1}}},e),opponentsInitialization(jQuery("#opponents-container",e),{onselect:onCaseOpponentSelect})}function onCaseClientSelect(e,t,a){var r,o=jQuery("select#client-type",a).val();0<t.id&&jQuery("#clientLinkId",a).length&&(r="","contact"==o?r="contacts/edit/":"Internal"===t.category?r="companies/tab_company/":"Group"===ui.item.record.category&&jQuery("#clientLinkId",a).addClass("d-none"),"Group"!==t.category)&&jQuery("#clientLinkId",a).attr("href",getBaseURL()+r+t.id).removeClass("d-none")}function onCaseOpponentSelect(e,t,a){var r,o=jQuery("select#opponent-member-type",a).val();0<t.id&&jQuery(".opponentLinkId",a).length&&(r="","contact"==o?r="contacts/edit/":"Internal"===t.category?r="companies/tab_company/":"Group"===ui.item.record.category&&jQuery(".opponentLinkId",a).addClass("d-none"),"Group"!==t.category)&&jQuery(".opponentLinkId",a).attr("href",getBaseURL()+r+t.id).removeClass("d-none")}function caseClientFieldEvents(o){jQuery("#clientType","#"+o).change(function(){jQuery("#contact_company_id","#"+o).val(""),jQuery("#clientLookup","#"+o).val(""),jQuery("#clientLookup","#"+o).attr("title",""),jQuery("#clientLinkId","#"+o).length&&jQuery("#clientLinkId","#"+o).addClass("d-none")}),jQuery("#clientLookup","#"+o).change(function(){""==this.value&&jQuery("#contact_company_id","#"+o).val("")}),jQuery("#clientLookup","#"+o).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim();var r=jQuery("select#clientType","#"+o).val();jQuery.ajax({url:getBaseURL()+r+"/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched_add.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return"contacts"==r?(foreignFullName=e.foreignFullName.trim(),{label:(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName)+(foreignFullName?" - "+foreignFullName:""),value:e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName,record:e}):"companies"==r?{label:(null==e.shortName?e.name:e.name+" ("+e.shortName+")")+(null==e.foreignName?"":" - "+e.foreignName),value:e.name,record:e}:void 0}))}})},response:function(e,t){},minLength:3,select:function(e,t){var a,r=jQuery("select#clientType","#"+o).val();0<t.item.record.id?(jQuery("#clientLinkId","#"+o).length&&(a="","contacts"==r?a="contacts/edit/":"Internal"===t.item.record.category?a="companies/tab_company/":"Group"===t.item.record.category&&jQuery("#clientLinkId","#"+o).addClass("d-none"),"Group"!==t.item.record.category)&&jQuery("#clientLinkId","#"+o).attr("href",getBaseURL()+a+t.item.record.id).removeClass("d-none"),jQuery("#clientLookup","#"+o).attr("title","contacts"==r?(null!=t.item.record.foreignFirstName?t.item.record.foreignFirstName:"")+" "+(null!=t.item.record.foreignLastName?t.item.record.foreignLastName:""):null!=t.item.record.foreignName?t.item.record.foreignName:""),openManageMoneyAccounts("contacts"==r?"contact":"company",t.item.record.id,"contacts"==r?t.item.record.contact_category_id:t.item.record.company_category_id,"client"),jQuery("#contact_company_id",jQuery(this).parent()).val(t.item.record.id)):-1==t.item.record.id&&(jQuery("#clientLinkId","#"+o).length&&jQuery("#clientLinkId","#"+o).addClass("d-none"),("contacts"==r?(companyContactFormMatrix.contactDialog={referalContainerId:jQuery("#"+o),lookupResultHandler:setContactCompanyDataToCaseClientField,lookupValue:t.item.record.term},contactAddForm):(companyContactFormMatrix.companyDialog={referalContainerId:jQuery("#"+o),lookupResultHandler:setContactCompanyDataToCaseClientField,lookupValue:t.item.record.term},companyAddForm))())},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function caseOpponentFieldEvents(o){jQuery("#opponent_member_type",o).change(function(){jQuery("#opponent_member_id",o).val(""),jQuery("#opponentLookup",o).val(""),jQuery("#opponentLookup",o).attr("title",""),jQuery("#opponentLinkId",o).length&&jQuery("#opponentLinkId",o).addClass("d-none")}),jQuery("#opponentLookup",o).change(function(){""==this.value&&jQuery("#opponent_member_id",o).val("")}),jQuery("#opponentLookup",o).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim();var r=jQuery("select#opponent_member_type",o).val(),e="contact"==r?"contacts":"companies";jQuery.ajax({url:getBaseURL()+e+"/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched_add.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return"contact"==r?(foreignFullName=e.foreignFullName.trim(),{label:(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName)+(foreignFullName?" - "+foreignFullName:""),value:e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName,record:e}):"company"==r?{label:(null==e.shortName?e.name:e.name+" ("+e.shortName+")")+(null==e.foreignName?"":" - "+e.foreignName),value:e.name,record:e}:void 0}))}})},response:function(e,t){},minLength:3,select:function(e,t){var a,r=jQuery("select#opponent_member_type",o).val();0<t.item.record.id?(jQuery("#opponentLinkId",o).length&&(a="","contact"==r?a="contacts/edit/":"Internal"===t.item.record.category?a="companies/tab_company/":"Group"===t.item.record.category&&jQuery("#opponentLinkId",o).addClass("d-none"),"Group"!==t.item.record.category)&&jQuery("#opponentLinkId",o).attr("href",getBaseURL()+a+t.item.record.id).removeClass("d-none"),jQuery("#opponentLookup",o).attr("title","contact"==r?(null!=t.item.record.foreignFirstName?t.item.record.foreignFirstName:"")+" "+(null!=t.item.record.foreignLastName?t.item.record.foreignLastName:""):null!=t.item.record.foreignName?t.item.record.foreignName:""),jQuery("#opponent_member_id",o).val(t.item.record.id)):-1==t.item.record.id&&(jQuery("#opponentLinkId",o).length&&jQuery("#opponentLinkId",o).addClass("d-none"),("contact"==r?(companyContactFormMatrix.contactDialog={referalContainerId:o,lookupResultHandler:setContactCompanyDataToCaseOpponentField,lookupValue:t.item.record.term},contactAddForm):(companyContactFormMatrix.companyDialog={referalContainerId:o,lookupResultHandler:setContactCompanyDataToCaseOpponentField,lookupValue:t.item.record.term},companyAddForm))())}})}function initializeOpponents(e){var t=jQuery("#opponentsCount",e).val(),a=1;jQuery(".opponent-div",e).each(function(){t<a||(caseOpponentFieldEvents(opponentContainer=jQuery("#opponent-"+a,"#opponentsContainer")),a++)})}function updateOpponentsLables(e){var t=1;jQuery(".opponent-label","#opponentsContainer").each(function(){if(!(t<e))return!0;jQuery(this).html(_lang.opponent+" ("+t+")"),t++}),t=1,jQuery(".opponent-div","#opponentsContainer").each(function(){if(!(t<e))return!0;jQuery(this).attr("id","opponent-"+t),t++}),t=1,jQuery(".delete-opponent","#opponentsContainer").each(function(){if(!(t<e))return!0;jQuery(this).attr("onclick","deleteOpponent("+t+", event)"),t++}),t=1,jQuery(".lookup","#opponentsContainer").each(function(){if(!(t<e))return!0;jQuery(this).attr("onblur","fixOpponentSearchInDialog();checkLookupValidity(jQuery(this), jQuery('#opponent_member_id', '#opponent-"+t+"'));"),t++}),t=1,jQuery("[data-field=administration-case_opponent_positions]","#opponentsContainer").each(function(){if(!(t<=e))return!0;jQuery(this).attr("data-field-id","opponent-position-"+t),t++}),t=1,jQuery(".opponent-position-quick-add","#opponentsContainer").each(function(){if(!(t<=e))return!0;jQuery(this).removeAttr("onClick").attr("onclick","quickAdministrationDialog('case_opponent_positions', '#opponentsContainer' , false, false, false,jQuery(\"[data-field-id=opponent-position-"+t+']"))'),t++}),initializeOpponents()}function deleteOpponent(e,t,a){var r=jQuery("#opponentsCount",a).val();1<r?(jQuery("#opponent-"+e,a).remove(),jQuery("#opponentsCount",a).val(r-1),updateOpponentsLables(r),2==r&&jQuery(".delete-icon","#opponent-1").addClass("d-none")):pinesMessage({ty:"warning",m:_lang.invalid_request}),t.preventDefault()}function addNewOpponent(e,t,a){var r;jQuery(".opponent-div",e).length==a?pinesMessage({ty:"information",m:_lang.caseMaxOpponentsInfo.sprintf([a]),d:1e4}):(r=parseInt(jQuery("#opponentsCount",e).val()),jQuery(".opponent-div",e).last().clone().insertAfter(jQuery(".opponent-div",e).last()),jQuery("#opponentsCount",e).val(r+1),updateOpponentsLables(r+2),jQuery("#opponentLinkId",jQuery("#opponent-"+(r+1),e)).addClass("d-none"),jQuery("#opponent_member_id",jQuery("#opponent-"+(r+1),e)).val(""),jQuery("#opponentLookup",jQuery("#opponent-"+(r+1),e)).val(""),jQuery("#opponentLookup",jQuery("#opponent-"+(r+1),e)).attr("title",""),jQuery("#opponent_member_type",jQuery("#opponent-"+(r+1),e)).find("option").removeAttr("selected"),jQuery("#opponent-position",jQuery("#opponent-"+(r+1),e)).find("option").removeAttr("selected"),jQuery("#opponent-position",jQuery("#opponent-"+(r+1),e)).attr("data-field-id","opponent-position-"+(r+1)),jQuery(".opponent-position-quick-add",jQuery("#opponent-"+(r+1),e)).removeAttr("onClick").click(function(){quickAdministrationDialog("case_opponent_positions",jQuery(e),!1,!1,!1,jQuery("[data-field-id=opponent-position-"+(r+1)+"]"))}),jQuery(".delete-icon","#opponent-"+(r+1)).removeClass("d-none"),1==r&&jQuery(".delete-icon","#opponent-"+r).removeClass("d-none"),jQuery("form#legalCaseAddForm").dirty_form({includeHidden:!0}),t.preventDefault())}function setContactCompanyDataToCaseClientField(e,t,a,r){a=a||"#contact_company_id",r=r||"#clientLookup";var o=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery(a,t).val(e.id),jQuery(r,t).val(o)}function setContactCompanyDataToOutsourceField(e,t){var a=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery("#outsource-id",t).val(e.id),jQuery("#outsource-lookup",t).val(a)}function sumTwoNumbers(e,t){return parseInt(e+t)}function setCompanyRelatedContactData(e,t){var a=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery("#relatedContactId",t).val(e.id),jQuery("#relatedContactLookUp",t).val(a),jQuery("#btnAdd",t).removeAttr("disabled"),jQuery(".k-grid").data("kendoGrid").dataSource.read()}function setContactCompanyDataToCaseOpponentField(e,t){var a=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName),r=e.foreignName||(e.foreignFirstName||"")+" "+(e.foreignLastName||"");jQuery("#opponent_member_id",t).val(e.id),jQuery("#opponentLookup",t).val(a),jQuery("#opponentLookup",t).attr("title",r)}function setContactToCaseForm(e){var t=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#lookupCaseContact").val(t),jQuery("#caseContactId").val(e.id)}function setReferredByContactToCaseForm(e){var t=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#referredByLookup").val(t),jQuery("#referredBy").val(e.id),jQuery("#referredByLinkId").length&&0<e.id?jQuery("#referredByLinkId").attr("href",getBaseURL()+"contacts/edit/"+e.id).removeClass("d-none"):jQuery("#referredByLinkId").addClass("d-none")}function setRequestedByContactToCaseForm(e){var t=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#requestedByLookup").val(t),jQuery("#requestedBy").val(e.id),jQuery("#requestedByLinkId").length&&0<e.id?jQuery("#requestedByLinkId").attr("href",getBaseURL()+"contacts/edit/"+e.id).removeClass("d-none"):jQuery("#requestedByLinkId").addClass("d-none")}function setCompanyToCaseForm(e){jQuery("#lookupCaseCompany").val(e.name),jQuery("#caseCompanyId").val(e.id)}function caseFormWatchersEventsHandler(){var t=jQuery("#lookupWatchersUsers"),e=jQuery("#private");e.is(":checked")?t.autocomplete("enable").removeAttr("readonly").removeClass("ui-state-disabled"):t.autocomplete("disable").attr("readonly","readonly").addClass("ui-state-disabled"),e.click(function(){var e=jQuery("#caseAddFormWatchersContainer",newCaseFormDialog);this.checked?(t.autocomplete("enable").removeAttr("readonly").removeClass("ui-state-disabled"),e.length&&e.removeClass("d-none")):(t.autocomplete("disable").attr("readonly","readonly").addClass("ui-state-disabled"),e.length&&e.addClass("d-none"))})}function caseFormWatchersUsersLookUp(){jQuery("#lookupWatchersUsers",newCaseFormDialog).autocomplete({autoFocus:!1,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL()+"users/autocomplete/active",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched_for.sprintf([t.term]),value:"",record:{user_id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return{label:e.firstName+" "+e.lastName,value:"",record:e}}))}})},minLength:2,select:function(e,t){0<t.item.record.id&&setWatchersUsersDataToBoxMultiOptionAfterAutocomplete(t.item.record)}})}function caseLookup(e,t,a){a=jQuery.extend({legalCaseSubject:!1,onSelect:function(){}},a),t=t||!1;$lookupField="string"==typeof e?jQuery("#"+e):e,$legalCaseIdField="string"==typeof t?jQuery("#"+t):t,a.legalCaseSubject="string"==typeof a.legalCaseSubject?jQuery("#"+a.legalCaseSubject):a.legalCaseSubject,$lookupField.autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL()+"cases/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return{label:e.id.replace(/^0+/,"")+": "+e.subject,value:e.id,record:e}}))}})},response:function(e,t){},minLength:3,select:function(e,t){0<t.item.record.id&&(0!=$legalCaseIdField&&$legalCaseIdField.val(t.item.record.id),0!=a.legalCaseSubject&&a.legalCaseSubject.text(t.item.record.subject),!1!==a.afterSaveResultHandlerFunction)&&void 0!==a.afterSaveResultHandlerFunction&&(caseResultHandlerFunction=a.afterSaveResultHandlerFunction)(t.item.record),a.onSelect(t.item.record)},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function clearTaskUnbindCase(){jQuery("#taskDescription").html(""),jQuery("#case-log-time").length||jQuery("input[name=action][value=StartTimer]").length||(jQuery("#client-div").addClass("d-none"),clearLegalCaseData())}function clearLegalCaseData(){jQuery("#legalCaseLookupId").val(""),jQuery("#legalCaseLookup").val("").autocomplete("option","disabled",!1),jQuery("#legalCaseSubject").html(""),jQuery("#task-related-case-subject").remove(),jQuery("#client-id").val(""),jQuery("#client-name").val("")}function showTaskRelatedCaseSubject(e,t,a){e=_lang.relatedCase+": "+jQuery(e,t).html()+' <a target="_blank" href="'+getBaseURL()+(null==a||"IP"!=a?"cases":"intellectual_properties")+"/edit/"+jQuery("#legalCaseLookupId",t).val()+'">'+_lang.goTo+"</a>";jQuery("#task-related-case-subject",t).length?jQuery("#task-related-case-subject",t).html(taskRelatedCaseSubjectHtml):jQuery("#taskDescription",t).after('<div id="task-related-case-subject" class="help-inline">'+e+"</div>")}function companyAutocompleteMultiOption(e,a,r,o){r=r||!1,o=o||!1,e.autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL()+"companies/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:(r?_lang.no_results_matched_add:_lang.no_results_matched).sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){var t="",t=r?"":null==e.shortName?e.name:e.name+" ("+e.shortName+")";return{label:(0!=r?null==e.shortName?e.name:e.name+" ("+e.shortName+")":t)+(null==e.foreignName?"":" - "+e.foreignName),value:o?"":e.name,record:e}}))}})},response:function(e,t){},minLength:3,select:function(e,t){0<t.item.record.id?a(t.item.record):-1==t.item.record.id&&r&&(companyContactFormMatrix.companyDialog={lookupResultHandler:a,lookupValue:t.item.record.term},companyAddForm())},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function contactAutocompleteMultiOption(e,r,a){e="string"==typeof e?jQuery("#"+e):e,jQuery(e).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL()+"contacts/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:("1"==r||"2"==r?_lang.no_results_matched_add:_lang.no_results_matched).sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return foreignFullName=e.foreignFullName.trim(),{label:(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName)+(foreignFullName?" - "+foreignFullName:""),value:"2"==r||"3"==r?e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName:"",record:e}}))}})},response:function(e,t){},minLength:3,select:function(e,t){0<t.item.record.id?a(t.item.record):-1==t.item.record.id&&"3"!=r&&"4"!=r&&(companyContactFormMatrix.contactDialog={lookupResultHandler:a,lookupValue:t.item.record.term},contactAddForm())},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function partyAutocompleteMultiOption(e,r,a,o){r=r||!1,o=o||!1,e="string"==typeof e?jQuery("#"+e):e,jQuery(e).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL("contract")+"contracts/autocomplete_party",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched,value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){var t=e.company_id?"company":"contact",a="";return e.company_id?(a=r?"":null==e.shortName?e.name:e.name+" ("+e.shortName+")",{label:(0!=r?null==e.shortName?e.name+" ("+t+")":e.name+" ("+e.shortName+") ("+t+")":a)+(null==e.foreignName?"":" - "+e.foreignName),value:o?"":e.name,record:e}):(foreignFullName=e.foreignFullName.trim(),{label:(e.father?e.firstName+" "+e.father+" "+e.lastName+" ("+t+")":e.firstName+" "+e.lastName+" ("+t+")")+(foreignFullName?" - "+foreignFullName:""),value:o?"":e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName,record:e})}))}})},response:function(e,t){},minLength:3,select:function(e,t){0<t.item.record.id&&a(t.item.record)},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function checkReminderRecurrence(a){jQuery.ajax({url:getBaseURL()+"reminders/check_is_recurrence",type:"GET",dataType:"JSON",data:{id:a},async:!1,success:function(e){var t;e.html?jQuery("#recurrence-options-container").length<=0&&(jQuery('<div id="recurrence-options-container"></div>').appendTo("body"),(t=jQuery("#recurrence-options-container")).html(e.html),jQuery(".tooltip-title",t).tooltipster(),jQuery(".modal-container",t).addClass("modal"),commonModalDialogEvents(t),jQuery("#form-submit",t).click(function(){var e=1==jQuery("input[type=radio]:checked",t).val()?"yes":"no";jQuery(".modal",t).modal("hide"),deleteReminder(a,e)})):confirmationDialog("confim_delete_action",{resultHandler:deleteReminder,parm:a})},error:defaultAjaxJSONErrorsHandler})}function deleteReminder(t,e){data={reminderId:t},e&&(data.delete_recurrence=e),jQuery.ajax({url:getBaseURL()+"reminders/delete",type:"POST",dataType:"JSON",data:data,success:function(e){switch(e.status){case 202:updateRemindersAfterActions(t),0<jQuery("#reminderGrid").length&&jQuery("#reminderGrid").data("kendoGrid").dataSource.read(),0<jQuery("#reminders-grid").length&&jQuery("#reminders-grid").data("kendoGrid").dataSource.read(),0<jQuery("#related-reminders-grid").length&&jQuery("#related-reminders-grid").data("kendoGrid").dataSource.read();break;case 101:pinesMessage({ty:"error",m:_lang.recordNotDeleted});break;case 102:pinesMessage({ty:"error",m:_lang.dischargeOfSocialSecurityRelatedReminders})}},error:defaultAjaxJSONErrorsHandler})}function disableEmpty(e){jQuery("div.form-group input.form-control:last-of-type, div.form-group select.form-control:last-of-type",e).each(function(e,t){""!==String(t.value).trim()||jQuery(t).hasClass("hasDatepicker")||jQuery(t).hasClass("hijri-date-picker")||jQuery("input, select",jQuery(t).parent().parent()).attr("disabled","disabled")}),jQuery("div.form-group input.form-control.hasDatepicker:first-of-type",e).each(function(e,t){""===String(t.value).trim()&&jQuery(t).parent().parent().children().slice(1,3).each(function(){jQuery("input, select",jQuery(this)).attr("disabled","disabled")})}),jQuery("div.form-group input.form-control.hasDatepicker:last-of-type",e).each(function(e,t){""===String(t.value).trim()&&jQuery("input, select",jQuery(t).parent()).attr("disabled","disabled")}),jQuery("div.form-group input.form-control.hijri-date-picker",e).each(function(e,t){if(""===String(t.value).trim()){for(var a=jQuery(t).parent(),r=0,o=a.attr("id");void 0===o||void 0!==o&&!o.endsWith("Container")&&r++<5;)o=(a=a.parent()).attr("id");if(5<r)throw new Error("Infinite loop detected and prevented");a.find("[data-input-filter-id='${t.id}']").each(function(){jQuery(this).attr("disabled","disabled")})}})}function disableEmptyFilter(e){jQuery("div.form-group select.form-control, div.form-group input.form-control",e).each(function(e,t){""!==String(t.value).trim()||jQuery(t).hasClass("hasDatepicker")||jQuery("input, select",jQuery(t).parent().parent()).prop("disabled",!0)}),jQuery("div.form-group input.form-control.hasDatepicker, div.form-group input.form-control.hijri-date-picker",e).each(function(e,t){""===String(t.value).trim()&&jQuery(t).parent().parent().children().each(function(){jQuery("input, select",jQuery(this)).prop("disabled",!0)})})}function enableEmptyFilter(e){jQuery("div.form-group select.form-control, div.form-group input.form-control",e).each(function(e,t){""!==String(t.value).trim()||jQuery(t).hasClass("hasDatepicker")||jQuery("input, select",jQuery(t).parent().parent()).prop("disabled",!1)}),jQuery("div.form-group input.form-control.hasDatepicker, div.form-group input.form-control.hijri-date-picker",e).each(function(e,t){""===String(t.value).trim()&&jQuery(t).parent().parent().children().each(function(){jQuery("input, select",jQuery(this)).prop("disabled",!1)})})}function disableUnCheckedFilters(){jQuery(".chk-filter").each(function(){var e=jQuery(this);e.parent().parent().find(".data-filter").each(function(){e.is(":checked")?(""!==String(jQuery(".sf-value",jQuery(this)).val()).trim()&&null!=jQuery(".sf-value",jQuery(this)).val()||jQuery("input, select",jQuery(this)).attr("disabled","disabled"),jQuery(".end-date-icon-filter",jQuery(this)).hasClass("d-none")&&jQuery("input, select",jQuery(".end-date-container",jQuery(this))).attr("disabled","disabled")):jQuery("input, select",jQuery(this)).attr("disabled","disabled")})})}function dismissReminder(t){jQuery.ajax({url:getBaseURL()+"reminders/dismiss",type:"POST",dataType:"JSON",data:{reminderId:t},success:function(e){switch(e.status){case 202:updateRemindersAfterActions(t),0<jQuery("#reminderGrid").length&&jQuery("#reminderGrid").data("kendoGrid").dataSource.read(),0<jQuery("#reminders-grid").length&&jQuery("#reminders-grid").data("kendoGrid").dataSource.read(),0<jQuery("#related-reminders-grid").length&&jQuery("#related-reminders-grid").data("kendoGrid").dataSource.read();break;case 101:pinesMessage({ty:"error",m:_lang.feedback_messages.updatesFailed})}},error:defaultAjaxJSONErrorsHandler})}function taskEditForm(e,t,a){a=a||!1,void 0!==t&&t&&t.preventDefault(),a?taskForm(e,!1,!1,!1,a):taskForm(e,!1)}function enableAll(e){jQuery("div.form-group input.form-control:last-of-type[disabled=disabled], div.form-group select.form-control:last-of-type[disabled=disabled]",e).each(function(e,t){jQuery(t).parent().children().removeAttr("disabled"),void 0!==jQuery(this).attr("field-type")&&!1!==jQuery(this).attr("field-type")&&"list"==jQuery(this).attr("field-type")&&jQuery(this).trigger("chosen:updated")}),jQuery("input:disabled",e).each(function(){jQuery(this).removeAttr("disabled")})}function enableDisableTaskUsersLookup(){var e=jQuery("#task-dialog"),t=jQuery("#lookupTaskUsers",e);jQuery("#private",e).is(":checked")?(jQuery(".task-users-container",e).removeClass("d-none"),jQuery(".modal-body",e).scrollTo(jQuery("#selected_task_users",e)),t.focus()):jQuery(".task-users-container",e).addClass("d-none")}function isKendoInlineFormHasUnsavedData(){jQuery(window).bind("beforeunload",function(e){if(0<jQuery(".k-dirty").length)return _lang.warning_you_have_unsaved_changes})}function triggerFormEvents(e,t,a){-1==a&&(a=""),jQuery(".select-picker",e).selectpicker({dropupAuto:!1}),lookUpUsers(jQuery("#assignedToLookUp"+a,e),jQuery("#assignedToId"+a,e),"assigned_to"+a,jQuery(".assignee-container",e),e),jQuery("#assignedToId"+a,e).change(function(){0<jQuery("#user-relation",e).val()&&0<jQuery("#assignedToId"+a,e).val()&&jQuery("#user-relation",e).val()!==jQuery("#assignedToId"+a,e).val()&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignee})})}function taskFormEvents(e,t){setDatePicker("#form-due-date",e),void 0!==t.restricted_by_task_reporter&&t.restricted_by_task_reporter&&(jQuery("#form-due-date-input",e).attr("disabled","disabled"),tinyMCE.get("description").setMode("readonly"),jQuery("#assignedToLookUp",e).attr("disabled","disabled"),jQuery("#type",e).attr("disabled","disabled"),jQuery("#quickAddButton",e).attr("disabled","disabled"),jQuery("#reporterLookUp",e).attr("disabled","disabled"),jQuery("#assignToMeLinkId",e).addClass("disabled-anchor"),jQuery("#notify-me-link",e).addClass("disabled-anchor"),jQuery("#date-conversion",e).addClass("disabled-anchor"),jQuery(".assign-to-me-link-id-wrapper",e).addClass("drop-pointer"),jQuery(".restriction-tooltip",e).each(function(){jQuery(this).append('<span title="'+_lang.onlyReporterCanEdit+'" class="tooltip-title m-h-3"><i class="fa-solid fa-circle-question purple_color"></i></span>')})),0<jQuery(".visualize-hijri-date",e).length&&getHijriDate(jQuery("#due-date",e),jQuery("#due-date-container",e)),notifyMeBeforeEvent({input:"due-date-input",inputContainer:"due-date"},e,!0),jQuery(".select-picker","#task-dialog").selectpicker(),jQuery("#type","#task-dialog").on("shown.bs.select",function(e){jQuery(".dropdown-menu.inner").animate({scrollTop:jQuery(".selected").offset().top},"fast"),jQuery(".modal-body").animate({scrollTop:"0px"},"fast")});t={keyName:"isDeleted",value:"0",resultHandler:fetchCaseRelatedDataToHearingFrom};lookUpCases(jQuery("#caseLookup",e),jQuery("#caseLookupId",e),"legal_case_id",e,t),lookUpUsers(jQuery("#assignedToLookUp",e),jQuery("#assignedToId",e),"assigned_to",jQuery(".assignee-container",e),e),jQuery("#assignedToId",e).change(function(){0<jQuery("#user-relation",e).val()&&0<jQuery("#assignedToId",e).val()&&jQuery("#user-relation",e).val()!==jQuery("#assignedToId",e).val()&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignee})}),lookUpUsers(jQuery("#reporterLookUp",e),jQuery("#reporter-id",e),"reporter",jQuery(".reporter-container",e),e),lookUpLocations(jQuery("#location",e),jQuery("#task_location_id",e),"task_location_id",e),lookupPrivateUsers(jQuery("#lookupTaskUsers",e),"Task_Users","#selected_task_users","users-lookup-container",jQuery("#task-form")),lookupPrivateUsers(jQuery("#contributors-lookup",e),"contributors","#selected-contributors","contributors-container",e),lookUpContracts({lookupField:jQuery("#lookup-contract",e),hiddenId:jQuery("#lookup-contract-id",e),errorDiv:"contract_id"},e),checkBoxContainersValues({"contributors-container":jQuery("#selected-contributors",e)},e),enableDisableTaskUsersLookup(),initializeModalSize(e)}function loadUserLatestReminders(t){jQuery.ajax({url:getBaseURL()+"reminders/reminders_list",dataType:"json",type:"POST",data:{typeReturn:"list"},success:function(e){"refresh"===t?1<=e.totalRows&&jQuery("#pendingReminders").css("display","inline-block").text(e.totalRows):"load_all"===t&&(clearInterval(refreshRemindersIntervalId),jQuery("h3.popover-header",jQuery("#remindersListLatestContainer").parent().parent()).html(_lang.remindersCounter.sprintf([e.totalRows])+remindersPopoverIconClose).popover("show"),1<=e.totalRows?jQuery("#pendingReminders").css("display","inline-block").text(e.totalRows):jQuery("#pendingReminders").html(""),jQuery("#remindersListLatest").removeClass("loading").html(e.html))},error:defaultAjaxJSONErrorsHandler})}function is_touch_device(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints}function makeFieldsDatePicker(t){function e(){var e=jQuery(this);""!=e.val()&&(e=e,null!=t.yearRange||""!=t.yearRange?e.datepicker("option","yearRange",t.yearRange):e.datepicker("option","yearRange","c-25:c+25"),null!=t.minDate||""!=t.minDate?e.datepicker("option","minDate",t.minDate):e.datepicker("option","minDate",null),null!=t.maxDate||""!=t.maxDate?e.datepicker("option","maxDate",t.maxDate):e.datepicker("option","maxDate",null))}is_touch_device()&&jQuery('*[placeholder="YYYY-MM-DD"]').attr("readonly","readonly");var r=jQuery.extend({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",firstDay:1},_lang.jQuery_datepicker_options),a=(void 0===t.yearRange||""===t.yearRange?r.yearRange="c-25:c+25":r.yearRange=t.yearRange,null==t.minDate&&""==t.minDate||(r.minDate=t.minDate),null==t.maxDate&&""==t.maxDate||(r.maxDate=t.maxDate),null==t.hiddenField&&""==t.hiddenField||null==t.container&&""==t.container?r.onSelect=function(){jQuery(this).blur().change()}:(r.hiddenField=t.hiddenField,r.container=t.container,r.onSelect=function(){var e,t,a=jQuery(this).datepicker("getDate");a&&(e=a.getDate()<10?"0"+a.getDate():a.getDate(),t=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,a=a.getFullYear()+"-"+t+"-"+e,jQuery("#"+r.hiddenField,"#"+r.container).val(a).trigger("change"),jQuery(this).blur().change())}),t.fields);for(i in a){fieldSelector=void 0!==t.container&&""!==t.container?"string"==typeof a[i]?jQuery("#"+a[i],"#"+t.container):jQuery(a[i],"#"+t.container):"string"==typeof a[i]?jQuery("#"+a[i]):jQuery(a[i]);var o={};if(void 0!==t.startDate&&0<t.startDate.length)for(j in t.startDate)jQuery.each(t.startDate[j],function(e,t){e==a[i]&&(o.minDate=jQuery("#"+t).val())});fieldSelector.datepicker(jQuery.extend({},r,o)),fieldSelector.on("changeDate change",e)}}function newCaseFormAssigneeLookUp(){jQuery("#userId",newCaseFormDialog).autocomplete({autoFocus:!1,delay:600,source:function(t,a){t.term=t.term.trim(),t.join=["provider_groups_users"],t.more_filters={},t.more_filters.provider_group_id=jQuery("#provider_group_id").val(),jQuery.ajax({url:getBaseURL()+"users/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched_add.sprintf([t.term]),value:"",record:{user_id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return{label:e.firstName+" "+e.lastName,value:e.firstName+" "+e.lastName,record:e}}))}})},minLength:2,select:function(e,t){0<t.item.record.id?jQuery("#user_id",newCaseFormDialog).val(t.item.record.user_id):t.item.record.id}})}function newCaseFormValidation(){jQuery("#legalCaseAddForm",newCaseFormDialog).validationEngine({validationEventTrigger:"submit",autoPositionUpdate:!0,promptPosition:"bottomLeft",scroll:!1,prettySelect:!0,useSuffix:"_chosen",custom_error_messages:{"#case_status_id":{required:{message:_lang.validation_field_required.sprintf([_lang.case_status])}},"#case_type_id":{required:{message:_lang.validation_field_required.sprintf([_lang.caseType])}},"#subject":{required:{message:_lang.validation_field_required.sprintf([_lang.subject_Case])}},"#provider_group_id":{required:{message:_lang.validation_field_required.sprintf([_lang.providerGroup])}},"#arrivalDate":{custom:{message:_lang.validation_field_date_format_required.sprintf([_lang.filedOn])}}}})}function niceDropDownLists(){jQuery("#nationality_id").chosen({no_results_text:_lang.no_results_matched,placeholder_text:_lang.chooseNationality,height:100,width:"100%"}),jQuery("#country_id").chosen({no_results_text:_lang.no_results_matched,placeholder_text:_lang.chooseCountry,height:100,width:"100%"})}function taskAddForm(e,t,a,r){r=r||!1,(a=a||!1)?taskForm(!1,e,!1,t,a,r):taskForm(!1,e,!1,t)}function reloadUsersListByProviderGroupSelected(a,r,o){o=o||!1;var n=!1;jQuery.ajax({url:getBaseURL()+"users/autocomplete/active",dataType:"JSON",async:!1,data:{join:["provider_groups_users"],more_filters:{provider_group_id:a},term:""},success:function(e){var t='<option value="">&nbsp;</option>';if(void 0!==jQuery("#all-users-provider-group").val()&&""!==jQuery("#all-users-provider-group").val()&&jQuery("#all-users-provider-group").val()!==a&&(t+='<option value="quick_add">'+_lang.clickToAddUserToTeam+"</option>"),void 0!==e&&null!=e&&0<e.length)for(i in e)t+='<option value="'+e[i].id+'">'+e[i].firstName+" "+e[i].lastName+"</option>",o||"undefined"==assigneeInfo||a!==assigneeInfo.assignedTeamId||assigneeInfo.assigneeId===e[i].id||(n=!0);else o||"undefined"==assigneeInfo||a!==assigneeInfo.assignedTeamId||(n=!0);n&&(t+='<option value="'+assigneeInfo.assigneeId+'">'+assigneeInfo.assigneeName+"</option>"),o?r.html(t).selectpicker("refresh"):r.html(t).trigger("chosen:updated")},error:defaultAjaxJSONErrorsHandler})}function resetContactCheckboxesValues(){var e=jQuery("#contactDialog");jQuery("#isLawyer",e).val("no"),jQuery("#lawyerForCompany",e).val("no")}function resetNewCaseDialogForm(){caseFormElement[0].reset(),jQuery("#provider_group_id").trigger("chosen:updated"),jQuery('[name="provider_group_id"]').val("").trigger("chosen:updated"),jQuery("#userId").trigger("chosen:updated"),jQuery('[name="user_id"]').val("").trigger("chosen:updated"),jQuery("#selected_companies, #selected_referrers, #selected_opponents, #selected_opponent_lawyers, #selected_watchers_users").html(""),jQuery("#category").val("Matter"),jQuery("#private").attr("checked",!1),jQuery("#caseAddFormWatchersContainer",newCaseFormDialog).addClass("d-none"),jQuery("#caseValuetoDisplay",newCaseFormDialog).text("0.00"),jQuery("#recoveredValuetoDisplay",newCaseFormDialog).text("0.00"),jQuery("#judgmentValuetoDisplay",newCaseFormDialog).text("0.00")}function resetTaskFormValues(){var e=jQuery("#taskDialog");0<jQuery("form#taskForm",e).length&&(jQuery("form#taskForm",e)[0].reset(),jQuery("#selected_task_users",e).html(""),enableDisableTaskUsersLookup())}function setCompanyLawyerToFormAfterAutocomplete(e){var t=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#lawyer_id","#companyDetailedForm").val(e.id),jQuery("#lookupLawyer","#companyDetailedForm").val(t)}function setNewCaseMultiOption(e,t,a){a=a||"",t.id&&!jQuery("#"+t.name+t.id,e).length&&(e.css("border","solid 1px #ddd"),e.append(jQuery('<div class="flex-item-box row multi-option-selected-items no-margin w-100 height-30px" objectName="'+a+'" id="'+t.name+t.id+'">'+("Legal_Case_Referrer"==t.name||"Legal_Case_Opponent_Lawyers"==t.name||"Legal_Case_External_Lawyers"==t.name?t.isLawyer?'<i class="person-lawyer-icon">&nbsp;</i>':'<i class="person-contact-icon">&nbsp;</i>':"")+'<span id="'+t.id+'">'+t.value+"</span> </div>").append(jQuery('<input type="hidden" value="'+t.id+'" name="'+t.name+'[]" />')).append(jQuery('<a href="javascript:;" class="btn btn-default btn-sm btn-link pull-right flex-end-item" tabindex="-1" onclick="unsetNewCaseMultiOption(this.parentNode);"><i class="fa-solid fa-xmark"></i></a>'))))}function setOpponentLawyersContactDataToBoxMultiOptionAfterAutocomplete(e){setNewCaseMultiOption(jQuery("#selected_opponent_lawyers"),{id:e.id,value:e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName,name:"Legal_Case_Opponent_Lawyers",isLawyer:"yes"==e.isLawyer})}function setSelectedCompany(e){var t=jQuery("#contactDetailsForm"),t=jQuery("#selected_companies",t);e.id&&!jQuery("#contact_company"+e.id,t).length&&t.append(jQuery('<div class="flex-item-box row multi-option-selected-items no-margin w-100 height-30px" id="contact_company'+e.id+'"><span id="'+e.id+'">'+e.name+"</span> </div>").append(jQuery('<input type="hidden" value="'+e.id+'" name="companies_contacts[]" />')).append(jQuery('<input value="x" type="button" class="btn btn-default btn-sm pull-right x-icon flex-end-item" onclick="jQuery(this.parentNode).remove();" />')))}function setWatchersUsersDataToBoxMultiOptionAfterAutocomplete(e){setNewCaseMultiOption(jQuery("#selected_watchers_users"),{id:e.id,value:e.firstName+" "+e.lastName,name:"Legal_Case_Watchers_Users"})}function taskFormSubmit(a,r,o){r=r||!1;var e=new FormData(document.getElementById(jQuery("form#task-form",a).attr("id")));e.append("description",tinymce.activeEditor.getContent()),jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery(".modal-save-btn").attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",contentType:!1,cache:!1,processData:!1,url:getBaseURL()+"tasks/"+(r?"edit/"+r:"add"),success:function(e){var t;1<=e.totalNotifications?jQuery("#pendingNotifications").css("display","inline-block").text(e.totalNotifications):jQuery("#pendingNotifications").html(""),jQuery(".inline-error","#task-dialog").addClass("d-none"),e.result?(jQuery("#notify-me-before-container",a).is(":visible")&&loadUserLatestReminders("refresh"),e.cloned||"function"!=typeof taskCallBack||taskCallBack(),0<jQuery("#my-dashboard").length&&(loadDashboardData("tasks"),pieCharts()),updateGetingStartedSteps("task"),t=_lang.feedback_messages.addedNewTaskSuccessfully.sprintf(['<a href="'+getBaseURL()+"tasks/view/"+e.id+'">'+e.task_code+"</a>"]),pinesMessage({ty:"success",m:r?_lang.feedback_messages.updatesSavedSuccessfully:t}),e.cloned?(jQuery("#clone",a).val("no"),assignmentPerType(jQuery("#type",a).val(),"task",a)):jQuery(".modal","#task-dialog").modal("hide"),isFunction(o)&&o(jQuery("#stage-id").val())):displayValidationErrors(e.validationErrors,a)},complete:function(){jQuery(".modal-save-btn").removeAttr("disabled"),jQuery(".loader-submit",a).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function taskLookup(e,t,r){var r=r||{},a="string"==typeof(t=t||!1)?jQuery("#"+t):t;("string"==typeof e?jQuery("#"+e):e).autocomplete({autoFocus:!0,delay:600,source:function(t,a){null!==r.filterCases&&"yes"==r.filterCases&&""!=jQuery(r.legalCaseLookupId).val()&&(t.more_filters={},t.more_filters.legal_case_id=jQuery(r.legalCaseLookupId).val()),t.term=t.term.trim(),jQuery.ajax({url:getBaseURL()+"tasks/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return{label:e.id+": "+e.title,value:e.id,record:e}}))}})},response:function(e,t){},minLength:3,search:function(e,t){clearTaskUnbindCase()},select:function(e,t){0<t.item.record.id&&0!=a&&(a.val(t.item.record.id),r.taskDescriptionId&&jQuery(r.taskDescriptionId,r.container).text(t.item.record.description),jQuery("input[name=action][value=StartTimer]").length||jQuery("#case-log-time").length||(null!=t.item.record.legal_case_id?(jQuery(r.legalCaseLookupId,r.container).val(t.item.record.legal_case_id),jQuery(r.legalCaseLookup,r.container).val(t.item.record.legal_case_id).attr("readonly","readonly").addClass("disabled").autocomplete("option","disabled",!0),jQuery(r.legalCaseSubject,r.container).html(t.item.record.caseSubject),showTaskRelatedCaseSubject(r.legalCaseSubject,r.container,t.item.record.category),jQuery('input[name="timeStatus"][value=billable]').attr("checked")&&(jQuery("#client-div").removeClass("d-none"),t.item.record.client_id?(jQuery("#client-id").val(t.item.record.client_id),jQuery("#client-name").val(t.item.record.client_name).attr("readonly",!0)):jQuery("#client-name").val(t.item.record.client_name).attr("readonly",!1))):(jQuery(r.legalCaseLookupId,r.container).val(""),jQuery(r.legalCaseLookup,r.container).val("").removeAttr("readonly").removeClass("disabled").autocomplete("option","disabled",!1),jQuery(r.legalCaseSubject,r.container).html(""),jQuery("#client-div").addClass("d-none"),jQuery("#client-id").val(""),jQuery("#client-name").val("").attr("readonly",!1))))},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function unsetNewCaseMultiOption(e){jQuery(e).remove()}function updateRemindersAfterActions(e){e=e||!1,jQuery("#reminder_"+e).remove();e=parseInt(jQuery("#pendingReminders").text());e--,0<jQuery("#my-dashboard").length&&loadDashboardData("reminders"),1<=e?jQuery("#pendingReminders").css("display","inline-block").text(e):jQuery("#pendingReminders").text("").css("background-color","").css("display","none"),jQuery("h3.popover-header",jQuery("#remindersListLatestContainer").parent().parent()).html(_lang.remindersCounter.sprintf([e])+"<a class=\"pull-right\" href=\"javascript:;\" onclick=\"jQuery('#pendingReminders').parent().popover('hide');if(remindersRefreshInterval!=''){refreshRemindersIntervalId = window.setInterval(function(){loadUserLatestReminders('refresh');}, remindersRefreshInterval);}\"><sub style=\"color: #fff;\">x</sub></a>")}function userLookup(e,a,r,t,o){a=a||!1,r=r||!1;var n="",i=(!0===(o=o||!1)&&(n=jQuery("#provider_group_id").val()),getBaseURL()+"users/autocomplete/"+t);e="string"==typeof e?jQuery("#"+e):e,jQuery(e).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),o&&(t.more_filters={},t.more_filters.excludedProviderGroupUsers=n),jQuery.ajax({url:i,dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched_for.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){var t="";return"Inactive"==e.status&&(t=" ("+_lang.custom[e.status]+")"),{label:e.firstName+" "+e.lastName+t,value:e.firstName+" "+e.lastName,record:e}}))}})},response:function(e,t){},minLength:1,select:function(e,t){0<t.item.record.id&&a?(a&&jQuery("#"+a).val(t.item.record.id),r&&r(t.item.record)):t.item.record.id},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function loadLatestNotifications(t){typeReturn="refresh"==t?"counter":"list",jQuery.ajax({url:getBaseURL()+"notifications/get_pending_list",dataType:"json",type:"POST",data:{typeReturn:typeReturn},success:function(e){"refresh"===t?1<=e.pending_notifications&&jQuery("#pendingNotifications").css("display","inline-block").text(e.pending_notifications):"load_all"===t&&(clearInterval(refreshNotificationsIntervalId),jQuery("h3.popover-header",jQuery("#notificationsContainer").parent().parent()).html(_lang.notificationsCounter.sprintf([e.totalRows])+notificationsPopoverIconClose),jQuery("#pendingNotifications").html(""),jQuery("#notificationsListLatest").removeClass("loading").html(e.html),"expenses"!=jQuery(element).attr("objectType"))&&jQuery("a.notify-links","#notificationsContainer").each(function(e,a){jQuery(a).tooltip({show:{effect:"highlight",duration:1100},items:"[title], [objectType], [objectID]",content:function(){var t=jQuery(a).attr("objectType");jQuery.ajax({url:getBaseURL()+t+"/autocomplete",dataType:"json",data:{term:jQuery(a).attr("objectID")},error:defaultAjaxJSONErrorsHandler,success:function(e){if(0!==e.length)return"cases"==t?jQuery(a).attr("title",e[0].fullSubject):jQuery(a).attr("title",e[0].description),jQuery(a).attr("title")},error:defaultAjaxJSONErrorsHandler})},track:!1})})},error:defaultAjaxJSONErrorsHandler})}function dismissNotification(t){jQuery.ajax({url:getBaseURL()+"notifications/dismiss",type:"POST",dataType:"JSON",data:{notificationId:t},success:function(e){switch(e.status){case 202:updateNotificationsAfterActions(t);break;case 101:pinesMessage({ty:"error",m:_lang.feedback_messages.updatesFailed})}},error:defaultAjaxJSONErrorsHandler})}function updateNotificationsAfterActions(e){e=e||!1,jQuery("#notification_"+e).remove();e=jQuery("#notificationsContainer").parent().prev().text().match(/\d+/)[0];1<=--e?jQuery("#pendingNotifications").css("display","none").text(e):jQuery("#pendingNotifications").text("").css("background-color","").css("display","none"),jQuery("h3.popover-header",jQuery("#notificationsContainer").parent().parent().parent()).html(_lang.notificationsCounter.sprintf([e])+"<a class=\"pull-right\" href=\"javascript:;\" onclick=\"jQuery('#pendingNotifications').parent().popover('hide');if(notificationRefreshInterval!=''){refreshNotificationsIntervalId = window.setInterval(function(){loadLatestNotifications('refresh');}, notificationRefreshInterval);}\"><sub style=\"color: #fff;\">x</sub></a>")}function notificationSendEmailClickPopup(e,t){notificationSendEmailClick(e,t=t||"","#notificationSendEmailId"),notificationSendEmailClick(e,t,"#send_notifications_email")}function notificationSendEmailClick(e,t,a){a=a||"#send_notifications_email",jQuery(a,t).val(jQuery(e).is(":checked")?"yes":"")}function resetUserActivityLogForm(){jQuery("[aria-describedby='userActivityLogDialog']").remove(),jQuery("#userActivityLogDialog").remove()}function logActivityDialog(r,o,n,i,s,l){r=r||!1,(o=o||{})&&(o.taskDescription&&(checkIfStringIsURIEncoded(o.taskDescription)&&(o.taskDescription=decodeURIComponent(o.taskDescription)),o.taskDescription=replaceHtmlCharacter(o.taskDescription)),o.legalCaseSubject)&&(checkIfStringIsURIEncoded(o.legalCaseSubject)&&(o.legalCaseSubject=decodeURIComponent(o.legalCaseSubject)),o.legalCaseSubject=replaceHtmlCharacter(o.legalCaseSubject));var e=r?getBaseURL().concat("time_tracking/edit/").concat(r):getBaseURL().concat("time_tracking/add"),d={};jQuery.ajax({url:e,data:d,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.status&&(jQuery("#noty_topRight_layout_container").remove(),jQuery('<div id="time-log-dialog"></div>').appendTo("body"),(t=jQuery("#time-log-dialog")).html(e.html),initializeModalSize(t,.4,"auto"),commonModalDialogEvents(t),jQuery("#log-options-menu",t).selectpicker(),jQuery("#time-status",t).selectpicker(),jQuery("#time-internal-status",t).selectpicker(),jQuery("#rate-time-log",t).selectpicker(),jQuery("#entity-time-log",t).selectpicker(),jQuery("#task_lookup",t).val(jQuery("#task_lookup",t).val()),jQuery("#time-logs-comment",t).val(replaceHtmlCharacter(jQuery("#time-logs-comment",t).val())),jQuery("#case_lookup",t).val(replaceHtmlCharacter(jQuery("#case_lookup",t).val())),l&&(jQuery("#log-date",t).val(l.last_date),jQuery("#repeat-until-date-input",t).val(l.log_date),jQuery("#is-repeat",t).prop("checked",!0),timeLogsDialog.repeatInput("#is-repeat")),lookUpCases(jQuery("#case_lookup",t),jQuery("#legal_case_id",t),"legal_case_id",t,!1,{callback:timeLogsDialog.onCaseLookup,onEraseLookup:timeLogsDialog.onEraseCaseLookup}),lookUpTasks({lookupField:jQuery("#task_lookup",t),hiddenId:jQuery("#task_id",t),errorDiv:"task_id"},t,{callback:timeLogsDialog.onTaskLookup,onEraseLookup:timeLogsDialog.onErasetaskLookup}),lookUpClients({lookupField:jQuery("#client-name",t),hiddenId:jQuery("#client-id",t),errorDiv:"client-lookup-wrapper"},t),getSystemRateValue=!1,lookUpUsers(jQuery("#user-lookup",t),jQuery("#user-id",t),"user_id",jQuery("#user-lookup-wrapper",t),t,{resize:"false"},{callback:timeLogsDialog.onUserLookupSelect()}),setDatePicker("#log-date-wrapper",t),setDatePicker("#to-date-picker-wrapper",t),r||RelateTimeLogTo(t,r,o,n,i,e.defaultNewTimeLogStatus,"no"),a=jQuery("#log-date-wrapper",t).data("datepicker").getFormattedDate("yyyy-mm-dd"),jQuery("#to-date-picker-wrapper",t).bootstrapDP("setStartDate",a||-1/0),jQuery("#log-date-wrapper",t).bootstrapDP().on("changeDate",function(e){jQuery("#to-date-picker-wrapper",t).bootstrapDP("setStartDate",timeActions.get_next_date(e.date)),jQuery("#to-date-picker-wrapper",t).bootstrapDP("setDate","")}),jQuery("#effectiveEffortHour",t).keyup(function(){jQuery("#splited-time-value",t).html(""),jQuery("#split-none-billable-time-value",t).val(""),jQuery("#split-billable-time-value",t).val("")}),jQuery("#add-timer-dialog-submit").on("click",function(){timeLogsDialog.logTimeSave(jQuery("#form-action",t).val(),!1),s&&setTimeout(function(){window.location=window.location.href},1e3)}),jQuery("#add-timer-duplicate-button").on("click",function(){timeLogsDialog.logTimeSave(jQuery("#form-action",t).val(),!0),s&&setTimeout(function(){window.location=window.location.href},1e3)}),jQuery("#time-status",t).change(function(){jQuery.ajax({url:getBaseURL().concat("time_types/get_record_by_id/").concat(jQuery(this).val()),data:d,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.status&&(e.data.default_comment&&e.data.default_time_effort?changeTimeLogsDefaultValue(e.data.default_time_effort,"replace_time","#effectiveEffortHour",t,function(){changeTimeLogsDefaultValue(e.data.default_comment,"replace_comment","#time-logs-comment",t)}):(changeTimeLogsDefaultValue(e.data.default_comment,"replace_comment","#time-logs-comment",t),changeTimeLogsDefaultValue(e.data.default_time_effort,"replace_time","#effectiveEffortHour",t)))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler}),jQuery("#time-logs-comment",t).val()}),jQuery(".effort-time-tooltip",t).tooltipster(),jQuery(".billable-check-box-message",t).tooltipster({contentAsHTML:!0,timer:22800,animation:"grow",delay:200,theme:"tooltipster-default",touchDevices:!1,trigger:"hover",maxWidth:350,interactive:!0}),jQuery(".repeat-check-box-message",t).tooltipster(),jQuery("#log-options-menu",t).on("logType:toggle",function(e){var t=jQuery(this);t.is(".task-type")?t.trigger("logType:matter"):t.trigger("logType:task")}).on("logType:task",function(e){jQuery(this).removeClass("matter-type").addClass("task-type"),timeLogsDialog.taskLogTypeSelected(e,t)}).on("logType:matter",function(e){jQuery(this).removeClass("task-type").addClass("matter-type"),timeLogsDialog.matterLogTypeSelected(e,t)}),timeLogsDialog.onChangeRate("#rate-time-log","no",!!jQuery("#client-id",t).val()||"noClient"),disableAutocomplete(t),e.has_billing_options)&&(helpers.readonlyFieldsEnable(t),jQuery("#time-status",t).prop("readonly",!1),jQuery("#time-internal-status",t).prop("readonly",!1),jQuery("[data-id='time-status']").prop("disabled",!1),jQuery("#time-logs-comment",t).prop("readonly",!1),jQuery("#log-date-wrapper",t).bootstrapDP("remove").prop("readonly",!0),jQuery("#related-entity",t).addClass("d-none"))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function changeTimeLogsDefaultValue(e,t,a,r,o){o=o||!1,jQuery(a,r).val()&&e&&confirmationDialog(t,{resultHandler:function(){jQuery(a,r).val(e),o&&o()}})}function onchangeOperatorsFiltersDate(e,t,a){a=a||!1;var t=jQuery("#"+t),e=jQuery(e).val(),r=jQuery(".end-date-filter",t),o=jQuery(".end-date-icon-filter",t),n=t.find("input[type='text']:first"),i=jQuery(".start-date-operator",t);i.val(e),"between"==e?(i.val("cas_gte"),r.val("").removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"cast_between"===e?(i.val("cast_gte"),r.val("").removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"yd"===e?(startOf=moment().locale("en").subtract(1,"days").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&(startOf=gregorianToHijri(startOf)),i.val("cast_eq"),n.val(startOf).removeClass("d-none"),r.val("").addClass("d-none"),o.addClass("d-none"),jQuery("#arrivalDateAnd",t).addClass("d-none")):"tday"===e?(startOf=moment().locale("en").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=gregorianToHijri(startOf)),i.val("cast_eq"),n.val(startOf).removeClass("d-none"),r.val("").addClass("d-none"),o.addClass("d-none"),jQuery("#arrivalDateAnd",t).addClass("d-none")):"tomorrow"===e?(startOf=moment().locale("en").add(1,"days").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=gregorianToHijri(startOf)),i.val("cast_eq"),n.val(startOf).removeClass("d-none"),r.val("").addClass("d-none"),o.addClass("d-none"),jQuery("#arrivalDateAnd",t).addClass("d-none")):"tw"===e?(startOf=moment().startOf("week").toDate().format("Y-m-d"),endOf=moment().endOf("week").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=gregorianToHijri(startOf),endOf=gregorianToHijri(endOf)),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"lw"===e?(startOf=moment().subtract(1,"weeks").startOf("week").toDate().format("Y-m-d"),endOf=moment().subtract(1,"weeks").endOf("week").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=gregorianToHijri(startOf),endOf=gregorianToHijri(endOf)),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"nw"===e?(startOf=moment().add(1,"weeks").startOf("week").toDate().format("Y-m-d"),endOf=moment().add(1,"weeks").endOf("week").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=gregorianToHijri(startOf),endOf=gregorianToHijri(endOf)),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"tm"===e?(startOf=moment().startOf("month").toDate().format("Y-m-d"),endOf=moment().endOf("month").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=moment().locale("en").startOf("iMonth").format("iYYYY-iMM-iDD"),endOf=moment().locale("en").endOf("iMonth").format("iYYYY-iMM-iDD")),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"lm"===e?(startOf=moment().subtract(1,"months").startOf("month").toDate().format("Y-m-d"),endOf=moment().subtract(1,"months").endOf("month").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=moment().locale("en").subtract(1,"iMonth").startOf("iMonth").format("iYYYY-iMM-iDD"),endOf=moment().locale("en").subtract(1,"iMonth").endOf("iMonth").format("iYYYY-iMM-iDD")),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"nm"===e?(startOf=moment().add(1,"months").startOf("month").toDate().format("Y-m-d"),endOf=moment().add(1,"months").endOf("month").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=moment().locale("en").add(1,"iMonth").startOf("iMonth").format("iYYYY-iMM-iDD"),endOf=moment().locale("en").add(1,"iMonth").endOf("iMonth").format("iYYYY-iMM-iDD")),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"tq"===e?(startOf=moment().startOf("quarter").toDate().format("Y-m-d"),endOf=moment().endOf("quarter").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=getCurrentYearQuarterInHijri().startOf,endOf=getCurrentYearQuarterInHijri().endOf),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"lq"===e?(startOf=moment().subtract(1,"quarters").startOf("quarter").toDate().format("Y-m-d"),endOf=moment().subtract(1,"quarters").endOf("quarter").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=getPreviousYearQuarterInHijri().startOf,endOf=getPreviousYearQuarterInHijri().endOf),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"ty"===e?(startOf=moment().startOf("year").toDate().format("Y-m-d"),endOf=moment().endOf("year").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=moment().locale("en").startOf("iYear").format("iYYYY-iMM-iDD"),endOf=moment().locale("en").endOf("iYear").format("iYYYY-iMM-iDD")),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):"ly"===e?(startOf=moment().subtract(1,"years").startOf("year").toDate().format("Y-m-d"),endOf=moment().subtract(1,"years").endOf("year").toDate().format("Y-m-d"),0<jQuery(".hijri-date-picker",t).length&&a&&(startOf=moment().locale("en").subtract(1,"iYear").startOf("iYear").format("iYYYY-iMM-iDD"),endOf=moment().locale("en").subtract(1,"iYear").endOf("iYear").format("iYYYY-iMM-iDD")),i.val("cast_gte"),n.val(startOf).removeClass("d-none"),r.val(endOf).removeClass("d-none"),o.removeClass("d-none"),jQuery("#arrivalDateAnd",t).removeClass("d-none")):(r.val("").addClass("d-none"),o.addClass("d-none"),jQuery("#arrivalDateAnd",t).addClass("d-none"))}function RelateTimeLogTo(e,t,a,r,o,n,i){i=i||!0,n=n||!0;var s=(a=a||{}).hasOwnProperty("task_id")&&a.task_id?"task":"case",l=jQuery("#log-options-menu",e);switch(s){case"task":l.val("task").selectpicker("refresh"),timeLogsDialog.changeTimeLogAction("#log-options-menu",i),timeLogsDialog.setLookupValue("task",a,n);break;case"case":l.val("case").selectpicker("refresh"),timeLogsDialog.changeTimeLogAction("#log-options-menu",i),timeLogsDialog.setLookupValue("case",a,n)}}function taskLocationLookup(e){($lookupField=jQuery("#"+e)).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL()+"tasks/location_autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return{label:e.location,value:e.location,record:e}}))}})},response:function(e,t){},minLength:2,select:function(e,t){for(i in t.item.record)0<t.item.record.id&&jQuery("#task_location_id").val(t.item.record.id)},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function isLayoutRTL(){return"rtl"==jQuery("body").css("direction")}function copyAddressFromLookup(o){o="string"==typeof o?jQuery("#"+o):jQuery(o),jQuery("#copyAddressFromType",o).change(function(){jQuery("#copyAddressFromLookup",o).val("")}),jQuery("#copyAddressFromLookup",o).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim();var r=jQuery("select#copyAddressFromType",o).val();jQuery.ajax({url:getBaseURL()+r+"/autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched,value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return"contacts"==r?{label:e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName,value:e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName,record:e}:"companies"==r?{label:null==e.shortName?e.name:e.name+" ("+e.shortName+")",value:e.name,record:e}:void 0}))}})},open:function(e,t){jQuery("ul",o).css("width",jQuery(".lookup.ui-autocomplete-input",o).parent().width())},response:function(e,t){},minLength:3,select:function(e,t){0<t.item.record.id&&("contacts"==jQuery("select#copyAddressFromType",o).val()?copyAddressFromContact:copyAddressFromCompany)(t.item.record,o)}}),jQuery("#copyAddressFromLookup",o).autocomplete("option","appendTo",jQuery("#copyAddressFromContainer",o))}function copyAddressFromContact(e,t,a){a=a||!1,jQuery("#copyAddressFromLookup",t).val(""),jQuery("#address1",t).focus(),jQuery("#address1",t).val(e.address1),jQuery("#address2",t).val(e.address2),jQuery("#city",t).val(e.city),a?jQuery("#country_id",t).val(e.country_id).selectpicker("refresh"):jQuery("#country_id",t).val(e.country_id).trigger("chosen:updated"),jQuery("#state",t).val(e.state),jQuery("#zip",t).val(e.zip),jQuery("#street_name",t).val(e.street_name),jQuery("#additional_street_name",t).val(e.additional_street_name),jQuery("#building_number",t).val(e.building_number),jQuery("#address_additional_number",t).val(e.address_additional_number),jQuery("#district_neighborhood",t).val(e.district_neighborhood),setTimeout(function(){toggleCopyAddressFrom(t)},100)}function checkLookupValidity(e,t){setTimeout(function(){disableBlurEventToCheckLookupValidity||""!==t.val()||""===e.val()||(pinesMessage({ty:"error",m:_lang.checkLookupValidity.sprintf([e.val()]),d:5e3}),e.val("").focus()),""===e.val()?t.val(""):e.validationEngine("hide")},100)}function resetFormFields(){var e=window.navigator.userAgent.indexOf("MSIE "),t=!!navigator.userAgent.match(/Trident\/7\./);0<e||t?window.location=window.location.href:(jQuery("#resetBtnHidden").click(),jQuery(".data-filter").hide(),jQuery(".checkbox-inline").attr("style","font-weight: normal !important;"),jQuery(".chk-filter").attr("checked",!1),jQuery("#gridFiltersList").length&&0===jQuery("#gridFiltersList").val().length&&"undefined"!=typeof default_active_filters&&jQuery.each(default_active_filters,function(e,t){jQuery(".chk-filter","#"+t.id+"Container").attr("checked",!0),jQuery(".data-filter","#"+t.id+"Container").show()}),jQuery("#resetBtnHiddenV2").click(),jQuery(".empty-value-field").length&&jQuery(".empty-value-field").show(),jQuery(".sf-value").each(function(){void 0!==jQuery(this).attr("data-field")&&"hidden-lookup-input"===jQuery(this).attr("data-field")&&jQuery(".sf-value").attr("data-field","hidden-lookup-input").val("")}),jQuery(".multi-select","#filtersFormWrapper").each(function(e,t){jQuery("option",t).each(function(){return jQuery(this).is(":disabled")?jQuery("li.search-field","#"+jQuery(t).attr("id")+"_chosen").remove():jQuery(t).val("").trigger("chosen:updated"),!1})}),jQuery(".start-date-operator","#filtersFormWrapper").length&&jQuery(".start-date-operator","#filtersFormWrapper").val("cast_eq"))}function clearCaseHiddenFieldsValues(e){jQuery("#contact_company_id",e).val(""),jQuery("#caseCompanyId",e).val(""),jQuery("#caseContactId",e).val(""),jQuery("#referredBy",e).val(""),jQuery("#requestedBy",e).val(""),jQuery("#opponent_member_id",e).val(""),jQuery("#opponentLookup",e).val("")}function subscribe(){jQuery.ajax({beforeSend:function(){jQuery("#loader-global").show()},dataType:"JSON",success:function(e){e&&(jQuery("#loader-global").hide(),e.error?pinesMessage({ty:"information",m:e.error}):(($subscribeTempContainer=jQuery("#subscribe-temp-form").length?$subscribeTempContainer:jQuery('<div id="subscribe-temp-form"></div>').addClass("d-none").appendTo("body")).html(e.html),jQuery("form#subscribe-temp-form",$subscribeTempContainer).submit(),$subscribeTempContainer.remove()))},error:defaultAjaxJSONErrorsHandler,url:getBaseURL()+"subscription/subscribe"})}function uploadInProgress(e,a){jQuery('[name="'+e+'"]').click(function(e){var t=jQuery(this).parents("form:first");return""!==jQuery("#"+a).val()&&t.validationEngine("validate")&&jQuery("#loader-global").show().html('<div class="alert alert-warning" style="opacity: 1; display: block; cursor: auto; width: 300px; margin-left: -29%; margin-top: 25px;height:50px;box-shadow:0px 5px 7px 4px #cccccc;"><a href="#" class="close" data-dismiss="meeting">&times;</a><h4 class="global-notify-title">'+_lang.uploadInProgress+"</h4></div>"),!0})}function collapse(e,t,a,r,o,n,i,s){i=i||!1,s=s||!1,o=o||"fa-solid fa-angle-down",n=n||"fa-solid fa-angle-right",(a=a||!1)?(jQuery("#"+t).toggleClass("d-none"),tgleImgTitle=jQuery("#"+t).hasClass("d-none")?_lang.showDetails:_lang.hideDetails,jQuery("#"+e).find("img").attr("title",tgleImgTitle)):(jQuery("#"+t).toggleClass("d-none"),new_class=jQuery("#"+t).hasClass("d-none")?(old_class=o,n):(old_class=n,o),(i?(jQuery("#"+e).find("svg:last-child").removeClass(old_class).addClass(new_class),jQuery("#"+e).find("i:last-child")):s?jQuery("#"+e).find("svg:first"):(jQuery("#"+e).find("svg").removeClass(old_class).addClass(new_class),jQuery("#"+e).find("i"))).removeClass(old_class).addClass(new_class))}function universalSearchFocus(e,t,a){var r=jQuery("#search-related-object-view"),o=jQuery("#universal-search-slide");r.html('<div class="col-md-12">\n        <h4 class="mb-15 no-margin-top"><strong>'+recentVisitedLang+'</strong></h4>\n    </div><div id="universal-loading"></div>'),jQuery.ajax({beforeSend:function(){},beforeSend:function(){jQuery("#universal-loading").show(),o.animate({width:"400px"},{duration:100,specialEasing:{width:"linear"}}),jQuery("body").addClass("hidden-overflow")},data:{},dataType:"JSON",success:function(e){e.status&&(setTimeout(function(){r.html(e.html)},2e3),o.removeClass("d-none"),jQuery("#universal-search-slide-wrapper").click(function(){jQuery("#universal-search-slide-wrapper").addClass("d-none"),o.animate({width:"0px"},{duration:100,specialEasing:{width:"linear"}}),jQuery("body").removeClass("hidden-overflow")}),jQuery(".tooltip-title").tooltipster(),jQuery("#universal-search-input").focus())},complete:function(){jQuery("#universal-loading").show()},error:defaultAjaxJSONErrorsHandler,type:"POST",url:getBaseURL()+"home/get_recent_search_data"}),jQuery("#universal-search-slide-wrapper").removeClass("d-none")}function universalSearch(e,t,a){var r;jQuery("#search-input").hasClass("d-none")?jQuery("#search-input").removeClass("d-none"):(a=a||!1,t=t||!1,e=e.val(),r=jQuery(".feedback-message-type-error","#feedback-message-container").length,!a&&13!==t||(e.length<2?r||pinesMessageV2({ty:"error",m:_lang.quickSearchMinLength}):quick_search(String(e).trim())))}function closeFormattingField(e,t,a,r){r=r||!1,t.addClass("d-none"),e.removeClass("d-none").focus(),r&&r.addClass("d-none"),a.preventDefault()}function numberFormattingInput(targetField,fieldToDisplay,visualizeDecimalsContainer,visualizeDecimalsCheckbox){visualizeDecimalsContainer=visualizeDecimalsContainer||!1,visualizeDecimalsCheckbox=visualizeDecimalsCheckbox||!1;var fieldValue=eval(targetField.attr("id")+"Value").rawValue,fieldValueToDisplay=(""==fieldValue&&(fieldValue=0),targetField.addClass("d-none"),"");visualizeDecimalsContainer?(visualizeDecimalsContainer.removeClass("d-none"),fieldValueToDisplay=fieldValue.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0],"checked"!=visualizeDecimalsCheckbox.attr("checked")&&(fieldValueToDisplay=parseInt(fieldValueToDisplay))):fieldValueToDisplay=fieldValue.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0],fieldToDisplay.html(""),fieldToDisplay.html(' <span id="capital-text">'+fieldValueToDisplay+'</span>&nbsp;&nbsp;&nbsp;<a href="javascript:;" onclick="'+fieldToDisplay.attr("onclick")+'">'+_lang.edit+"</a>").removeClass("d-none"),new AutoNumeric("#capital-text","float")}function companyCapitalVisualizeDecimalsClick(e,t,a){var r="checked"==e.attr("checked")?"yes":"no";e.val(r),t?jQuery.ajax({beforeSend:function(){},data:{visualizeDecimals:r,companyId:t},dataType:"JSON",success:function(e){e.result||pinesMessage({ty:"error",m:_lang.feedback_messages.updatesFailed}),displayHideCapitalDecimals(r,a)},error:defaultAjaxJSONErrorsHandler,type:"POST",url:getBaseURL()+"companies/capital_visualize_decimals"}):displayHideCapitalDecimals(r,a)}function displayHideCapitalDecimals(e,t){var a=(a=jQuery("#capital",t).val()).replace(/,(?=[\d,]*\.\d{2}\b)/g,""),a=number_format(a,"2",".",","),e=("yes"!=e&&(a=a.replace(/,(?=[\d,]*\.\d{2}\b)/g,""),a=(a=parseInt(a)).toLocaleString()),jQuery("#capitaltoDisplay",t));e.html(' <span id="capital-text">'+a+'</span>&nbsp;&nbsp;&nbsp;<a href="javascript:;" onclick="'+e.attr("onclick")+'">'+_lang.edit+"</a>").removeClass("d-none")}function preventFormPropagation(e){null!=e&&e.preventDefault()}function topStickyRelocate(e){var t=jQuery(window).scrollTop(),a=jQuery("#"+e.affectedDivs.stickyAnchor).offset().top-jQuery("#header_div").height(),r=jQuery("#"+e.affectedDivs.toStick);a<t?!1===jQuery.isEmptyObject(e.cssRules)?r.css(e.cssRules.fixedObject):r.addClass("stick"):!1===jQuery.isEmptyObject(e.cssRules)?r.css(e.cssRules.relativeObject):r.removeClass("stick")}function showHideGridContent(e,t){t="string"==typeof t?jQuery("#"+t):t,0==e.totalRows?(jQuery(".k-grid-header",t).hide(),jQuery(".k-grid-content",t).hide(),jQuery(".k-pager-wrap",t).hide()):(jQuery(".k-grid-header",t).show(),jQuery(".k-grid-content",t).show(),jQuery(".k-pager-wrap",t).show())}function gridScrollRTL(){-1<navigator.userAgent.indexOf("Chrome")&&jQuery(".k-grid-content").css("overflow-y","scroll").css("overflow-x","auto").scroll(function(){var e=jQuery(this).scrollLeft(),t=jQuery(".k-grid-header-wrap");t.scrollLeft()!=e&&t.scrollLeft(e)})}function disableExpiredFields(e){e="string"==typeof e?jQuery("#"+e):e,jQuery(".form-control, .btn",e).each(function(e,t){"submit"!=jQuery(this).attr("type")&&jQuery(this).attr("disabled","disabled")})}function fixOpponentSearchInDialog(){var e=jQuery('.ui-dialog[aria-describedby="newCaseFormDialog"]');e.length&&e.css("z-index","101")}function addGridFilter(r,o,n,i){i=i||0,jQuery.ajax({url:getBaseURL()+"grid_saved_filters/add/"+r+"/"+i,dataType:"JSON",type:"POST",beforeSend:function(){jQuery(".save-filter-as").attr("disabled","disabled"),jQuery("#loader-global").show()},success:function(e){jQuery("#loader-global").hide(),0==jQuery("#gridSavedFilterFormContainer").length&&jQuery('<div id="gridSavedFilterFormContainer" class="d-none"></div>').appendTo("body");var t=jQuery("#gridSavedFilterFormContainer");t.html(e.html).removeClass("d-none"),jQuery(".modal",t).modal({keyboard:!1}),(gridSavedForm=jQuery("form#gridSavedFilterForm",t)).validationEngine({validationEventTrigger:"submit",autoPositionUpdate:!0,promptPosition:"bottomRight",scroll:!1}),jQuery("#saveGridFormBtn").click(function(){var e,a;gridSavedForm.validationEngine("validate")&&(e=prepareGridFilters(n),jQuery("#gridFilters",gridSavedForm).val(JSON.stringify(e)),jQuery("#gridPageSize",gridSavedForm).val(jQuery("#"+o).data("kendoGrid").dataSource.pageSize()),a=[],jQuery("#"+o).data("kendoGrid").options.columns.forEach(function(e,t){""!=e.title.trim()&&a.push(e.field)}),jQuery("#grid-columns",gridSavedForm).val(a.toString()),jQuery("#grid-columns-sort",gridSavedForm).val(JSON.stringify(jQuery("#"+o).data("kendoGrid").dataSource.sort())),jQuery.ajax({data:gridSavedForm.serialize(),beforeSend:function(){jQuery("#saveGridFormBtn").attr("disabled","disabled"),jQuery("#loader-global").show()},success:function(e){jQuery("#loader-global").hide(),e.success?(jQuery(".modal",t).modal("hide"),jQuery("#gridFiltersList").append('<option value="'+e.data.id+'" isGlobalFilter="'+e.data.isGlobalFilter+'">'+jQuery("#filterName",gridSavedForm).val()+"</option>").val(e.data.id),displayGridFiltersActionEvents()):(pinesMessage({ty:"error",m:e.error}),jQuery("#saveGridFormBtn").removeAttr("disabled"))},type:"POST",url:getBaseURL()+"grid_saved_filters/add/"+r+"/"+i}))}),jQuery("#filterName",gridSavedForm).keypress(function(e){13==e.which&&jQuery("#saveGridFormBtn").click()}),jQuery(".modal-body").on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#filterName","#gridSavedFilterForm").focus()})},complete:function(){jQuery("#saveGridFormBtn").removeAttr("disabled"),jQuery(".save-filter-as").removeAttr("disabled")},error:defaultAjaxJSONErrorsHandler})}function browserIsIE(){var e=window.navigator.userAgent.indexOf("MSIE "),t=!!navigator.userAgent.match(/Trident\/7\./);return 0<e||t}function prepareGridFilters(e){var t=jQuery("#"+e),e=(disableEmpty(t),disableUnCheckedFilters(),form2js(e,".",!0)),a="";return(a=e.filter).customFields=e.customFields,enableAll(t),a}function updateGridFilterData(e,t,a){a=prepareGridFilters(a);jQuery.ajax({url:getBaseURL()+"grid_saved_filters/update_data/"+e,dataType:"JSON",type:"POST",data:{gridFilters:JSON.stringify(a),gridPageSize:jQuery("#"+t).data("kendoGrid").dataSource.pageSize()},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery("#loader-global").hide(),e.success?jQuery("#"+t).data("kendoGrid").dataSource.read():pinesMessage({ty:"error",m:_lang.feedback_messages.updatesFailed})},error:defaultAjaxJSONErrorsHandler})}function deleteGridFilter(a){a&&confirm(_lang.confirmationDeleteSelectedFilter)&&jQuery.ajax({url:getBaseURL()+"grid_saved_filters/delete/"+a,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;jQuery("#loader-global").hide(),e.success?(t=jQuery("#gridFiltersList").val(),pinesMessage({ty:"information",m:_lang.deleteRecordSuccessfull}),jQuery("option[value='"+a+"']","#gridFiltersList").remove(),jQuery("tr#"+a,"#manageFiltersTable").remove(),hideGridFiltersActionEvents(),0==jQuery("tr",jQuery("tbody","#manageFiltersTable")).length&&jQuery(".modal",jQuery("#gridManageFiltersContainer")).modal("hide"),""!=t&&t==a&&null!=e.gridDetails&&setGridDetails(e.gridDetails)):pinesMessage({ty:"error",m:e.error||_lang.recordNotDeleted})},error:defaultAjaxJSONErrorsHandler})}function clearGridFilters(t,a){a=a||"",t&&jQuery.ajax({url:getBaseURL()+"grid_saved_filters/load_data/0/"+t,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){if(jQuery("#loader-global").hide(),e.success)switch(t){case"Legal_Case_Hearing":-1!==hearingFixedFilters.indexOf(a)?window.location=getBaseURL()+"cases/"+a:a||(window.location=getBaseURL()+"cases/list_hearings");break;case"awaiting_approvals":"awaiting_my_approvals"===a?window.location=getBaseURL("contract")+"contracts/awaiting_my_approvals":a||(window.location=getBaseURL("contract")+"contracts/awaiting_approvals");break;case"awaiting_signatures":"awaiting_my_signatures"===a?window.location=getBaseURL("contract")+"contracts/awaiting_my_signatures":a||(window.location=getBaseURL("contract")+"contracts/awaiting_signatures");break;default:window.location=window.location.href}else pinesMessage({ty:"error",m:e.error})},error:defaultAjaxJSONErrorsHandler})}function loadGridFilters(e,t,a){e&&jQuery.ajax({url:getBaseURL()+"grid_saved_filters/load_data/"+e,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery("#loader-global").hide(),e.success?setGridFiltersData(e.data,t,!0):pinesMessage({ty:"error",m:e.error})},error:defaultAjaxJSONErrorsHandler})}function hideGridFiltersActionEvents(){jQuery("#submitAndSaveFilter").addClass("d-none")}function displayGridFiltersActionEvents(){jQuery("#submitAndSaveFilter").removeClass("d-none")}function setGridFiltersData(e,t,a){a=a||!1;var r=e.formData.gridFilters;jQuery("#"+t);setGridFormFilters(r),a&&(gridSavedFiltersParams=r),null!=e.gridDetails&&setGridDetails(e.gridDetails),null!=e.client_account&&(jQuery("#accountNameValue","#filtersFormWrapper").length&&jQuery("#accountNameValue").val(e.client_account),jQuery("#accountIDValue","#filtersFormWrapper").length&&jQuery("#accountIDValue").val(e.client_account),jQuery("#supplierAccountValue","#filtersFormWrapper").length)&&jQuery("#supplierAccountValue").val(e.client_account),null==e.outsource_type&&null==e.outsource_to_value&&null==e.outsource_to_function||(jQuery("#outsourceTypeOperator","#filtersFormWrapper").length&&jQuery("#outsourceTypeOperator").val(e.outsource_type),jQuery("#outsourceToValue","#filtersFormWrapper").length&&jQuery("#outsourceToValue").val(e.outsource_to_value),jQuery("#outsourceToFunction","#filtersFormWrapper").length&&jQuery("#outsourceToFunction").val(e.outsource_to_function))}function setGridDetails(e){e.selected_columns&&jQuery("#display-columns").val(e.selected_columns.toString()),gridSavedPageSize=e.grid_saved_details.pageSize||gridDefaultPageSize,gridSavedColumnsSorting=e.grid_saved_details.sort||!1,gridInitialization()}function gridFiltersEvents(t,a,r){1!=loggedUserIsAdminForGrids&&jQuery("#gridGlobalFilterContainer").remove(),jQuery("#gridFiltersContainer").html(jQuery("#gridFiltersTempContainer").html());var e=jQuery("#gridFiltersList",jQuery("#gridFiltersContainer"));e.val()&&-1===hearingFixedFilters.indexOf(e.val())&&"awaiting_my_approvals"!==e.val()&&"awaiting_my_signatures"!==e.val()&&(1!=e.find("option:selected").attr("isGlobalFilter")||1==loggedUserIsAdminForGrids)||hideGridFiltersActionEvents(),e.change(function(){enableQuickSearch=!1;var e=this.value;e?-1!==hearingFixedFilters.indexOf(e)||"awaiting_my_approvals"===e||"awaiting_my_signatures"===e?(hideGridFiltersActionEvents(),clearGridFilters(t,e)):((1==jQuery(this).find("option:selected").attr("isGlobalFilter")&&1!=loggedUserIsAdminForGrids?hideGridFiltersActionEvents:displayGridFiltersActionEvents)(),jQuery(".quick-search-filter").val(""),loadGridFilters(e,a,r),jQuery(".grid-fixed-filter","#"+r).length&&jQuery(".grid-fixed-filter","#"+r).val()):(hideGridFiltersActionEvents(),clearGridFilters(t))}),jQuery("#submitAndSaveFilter").click(function(){e.val()&&updateGridFilterData(e.val(),a,r)})}function setGridFormFilters(e){jQuery("#resetBtnHidden").click(),jQuery(".sf-value").each(function(){jQuery(this).hasClass("multi-select")&&jQuery(this).val("").trigger("chosen:updated")}),jQuery(".data-filter").hide(),jQuery(".checkbox-inline").prop("style","font-weight: normal !important;"),jQuery(".chk-filter").prop("checked",!1);var t=json_decode(e);if(jQuery(".empty-value-field").show(),null!=t.filters)for(var a=0;a<t.filters.length;a++){var r=t.filters[a].filters[0].field,o=jQuery("div").find("[sf-field='"+r+"']"),n=t.filters[a].filters[0].operator,i=t.filters[a].filters[0].value,s=jQuery(".sf-value",o);jQuery(".sf-operator",o).val(n),i&&(jQuery(".chk-filter",o).prop("checked","true"),jQuery(".data-filter",o).show(),jQuery(".checkbox-inline",o).prop("style","font-weight: 600 !important;"),jQuery(".chk-filter",o).parent().parent().insertBefore(jQuery("#sortable .form-group-filter:eq(0)"))),"not_empty"===n||"empty"===n?s.hide():s.show(),jQuery(".sf-operator-list",o).length&&jQuery(".sf-operator-list",o).val("eq"==n||"startswith"==n?"startswith":n),jQuery(".empty-value-field",o).length&&jQuery(".empty-value-field",o).val("eq"==n||"startswith"==n?"startswith":n),s.val(i),s.hasClass("multi-select")&&s.trigger("chosen:updated"),1<t.filters[a].filters.length&&(i=t.filters[a].filters[1].operator,s=t.filters[a].filters[1].value,"clientType"!=r&&"legal_cases.clientType"!=r||"client_foreign_name"!=t.filters[a].filters[1].field&&"legal_cases.client_foreign_name"!=t.filters[a].filters[1].field&&"clientForeignName"!=t.filters[a].filters[1].field&&"legal_cases.clientForeignName"!=t.filters[a].filters[1].field||jQuery(".sf-value",jQuery("div").find("[sf-field='"+t.filters[a].filters[1].field+"']")).val(s),"clientType"!=r&&"legal_cases.clientType"!=r||"clientName"!=t.filters[a].filters[1].field&&"legal_cases.clientName"!=t.filters[a].filters[1].field&&"clients"!=t.filters[a].filters[1].field&&"legal_cases.clients"!=t.filters[a].filters[1].field?(jQuery(".sf-operator-list",o).val("cast_between"),jQuery(".sf-operator2",o).val(i),jQuery(".sf-value2",o).val(s).removeClass("d-none"),jQuery(".end-date-icon-filter",o).removeClass("d-none")):(jQuery(".sf-value",jQuery("div").find("[sf-field='"+t.filters[a].filters[1].field+"']")).val(s),jQuery(".sf-operator",jQuery("div").find("[sf-field='"+t.filters[a].filters[1].field+"']")).val(i)))}if(null!=t.customFields)for(a=0;a<t.customFields.length;a++){r="customFiled-"+t.customFields[a].id,o=jQuery("div").find("[sf-field='"+r+"']"),n=t.customFields[a].operator;switch(jQuery(".chk-filter",o).prop("checked","true"),jQuery(".data-filter",o).show(),jQuery(".checkbox-inline",o).prop("style","font-weight: 600 !important;"),jQuery(".chk-filter",o).parent().parent().insertBefore(jQuery("#sortable .form-group-filter:eq(0)")),t.customFields[a].type){case"date":var l=t.customFields[a].date_value;jQuery(".sf-operator",o).val(n.start),jQuery(".sf-value",o).val(l.start),jQuery(".sf-operator-list",o).length&&jQuery(".sf-operator-list",o).val("eq"==n.start||"startswith"==n.start?"startswith":n.start),void 0!==n.end_date&&(jQuery(".sf-operator-list",o).val("cast_between"),jQuery(".sf-operator2",o).val(n.end),jQuery(".sf-value2",o).val(l.end).removeClass("d-none"),jQuery(".end-date-icon-filter",o).removeClass("d-none"));break;case"date_time":var l=t.customFields[a].date_value,d=t.customFields[a].time_value;jQuery(".sf-operator-date-time",o).length&&jQuery(".sf-operator-date-time",o).val("cast_eq"==n.start||"startswith"==n.start?"cast_eq":n.start),void 0!==l.start&&(jQuery(".sf-operator-start-date",o).val(n.start),jQuery(".sf-value-start-date",o).val(l.start)),void 0!==l.end&&(jQuery(".sf-operator-date-time",o).val("cast_between"),jQuery(".sf-operator-end-date",o).val(n.end),jQuery(".sf-value-end-date",o).val(l.end).removeClass("d-none")),void 0!==d&&(jQuery(".sf-operator-time",o).val(n.time),jQuery(".sf-value-time",o).val(d));break;case"list":var u=t.customFields[a].text_value;jQuery(".sf-operator",o).val(n),jQuery(".sf-value",o).val(u),jQuery(".sf-value",o).trigger("chosen:updated");break;default:u=t.customFields[a].text_value;jQuery(".sf-operator",o).val(n),jQuery(".sf-value",o).val(u)}}loadEventsForFilters()}function manageGridFilters(e,t,a,r){jQuery.ajax({url:getBaseURL()+"grid_saved_filters/manage_filters/"+e,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery("#loader-global").hide(),0==jQuery("#gridManageFiltersContainer").length&&jQuery('<div id="gridManageFiltersContainer" class="d-none"></div>').appendTo("body");var t=jQuery("#gridManageFiltersContainer");t.html(e.html).removeClass("d-none"),jQuery("#advancedSearchEventsFunction").val(r),jQuery(".modal",t).modal({keyboard:!1})},error:defaultAjaxJSONErrorsHandler})}function onthefly_Ajax(e,t,r,a){null!=a&&a.preventDefault(),jQuery(".onthefly_hidden").length<=0&&jQuery('<div class="d-none onthefly_hidden"></div>').appendTo("body"),r=r||"",jQuery.ajax({url:getBaseURL()+e+"/add/",dataType:"JSON",type:"GET",data:{quick_add_form:!0,type:t},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t="",t=jQuery("#"+r),a=jQuery(".onthefly_hidden");a.html(e.html).removeClass("d-none"),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".modal",a).modal("hide"),t.hasClass("ui-dialog-content"))&&(t.dialog("close"),jQuery(".ui-widget-overlay.ui-front").hide())}),jQuery(".modal",a).modal({keyboard:!1,show:!0,backdrop:"static"}),resizeMiniModal(a),jQuery(window).bind("resize",function(){resizeMiniModal(a)}),jQuery("input",a).keypress(function(e){13==e.which&&(e.preventDefault(),jQuery("#ontheflyFormBtn").click())}),jQuery(".modal-body").on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(a)}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#fieldName",a).focus()}),ctrlS(function(){jQuery("#ontheflyFormBtn").click()})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function copyTextToClipboard(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e.trim(),document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.log("Unable to copy")}document.body.removeChild(t)}function deleteCaseRecord(e){var t=_lang.confirmationOfCaseDelete;confirm(t)&&(window.location=getBaseURL()+"cases/delete_case/"+e)}function initPrivateWatchers(e,t,a,r){r=r||!1,jQuery("#"+e,t).selectize({plugins:["remove_button"],persist:!1,maxItems:null,valueField:"id",labelField:"name",searchField:["name"],options:a}),(r?jQuery(".shared-with-label",t):(jQuery(".selectize-control",t).addClass("d-none"),jQuery(".alert",t))).addClass("d-none")}function setAsPrivate(t,e,a,r,o,n){r=r||!1,o=o||!1,a=a||!1,n=n||!1,jQuery.ajax({url:getBaseURL()+e+"/set_privacy",dataType:"JSON",type:"POST",beforeSend:function(){n?jQuery(".loader-submit",t).addClass("loading"):jQuery("#loader-global").show()},success:function(e){e.result&&(jQuery("#privateLink",t).addClass("d-none"),jQuery("#publicLink",t).removeClass("d-none"),jQuery(".shared-with-label",t).addClass("d-none"),jQuery("#private",t).val("yes"),jQuery(".alert-message",t).removeClass("d-none"),n?(jQuery(".lookup-box-container",t).removeClass("d-none"),jQuery("#selected-watchers",t).removeClass("d-none").css("border","solid 1px #ddd"),jQuery(".autocomplete-helper",t).removeClass("d-none"),resizeLookupDropDownWidth(t)):(jQuery("#watchersUsers",t).removeClass("d-none"),jQuery(".selectize-control",t).removeClass("d-none"),jQuery(".alert",t).removeClass("d-none"),r&&o&&Number(r)!=Number(o)&&a[0].selectize.addItem(o,!0)))},complete:function(){n?jQuery(".loader-submit",t).removeClass("loading"):jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function setAsPublic(t,e,a){a=a||!1,jQuery.ajax({url:getBaseURL()+e+"/set_privacy",dataType:"JSON",type:"POST",beforeSend:function(){a?jQuery(".loader-submit").addClass("loading"):jQuery("#loader-global").show()},success:function(e){e.result&&(jQuery("#private",t).val("no"),jQuery("#privateLink",t).removeClass("d-none"),jQuery("#publicLink",t).addClass("d-none"),jQuery(".shared-with-label",t).removeClass("d-none"),jQuery(".alert-message",t).addClass("d-none"),(a?(jQuery(".lookup-box-container",t).addClass("d-none"),jQuery("#selected-watchers",t).addClass("d-none"),jQuery(".autocomplete-helper",t).addClass("d-none"),jQuery(".inline-error",t)):(jQuery("#watchersUsers",t).addClass("d-none"),jQuery(".selectize-control",t).addClass("d-none"),jQuery(".alert",t))).addClass("d-none"))},complete:function(){a?jQuery(".loader-submit").removeClass("loading"):jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function lookUpUsers(e,t,a,r,o,n,i){n=n||!1,i=i||!1;var s=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("firstName")},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:getBaseURL()+(void 0!==n.keyName?"users/autocomplete/active?term=%QUERY&more_filters["+n.keyName+"]=%MORE_FILTERS ":"users/autocomplete/active?term=%QUERY"),replace:function(e,t){var a;return void 0!==n.value?(a=encodeURIComponent(n.value),e.replace("%QUERY",t).replace("%MORE_FILTERS",a)):e.replace("%QUERY",t)},filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});s.initialize(),jQuery(e).typeahead({hint:!1,highlight:!0,minLength:void 0!==n.minLength?n.minLength:0},{source:s.ttAdapter(),display:function(e){return e.firstName+" "+e.lastName},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),header:n?"":'<div class="suggestions-header">'+_lang.allUsers+"</div>"}}).on("typeahead:selected",function(e,t){i.callback&&isFunction(i.callback)&&i.callback(t,r)}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",o).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(e,t){""==e.currentTarget.value&&null==t&&n&&jQuery(".empty","#"+e.currentTarget.form.id).html(n.messageDisplayed),jQuery(".loader-submit",o).removeClass("loading"),highLightFirstSuggestion()}).on("focus",function(){highLightFirstSuggestion()}),void 0===n.resize&&resizeLookupDropDownWidth(r),isFunction(i.onEraseLookup)&&i.onEraseLookup||(i.onEraseLookup=!1),isFunction(i.onClearLookup)&&i.onClearLookup||(i.onClearLookup=!1),lookupCommonFunctions(e,t,a,o,i.onEraseLookup,i.onClearLookup)}function lookUpCases(a,e,t,r,o,n){o=o||!1,n=n||!1;var i=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("fullSubject")},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:getBaseURL()+"cases/autocomplete/active?term=%QUERY"+(o?"&more_filters["+o.keyName+"]=%MORE_FILTERS ":""),filter:function(e){return e},replace:function(e,t){var a;return o?(a=encodeURIComponent(o.value),e.replace("%QUERY",t).replace("%MORE_FILTERS",a)):e.replace("%QUERY",t)},cache:!1,wildcard:"%QUERY"}});i.initialize(),jQuery(a).typeahead({hint:!1,highlight:!0,minLength:2},{source:i.ttAdapter(),display:function(e){return e.caseID+": "+replaceHtmlCharacter(e.subject)},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return'<div title="'+e.fullSubject+'">'+e.caseID+": "+replaceHtmlCharacter(e.subject)+"</div>"}}}).on("typeahead:selected",function(e,t){jQuery(a,r).attr("title",replaceHtmlCharacter(t.fullSubject)),jQuery("#case-subject",r).removeClass("d-none"),jQuery("#case-link",r).attr("href",("IP"==t.category?"intellectual_properties/edit/":"cases/edit/")+t.id),o&&o.resultHandler(t,r),n.callback&&isFunction(n.callback)&&n.callback(t,r)}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",r).removeClass("loading")}),jQuery(a).on("input",function(e){""==jQuery(a,r).val()&&(jQuery(a,r).removeAttr("title"),jQuery("#case-subject",r).addClass("d-none"))}),isFunction(n.onEraseLookup)&&n.onEraseLookup||(n.onEraseLookup=!1),isFunction(n.onClearLookup)&&n.onClearLookup||(n.onClearLookup=!1),lookupCommonFunctions(a,e,t,r,n.onEraseLookup,n.onClearLookup)}function lookUpLocations(e,t,a,r){var o=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("location")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL()+"tasks/location_autocomplete?term=%QUERY",filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});o.initialize(),jQuery(e).typeahead({hint:!1,highlight:!0,minLength:2},{source:o.ttAdapter(),display:function(e){return e.location},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return"<div>"+e.location+"</div>"}}}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",r).removeClass("loading")}),lookupCommonFunctions(e,t,a,r)}function lookupCommonFunctions(e,a,r,o,t,n){t=t||!1,n=n||!1,jQuery(e).on("input",function(e){jQuery(".tt-selectable",".twitter-typeahead").length||(jQuery(a,o).val("").trigger("change"),t&&isFunction(t)&&t()),""===jQuery(this).val()&&n&&isFunction(n)&&n()}),jQuery(e).bind("typeahead:select",function(e,t){jQuery(a,o).val(t.id).trigger("change"),jQuery("div",o).find("[data-field="+r+"]").addClass("d-none"),onSelectLookupCallback&&isFunction(onSelectLookupCallback)&&onSelectLookupCallback(e,t)}),jQuery(e).keydown(function(e){13!==e.which&&9!==e.which&&(jQuery(a,o).val("").trigger("change"),t)&&isFunction(t)&&t()}),setTimeout(function(){},600)}function taskForm(r,o,e,n,i,s){if(licenseHasExpired)return alertLicenseExpirationMsg(),!1;r=r||!1,o=o||0,e=e||0,n=n||!1,i=i||!1,s=s||!1,jQuery.ajax({dataType:"JSON",url:getBaseURL()+"tasks/"+(r?"edit/"+r:"add/"+o+"/"+e+"/"+(n?"/"+n:"")),beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html?jQuery("#task-dialog").length<=0&&(jQuery('<div id="task-dialog"></div>').appendTo("body"),(t=jQuery("#task-dialog")).html(e.html),initTinyTemp("description","#task-dialog","task"),commonModalDialogEvents(t),a=jQuery("#id",t).val(),fixDateTimeFieldDesign(t),loadCustomFieldsEvents("custom-field-",t),jQuery("#save-task-btn",t).click(function(){taskFormSubmit(t,a,i)}),jQuery(t).find("input").keypress(function(e){13==e.which&&taskFormSubmit(t,a,i)}),o&&!r&&jQuery("#caseLookupId",t).val(o),taskFormEvents(t,e),r||jQuery("#type",t).change(function(){assignmentPerType(this.value,"task",t)}),r||!o||s||matterStageMetadata(t,o,n),""===n&&void 0===e.stage_html&&!e.stage_html||s?jQuery("#stage-div",t).html(""):litigationStageDataEvents(e.stage_html,t)):pinesMessage({ty:"error",m:_lang.feedback_messages.privateTaskMeetingMessage})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function conveyancingAddForm(e,t,a,r){return pinesMessage({ty:"warning",m:"You do not have permission to add a conveyancing record as this is an HRA Role"}),!1}function conveyancingForm(r,o,e,n,i,s){if(licenseHasExpired)return alertLicenseExpirationMsg(),!1;r=r||!1,o=o||0,e=e||0,n=n||!1,i=i||!1,s=s||!1,jQuery.ajax({dataType:"JSON",url:getBaseURL()+"legal_opinions/"+(r?"edit_conveyancing/"+r:"add_conveyancing/"+o+"/"+e+"/"+(n?"/"+n:"")),beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html?jQuery("#opinion-dialog").length<=0&&(jQuery('<div id="opinion-dialog"></div>').appendTo("body"),(t=jQuery("#opinion-dialog")).html(e.html),commonModalDialogEvents(t),a=jQuery("#id",t).val(),fixDateTimeFieldDesign(t),loadCustomFieldsEvents("custom-field-",t),jQuery("#save-opinion-btn",t).click(function(){opinionFormSubmit(t,a,i)}),jQuery(t).find("input").keypress(function(e){13==e.which&&opinionFormSubmit(t,a,i)}),o&&!r&&jQuery("#caseLookupId",t).val(o),opinionFormEvents(t,e),r||jQuery("#type",t).change(function(){assignmentPerType(this.value,"opinion",t)}),r||!o||s||matterStageMetadata(t,o,n),""===n&&void 0===e.stage_html&&!e.stage_html||s?jQuery("#stage-div",t).html(""):litigationStageDataEvents(e.stage_html,t)):pinesMessage({ty:"error",m:_lang.feedback_messages.privateOpinionMeetingMessage})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function opinionAddForm(e,t,a,r){r=r||!1,(a=a||!1)?opinionForm(!1,e,!1,t,a,r):opinionForm(!1,e,!1,t)}function opinionForm(r,o,e,n,i,s){if(licenseHasExpired)return alertLicenseExpirationMsg(),!1;r=r||!1,o=o||0,e=e||0,n=n||!1,i=i||!1,s=s||!1,jQuery.ajax({dataType:"JSON",url:getBaseURL()+"legal_opinions/"+(r?"edit/"+r:"add/"+o+"/"+e+"/"+(n?"/"+n:"")),beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html?jQuery("#opinion-dialog").length<=0&&(jQuery('<div id="opinion-dialog"></div>').appendTo("body"),(t=jQuery("#opinion-dialog")).html(e.html),initTinyTemp("background_info","#opinion-dialog","core"),initTinyTemp("detailed_info","#opinion-dialog","core"),initTinyTemp("legal_question","#opinion-dialog","core"),commonModalDialogEvents(t),a=jQuery("#id",t).val(),fixDateTimeFieldDesign(t),loadCustomFieldsEvents("custom-field-",t),jQuery("#save-opinion-btn",t).click(function(){opinionFormSubmit(t,a,i)}),jQuery(t).find("input").keypress(function(e){13==e.which&&opinionFormSubmit(t,a,i)}),o&&!r&&jQuery("#caseLookupId",t).val(o),opinionFormEvents(t,e),r||jQuery("#type",t).change(function(){assignmentPerType(this.value,"opinion",t)}),r||!o||s||matterStageMetadata(t,o,n),""===n&&void 0===e.stage_html&&!e.stage_html||s?jQuery("#stage-div",t).html(""):litigationStageDataEvents(e.stage_html,t)):pinesMessage({ty:"error",m:_lang.feedback_messages.privateOpinionMeetingMessage})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function opinionFormEvents(e,t){setDatePicker("#form-due-date",e),void 0!==t.restricted_by_opinion_reporter&&t.restricted_by_opinion_reporter&&(jQuery("#form-due-date-input",e).attr("disabled","disabled"),tinyMCE.get("background_info").setMode("readonly"),tinyMCE.get("detailed_info").setMode("readonly"),tinyMCE.get("legal_question").setMode("readonly"),jQuery("#assignedToLookUp",e).attr("disabled","disabled"),jQuery("#type",e).attr("disabled","disabled"),jQuery("#quickAddButton",e).attr("disabled","disabled"),jQuery("#reporterLookUp",e).attr("disabled","disabled"),jQuery("#assignToMeLinkId",e).addClass("disabled-anchor"),jQuery("#notify-me-link",e).addClass("disabled-anchor"),jQuery("#date-conversion",e).addClass("disabled-anchor"),jQuery(".assign-to-me-link-id-wrapper",e).addClass("drop-pointer"),jQuery(".restriction-tooltip",e).each(function(){jQuery(this).append('<span title="'+_lang.onlyReporterCanEdit+'" class="tooltip-title m-h-3"><i class="fa-solid fa-circle-question purple_color"></i></span>')})),0<jQuery(".visualize-hijri-date",e).length&&getHijriDate(jQuery("#due-date",e),jQuery("#due-date-container",e)),notifyMeBeforeEvent({input:"due-date-input",inputContainer:"due-date"},e,!0),jQuery(".select-picker","#opinion-dialog").selectpicker(),jQuery("#type","#opinion-dialog").on("shown.bs.select",function(e){jQuery(".dropdown-menu.inner").animate({scrollTop:jQuery(".selected").offset().top},"fast"),jQuery(".modal-body").animate({scrollTop:"0px"},"fast")});t={keyName:"isDeleted",value:"0",resultHandler:fetchCaseRelatedDataToHearingFrom};lookUpCases(jQuery("#caseLookup",e),jQuery("#caseLookupId",e),"legal_case_id",e,t),lookUpUsers(jQuery("#assignedToLookUp",e),jQuery("#assignedToId",e),"assigned_to",jQuery(".assignee-container",e),e),jQuery("#assignedToId",e).change(function(){0<jQuery("#user-relation",e).val()&&0<jQuery("#assignedToId",e).val()&&jQuery("#user-relation",e).val()!==jQuery("#assignedToId",e).val()&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignee})}),lookUpUsers(jQuery("#reporterLookUp",e),jQuery("#reporter-id",e),"reporter",jQuery(".reporter-container",e),e),lookUpOpinionLocations(jQuery("#location",e),jQuery("#opinion_location_id",e),"opinion_location_id",e),lookupPrivateUsers(jQuery("#lookupOpinionUsers",e),"Opinion_Users","#selected_opinion_users","users-lookup-container",jQuery("#opinion-form")),lookupPrivateUsers(jQuery("#contributors-lookup",e),"contributors","#selected-contributors","contributors-container",e),lookUpContracts({lookupField:jQuery("#lookup-contract",e),hiddenId:jQuery("#lookup-contract-id",e),errorDiv:"contract_id"},e),checkBoxContainersValues({"contributors-container":jQuery("#selected-contributors",e)},e),enableDisableOpinionUsersLookup(),initializeModalSize(e)}function enableDisableOpinionUsersLookup(){var e=jQuery("#opinion-dialog"),t=jQuery("#lookupOpinionUsers",e);jQuery("#private",e).is(":checked")?(jQuery(".opinion-users-container",e).removeClass("d-none"),jQuery(".modal-body",e).scrollTo(jQuery("#selected_opinion_users",e)),t.focus()):jQuery(".opinion-users-container",e).addClass("d-none")}function opinionFormSubmit(a,r,o){r=r||!1;var e=new FormData(document.getElementById(jQuery("form#opinion-form",a).attr("id")));e.append("detailed_info",tinymce.activeEditor.getContent()),e.append("legal_question",tinymce.get("legal_question").getContent()),e.append("background_info",tinymce.get("background_info").getContent()),jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery(".modal-save-btn").attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",contentType:!1,cache:!1,processData:!1,url:getBaseURL()+"legal_opinions/"+(r?"edit/"+r:"add"),success:function(e){var t;1<=e.totalNotifications?jQuery("#pendingNotifications").css("display","inline-block").text(e.totalNotifications):jQuery("#pendingNotifications").html(""),jQuery(".inline-error","#opinion-dialog").addClass("d-none"),e.result?(jQuery("#notify-me-before-container",a).is(":visible")&&loadUserLatestReminders("refresh"),e.cloned||"function"!=typeof opinionCallBack||opinionCallBack(),0<jQuery("#my-dashboard").length&&(loadDashboardData("opinions"),pieCharts()),updateGetingStartedSteps("opinion"),t=_lang.feedback_messages.addedNewOpinionSuccessfully.sprintf(['<a href="'+getBaseURL()+"legal_opinions/view/"+e.id+'">'+e.opinion_code+"</a>"]),pinesMessage({ty:"success",m:r?_lang.feedback_messages.updatesSavedSuccessfully:t}),e.cloned?(jQuery("#clone",a).val("no"),assignmentPerType(jQuery("#type",a).val(),"opinion",a)):jQuery(".modal","#opinion-dialog").modal("hide"),isFunction(o)&&o(jQuery("#stage-id").val())):displayValidationErrors(e.validationErrors,a)},complete:function(){jQuery(".modal-save-btn").removeAttr("disabled"),jQuery(".loader-submit",a).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function opinionLocationLookup(e){($lookupField=jQuery("#"+e)).autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL()+"legal_opinions/location_autocomplete",dataType:"json",data:t,error:defaultAjaxJSONErrorsHandler,success:function(e){e.length<1?a([{label:_lang.no_results_matched.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return{label:e.location,value:e.location,record:e}}))}})},response:function(e,t){},minLength:2,select:function(e,t){for(i in t.item.record)0<t.item.record.id&&jQuery("#opinion_location_id").val(t.item.record.id)},open:function(e,t){disableBlurEventToCheckLookupValidity=!0},close:function(e,t){disableBlurEventToCheckLookupValidity=!1}})}function opinionEditForm(e,t,a){a=a||!1,void 0!==t&&t&&t.preventDefault(),a?opinionForm(e,!1,!1,!1,a):opinionForm(e,!1)}function lookUpOpinionLocations(e,t,a,r){var o=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("location")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL()+"legal_opinions/location_autocomplete?term=%QUERY",filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});o.initialize(),jQuery(e).typeahead({hint:!1,highlight:!0,minLength:2},{source:o.ttAdapter(),display:function(e){return e.location},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return"<div>"+e.location+"</div>"}}}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",r).removeClass("loading")}),lookupCommonFunctions(e,t,a,r)}function opinionStatusForm(r,o){r=r||!1,o=o||!1,jQuery.ajax({url:getBaseURL()+"opinion_statuses/"+(r?"edit/"+r:"add"),type:"GET",dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&(t="#opinion-status-container",jQuery(t).length<=0)&&(jQuery("<div id='opinion-status-container'></div>").appendTo("body"),(a=jQuery(t)).html(e.html),commonModalDialogEvents(a),jQuery("#form-submit",a).click(function(){opinionStatusFormSubmit(r,o,a)}),jQuery(a).find("input").keypress(function(e){13==e.which&&(e.preventDefault(),opinionStatusFormSubmit(r,o,a))}),resizeMiniModal(a),jQuery(window).bind("resize",function(){resizeMiniModal(a)}),showToolTip())},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function opinionStatusFormSubmit(e,t,a){e=e||!1,t=t||!1;var r=jQuery("#opinion-status-form",a).serializeArray();t&&r.push({name:"workflow_id",value:t}),jQuery.ajax({url:getBaseURL()+"opinion_statuses/"+(e?"edit/"+e:"add"),type:"POST",dataType:"json",data:r,error:defaultAjaxJSONErrorsHandler,beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery(".modal-save-btn",a).attr("disabled","disabled")},success:function(e){jQuery(".inline-error",a).addClass("d-none"),e.result?(jQuery(".modal",a).modal("hide"),pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),window.location=getBaseURL()+"opinion_workflows/index/"+t):displayValidationErrors(e.validation_errors,a)},complete:function(){jQuery(".modal-save-btn",a).removeAttr("disabled"),jQuery(".loader-submit",a).removeClass("loading")}})}function animateDropdownMenuInGridsV2(e,a){a=a||85,jQuery(".dropdown-toggle","#"+e+" .k-grid-content").click(function(){var e,t=jQuery(this).offset();t=t.top,(e=jQuery(".grid-container").prop("scrollHeight"))<t&&(e=jQuery(".k-grid-content")).animate({scrollTop:e.scrollTop()+a})}),jQuery(".dropdown .dropdown-menu","#"+e+" .k-grid-content").mouseleave(function(){jQuery(this.parentNode).removeClass("open")})}function fixGridHeader(e){var t,a,r,o;e=e||!1,jQuery(".grid-header",".grid-main-container").length?(jQuery("#grid-header-fixed-navbar").length||jQuery(".grid-header",".grid-main-container").wrap('<nav id="grid-header-fixed-navbar"></nav>'),t=jQuery("#header_div").outerHeight(!0),a=jQuery(".k-grid-header-wrap").find("table").width()>screen.width?jQuery(".k-grid-header-wrap").find("table").width():screen.width,jQuery("#grid-scrollable").length&&(jQuery("#grid-header-fixed-navbar","#grid-scrollable").attr("style","width: "+a+"px !important"),jQuery(".grid-container").attr("style","width: "+a+"px !important"),jQuery(".footer-bg").attr("style","width: "+a+"px !important ;background-color:"+jQuery(".footer").css("background-color")+"!important"),jQuery(".nav-money-bg").attr("style","width: "+a+"px !important ;background-color:"+jQuery("#subNavMenu").css("background-color")+"!important"),jQuery(".grid-header").attr("style","width: "+a+"px !important")),a=window.navigator.userAgent.indexOf("MSIE "),r=!!navigator.userAgent.match(/Trident\/7\./),(0<a||r)&&jQuery(".grid-container").css("min-width",jQuery("#header_div").width()),jQuery("#grid-header-fixed-navbar").scrollToFixed({marginTop:t,zIndex:100}),e&&a<0&&!r&&994<jQuery(window).outerWidth()&&jQuery("#grid-header-fixed-navbar","#grid-unscrollable").css("width","inherit"),jQuery("#grid-header-fixed-navbar").next().css("width","inherit"),jQuery("#fixed-navbar").length||(jQuery(".k-grid-toolbar").remove(),jQuery(".k-grid-header").wrap('<nav id="fixed-navbar"></nav>'),jQuery(".k-grid-header").appendTo("#fixed-navbar")),o=-1<navigator.userAgent.indexOf("Chrome"),e&&a<0&&!r&&("arabic"!==_lang.languageSettings.langName||jQuery("#grid-scrollable").length&&"arabic"===_lang.languageSettings.langName&&!o||!jQuery("#grid-scrollable").length&&"arabic"===_lang.languageSettings.langName&&994<jQuery(window).outerWidth())&&jQuery("#fixed-navbar",".grid-main-container").addClass("inherited-width"),a<0&&!r&&"arabic"===_lang.languageSettings.langName&&jQuery(".k-grid-header",".grid-main-container").addClass("padding-right"),t+=jQuery("#grid-header-fixed-navbar").outerHeight(!0),jQuery("#fixed-navbar").scrollToFixed({marginTop:t,zIndex:99}),e&&jQuery("#fixed-navbar","#grid-unscrollable").next().css("width","inherit"),reorderGridPagination(),resizeHeaderAndFooter()):(jQuery(".k-grid-toolbar").wrap('<nav id="fixed-navbar"></nav>'),jQuery(".k-grid-header").appendTo("#fixed-navbar"),jQuery("#fixed-navbar").scrollToFixed({marginTop:jQuery("#header_div").outerHeight(!0)}))}function reorderGridPagination(){0==jQuery(".k-grid-info-refresh",".grid-main-container").length&&(jQuery(".k-pager-refresh",".grid-main-container").wrap('<div class="k-grid-info-refresh"></div>'),jQuery(".k-pager-info",".grid-main-container").appendTo(".k-grid-info-refresh"))}function reinitializeGridFixedNav(){jQuery("#grid-header-fixed-navbar").trigger("detach.ScrollToFixed"),jQuery("#fixed-navbar").trigger("detach.ScrollToFixed"),setTimeout(function(){fixGridHeader(),fixFooterPosition()},400)}function logoPosition(){jQuery("#image").width(jQuery(".logo").width());var e=jQuery(window).height(),t=jQuery("#main-container").height(),e=(e-jQuery(".login-header").height()-t)/5;jQuery("#main-container").css("top",e+"px")}function lookupPrivateUsers(e,a,r,o,n,i){i=i||"",n="#"+n.attr("id");var t=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("firstName")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL()+"users/autocomplete/active?term=%QUERY",filter:function(e){var t=[];return e.forEach(function(e){e.firstName&&(e.firstName=escapeHtml(e.firstName)),e.lastName&&(e.lastName=escapeHtml(e.lastName)),e.email&&(e.email=escapeHtml(e.email)),t.push(e)}),t},cache:!1,wildcard:"%QUERY"}});t.initialize(),jQuery(e).typeahead({hint:!1,highlight:!0,minLength:0},{source:t.ttAdapter(),display:function(e){},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return"<div>"+e.firstName+" "+e.lastName+"</div>"}}}).on("typeahead:selected",function(e,t){setNewBoxElement(r,o,n,{id:t.id,value:t.firstName+" "+t.lastName,name:a,formId:i}),lookupBoxContainerDesign(jQuery("."+o,n))}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",n).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",n).removeClass("loading"),highLightFirstSuggestion()}).on("focus",function(){highLightFirstSuggestion()})}function lookupApproversSignees(e,d,u,c,y,m,p,t,j){p=p||"",j=j||!1,m="#"+m.attr("id");t="approval"==t?"approver":"signee",t=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("firstName")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL("contract")+"contracts/approvers_signees_autocomplete?term=%QUERY&lookup_field="+t,filter:function(e){var t=[];return e.forEach(function(e){e.firstName&&(e.firstName=escapeHtml(e.firstName)),e.lastName&&(e.lastName=escapeHtml(e.lastName)),e.type&&(e.type=escapeHtml(e.type)),t.push(e)}),t},cache:!1,wildcard:"%QUERY"}});t.initialize(),jQuery(e).typeahead({hint:!1,highlight:!0,minLength:0},{source:t.ttAdapter(),display:function(e){},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return"<div>"+e.firstName+" "+e.lastName+" ("+e.type+")</div>"}}}).on("typeahead:selected",function(e,t){var a=jQuery(c,m),r=jQuery("."+y,m),o=t.id,n=t.type,t=t.firstName+" "+t.lastName,i=d,s=u,l=p,r=(lookupBoxContainerDesign(r),n+o);o&&!jQuery("#"+r,a).length&&(l=null!=l&&l?'form="'+l+'"':"",j?(jQuery("tbody",m).attr("data-count-row"),a.append(jQuery('<div class="col-md-12 padding-a-5"><div class="multi-option-selected-items-new padding-a-5" id="'+r+'"><span id="'+n+o+'" class="padding-h-5"><span class="selected-name">'+t+"</span> ("+n+')</span><input type="hidden" value="'+o+'" name="'+i+'"'+l+' /><input type="hidden" value="'+n+'" name="'+s+'"'+l+' /><a href="javascript:;" class="btn btn-sm btn-link pull-right remove-button" tabindex="-1" onclick="removeBoxElement(jQuery(this.parentNode),\''+c+"','"+y+"','"+m+'\');"><i class="fa fa-remove margin-bottom-15"></i></a></div></div>'))):a.append(jQuery('<div class="m-0 col-md-6 padding-a-5" id="box-'+n+o+'"><div class="col-md-12 multi-option-selected-items-new padding-a-5" id="'+r+'"><span id="'+n+o+'" class="padding-h-5"><span class="selected-name">'+t+"</span> ("+n+')</span><input type="hidden" value="'+o+'" name="'+i+'"'+l+' /><input type="hidden" value="'+n+'" name="'+s+'"'+l+' /><a href="javascript:;" class="btn btn-sm btn-link pull-right remove-button" tabindex="-1" onclick="removeBoxElement(\'#box-'+n+o+"', '"+c+"','"+y+"','"+m+'\');"><i class="fa fa-remove"></i></a></div></div>'))),lookupBoxContainerDesign(jQuery("."+y,m))}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",m).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",m).removeClass("loading"),highLightFirstSuggestion()}).on("focus",function(){highLightFirstSuggestion()})}function destroyModal(e){e.remove()}function contractSubTypeFormEvents(e,t){e=e||!1,(t=t||!1).id?(jQuery("#type","#"+e).val(jQuery("#type-id",".administration-dialog-container").val()).selectpicker("refresh"),contractTypeEvent(jQuery("#type","#"+e).val(),jQuery("#sub-type","#"+e),t.id)):jQuery("#type-id",".administration-dialog-container").val(jQuery("#type","#"+e).val())}function quickAdministrationDialog(o,n,s,t,l,d,a,e,u){s=s||!1,t=t||"",a=a||!1,l=l||!1,u=u||!1,d=d||!1,url=((e=e||!1)?getBaseURL(e):getBaseURL())+o+"/add/",jQuery.ajax({url:url,dataType:"JSON",type:"GET",data:{quick_add_form:!0,is_new_form:!0},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var r;e.html&&jQuery(".administration-dialog-container").length<=0&&(jQuery('<div class="d-none administration-dialog-container"></div>').appendTo("body"),(r=jQuery(".administration-dialog-container")).html(e.html).removeClass("d-none"),a&&r.find(".modal-title").html(a),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",r).modal("hide")}),jQuery(".modal",r).modal({keyboard:!1,show:!0,backdrop:"static"}),resizeMiniModal(r),jQuery(window).bind("resize",function(){resizeMiniModal(r)}),"function"==typeof u&&u(jQuery(n).attr("id")),jQuery(".select-picker",r).selectpicker({dropupAuto:!1}),jQuery("#administration-dialog-submit").click(function(){var e=jQuery("form#administration-dialog-form",r).serializeArray();t&&e.push({name:"caseType",value:t}),jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",r).addClass("loading"),jQuery("#administration-dialog-submit",r).attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",url:url,success:function(e){if(jQuery(".inline-error",r).html(""),void 0!==e.validationErrors)for(i in e.validationErrors)jQuery(".validation-error-container","#administration-dialog-form").removeClass("d-none"),jQuery("div",r).find("[data-field="+i+"]").html(e.validationErrors[i]);else{jQuery(".modal",r).modal("hide");var t="administration-"+o,a=jQuery("div",n).find("[data-field="+t+"]");"administration-task_locations"==t?(jQuery("#task_location_id",n).val(e.id),a.val(e.name),jQuery(".twitter-typeahead",n).length&&(jQuery(a).typeahead("destroy"),lookUpLocations(a,jQuery("#task_location_id",n),"task_location_id"))):(a.append(jQuery("<option/>",{value:e.id,text:e.name})),(d||a).val(e.id),s?a.selectpicker("refresh"):a.trigger("chosen:updated")),"function"==typeof l&&setTimeout(function(){l(jQuery(n).attr("id"),e)},50),s||(setTimeout(function(){location.reload()},1e3),pinesMessageV2({ty:"success",m:_lang.feedback_messages.recordSaved}))}"task_types"===o&&enableDisableTaskUsersLookup()},complete:function(){jQuery(".loader-submit",r).removeClass("loading"),jQuery("#administration-dialog-submit",r).removeAttr("disabled")},error:defaultAjaxJSONErrorsHandler})}),jQuery("input",r).keypress(function(e){13==e.which&&(e.preventDefault(),jQuery("#administration-dialog-submit",r).click())}),jQuery(".modal-body").on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(r)}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#field-name",r).focus()}),ctrlS(function(){jQuery("#administration-dialog-submit",r).click()}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function contactAddForm(r,o){if(licenseHasExpired)return alertLicenseExpirationMsg(),!1;var n=Math.round(Math.random()*(upperBound-lowerBound)+lowerBound),e="";companyContactFormMatrix.contactDialog.customData&&companyContactFormMatrix.contactDialog.customData.fromAdvisor&&(e="?fromAdvisor=true"),jQuery.ajax({dataType:"JSON",url:getBaseURL()+(o?"contacts/clone_contact/"+o:"contacts/add"+e),beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&(t="#contact-dialog-"+n,jQuery(t).length<=0)&&(jQuery('<div id="contact-dialog-'+n+'"></div>').appendTo("body"),companyContactFormMatrix[t]={referalContainerId:companyContactFormMatrix.contactDialog.referalContainerId,lookupResultHandler:companyContactFormMatrix.contactDialog.lookupResultHandler,lookupValue:companyContactFormMatrix.contactDialog.lookupValue,company:companyContactFormMatrix.contactDialog.company,customData:companyContactFormMatrix.contactDialog.customData},companyContactFormMatrix.contactDialog={},(a=jQuery(t)).html(e.html),jQuery("form",a).attr("id","contact-add-form-"+n),contactAddFormEvents(t),o&&checkBoxContainersValues({"company-lookup-container":jQuery("#selected_companies",a),"nationality-lookup-container":jQuery("#selected_nationalities",a)},a),r||(jQuery(".create-another-button",a).addClass("d-none"),jQuery("#save-contact-btn",a).css("border-radius","4px")),jQuery(".modal",a).modal({keyboard:!1,backdrop:"static",show:!0}),companyContactFormMatrix[t].lookupValue&&jQuery("#firstName",a).val(companyContactFormMatrix[t].lookupValue),null!=companyContactFormMatrix[t].company&&setSelectedCompanyToContact(companyContactFormMatrix[t].company,t),setTimeout(addContactDemo,1500))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function contactAddFormEvents(t){jQuery(".select-picker",t).selectpicker({dropupAuto:!1}),jQuery("#copyAddressFromType",t).on("change",function(){jQuery("#copyAddressFromLookup",t).typeahead("destroy"),lookupTypeToCopyAddress(jQuery("#copyAddressFromLookup",t),jQuery(t))}),setDatePicker(".date-of-birth",t),jQuery(".date-of-birth",t).bootstrapDP("setStartDate","1900-1-1"),jQuery(".date-of-birth",t).bootstrapDP("setEndDate",getCurrentDate()),lookUpNationalities(jQuery("#lookup-nationalities",t),"Contact_Nationalities",jQuery(".nationality-lookup-container",t),t);var e={lookupField:jQuery("#lookupCompanies",t),errorDiv:"companies_contacts",lookupContainer:jQuery(".company-lookup-container",t),resultHandler:setSelectedCompanyToContact};lookUpCompanies(e,jQuery(t)),lookupPrivateUsers(jQuery("#lookup-contact-users",t),"Contact_Users","#selected-watchers","contact-privacy-container",jQuery(t)),lookupTypeToCopyAddress(jQuery("#copyAddressFromLookup",t),jQuery(t),!0),initializeModalSize(t),jQuery("#add-contact-sub-categories",t).click(function(){quickAdministrationDialog("contact_company_sub_categories",t,!0)}),jQuery("#add-contact-title",t).click(function(){quickAdministrationDialog("titles",t,!0)}),jQuery("#privateLink",t).click(function(){setAsPrivate(jQuery("#contact-privacy-container",t),"contacts","","","",!0)}),jQuery("#publicLink",t).click(function(){setAsPublic(jQuery("#contact-privacy-container",t),"contacts",!0)}),jQuery("#show-more-fields",t).click(function(){showMoreFields(t,jQuery("#mobile",t))}),jQuery("#show-less-fields",t).click(function(){showLessFields(t)}),jQuery("#create-another",t).click(function(){cloneDialog(t,contactAddFormSubmit)}),jQuery("#remove-nationality-element",t).click(function(){removeBoxElement(jQuery(this.parentNode),"#selected_nationalities","nationality-lookup-container",t)}),jQuery("#remove-watcher-element",t).click(function(){removeBoxElement(jQuery(this.parentNode),"#selected-watchers","users-lookup-container",t)}),jQuery("#remove-company-element",t).click(function(){removeBoxElement(jQuery(this.parentNode),"#selected_companies","company-lookup-container",t)}),jQuery("#toggle-copy-address-from",t).click(function(){toggleCopyAddressFrom(jQuery(t))}),jQuery("#isLawyerCheck",t).on("change",function(){jQuery("#isLawyer",t).val(this.checked?"yes":"no")}),jQuery("#lawyerForCompanyCheck",t).on("change",function(){jQuery("#lawyerForCompany",t).val(this.checked?"yes":"no")}),jQuery("#shared-with-users",t).click(function(){jQuery("#lookup-contact-users",t).focus()}),jQuery("#save-contact-btn",t).click(function(){contactAddFormSubmit(t)}),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".date-of-birth",t).bootstrapDP("remove"),jQuery(".modal",t).modal("hide"))}),jQuery(t).find("input").keypress(function(e){13==e.which&&contactAddFormSubmit(t)}),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(jQuery(t)),delete companyContactFormMatrix[t]}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("div",t).find("[data-id=title]").focus()})}function removeBoxElement(e,t,a,r){t=jQuery(t,r),a=jQuery("."+a,r);jQuery(e,t).remove(),""==jQuery.trim(t.html())&&(jQuery(".lookup-box-container",a).removeClass("margin-bottom"),jQuery(".autocomplete-helper",a).removeClass("d-none"),t.css("border","none"),t.removeClass("border"))}function cloneDialog(e,t){jQuery("#clone",e).val("yes"),t(e)}function lookupBoxContainerDesign(e){jQuery(".autocomplete-helper",e).addClass("d-none"),jQuery(".lookup-box-container",e).addClass("margin-bottom"),jQuery(".inline-error",e).addClass("d-none")}function checkBoxContainersValues(e,t){for(i in e)""!==jQuery.trim(e[i].html())&&(lookupBoxContainerDesign(jQuery("."+i,t)),e[i].css("border","solid 1px #ddd"))}function setNewBoxElement(e,t,a,r){var o,n=jQuery(e,a),i=(lookupBoxContainerDesign(jQuery("."+t,a)),r.name+r.id);"calendar[attendees]"==r.name&&(i="cases_calendar_attende_"+r.id),r.id&&!jQuery("#"+i,n).length&&(n.css("border","solid 1px #ddd"),jQuery("#meeting-dialog").is(":visible")||jQuery("#case-event-form-container").is(":visible")?jQuery("#meeting-dialog #event-id").val()?(n.append(jQuery('<div class="flex-item-box row multi-option-selected-items no-margin w-100 height-30px"  onmouseout="checkParticipant(\''+r.id+"')\" onmouseover=\"showParticipant('"+r.id+'\')"  id="'+i+'"><img class="img-circle" width="30" src="users/get_profile_picture/'+r.id+'/1" ><span id="'+r.id+'">'+r.value+"</span> </div>").append(jQuery('<input type="hidden" value="'+r.id+'" name="'+r.name+'[]" />')).append(jQuery('<a href="javascript:;" class="btn btn-default btn-sm btn-link pull-right remove-button remove-button-event flex-end-item" tabindex="-1" onclick="removeBoxElement(jQuery(this.parentNode),\''+e+"','"+t+"','"+a+'\');"><i class="fa-solid fa-x"></i></a> <input id="input_participant_'+r.id+'" type="hidden" name="participant[]" value="0" > <input id="input_attend_status_'+r.id+'" type="hidden" name="mandatory[]" value="1" ><a class="attend_status"  href="javascript:;" id="attend_status_'+r.id+'" data-type="optional" onclick="changeAttendStatus(\''+r.id+'\');" ><img width="25" src="assets/images/icons/mark_mandatory.png" ><span></span></a> <a class="attend_status hide"  id="participant_status_'+r.id+'" onclick="changeParticipantStatus(\''+r.id+'\');"  href="javascript:;" ><img class="img-circle tooltipTable"  tooltipTitle="'+_lang.mark_participant+'"  src="assets/images/icons/unparticipant.png" ></a>'))),runTooltipMeeting("#attend_status_"+r.id+" img",_lang.mark_optional),runTooltipMeeting("#participant_status_"+r.id+" img",_lang.mark_participant)):(o=null!=r.formId?'form="'+r.formId+'"':"",n.append(jQuery('<div class="flex-item-box row multi-option-selected-items no-margin w-100 height-30px" id="'+i+'"><img class="img-circle" width="30" src="users/get_profile_picture/'+r.id+'/1" ><span id="'+r.id+'">'+r.value+"</span> </div>").append(jQuery('<input type="hidden" value="'+r.id+'" name="'+r.name+'[]" />')).append(jQuery('<a href="javascript:;" class="btn btn-default btn-sm btn-link pull-right remove-button remove-button-event flex-end-item" tabindex="-1" onclick="removeBoxElement(jQuery(this.parentNode),\''+e+"','"+t+"','"+a+'\');"><i class="fa-solid fa-xmark"></i></a> <input id="input_attend_status_'+r.id+'" type="hidden" name="mandatory[]" value="1" ><a class="attend_status"  href="javascript:;" id="attend_status_'+r.id+'" data-type="optional" onclick="changeAttendStatus(\''+r.id+'\');" ><img width="25" src="assets/images/icons/mark_mandatory.png" ><span></span></a>'))),runTooltipMeeting("#attend_status_"+r.id+" img",_lang.mark_optional)):void 0!==r.isAzure?n.append(jQuery('<div class="flex-item-box row multi-option-selected-items no-margin w-100 height-30px" id="'+i+'"><span id="'+r.id+'">'+r.value+"</span> </div>").append(jQuery('<input type="hidden" value="'+r.email+'" name="users[email][]" />')).append(jQuery('<input type="hidden" value="'+r.firstName+'" name="users[firstname][]" />')).append(jQuery('<input type="hidden" value="'+r.lastName+'" name="users[lastname][]" />')).append(jQuery('<a href="javascript:;" class="btn btn-default btn-sm btn-link pull-right remove-button flex-end-item" tabindex="-1" onclick="removeBoxElement(jQuery(this.parentNode),\''+e+"','"+t+"','"+a+'\');"><i class="fa-solid fa-xmark"></i></a>'))):void 0!==r.isIdp?n.append(jQuery('<div class="flex-item-box row multi-option-selected-items no-margin w-100 height-30px" id="'+i+'"><span id="'+r.id+'">'+r.value+"</span> </div>").append(jQuery('<input type="hidden" class="idp-users" value="'+r.email+'" data-email="'+r.email+'" data-firstname="'+r.firstName+'" data-lastname="'+r.lastName+'" />')).append(jQuery('<a href="javascript:;" class="btn btn-default btn-sm btn-link pull-right remove-button flex-end-item" tabindex="-1" onclick="removeBoxElement(jQuery(this.parentNode),\''+e+"','"+t+"','"+a+'\');"><i class="fa-solid fa-x"></i></a>'))):(o=null!=r.formId&&r.formId?'form="'+r.formId+'"':"",n.append(jQuery('<div class="flex-item-box row multi-option-selected-items no-margin w-100 height-30px" id="'+i+'"><span id="'+r.id+'">'+r.value+"</span> </div>").append(jQuery('<input type="hidden" value="'+r.id+'" name="'+r.name+'[]"  '+o+" />")).append(jQuery('<a href="javascript:;" class="btn btn-default btn-sm btn-link pull-right remove-button flex-end-item" tabindex="-1" onclick="removeBoxElement(jQuery(this.parentNode),\''+e+"','"+t+"','"+a+'\');"><i class="fa-solid fa-xmark"></i></a>')))))}function companyAddForm(){if(licenseHasExpired)return alertLicenseExpirationMsg(),!1;var r=Math.round(Math.random()*(upperBound-lowerBound)+lowerBound);jQuery.ajax({dataType:"JSON",url:getBaseURL()+"companies/add",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&(t="#company-dialog-"+r,jQuery(t).length<=0)&&(jQuery('<div id="company-dialog-'+r+'"></div>').appendTo("body"),companyContactFormMatrix[t]={referalContainerId:companyContactFormMatrix.companyDialog.referalContainerId,lookupResultHandler:companyContactFormMatrix.companyDialog.lookupResultHandler,lookupValue:companyContactFormMatrix.companyDialog.lookupValue},companyContactFormMatrix.companyDialog={},(a=jQuery(t)).html(e.html),jQuery("form",a).attr("id","company-add-form-"+r),jQuery("#name",a).focusout(function(){jQuery("#shortName",a).val(jQuery(this).val().substring(0,14))}),companyAddFormEvents(t),companyContactFormMatrix[t].lookupValue&&jQuery("#name",a).val(companyContactFormMatrix[t].lookupValue),jQuery("#company-group-grid").length&&jQuery("#container-id","#sub-title").val()&&jQuery("#company-id",a).selectpicker("val",jQuery("#container-id","#sub-title").val()),jQuery(".modal",a).modal({keyboard:!1,backdrop:"static",show:!0}),setTimeout(addCompanyDemo,1500))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function companyAddFormEvents(t){jQuery(".select-picker",t).selectpicker({dropupAuto:!1}),0<jQuery(".hijri-date-picker","#cr-released-on-hijri-container").length?(makeFieldsHijriDatePicker({fields:["crReleasedOn"]}),jQuery("#crReleasedOn","#cr-released-on-hijri-container").val(gregorianToHijri(jQuery("#cr-released-on-gregorian","#cr-released-on-hijri-container").val()))):setDatePicker(".cr-released-on",t),lookUpContacts({lookupField:jQuery("#lookup-lawyers",t),lookupContainer:"lawyer-lookup-container",errorDiv:"lookupLawyers",boxName:"companyLawyers",boxId:"#selected-lawyers",resultHandler:setSelectedContactToCompany},jQuery(t),!0),lookupPrivateUsers(jQuery("#lookup-company-watchers",t),"Company_Users","#selected-watchers","company-privacy-container",jQuery(t)),initializeModalSize(t),jQuery("#save-company-btn",t).click(function(){companyAddFormSubmit(t)}),jQuery("#add-legal-type",t).click(function(){quickAdministrationDialog("company_legal_types",t,!0)}),jQuery("#privateLink",t).click(function(){setAsPrivate(jQuery("#company-privacy-container",t),"companies","","","",!0)}),jQuery("#publicLink",t).click(function(){setAsPublic(jQuery("#company-privacy-container",t),"companies",!0)}),jQuery("#show-more-fields",t).click(function(){showMoreFields(t,jQuery("#capitalCurrency",t))}),jQuery("#show-less-fields",t).click(function(){showLessFields(t)}),jQuery("#add-container",t).click(function(){companyContainerForm("",t)}),jQuery("#shared-with-users",t).click(function(){jQuery("#lookup-company-watchers",t).focus()}),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".cr-released-on",t).bootstrapDP("remove"),jQuery(".modal",t).modal("hide"))}),jQuery(t).find("input").keypress(function(e){13==e.which&&companyAddFormSubmit(t)}),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(jQuery(t)),delete companyContactFormMatrix[t]}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#name",t).focus()}),jQuery("#add-company-sub-categories",t).click(function(){quickAdministrationDialog("contact_company_sub_categories",t,!0,!1,!1,!1,_lang.addContactCompanySubCategory)})}function companyContainerForm(a,r){r=r||!1,a=a||"",jQuery.ajax({url:getBaseURL()+"companies/"+(a?"container_edit/"+a:"container_add"),dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;jQuery("#company-container").length<=0&&(jQuery('<div id="company-container"></div>').appendTo("body"),(t=jQuery("#company-container")).html(e.html).removeClass("d-none"),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",t).modal("hide")}),jQuery(".modal",t).modal({keyboard:!1,show:!0,backdrop:"static"}),jQuery("#company-container-submit").click(function(){var e=jQuery("form#company-container-form","#company-container").serializeArray();jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery("#company-container-submit",t).attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",url:getBaseURL()+"companies/"+(a?"container_edit/"+a:"container_add"),success:function(e){if(void 0!==e.validationErrors)for(i in e.validationErrors)jQuery(".validation-error-container",t).removeClass("d-none"),jQuery("div",t).find("[data-field="+i+"]").html(e.validationErrors[i]);else r?(jQuery("#company-id",r).append(jQuery("<option/>",{value:e.records.id,text:e.records.name})),jQuery("#company-id",r).val(e.records.id),jQuery("#company-id",r).selectpicker("refresh")):(jQuery("#company_id").append(jQuery("<option/>",{value:e.records.id,text:e.records.name})),jQuery("#company_id").val(e.records.id).trigger("chosen:updated")),jQuery(".modal",t).modal("hide"),a?pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}):pinesMessage({ty:"success",m:_lang.feedback_messages.addedNewCompanyGroupSuccessfully.sprintf([e.records.companyID])}),jQuery("#companyContainersGrid").length&&jQuery("#companyContainersGrid").data("kendoGrid").dataSource.read(),jQuery("#company-group-grid").length&&window.location.reload()},complete:function(){jQuery(".loader-submit",t).removeClass("loading"),jQuery("#company-container-submit",t).removeAttr("disabled")},error:defaultAjaxJSONErrorsHandler})}),jQuery("input",t).keypress(function(e){13==e.which&&(e.preventDefault(),jQuery("#company-container-submit").click())}),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#name",t).focus()}),ctrlS(function(){jQuery("#company-container-submit").click()}),resizeMiniModal(t))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function getCurrentDate(){return new Date}function lookUpContacts(a,r,o,n,i){n=n||!1,o=o||!1,i=i||!1,a.onEraseLookup=a.onEraseLookup||!1,a.onChangeEvent=a.onChangeEvent||!1;var e=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("")},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:getBaseURL()+(n?"contacts/autocomplete?term=%QUERY&more_filters["+n.keyName+"]=%MORE_FILTERS ":"contacts/autocomplete?term=%QUERY&show_email="+i),replace:function(e,t){var a;return n?(a=encodeURIComponent(n.value),e.replace("%QUERY",t).replace("%MORE_FILTERS",a)):e.replace("%QUERY",t)},filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});e.initialize(),jQuery(a.lookupField).typeahead({hint:!1,highlight:!0,minLength:3},{source:e.ttAdapter(),display:function(e){if(!o)return(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName)+(i?null!=e.email?" ("+e.email+")":" <span class='text-danger'>("+_lang.noEmailAddress+")</span>":"")},templates:{empty:['<div class="empty click" ></div>'].join("\n"),suggestion:function(e){return foreignFullName=e.foreignFullName.trim(),"<div>"+(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName)+(foreignFullName?" - "+foreignFullName:"")+(i?null!=e.email?" ("+e.email+")":" <span class='text-danger'>("+_lang.noEmailAddress+")</span>":"")+"</div>"}}}).on("typeahead:selected",function(e,t){o&&(jQuery("div",jQuery("."+a.lookupContainer,r)).find("[data-field="+a.errorDiv+"]").addClass("d-none"),lookupBoxContainerDesign(jQuery("."+a.lookupContainer,r)),setNewBoxElement(a.boxId,a.lookupContainer,"#"+r.attr("id"),{id:t.id,value:(t.father?t.firstName+" "+t.father+" "+t.lastName:t.firstName+" "+t.lastName)+(i?null!=t.email?" ("+t.email+")":" <span class='text-danger'>("+_lang.noEmailAddress+")</span>":""),name:a.boxName}))}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(e,t){null==t&&(countDialog("contact-dialog-")<2?jQuery(".empty",r).html(_lang.no_results_matched_add.sprintf([a.lookupField.val()])).attr("onClick",'triggerAddContact("'+a.lookupField.val()+'",'+a.resultHandler+',"'+r.attr("id")+'")'):jQuery(".empty",r).html(_lang.no_results_matched).removeClass("click").attr("onClick","")),""==e.currentTarget.value&&null==t&&n&&jQuery(".empty","#"+e.currentTarget.form.id).html(n.messageDisplayed),jQuery(".loader-submit",r).removeClass("loading")}).on("focus",function(){highLightFirstSuggestion()}).on("typeahead:change",function(){a.onChangeEvent&&isFunction(a.onChangeEvent)&&a.onChangeEvent()}),o||lookupCommonFunctions(a.lookupField,a.hiddenId,a.errorDiv,r,a.onEraseLookup)}function lookUpLegalCaseContainers(a,r,o){a.callback=a.callback||{},a.callback.onEraseLookup=a.callback.onEraseLookup||!1,a.callback.onSelect=a.callback.onSelect||!1,a.callback.onChange=a.callback.onChange||!1;o=o||!1;var e=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL()+"case_containers/autocomplete?term=%QUERY",filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});e.initialize(),jQuery(a.lookupField).typeahead({hint:!1,highlight:!0,minLength:1},{source:e.ttAdapter(),display:function(e){if(!o)return e.subject},templates:{empty:['<div class="empty"></div>'].join("\n"),suggestion:function(e){return"<div>"+e.subject+"</div>"}}}).on("typeahead:selected",function(e,t){selected=t,o?(jQuery("div",jQuery("."+a.lookupContainer,r)).find("[data-field="+a.errorDiv+"]").addClass("d-none"),lookupBoxContainerDesign(jQuery("."+a.lookupContainer,r)),setNewBoxElement(a.boxId,a.lookupContainer,"#"+r.attr("id"),{id:t.id,value:t.subject,name:a.boxName})):a.callback.onSelect&&isFunction(a.callback.onSelect)?a.callback.onSelect(t):jQuery("#legal-case-related-container-link").length&&jQuery("#legal-case-related-container-link").removeClass("d-none").text("MC"+t.id).attr("href",getBaseURL()+"case_containers/edit/"+t.id)}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(e,t){null==t&&jQuery(".empty",r).html(_lang.no_results_matched),jQuery(".loader-submit",r).removeClass("loading")}).on("typeahead:active",function(e){selected=null,originalVal=jQuery(a.lookupField).typeahead("val")}).on("typeahead:change",function(e,t){a.callback.onChange&&isFunction(a.callback.onChange)?a.callback.onChange(e,t):"undefined"==typeof selected||selected||jQuery(a.lookupField).typeahead("val",originalVal)}),o||(isFunction(a.callback.onEraseLookup)&&a.callback.onEraseLookup||(a.callback.onEraseLookup=!1),lookupCommonFunctions(a.lookupField,a.hiddenId,a.errorDiv,r,a.callback.onEraseLookup))}function setSelectedContactToApprover(e,t){setNewBoxElement("#selected-contacts","contact-lookup-container",t,{id:e.id,value:(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName)+(null!=e.email?" ("+e.email+")":" <span class='text-danger'>("+_lang.noEmailAddress+")</span>"),name:"approverContacts"}),jQuery(".twitter-typeahead",t).length&&(jQuery("#lookup-contacts",t).val("").typeahead("destroy"),lookUpContacts({lookupField:jQuery("#lookup-contacts",t),lookupContainer:"contact-lookup-container",errorDiv:"lookupContacts",boxName:"approverContacts",boxId:"#selected-contacts",resultHandler:setSelectedContactToApprover},jQuery(t),!0))}function setSelectedContactToSignee(e,t){setNewBoxElement("#selected-signees","contact-lookup-container",t,{id:e.id,value:(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName)+(null!=e.email?" ("+e.email+")":" <span class='text-danger'>("+_lang.noEmailAddress+")</span>"),name:"signeeContacts"}),jQuery(".twitter-typeahead",t).length&&(jQuery("#lookup-contacts",t).val("").typeahead("destroy"),lookUpContacts({lookupField:jQuery("#lookup-contacts",t),lookupContainer:"contact-lookup-container",errorDiv:"lookupContacts",boxId:"#selected-signees",boxName:"signeeContacts",resultHandler:setSelectedContactToSignee},jQuery(t),!0))}function getCompanyGridTemplate(e,t,a,r){return"Company"==e&&"Group"==t?a:"Company"===e?'<a href="'+getBaseURL()+"companies/tab_company/"+r+'">'+a+"</a>":'<a href="'+getBaseURL()+"contacts/edit/"+r+'">'+a+"</a>"}function litigationCaseAddForm(a,r,o){if(r=r||!1,o=o||!1,a=a||!1,licenseHasExpired)return alertLicenseExpirationMsg(),!1;var e=0<a?getBaseURL()+"cases/add_litigation/"+a:getBaseURL()+"cases/add_litigation";jQuery.ajax({dataType:"JSON",url:e,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?jQuery("#litigation-dialog").length<=0&&(jQuery('<div id="litigation-dialog"></div>').appendTo("body"),(t=jQuery("#litigation-dialog")).html(e.html),caseAddFormEvents(t),r&&(jQuery("#remarks",t).val(_lang.remarksAppealCase+" "+o),jQuery('<input type="hidden" id="related_appeal_case_id" name="related_appeal_case_id" value="'+o+'" />').appendTo("#litigation-add-form")),a&&jQuery("#legal-case-related-container-id",t).val(jQuery("#id","#caseContainerContainer").val()),opponentsInitialization(jQuery("#opponents-container",t)),jQuery("#case_type_id",t).change(function(){assignmentPerType(this.value,"litigation",t,!0)}),jQuery("#provider-group-id",t).change(function(){assignmentPerType(jQuery("#case_type_id",t).val(),"litigation",t,!1)})):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function legalMatterAddForm(a){if(a=a||!1,licenseHasExpired)return alertLicenseExpirationMsg(),!1;var e=0<a?getBaseURL()+"cases/add_legal_matter/"+a:getBaseURL()+"cases/add_legal_matter";jQuery.ajax({dataType:"JSON",url:e,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?jQuery("#legal-matter-dialog").length<=0&&(jQuery('<div id="legal-matter-dialog"></div>').appendTo("body"),(t=jQuery("#legal-matter-dialog")).html(e.html),caseAddFormEvents(t),a&&jQuery("#legal-case-related-container-id",t).val(jQuery("#id","#caseContainerContainer").val()),jQuery("#case_type_id",t).change(function(){assignmentPerType(this.value,"matter",t,!0)}),jQuery("#provider-group-id",t).change(function(){assignmentPerType(jQuery("#case_type_id",t).val(),"matter",t,!1)})):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function litigationCriminalCaseAddForm(a){if(a=a||!1,licenseHasExpired)return alertLicenseExpirationMsg(),!1;var e=0<a?getBaseURL()+"cases/add_criminal_case/"+a:getBaseURL()+"cases/add_criminal_case/";jQuery.ajax({dataType:"JSON",url:e,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?jQuery("#litigation-dialog").length<=0&&(jQuery('<div id="litigation-dialog"></div>').appendTo("body"),(t=jQuery("#litigation-dialog")).html(e.html),criminalCaseAddFormEvents(t),a&&jQuery("#legal-case-related-container-id",t).val(jQuery("#id","#caseContainerContainer").val()),opponentsInitialization(jQuery("#opponents-container",t)),jQuery("#case_type_id",t).change(function(){assignmentPerType(this.value,"litigation",t,!0)}),jQuery("#provider-group-id",t).change(function(){assignmentPerType(jQuery("#case_type_id",t).val(),"litigation",t,!1)})):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function caseAddFormEvents(t){jQuery(".select-picker",t).selectpicker({dropupAuto:!1}),setDatePicker("#arrival-date-add-new",t),setDatePicker("#filed-on",t),setDatePicker("#due-date-add-new",t),0<jQuery(".visualize-hijri-date",t).length&&(getHijriDate(jQuery("#arrival-date-add-new",t),jQuery("#arrival-date-container",t)),getHijriDate(jQuery("#filed-on",t),jQuery("#filed-on-date-container",t)),getHijriDate(jQuery("#due-date-add-new",t),jQuery("#due-date-container",t))),notifyMeBeforeEvent({input:"due-date-input",inputContainer:"due-date-add-new"},t,!0),initializeModalSize(t),lookupPrivateUsers(jQuery("#lookup-case-users",t),"case_watchers","#selected-watchers","case-privacy-container",t),clientInitialization(t),lookUpContacts({lookupField:jQuery("#lookup-requested-by",t),errorDiv:"requestedBy",hiddenId:"#requested-by",resultHandler:setRequestedByToForm},t),jQuery("#user-id",t).change(function(){"quick_add"==jQuery("#user-id",t).val()?(jQuery("#user-id",t).val("").selectpicker("refresh"),addUserToTheProviderGroup(jQuery("#provider-group-id",t).val(),"user-id",!0)):0<jQuery("#user-relation",t).val()&&jQuery("#user-relation",t).val()!==this.value&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignee})}),lookUpLegalCaseContainers({lookupField:jQuery("#legal-case-related-container-lookup",t),errorDiv:"legal-case-related-container-id",hiddenId:"#legal-case-related-container-id",resultHandler:setLegalCaseContainerToCaseForm},t),jQuery("#provider-group-id",t).change(function(){jQuery("#related-assigned-team",t).val()!==this.value&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignedTeam}),reloadUsersListByProviderGroupSelected(jQuery("#provider-group-id",t).val(),jQuery("#user-id",t),!0)}),jQuery("#case-submit",t).click(function(){caseAddFormSubmit(t)}),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".date-picker",t).bootstrapDP("remove"),jQuery(".modal",t).modal("hide"))}),jQuery(t).find("input").keypress(function(e){13==e.which&&caseAddFormSubmit(t)}),jQuery(".modal-body").on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t),companyContactFormMatrix.commonLookup={}}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#subject",t).focus(),jQuery("#pendingReminders").parent().popover("hide")})}function criminalCaseAddFormEvents(t){jQuery(".select-picker",t).selectpicker({dropupAuto:!1}),setDatePicker("#arrival-date-add-new",t),setDatePicker("#filed-on",t),setDatePicker("#due-date-add-new",t),0<jQuery(".visualize-hijri-date",t).length&&(getHijriDate(jQuery("#arrival-date-add-new",t),jQuery("#arrival-date-container",t)),getHijriDate(jQuery("#filed-on",t),jQuery("#filed-on-date-container",t)),getHijriDate(jQuery("#due-date-add-new",t),jQuery("#due-date-container",t))),notifyMeBeforeEvent({input:"due-date-input",inputContainer:"due-date-add-new"},t,!0),initializeModalSize(t),lookupPrivateUsers(jQuery("#lookup-case-users",t),"case_watchers","#selected-watchers","case-privacy-container",t),clientInitialization(t),lookUpContacts({lookupField:jQuery("#lookup-requested-by",t),errorDiv:"requestedBy",hiddenId:"#requested-by",resultHandler:setRequestedByToForm},t),jQuery("#user-id",t).change(function(){"quick_add"==jQuery("#user-id",t).val()?(jQuery("#user-id",t).val("").selectpicker("refresh"),addUserToTheProviderGroup(jQuery("#provider-group-id",t).val(),"user-id",!0)):0<jQuery("#user-relation",t).val()&&jQuery("#user-relation",t).val()!==this.value&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignee})}),lookUpLegalCaseContainers({lookupField:jQuery("#legal-case-related-container-lookup",t),errorDiv:"legal-case-related-container-id",hiddenId:"#legal-case-related-container-id",resultHandler:setLegalCaseContainerToCaseForm},t),jQuery("#provider-group-id",t).change(function(){jQuery("#related-assigned-team",t).val()!==this.value&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignedTeam}),reloadUsersListByProviderGroupSelected(jQuery("#provider-group-id",t).val(),jQuery("#user-id",t),!0)}),jQuery("#case-submit",t).click(function(){criminalCaseAddFormSubmit(t)}),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".date-picker",t).bootstrapDP("remove"),jQuery(".modal",t).modal("hide"))}),jQuery(t).find("input").keypress(function(e){13==e.which&&criminalCaseAddFormSubmit(t)}),jQuery(".modal-body").on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t),companyContactFormMatrix.commonLookup={}}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#subject",t).focus(),jQuery("#pendingReminders").parent().popover("hide")})}function opponentsInitialization(e,t){t=t||!1;var a=jQuery("#opponents-count",e).val(),r=1;jQuery(".opponent-div",e).each(function(){a<r||(opponentsEvents(opponentContainer=jQuery("#opponent-"+r,e),t),r++)})}function opponentsEvents(e,t){t=t||!1;var a=e.attr("id"),r="#"+a,a=a.charAt(a.length-1),o={lookupField:jQuery("#opponent-lookup",e),hiddenInput:jQuery("#opponent-member-id",e),errorDiv:"opponent_member_id_"+a,resultHandler:setDataToCaseOpponentField,callback:t};jQuery("#opponent-member-type",e).selectpicker().change(function(){jQuery("#opponent-lookup",e).val(""),jQuery("#opponent-member-id",e).val(""),jQuery(".inline-error",e).html(""),jQuery("#opponent-lookup",e).typeahead("destroy"),companyContactFormMatrix.commonLookup[r].lookupType=jQuery("select#opponent-member-type",e).val(),lookupCompanyContactType(o,e)}),jQuery("#opponent-position",e).selectpicker(),companyContactFormMatrix.commonLookup[r]={lookupType:jQuery("select#opponent-member-type",e).val(),referalContainerId:e,parentContainer:e},companyContactFormMatrix.commonLookup[r].callback=t,jQuery("#opponent-lookup",e).typeahead("destroy"),lookupCompanyContactType(o,e)}function opponentAddContainer(e,t,a){var r,o,n,i,s;jQuery(".opponent-div",e).length==a?pinesMessage({ty:"information",m:_lang.caseMaxOpponentsInfo.sprintf([a]),d:1e4}):(a=jQuery("#opponents-container",e),r=parseInt(jQuery("#opponents-count",a).val()),jQuery("#opponent-member-type",jQuery(".opponent-div",a).last()).selectpicker("destroy"),jQuery("#opponent-position",jQuery(".opponent-div",a).last()).selectpicker("destroy"),o=jQuery(".opponent-div",a).last().clone(),i="#opponent-"+(n=r+1),o.insertAfter(jQuery(".opponent-div",a).last()).attr("id","opponent-"+n),jQuery("#opponent-member-type",jQuery("#opponent-"+r,a)).selectpicker(),jQuery("#opponent-position",jQuery("#opponent-"+r,a)).selectpicker(),jQuery("#opponents-count",a).val(n),jQuery(".delete-opponent",jQuery(i,a)).attr("onclick","opponentDelete("+n+",'"+e+"' , event)"),jQuery("#opponent-lookup",jQuery(i,a)).attr("onblur","if (this.value === '') { jQuery('.opponentLinkId','#opponent-"+n+"').addClass('d-none');jQuery(this).attr('title', ''); }"),jQuery(".opponent-label",jQuery(i,a)).html(_lang.opponent+" ("+n+")"),jQuery("#opponent-member-id",jQuery(i,a)).val(""),jQuery("#opponent-lookup",jQuery(i,a)).val(""),jQuery("#opponent-member-type",jQuery(i,a)).find("option").removeAttr("selected"),jQuery("#opponent-position",jQuery(i,a)).find("option").removeAttr("selected"),jQuery(".delete-icon",jQuery(i,a)).removeClass("d-none"),jQuery(".inline-error",jQuery(i,a)).attr("data-field","opponent_member_id_"+n).html(""),jQuery("#opponent-position",jQuery(i,a)).attr("data-field-id","opponent-position-"+n),jQuery(".opponent-position-quick-add",jQuery(i,a)).removeAttr("onClick").click(function(){quickAdministrationDialog("case_opponent_positions",jQuery(e),!0,!1,!1,jQuery("[data-field-id=opponent-position-"+n+"]"))}),1==r&&jQuery(".delete-icon",jQuery("#opponent-"+r,a)).removeClass("d-none"),opponentsEvents(jQuery(i,a),{onselect:onCaseOpponentSelect}),s=jQuery("#litigation-stage-dialog"),jQuery(s).find("input").keypress(function(e){13==e.which&&(e.preventDefault(),litigationStageFormSubmit(s))}),t.preventDefault())}function opponentsUpdateLabels(e){var t=jQuery("#opponents-container",e),a=jQuery("#opponents-count",t).val(),r=1,o=(jQuery(".opponent-label",t).each(function(){if(!(r<=a))return!0;jQuery(this).html(_lang.opponent+" ("+r+")"),r++}),r=1,jQuery(".opponent-div",t).each(function(){if(!(r<=a))return!0;jQuery(this).attr("id","opponent-"+r),r++}),r=1,jQuery(".inline-error",t).each(function(){if(!(r<=a))return!0;jQuery(this).attr("data-field","opponent_member_id_"+r),r++}),r=1,jQuery(".delete-opponent",t).each(function(){if(!(r<=a))return!0;jQuery(this).attr("onclick","opponentDelete("+r+",'"+e+"' , event)"),r++}),r=1,jQuery("[data-field=administration-case_opponent_positions]",t).each(function(){if(!(r<=a))return!0;jQuery(this).attr("data-field-id","opponent-position-"+r),r++}),r=1,jQuery("#opponent-position").hasClass("select-picker"));jQuery(".opponent-position-quick-add",t).each(function(){if(!(r<=a))return!0;jQuery(this).removeAttr("onClick").attr("onclick","quickAdministrationDialog('case_opponent_positions', "+e+"' , "+o+", "+!1+", "+!1+", "+jQuery("[data-field-id=opponent-position-"+r+"]")+")"),r++}),opponentsInitialization(e)}function opponentDelete(e,t,a){var r=jQuery("#opponents-container",t),o=jQuery("#opponents-count",r).val();1<o?(jQuery("#opponent-"+e,r).remove(),companyContactFormMatrix.commonLookup={},jQuery("#opponents-count",r).val(o-1),opponentsUpdateLabels(t),1==jQuery("#opponents-count",r).val()&&jQuery(".delete-icon",r).addClass("d-none")):pinesMessage({ty:"warning",m:_lang.invalid_request}),a.preventDefault()}function clientInitialization(e,t){(t=t||!1)&&(t.clientTypeChange=t.clientTypeChange||!1);var a="#"+e.attr("id"),r=(companyContactFormMatrix.commonLookup[a]={lookupType:jQuery("select#client-type",e).val()},{lookupField:jQuery("#client-lookup",e),hiddenInput:jQuery("#contact-company-id",e),errorDiv:"contact_company_id",resultHandler:setDataToCaseClientField,callback:t});companyContactFormMatrix.commonLookup[a].callback=t,lookupCompanyContactType(r,e),jQuery("#client-type",e).change(function(){t&&r.callback.clientTypeChange&&isFunction(r.callback.clientTypeChange)&&r.callback.clientTypeChange(jQuery("#contact-company-id",e).val()),jQuery("div",e).find("[data-field=contact_company_id]").addClass("d-none").html(""),jQuery(".inline-error",e).html(""),jQuery("#contact-company-id",e).val(""),jQuery("#client-lookup",e).val(""),jQuery("#client-lookup",e).typeahead("destroy"),companyContactFormMatrix.commonLookup[a].lookupType=jQuery("#client-type",e).val(),lookupCompanyContactType(r,e)})}function clientInitializationCaseTypes(e,t,a){(t=t||!1)&&(t.clientTypeChange=t.clientTypeChange||!1);var r="#"+e.attr("id"),o=(companyContactFormMatrix.commonLookup[r]={lookupType:jQuery("select#client-type"+a,e).val()},{lookupField:jQuery("#client-lookup"+a,e),hiddenInput:jQuery("#contact-company-id"+a,e),errorDiv:"contact_company_id"+a,resultHandler:setDataToCaseClientField,callback:t});companyContactFormMatrix.commonLookup[r].callback=t,lookupCompanyContactType(o,e),jQuery("#client-type"+a,e).change(function(){t&&o.callback.clientTypeChange&&isFunction(o.callback.clientTypeChange)&&o.callback.clientTypeChange(jQuery("#contact-company-id"+a,e).val()),jQuery("div",e).find("[data-field=contact_company_id"+a+"]").addClass("d-none").html(""),jQuery(".inline-error",e).html(""),jQuery("#contact-company-id"+a,e).val(""),jQuery("#client-lookup"+a,e).val(""),jQuery("#client-lookup"+a,e).typeahead("destroy"),companyContactFormMatrix.commonLookup[r].lookupType=jQuery("#client-type"+a,e).val(),lookupCompanyContactType(o,e)})}function OutsourceInitialization(e,t){t=t||!1;var a="#"+jQuery(e).attr("id"),r=(companyContactFormMatrix.commonLookup[a]={lookupType:jQuery("select#outsource-type-operator",e).val()},jQuery("#outsource-type-operator").selectpicker(),{lookupField:jQuery("#outsource-lookup",e),hiddenInput:jQuery("#outsource-id",e),errorDiv:"outsource_id",resultHandler:setDataToCaseOutsourceField,callback:t,type:"outsource"});companyContactFormMatrix.commonLookup[a].callback=t,lookupCompanyContactType(r,e),jQuery("#outsource-type-operator",e).change(function(){jQuery("div",e).find("[data-field=outsource_id]").addClass("d-none").html(""),jQuery(".inline-error",e).html(""),jQuery("#outsource-id",e).val(""),jQuery("#outsource-lookup",e).val(""),jQuery("#outsource-lookup",e).typeahead("destroy"),companyContactFormMatrix.commonLookup[a].lookupType=jQuery("#outsource-type-operator",e).val(),lookupCompanyContactType(r,e)})}function setDataToCaseOutsourceField(e,t){var a="#"+jQuery(t).attr("id"),r=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery("#outsource-id",t).val(e.id),jQuery("#outsource-lookup",t).val(r),jQuery(".twitter-typeahead",t).length&&(jQuery("#outsource-lookup",t).typeahead("destroy"),e={lookupField:jQuery("#outsource-lookup",t),hiddenInput:jQuery("#outsource-id",t),errorDiv:"outsource_id",resultHandler:setDataToCaseOutsourceField,callback:companyContactFormMatrix.commonLookup[a].callback},lookupCompanyContactType(e,jQuery(t)))}function addUserToTheProviderGroup(e,r,o){o=o||!1,jQuery.ajax({dataType:"JSON",type:"POST",url:getBaseURL()+"provider_groups/quick_add_user_to_team",data:{modeType:"getForm",id:e},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var a;jQuery("#quick-add-user-team").length||(jQuery('<div id="quick-add-user-team" class="d-none"></div>').appendTo("body"),a=jQuery("#quick-add-user-team"),e.html&&(a.html(e.html).removeClass("d-none"),addUserToTheProviderGroupEvents(a),jQuery("#add-user-submit",a).click(function(){var e=jQuery("form#quick-add-user-provider-group-form",a).serializeArray();jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery("#add-user-submit",a).attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",url:getBaseURL()+"provider_groups/quick_add_user_to_team",success:function(e){if(e.result){pinesMessageV2({ty:"success",m:_lang.feedback_messages.addeNewUserToTeamSuccessfully.sprintf([e.result.user,e.result.user_group_name])}),jQuery(".modal",a).modal("hide");var t='<option selected="selected" value="'+e.result.user_id+'">'+e.result.user+"</option>";o?jQuery("#"+r).append(t).selectpicker("refresh"):jQuery("#"+r).append(t).trigger("chosen:updated")}else if(void 0!==e.validationErrors)for(i in e.validationErrors)jQuery(".validation-error-container",a).removeClass("d-none"),jQuery("div",a).find("[data-field="+i+"]").html(e.validationErrors[i])},complete:function(){jQuery(".loader-submit",a).removeClass("loading"),jQuery("#add-user-submit",a).removeAttr("disabled")},error:defaultAjaxJSONErrorsHandler})})))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function addUserToTheProviderGroupEvents(t){jQuery(".modal",t).modal({keyboard:!1,show:!0,backdrop:"static"}),resizeMiniModal(t),jQuery(window).bind("resize",function(){resizeMiniModal(t)});var e={keyName:"excludedProviderGroupUsers",value:jQuery("#provider-group-id",t).val(),messageDisplayed:_lang.feedback_messages.allUsersAddedToTheTeam};lookUpUsers(jQuery("#user",t),jQuery("#user-id",t),"user_id",jQuery(".assignee-container",t),t,e),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",t).modal("hide")}),jQuery("input",t).keypress(function(e){13==e.which&&(e.preventDefault(),jQuery("#add-user-submit",t).click())}),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#user",t).focus()})}function setDataToCaseOpponentField(e,t){var a="#"+jQuery(t).attr("id"),r=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);t=void 0!==companyContactFormMatrix.commonLookup[a]&&void 0!==companyContactFormMatrix.commonLookup[a].parentContainer?companyContactFormMatrix.commonLookup[a].parentContainer:"#litigation-dialog",jQuery("#opponent-member-id",t).val(e.id),jQuery("#opponent-lookup",t).val(r),onCaseOpponentSelect("",e,t),jQuery(".twitter-typeahead",t).length&&(jQuery("#opponent-lookup",t).typeahead("destroy"),r={lookupField:jQuery("#opponent-lookup",t),hiddenInput:jQuery("#opponent-member-id",t),errorDiv:"opponent_member_id_"+t.attr("id").charAt(t.attr("id").length-1),resultHandler:setDataToCaseOpponentField,callback:companyContactFormMatrix.commonLookup[a].callback,parentContainer:t},lookupCompanyContactType(r,t))}function setDataToCaseClientField(e,t){var a="#"+jQuery(t).attr("id"),r=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery("#contact-company-id",t).val(e.id),jQuery("#client-lookup",t).val(r),onCaseClientSelect("",e,t),jQuery(".twitter-typeahead",t).length&&(jQuery("#client-lookup",t).typeahead("destroy"),r={lookupField:jQuery("#client-lookup",t),hiddenInput:jQuery("#contact-company-id",t),errorDiv:"contact_company_id",resultHandler:setDataToCaseClientField,callback:companyContactFormMatrix.commonLookup[a].callback},lookupCompanyContactType(r,jQuery(t)))}function setReferredByToForm(e,t){var a=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#referredByLookup").val(a),jQuery("#referredBy").val(e.id),jQuery(".twitter-typeahead",t).length&&(jQuery("#referredByLookup",t).typeahead("destroy"),lookUpContacts({lookupField:jQuery("#referredByLookup",t),errorDiv:"referredBy",hiddenId:"#referredBy",resultHandler:setReferredByToForm},jQuery(t))),jQuery("#referredByLinkId",t).length&&0<e.id?jQuery("#referredByLinkId",t).attr("href",getBaseURL()+"contacts/edit/"+e.id).removeClass("d-none"):jQuery("#referredByLinkId",t).addClass("d-none")}function setRequestedByToForm(e,t){var a=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#lookup-requested-by",t).val(a),jQuery("#requested-by",t).val(e.id),jQuery(".twitter-typeahead",t).length&&(jQuery("#lookup-requested-by",t).typeahead("destroy"),lookUpContacts({lookupField:jQuery("#lookup-requested-by",t),errorDiv:"requestedBy",hiddenId:"#requested-by",resultHandler:setRequestedByToForm},jQuery(t))),jQuery("#requestedByLinkId",t).length&&0<e.id?jQuery("#requestedByLinkId",t).attr("href",getBaseURL()+"contacts/edit/"+e.id).removeClass("d-none"):jQuery("#requestedByLinkId",t).addClass("d-none")}function setLegalCaseContainerToCaseForm(e,t){var a=e.subject;jQuery("#legal-case-related-container-lookup",t).val(a),jQuery("#legal-case-related-container-id",t).val(e.id),jQuery(".twitter-typeahead",t).length&&(jQuery("#legal-case-related-container-lookup",t).typeahead("destroy"),lookUpLegalCaseContainers({lookupField:jQuery("#legal-case-related-container-lookup",t),errorDiv:"legal-case-related-container-id",hiddenId:"#legal-case-related-container-id",resultHandler:setLegalCaseContainerToCaseForm},jQuery(t)))}function caseAddFormSubmit(a){var r=jQuery("#action",a).val(),e=jQuery("form",a).serialize();jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery(".btn-save",a).attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",url:getBaseURL()+"cases/"+r,success:function(e){if(jQuery(".inline-error",a).addClass("d-none"),e.result){jQuery("#notify-me-before-container",a).is(":visible")&&loadUserLatestReminders("refresh"),jQuery("#legalCaseGrid").length&&jQuery("#legalCaseGrid").data("kendoGrid").dataSource.read(),"add_legal_matter"==r&&updateGetingStartedSteps("legal_matter"),jQuery("#related-containers-cases-div","#caseContainerContainer").length&&displayRelatedCases();var t=_lang.done_case_n_created.sprintf([getBaseURL()+"cases/edit/"+e.caseId,e.modelCode+e.caseId]);void 0!==e.display_message&&(t=t+"</br>"+e.display_message),0<jQuery("#my-dashboard").length&&(loadDashboardData("matters"),pieCharts()),"add_litigation"==r&&0<jQuery("#litigation-dashboard").length&&loadDashboardData("cases"),pinesMessage({ty:"success",m:t}),jQuery(".modal",a).modal("hide")}else{for(i in jQuery(".inline-error",a).removeClass("validation-error"),e.validationErrors)jQuery("div",a).find("[data-field="+i+"]").removeClass("d-none").html(e.validationErrors[i]).addClass("validation-error");scrollToValidationError(a),void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})}},complete:function(){jQuery(".btn-save",a).removeAttr("disabled"),jQuery(".loader-submit",a).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function criminalCaseAddFormSubmit(a){var r=jQuery("#action",a).val(),e=jQuery("form",a).serialize();jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery(".btn-save",a).attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",url:getBaseURL()+"cases/"+r,success:function(e){if(jQuery(".inline-error",a).addClass("d-none"),e.result){jQuery("#notify-me-before-container",a).is(":visible")&&loadUserLatestReminders("refresh"),jQuery("#legalCaseGrid").length&&jQuery("#legalCaseGrid").data("kendoGrid").dataSource.read(),"add_legal_matter"==r&&updateGetingStartedSteps("legal_matter"),jQuery("#related-containers-cases-div","#caseContainerContainer").length&&displayRelatedCases();var t=_lang.done_criminal_case_n_created.sprintf([getBaseURL()+"cases/complaint_details/"+e.caseId,e.modelCode+e.caseId]);void 0!==e.display_message&&(t=t+"</br>"+e.display_message),0<jQuery("#my-dashboard").length&&(loadDashboardData("matters"),pieCharts()),"add_litigation"==r&&0<jQuery("#litigation-dashboard").length&&loadDashboardData("cases"),pinesMessage({ty:"success",m:t}),jQuery(".modal",a).modal("hide")}else{for(i in jQuery(".inline-error",a).removeClass("validation-error"),e.validationErrors)jQuery("div",a).find("[data-field="+i+"]").removeClass("d-none").html(e.validationErrors[i]).addClass("validation-error");scrollToValidationError(a),void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})}},complete:function(){jQuery(".btn-save",a).removeAttr("disabled"),jQuery(".loader-submit",a).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function linkIpToContainer(e,t){jQuery.ajax({dataType:"JSON",url:getBaseURL()+"case_containers/link_matter",type:"POST",data:{matter_id:e,container_id:t},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result?displayRelatedCases():pinesMessage({ty:"error",m:_lang.updatesFailed})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function setDueDate(e,t){var a;""!=e&&null!=e&&(a=jQuery("#arrival-date-input",t).val(),a=new Date(a),(a=returnDateinFormat(new Date(a.getFullYear(),a.getMonth(),a.getDate()+ +e)))>jQuery("#filed-on-hidden",t).val())&&(jQuery("#due-date-input",t).val(a),setDatePicker("#due-date",t),jQuery("#due-date",t).bootstrapDP("update",a),jQuery("#due-date-hidden",t).val(a),jQuery("#filed-on",t).bootstrapDP("setEndDate",a),jQuery("#notify-me-before-link",t).removeClass("d-none"))}function datesCombination(n,s){for(i in s){var l={minDate:{},maxDate:{}};jQuery("#"+i,n).on("changeDate",function(e){var t=jQuery(this).attr("id"),a=jQuery("#"+t+"-input",n).val(),r=(jQuery("#"+t+"-hidden",n).val(a).trigger("change"),jQuery("#"+t+"-hidden",n).val());if(s[t].minOf)if(jQuery.isArray(s[t].minOf))for(j in s[t].minOf)null==l.minDate[s[t].minOf[j]]&&(l.minDate[s[t].minOf[j]]=r,l.minDate[s[t].minOf[j][t]]=r,l.minDate[s[t].minOf[j][t]]=r,o=l.minDate[s[t].minOf[j]]||-1/0,jQuery("#"+s[t].minOf[j],n).bootstrapDP("setStartDate",o));else{l.minDate[s[t].minOf]=r;var o=l.minDate[s[t].minOf]||-1/0;jQuery("#"+s[t].minOf,n).bootstrapDP("setStartDate",o)}s[t].maxOf&&(l.maxDate[s[t].maxOf]=r,a=l.maxDate[s[t].maxOf]||1/0,jQuery("#"+s[t].maxOf,n).bootstrapDP("setEndDate",a))}),jQuery("#"+i+"-input",n).on("blur",function(){var e=jQuery(this).attr("id"),t=jQuery("#"+e,n).val(),a=e.substring(0,e.length-6);if(""!==jQuery("#"+a+"-hidden",n).val())if(""==t){if(jQuery("#"+a+"-hidden",n).val(""),jQuery.isArray(s[a].minOf))for(j in s[a].minOf)null==l.minDate[s[a].minOf[j]]&&jQuery("#"+s[a].minOf[j],n).bootstrapDP("setStartDate",-1/0);else s[a].minOf&&(l.minDate[s[a].minOf]=t,jQuery("#"+s[a].minOf,n).bootstrapDP("setStartDate",-1/0));s[a].maxOf&&(l.maxDate[s[a].maxOf]=t,jQuery("#"+s[a].maxOf,n).bootstrapDP("setEndDate",1/0))}else jQuery("#"+a+"-hidden",n).val(t).trigger("change"),s[a].minOf&&(l.minDate[s[a].minOf]=t,jQuery("#"+s[a].minOf,n).bootstrapDP("setStartDate",t)),s[a].maxOf&&(l.maxDate[s[a].maxOf]=t,jQuery("#"+s[a].maxOf,n).bootstrapDP("setEndDate",t))})}}function returnDateinFormat(e){var t=e.getFullYear().toString(),a=(e.getMonth()+1).toString(),e=e.getDate().toString(),r=a.split(""),o=e.split("");return t+"-"+(r[1]?a:"0"+r[0])+"-"+(o[1]?e:"0"+o[0])}function intellectualPropertyAddForm(a){if(a=a||!1,licenseHasExpired)return alertLicenseExpirationMsg(),!1;var e=0<a?getBaseURL()+"intellectual_properties/add/"+a:getBaseURL()+"intellectual_properties/add";jQuery.ajax({dataType:"JSON",url:e,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html&&jQuery("#intellectual-property-dialog").length<=0&&(jQuery('<div id="intellectual-property-dialog"></div>').appendTo("body"),(t=jQuery("#intellectual-property-dialog")).html(e.html),intellectualPropertyAddFormEvents(t,a))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function intellectualPropertyAddFormEvents(t,a){jQuery(".select-picker",t).selectpicker({dropupAuto:!1}),setDatePicker("#filed-on",t),setDatePicker("#registration-date",t),0<jQuery(".visualize-hijri-date",t).length&&(getHijriDate(jQuery("#filed-on",t),jQuery("#filed-on-date-container",t)),getHijriDate(jQuery("#registration-date",t),jQuery("#registration-date-container",t))),clientInitialization(t),agentInitialization(t),jQuery("#user-id",t).change(function(){"quick_add"==jQuery("#user-id",t).val()&&(jQuery("#user-id",t).val("").selectpicker("refresh"),addUserToTheProviderGroup(jQuery("#provider-group-id",t).val(),"user-id",!0))}),jQuery("#provider-group-id",t).change(function(){reloadUsersListByProviderGroupSelected(jQuery("#provider-group-id",t).val(),jQuery("#user-id",t),!0)}),lookUpLegalCaseContainers({lookupField:jQuery("#legal-case-related-container-lookup",t),errorDiv:"legal-case-related-container-id",hiddenId:"#legal-case-related-container-id",resultHandler:setLegalCaseContainerToCaseForm},t),initializeModalSize(t),jQuery("#intellectual-property-submit",t).click(function(){intellectualPropertyAddFormSubmit(t,a)}),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".date-picker",t).bootstrapDP("remove"),jQuery(".modal",t).modal("hide"))}),jQuery(t).find("input").keypress(function(e){13==e.which&&intellectualPropertyAddFormSubmit(t,a)}),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("div",t).find("[data-id=intellectual_property_right_id]").focus()})}function intellectualPropertyAddFormSubmit(t,a){var e=jQuery("form",t).serialize();jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".btn-save",t).attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",url:getBaseURL()+"intellectual_properties/add",success:function(e){if(jQuery(".inline-error",t).addClass("d-none"),e.result)jQuery("#intellectualPropertyGrid").length&&jQuery("#intellectualPropertyGrid").data("kendoGrid").dataSource.read(),0<jQuery("#my-dashboard").length&&loadDashboardData("IP"),a&&linkIpToContainer(e.id,jQuery("#id","#caseContainerContainer").val()),pinesMessage({ty:"success",m:_lang.done_case_n_created.sprintf([getBaseURL()+"intellectual_properties/edit/"+e.id,e.id])}),jQuery(".modal",t).modal("hide");else{for(i in jQuery(".inline-error",t).removeClass("validation-error"),e.validationErrors)jQuery("div",t).find("[data-field="+i+"]").removeClass("d-none").html(e.validationErrors[i]).addClass("validation-error");scrollToValidationError(t)}},complete:function(){jQuery(".btn-save",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function agentInitialization(e){var t="#"+e.attr("id"),a=(companyContactFormMatrix.commonLookup[t]={lookupType:jQuery("select#agent-type",e).val()},{lookupField:jQuery("#agent-lookup",e),hiddenInput:jQuery("#agent-id",e),errorDiv:"agentId",resultHandler:setDataToAgentField});lookupCompanyContactType(a,e),jQuery("#agent-type",e).change(function(){jQuery("div",e).find("[data-field=agentId]").addClass("d-none").html(""),jQuery(".inline-error",e).html(""),jQuery("#agent-id",e).val(""),jQuery("#agent-lookup",e).val(""),jQuery("#agent-lookup",e).typeahead("destroy"),companyContactFormMatrix.commonLookup[t].lookupType=jQuery("#agent-type",e).val(),lookupCompanyContactType(a,e)})}function setDataToAgentField(e,t){var a=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery("#agent-id",t).val(e.id),jQuery("#agent-lookup",t).val(a),jQuery(".twitter-typeahead",t).length&&(jQuery("#agent-lookup",t).typeahead("destroy"),e={lookupField:jQuery("#agent-lookup",t),hiddenInput:jQuery("#agent-id",t),errorDiv:"agentId",resultHandler:setDataToAgentField},lookupCompanyContactType(e,jQuery(t)))}function scrollToValidationError(e){jQuery(".modal-body").scrollTo(jQuery("div.validation-error:first",e).parent())}function makeFieldsHijriDatePicker(e){if("function"==typeof jQuery().datetimepickerhijri){var t=e.fields;for(i in t)jQuery("#"+t[i]).datetimepickerhijri({locale:{calender:"ummalqura",lang:"ar"},format:"YYYY-MM-DD"}).on("dp.show dp.update",function(){jQuery(".datepicker-years .picker-switch").removeAttr("title").css("cursor","default").css("background","inherit").on("click",function(e){e.stopPropagation()})}).on("dp.change",function(e){var t=new Date(hijriToGregorian(jQuery("#start-date-hijri","#start-date-hijri-container").val())),a=new Date;jQuery("#id","#hearing-form").val()||(a<t?jQuery(".hide-on-add-future-hearing").addClass("d-none"):jQuery(".hide-on-add-future-hearing").removeClass("d-none")),null!=e.oldDate&&jQuery("#hearing-form").length&&jQuery("#postponed-date-hijri","#postponed-date-hijri-container").length&&(handlePostponeHearing(jQuery("#postponed-date-hijri","#postponed-date-hijri-container").val(),jQuery("#start-date-hijri","#start-date-hijri-container").val(),jQuery("#postponedTime","#postponed-date-hijri-container").val(),jQuery("#sTime","#start-date-hijri-container").val(),"#hearing-form"),t=new Date(hijriToGregorian(jQuery("#start-date-hijri","#start-date-hijri-container").val())),a=new Date,jQuery("#id","#hearing-form").val()||(a<t?jQuery(".hide-on-add-future-hearing").addClass("d-none"):jQuery(".hide-on-add-future-hearing").removeClass("d-none")),t<=a?(jQuery("#time-spent-container").removeClass("d-none"),jQuery("#hearing-time-spent-value").val("1:00")):(jQuery("#time-spent-container").addClass("d-none"),jQuery("#hearing-time-spent-value").val("")))});jQuery(".input-group.date .input-group-addon .fa-calendar").click(function(){jQuery(".hijri-date-picker",jQuery(this).parent().parent()).focus(),jQuery(".hijri-date-picker-container",jQuery(this).parent().parent()).focus(),jQuery(".bootstrap-datetimepicker-widget",jQuery(this).parent().parent()).addClass("d-block")})}}function hideLicenseMessage(){jQuery(".lisence-message").remove(),jQuery("#getting-started-container").length&&(jQuery(".section-img",".next-section").tipsy("hide"),setTimeout(function(){jQuery(".section-img",".next-section").tipsy({position:isLayoutRTL()?"top-left":"top-right",trigger:"manual"}),jQuery(".section-img",".next-section").tipsy("show")},400)),jQuery.ajax({url:getBaseURL()+"home/hide_license_warning/"})}function meetingForm(r,o){if(r=r||!1,o=o||!1,licenseHasExpired)return alertLicenseExpirationMsg(),!1;jQuery.ajax({dataType:"JSON",url:getBaseURL()+"calendars/"+(void 0!==r.ev_id?"edit/"+r.ev_id:"add"),beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&jQuery("#meeting-container").length<=0&&(jQuery('<div id="meeting-container"></div>').appendTo("body"),(t=jQuery("#meeting-container")).html(e.html),meetingFormEvents(t,o),r&&(e=convert(r.start_date),a=convert(r.end_date),jQuery("#title",t).val(r.text),jQuery("#start-date-input",t).val(e.date),jQuery("#start-date",t).bootstrapDP("update",e.date),jQuery("#start-time",t).val(e.time),jQuery("#end-date-input",t).val(a.date),jQuery("#end-date",t).bootstrapDP("update",a.date),jQuery("#end-time",t).val(a.time),r.related_case_id)&&(jQuery("#legal-case-id",t).val(r.related_case_id),jQuery("#case-lookup",t).val(r.related_case_subject),lookUpCases(jQuery("#case-lookup",t),jQuery("#legal-case-id",t),"legal_case_id",t)),jQuery("#date-pair",t).datepair(),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t),scheduler&&!r.ev_id&&scheduler.deleteEvent(r.id)}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function meetingFormEvents(a,e){e=e||!1,initTinyTemp("description","#meeting-container","meeting"),lookUpCases(jQuery("#case-lookup",a),jQuery("#legal-case-id",a),"legal_case_id",a),lookupPrivateUsers(jQuery("#attendees-lookup",a),"attendees","#selected-attendees","attendees-container",a),lookUpLocations(jQuery("#location",a),jQuery("#task_location_id",a),"task_location_id",a),jQuery("#priority",a).selectpicker(),jQuery("#event_types",a).selectpicker(),setDatePicker("#start-date",a),setDatePicker("#end-date",a),0<jQuery(".visualize-hijri-date",a).length&&(getHijriDate(jQuery("#start-date",a),jQuery("#start-date-container",a)),getHijriDate(jQuery("#end-date",a),jQuery("#end-date-container",a))),jQuery("#start-date",a).on("changeDate",function(e){var t=jQuery("#start-date-input",a).val();jQuery("#end-date-input",a).val()<t&&jQuery("#end-date-input",a).val(t),jQuery("#end-date",a).bootstrapDP("setStartDate",t)}),jQuery("#start-time",a).timepicker({timeFormat:"H:i"}),jQuery("#end-time",a).timepicker({timeFormat:"H:i",showDuration:!0}),initializeModalSize(a),checkBoxContainersValues({"attendees-container":jQuery("#selected-attendees",a)},a),jQuery(".modal",a).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".date-picker",a).bootstrapDP("remove"),jQuery(".modal",a).modal("hide"))}),jQuery(a).find("input").keypress(function(e){13==e.which&&meetingFormSubmit(a)}),jQuery(".modal-body",a).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#title",a).focus()}),jQuery("#event-save",a).click(function(){meetingFormSubmit(a,e)}),jQuery(".tooltipTable").each(function(e,t){jQuery(t).tooltipster({content:jQuery(t).attr("tooltipTitle"),contentAsHTML:!0,timer:22800,animation:"grow",delay:200,theme:"tooltipster-default",touchDevices:!1,trigger:"hover",maxWidth:350})})}function meetingFormSubmit(t,a){a=a||!1;var e=new FormData(document.getElementById(jQuery("form",t).attr("id"))),r=(e.append("description",tinymce.activeEditor.getContent()),jQuery("#event-id",t).val());jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".btn-save",t).attr("disabled","disabled")},data:e,dataType:"JSON",type:"POST",contentType:!1,cache:!1,processData:!1,url:getBaseURL()+"calendars/"+(r?"edit/"+r:"add"),success:function(e){if(jQuery(".inline-error",t).addClass("d-none"),e.result)updateGetingStartedSteps("calendar_meeting"),pinesMessage({ty:"success",m:r?_lang.feedback_messages.updatesSavedSuccessfully:_lang.feedback_messages.addedMeetingSuccessfully}),jQuery("#pendingNotifications").css("display","inline-block").text(e.total_notifications),"no"==e.clone?(jQuery(".modal",t).modal("hide"),scheduler&&(scheduler.clearAll(),scheduler.load(getBaseURL()+"calendars/view"))):jQuery("#clone",t).val("no"),0<jQuery("#my-dashboard").length&&loadDashboardData("meetings"),isFunction(a)&&a();else{for(i in jQuery(".inline-error",t).removeClass("validation-error"),e.validation_errors)jQuery("div",t).find("[data-field="+i+"]").removeClass("d-none").html(e.validation_errors[i]).addClass("validation-error");scrollToValidationError(t)}},complete:function(){jQuery(".btn-save",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function enableDisablePrivacy(e,t){jQuery("#private",t).val(jQuery(e).is(":checked")?"yes":"")}function convert(e){var t=("0"+((e=e instanceof Date==!1?new Date(e):e).getMonth()+1)).slice(-2),a=("0"+e.getDate()).slice(-2),r=("0"+e.getHours()).slice(-2),o=("0"+e.getMinutes()).slice(-2);return{date:[e.getFullYear(),t,a].join("-"),time:[r,o].join(":")}}function confirmationDialog(e,a){var t=a.confirmationCategory||"default";a.isKeyJs=a.isKeyJs||!1,jQuery.ajax({url:getBaseURL()+"home/confirm_request/",dataType:"JSON",type:"POST",data:{key_message:e,confirmation_category:t,key_message_js:a.isKeyJs?e:"",confirmation_title:a.confirmationTitle||""},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html&&jQuery(".confirmation-dialog-container").length<=0&&(jQuery('<div class="d-none confirmation-dialog-container"></div>').appendTo("body"),(t=jQuery(".confirmation-dialog-container")).html(e.html).removeClass("d-none"),jQuery(".modal",t).addClass("confirmation-dialog-modal"),jQuery(".modal",t).modal({keyboard:!1,show:!0,backdrop:"static"}),resizeMiniModal(t),jQuery(window).bind("resize",function(){resizeMiniModal(t)}),jQuery("#cancel-confirmation-dialog",t).click(function(){a.onCloseHandler&&a.onCloseHandler(a.onCloseParm||!1)}),jQuery("#confirmation-dialog-submit",t).click(function(){(a.resultHandler?(a.resultHandler(a.parm||!1,void 0!==a.module&&a.module),jQuery(".modal",t)):(jQuery(".modal",t).modal("hide"),a.modelOpen)).modal("hide")}),jQuery("input",t).keypress(function(e){13==e.which&&(e.preventDefault(),jQuery("#confirmation-dialog-submit",t).click())}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function deleteEvent(t){jQuery.ajax({data:{id:scheduler.getEvent(t).ev_id},dataType:"JSON",type:"POST",url:getBaseURL()+"calendars/delete",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result?scheduler.deleteEvent(t):pinesMessage({ty:"warning",m:e.hearing_related?_lang.feedback_messages.deleteMeetingHearingRelatedFailed:_lang.feedback_messages.deleteMeetingFailed})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function resultHandlerAfterCompanyAutocomplete(){return!0}function avatarUploaderForm(){jQuery.ajax({url:getBaseURL()+"users/avatar_uploader",dataType:"JSON",type:"POST",data:{},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html&&jQuery(".user-avatar-container").length<=0&&(jQuery('<div class="d-none user-avatar-container"></div>').appendTo("body"),(t=jQuery(".user-avatar-container")).html(e.html).removeClass("d-none"),jQuery(".modal",t).modal({keyboard:!0,show:!0,backdrop:"static"}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",t).modal("hide")}),jQuery("#avatar-uploader",t).change(function(){jQuery(".loader-submit").addClass("loading"),jQuery("form#avatar-uploader-form",t).submit()}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t),""===jQuery("#display-whats-new").val()?""==userGuide&&"logged"==isloggedIn&&userGuideObject.userGuideSetup():_whatsNew()}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function avatarUploaderFormSubmit(e){avatarNb=jQuery(e).data("id"),jQuery.ajax({url:getBaseURL()+"users/avatar_uploader",dataType:"JSON",type:"POST",data:{avatar_number:avatarNb},beforeSend:function(){jQuery(".loader-submit").addClass("loading")},success:function(e){var t=jQuery(".user-avatar-container");e.result&&(jQuery("#getting-started-container").length&&(jQuery("#user-avatar","#getting-started-container").attr("src","assets/images/avatars/a4l_avatar_"+avatarNb+".png"),updateGetingStartedSteps("avatar")),jQuery("#user-profile").length&&(jQuery("#thumbParentLogo","#user-profile").attr("src","assets/images/avatars/a4l_avatar_"+avatarNb+".png"),jQuery("#thumb-profile-pic","#user-profile").attr("src","assets/images/avatars/a4l_avatar_"+avatarNb+".png")),jQuery(".header-image","#header_div").attr("src","assets/images/avatars/a4l_avatar_"+avatarNb+".png"),pinesMessage({ty:"success",m:_lang.feedback_messages.avatarUpdatedSuccessfully}),jQuery(".modal",t).modal("hide"))},complete:function(){jQuery(".loader-submit").removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function avatarUploaderDone(e){if(e)jQuery(".loader-submit").removeClass("loading"),jQuery("#error-message").html(e);else{if(jQuery("#getting-started-container").length)return window.location.replace(getBaseURL()+"dashboard"),!1;window.location=window.location.href}}function hideGettingStarted(){jQuery.ajax({dataType:"JSON",type:"POST",url:getBaseURL()+"dashboard/getting_started",data:{hide:!0},success:function(){window.location.replace(getBaseURL()+"dashboard")},error:defaultAjaxJSONErrorsHandler})}function updateGettingStartedHelpers(e){var t="legal_matter"==e?"corporate_matter":e,a=(jQuery(".section",".steps-section").removeClass("next-section"),jQuery(".section-img","."+e+"-section").tipsy("hide"),jQuery("."+e+"-section",".steps-section").addClass("next-section"));jQuery(".section-img",a).attr("title","avatar"===e?_lang.startByChoosingAvatar:_lang.startByAdding.sprintf([_lang.custom[t]])),setTimeout(function(){jQuery(".section-img",a).tipsy({position:isLayoutRTL()?"top-left":"top-right",trigger:"manual"}),jQuery(".section-img",a).tipsy("show")},400),jQuery(".next-step").remove(),jQuery("<div class='next-step'></div>").insertAfter("."+e+"-section .section-img"),jQuery(window).bind("resize",function(){jQuery(".section-img",a).tipsy({position:isLayoutRTL()?"top-left":"top-right",trigger:"manual"}),jQuery(".section-img",a).tipsy("show")})}function clientLookup(a){a.lookupField.autocomplete({autoFocus:!0,delay:600,source:function(t,a){t.term=t.term.trim(),jQuery.ajax({url:getBaseURL("money")+"clients/autocomplete",dataType:"json",data:t,success:function(e){e.length<1?a([{label:_lang.no_results_matched.sprintf([t.term]),value:"",record:{id:-1,term:t.term}}]):a(jQuery.map(e,function(e){return{label:e.name,value:e.name,record:e}}))}})},response:function(e,t){},minLength:3,select:function(e,t){void 0!==a.callback&&a.callback(t),0<t.item.record.id&&null!=a.hiddenField&&a.hiddenField.val(t.item.record.id)}})}function fetchCaseClient(t){jQuery.ajax({url:getBaseURL()+"cases/fetch_case_client/"+t.caseId,type:"POST",dataType:"JSON",success:function(e){null!=e.clientId&&null!=e.clientName&&(t.clientHiddenField.val(e.clientId),t.clientLookupField.val(e.clientName),t.clientLookupField.attr("readonly",!0))},error:defaultAjaxJSONErrorsHandler})}function HijriConverter(l,d,u){d=d||!1,u=u||!1,l=l||"";var t=-1/0,a=1/0,c=jQuery("#date-conversion",".visualize-hijri-date");jQuery.ajax({url:getBaseURL()+"home/hijri_date_converter/",type:"POST",dataType:"JSON",success:function(e){var r,o,n,i,s;e.html&&jQuery("#hijri-converter-container").length<=0&&(jQuery('<div id="hijri-converter-container"></div>').appendTo("body"),(r=jQuery("#hijri-converter-container")).html(e.html),moment.locale("arabic"==_lang.languageSettings.langName?"ar-sa":_lang.languageSettings.langName.substr(0,2)),jQuery(".select-picker",r).selectpicker(),setDatePicker("#gregorian",r),jQuery(".modal",r).modal({keyboard:!0,show:!0,backdrop:"static"}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",r).modal("hide")}),jQuery(".modal",r).on("hidden.bs.modal",function(){destroyModal(r)}),l&&(d||(jQuery(l).bootstrapDP("getStartDate")!==-1/0&&(t=moment(jQuery(l).bootstrapDP("getStartDate")).format("YYYY-MM-DD")),jQuery(l).bootstrapDP("getEndDate")!==1/0&&(a=moment(jQuery(l).bootstrapDP("getEndDate")).format("YYYY-MM-DD"))),jQuery("#gregorian",r).bootstrapDP("setStartDate",t),jQuery("#gregorian",r).bootstrapDP("setEndDate",a),o=jQuery("#"+l.attr("id"),l.prevObject.selector),jQuery("#insert-value-to-date-field",r).removeClass("d-none"),n=jQuery("#hijri-year",r),i=jQuery("#hijri-month",r),s=jQuery("#hijri-day",r),(u?(n.val(o.val().substring(0,4)),i.val(o.val().substring(5,7)<=9?o.val().substring(6,7):o.val().substring(5,7)).selectpicker("refresh"),s.val(o.val().substring(8,10)<=9?o.val().substring(9,10):o.val().substring(8,10)).selectpicker("refresh"),toGregorian):(jQuery("#gregorian",r).bootstrapDP("update",(d?l:o).val()),toHijri))(),jQuery("#insert-value-to-date-field",r).on("click",function(){var e,t=jQuery("#gregorian-date",r).val(),a=n.val()+"-"+(9<i.val()?i.val():"0"+i.val())+"-"+(9<s.val()?s.val():"0"+s.val());d?(l.val(u?a:t).datepicker("refresh"),o.val(u?a:t),t&&(e=_lang.hijriDate+": "+toHijri(),l.attr("title",_lang.hijriDate+": "+toHijri()),c.attr("title",_lang.hijriDate+": "+toHijri()))):(l.bootstrapDP("update",u?a:t),t?(e=_lang.hijriDate+": "+toHijri(),o.attr("title",e),c.attr("title",e)):(o.attr("title",""),c.attr("title",_lang.hijriDateConverter)))})),jQuery("#gregorian",r).on("changeDate",function(e){toHijri()}),jQuery("#gregorian-date",r).on("keyup",function(e){toHijri()}),jQuery("#hijri-year",r).on("blur",function(){toGregorian()}),jQuery("#hijri-month",r).on("change",function(){toGregorian()}),jQuery("#hijri-day",r).on("change",function(){toGregorian()}))},error:defaultAjaxJSONErrorsHandler})}function toGregorian(){var e=jQuery("#hijri-converter-container"),t=jQuery("#hijri-year",e).val(),a=jQuery("#hijri-month",e).val(),r=jQuery("#hijri-day",e).val();"Invalid date"!==(m=moment(t+"-"+a+"-"+r,"iYYYY-iM-iD")).format("YYYY-M-D")?jQuery("#gregorian",e).bootstrapDP("update",m.lang("en").format("YYYY-M-D")):jQuery("#gregorian-date",e).val("")}function toHijri(){var e=jQuery("#hijri-converter-container"),t=jQuery("#gregorian-date",e).val();if("Invalid date"!==(m=moment(t)).format("iYYYY-iM-iD"))return jQuery("#hijri-year",e).val(m.iYear()),jQuery("#hijri-month",e).val(m.iMonth()+1).selectpicker("refresh"),jQuery("#hijri-day",e).val(m.iDate()).selectpicker("refresh"),m.format("iYYYY-iMMMM-iD");jQuery("#hijri-year",e).val(""),jQuery("#hijri-month",e).val("").selectpicker("refresh"),jQuery("#hijri-day",e).val("").selectpicker("refresh")}function getHijriDate(e,t,a){var r,o,n=jQuery("#date-conversion",t);a=a||!1,moment.locale("arabic"==_lang.languageSettings.langName?"ar-sa":_lang.languageSettings.langName.substr(0,2)),a?(e.val()?"Invalid date"!==(m=moment(e.val())).format("iYYYY-iM-iD")&&(e.attr("title",_lang.hijriDate+": "+m.format("iYYYY-iMMMM-iD")),n.attr("title",_lang.hijriDate+": "+m.format("iYYYY-iMMMM-iD"))):(e.attr("title",""),n.attr("title",_lang.hijriDateConverter)),jQuery(e).change(function(){r=moment(e.val()),e.val()?(e.attr("title",_lang.hijriDate+": "+r.format("iYYYY-iMMMM-iD")),n.attr("title",_lang.hijriDate+": "+r.format("iYYYY-iMMMM-iD"))):(e.attr("title",""),n.attr("title",_lang.hijriDateConverter))})):((t=(o=jQuery("#"+e.attr("id")+"-input",e.prevObject.selector)).val())?"Invalid date"!==(m=moment(t)).format("iYYYY-iM-iD")&&(o.attr("title",_lang.hijriDate+": "+m.format("iYYYY-iMMMM-iD")),n.attr("title",_lang.hijriDate+": "+m.format("iYYYY-iMMMM-iD"))):(o.attr("title",""),n.attr("title",_lang.hijriDateConverter)),jQuery(e).on("changeDate",function(e){r=moment(o.val()),o.attr("title",_lang.hijriDate+": "+r.format("iYYYY-iMMMM-iD")),n.attr("title",_lang.hijriDate+": "+r.format("iYYYY-iMMMM-iD"))}),jQuery(o).on("blur",function(){r=moment(o.val()),o.val()?(o.attr("title",_lang.hijriDate+": "+r.format("iYYYY-iMMMM-iD")),n.attr("title",_lang.hijriDate+": "+r.format("iYYYY-iMMMM-iD"))):(o.attr("title",""),n.attr("title",_lang.hijriDateConverter))}))}function fixFooterPosition(){var e=0,t=jQuery("#header_div").outerHeight(!0),a=jQuery(".grid-main-container").outerHeight(!0),r=(a||(e=jQuery(".main-grid-container").outerHeight(!0)-jQuery(".grid-container").outerHeight(!0)+50),jQuery(".grid-container").outerHeight(!0)),o=jQuery(".lisence-message").outerHeight(!0),t=t+a+e+r+(o||0),a=jQuery(window).height();t+100<a?(t=a-jQuery("#footer").height(),jQuery("#footer").css("top",t+"px")):jQuery("#footer").css("top",t+20+"px")}function advancedSearchFilters(e){e=e||!1,jQuery("#filtersFormWrapper").is(":visible")||(loadEventsForFilters(),jQuery("#filtersFormWrapper").slideDown(),jQuery("#submitAndSaveFilter").is(":visible")&&jQuery("#advancedSearchFields").removeClass("d-none")),jQuery("html, body").animate({scrollTop:0},0),e||reinitializeGridFixedNav()}function hideAdvancedSearch(e){e=e||!1,jQuery("#filtersFormWrapper").slideUp(1,function(){e||fixFooterPosition()})}function resizeHeaderAndFooter(){jQuery(".grid-header").outerHeight(!0);var e=jQuery("#fixed-navbar").width();0<jQuery("#subNavMenu").length&&jQuery("#tabs-nav-menu-items").removeClass("margin-bottom").parent().removeClass("margin-bottom"),0<jQuery("#expense-info-message").length&&jQuery("#expense-info-message").removeClass("centered-text").css("width",e+30).css("margin-bottom",0),0<jQuery("#grid-scrollable",".grid-main-container").length?jQuery(".footer-hidden-background").removeClass("d-none").css("width",e):jQuery(".footer-hidden-background").removeClass("d-none").css("width",e-18),fixGridPaginationList()}function revertAllFilters(){jQuery("#gridFiltersList").val(""),jQuery("#submitAndSaveFilter").addClass("d-none");var e=window.navigator.userAgent.indexOf("MSIE "),t=!!navigator.userAgent.match(/Trident\/7\./);e<0&&!t&&resetFormFields()}function whatsNew(){!jQuery("#display-whats-new").val()||("undefined"==typeof openAvatarForm||openAvatarForm)&&"undefined"!=typeof openAvatarForm||_whatsNew()}function _whatsNew(){jQuery.ajax({url:getBaseURL()+"home/whats_new_popup/",dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&(t="#whats-new-dialog",jQuery(t).length<=0)&&(jQuery("<div id='whats-new-dialog'></div>").appendTo("body"),(a=jQuery(t)).html(e.html),initializeModalSize(a),jQuery(".modal",a).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(".modal",a).on("hidden.bs.modal",function(){""==userGuide&&"logged"==isloggedIn&&userGuideObject.userGuideSetup()}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",a).modal("hide")}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function saveGridColumns(e,t,a){e=e||!1,a=a||!1,r=[],0===(t=t||[]).length?(r=jQuery("form#selected-columns").serializeArray(),e&&r.push({name:"restore_default_columns",value:e})):r.push({name:"ordered_columns",value:t}),r.push({name:"model",value:jQuery("#model").val()});var r,o,e=jQuery("#gridFiltersList").val();e&&-1===hearingFixedFilters.indexOf(e)&&"awaiting_my_approvals"!=e&&r.push({name:"grid_saved_filter_id",value:e}),a?(o=0,r&&(jQuery.each(r,function(e,t){t.value.match("^custom_field_")&&o++}),a<o?pinesMessage({ty:"warning",m:_lang.limitCustomFieldWarning.sprintf([a])}):(jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide"),savGridDetails(r)))):savGridDetails(r)}function savGridDetails(e){e&&e[0].value&&e[0].value instanceof Array&&e[1]&&("User_Activity_Log"===e[1].value||"User_Activity_Log_Money_Module"===e[1].value)&&(e[0].value=e[0].value.map(e=>"allRecordsClientName"===e?"clientName":e)),jQuery.ajax({url:getBaseURL()+"grid_saved_columns/save_grid_details/",dataType:"JSON",type:"POST",data:e,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result&&"arabic"===_lang.languageSettings.langName&&jQuery(".k-grid-header",".grid-main-container").removeClass("padding-right"),e.result||(null!=e.feedbackMessage?pinesMessage({ty:e.feedbackMessage.ty,m:e.feedbackMessage.m}):pinesMessage({ty:"error",m:_lang.updatesFailed}),jQuery("#loader-global").hide()),(e.result||!e.result&&!restoreDefaultColumns&&orderedColumnsArray.length)&&setGridDetails(e.gridDetails)},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function getTranslation(e){return _lang[e]}function gridEvents(){var e={html:!0,trigger:"click",placement:"bottom",sanitize:!1,content:jQuery("#columns-suggestions").html(),container:jQuery("#column-picker-trigger-container")};jQuery("#columns-suggestions").remove(),jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover(e),jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").on("shown.bs.popover",function(){var t=0;jQuery(window).scroll(function(){var e=jQuery(document).scrollLeft();jQuery("#filtersFormWrapper").is(":visible")&&!jQuery("#grid-header-fixed-navbar").hasClass("scroll-to-fixed-fixed")&&jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide"),t!==e&&jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide"),t=e}),jQuery(".restore-defaults-columns").on("click",function(){saveGridColumns(!0),jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide")}),jQuery("#submit-grid-columns").on("click",function(){jQuery("#task-contributors").prop("disabled",!1).trigger("chosen:updated"),"undefined"!=typeof selectedCustomFieldsLimit?saveGridColumns(!1,[],selectedCustomFieldsLimit):(saveGridColumns(),jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide"))}),jQuery(".cancel-popover").on("click",function(){jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide")}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide")}),jQuery("#search-columns-suggestions","#selected-columns").keypress(function(e){13==e.which&&e.preventDefault()})}),jQuery("body").on("click",function(e){jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").is(e.target)||0!==jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").has(e.target).length||0!==jQuery(".popover","#column-picker-trigger-container").has(e.target).length||jQuery('[data-toggle="popover"]',"#column-picker-trigger-container").popover("hide")}),"rtl"===_lang.languageSettings.langDirection&&gridScrollRTL(),jQuery(":input",jQuery("li.search-field","ul.chosen-choices")).removeAttr("disabled"),0<jQuery(".grid-main-container").length&&setTimeout(function(){fixFooterPosition()},300),jQuery(".k-pager-info-top",".k-grid-info-refresh-top").text(jQuery(".k-pager-info",".k-grid-pager").text())}function orderColumns(e){var t=e.sender.columns.slice(0),a=t.splice(e.oldIndex,1)[0],r=(t.splice(e.newIndex,0,a),[]);t.map(function(e){for(i in e)"field"==i&&e.title.trim()&&e.title!==_lang.actions&&r.push(e[i])}),saveGridColumns(!1,r)}function displayCourtReferenceContent(e,t){if(t){var a=e.split("\n");for(i in a){var r=a[i],o=r.substring(r.lastIndexOf("/ ")+1,r.length),o=kendo.toString(gregorianToHijri(o),"yyyy-MM-dd");a[i]=r.replaceAt(r.lastIndexOf("/ ")+2,o)}e=a.join("\n")}return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function displayContent(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function alertLicenseExpirationMsg(){pinesMessage({ty:"information",m:"lead"===clientLicenseType?_lang.feedback_messages.trialLicenseExpiration.sprintf(["subscribe()"]):_lang.feedback_messages.clientLicenseExpiration.sprintf([contactUsLink]),d:0})}function gridTriggers(e){7<e.gridColumnsLength?jQuery("#grid-unscrollable").attr("id","grid-scrollable"):jQuery("#grid-scrollable").attr("id","grid-unscrollable"),null==e.gridContainer.data("kendoGrid")?(e.gridContainer.kendoGrid(e.gridOptions),fixGridHeader(!0)):(e.gridContainer.empty().kendoGrid(e.gridOptions),jQuery("#grid-header-fixed-navbar").trigger("detach.ScrollToFixed"),jQuery("#fixed-navbar").trigger("detach.ScrollToFixed"),fixGridHeader()),jQuery('[data-role="dropdownlist"]',e.gridContainer).change(function(e){savePageSize=!0})}function validateWebsite(e,t,a,r){if(!/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(e.val()))return _lang.invalidUrl}function integrationPopup(){jQuery.ajax({url:getBaseURL()+"calendars/integrations_list",dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&(t="#calendar-integration-dialog",jQuery(t).length<=0)&&(jQuery("<div id='calendar-integration-dialog'></div>").appendTo("body"),(a=jQuery(t)).html(e.html),initializeModalSize(a),jQuery(".modal",a).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",a).modal("hide")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(a)}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function resetIntegrationToggle(e){e.integrationToggle.bootstrapToggle(e.status)}function enableCalendarIntegration(e,t){jQuery.ajax({url:getBaseURL()+"calendar_integrations/index",type:"POST",dataType:"JSON",data:{status:"on",integration_type:e,pre_integration_location:window.location.href},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.calendarIntegrationEnabled?(jQuery("#calendar-integration-message").length||jQuery("#integration-list").prepend('<div id="calendar-integration-message" class="alert alert-warning"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+_lang.cannotSyncWithBothCalendars+"</div>"),resetIntegrationToggle({status:"off",integrationToggle:t})):window.location=e.oauthUrl},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function disableCalendarIntegration(t){jQuery.ajax({url:getBaseURL()+"calendar_integrations/index",type:"POST",dataType:"JSON",data:{status:"off"},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.syncTurnedOff&&(t.integrationCalendarLabel.remove(),t.integrationStatusHolder.val("no"))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function makeFieldsTimePicker(e){for(i in e)jQuery("#"+e[i]).timepicker({timeFormat:"H:i"})}function resultHandlerAfterContactsLegalCasesAutocomplete(){return!0}function resultHandlerAfterContactsLegalCaseContainersAutocomplete(){return!0}function resultHandlerAfterCompaniesLegalCasesAutocomplete(){return!0}function reminderForm(a,r,o,n,i){if(a=a||!1,r=r||!1,n=n||!1,i=i||!1,licenseHasExpired)return alertLicenseExpirationMsg(),!1;jQuery.ajax({dataType:"JSON",url:getBaseURL()+"reminders/"+(r||(a?"edit":"add")),data:a?{id:a}:"",type:"GET",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html&&jQuery("#reminder-form-container").length<=0&&(jQuery('<div id="reminder-form-container"></div>').appendTo("body"),(t=jQuery("#reminder-form-container")).html(e.html),0<jQuery("#company-reminders-search-filters").length&&(jQuery("#lookup-company-id",t).val(jQuery("#companyValue","#company-reminders-search-filters").val()),jQuery("#lookup-companies",t).val(jQuery("#company-name","#company-reminders-search-filters").val())),o&&(0<jQuery("#legal-case-reminders-search-filters").length&&(jQuery("#lookup-case-id",t).val(jQuery("#quickSearchFilterLegalCaseIdValue","#legal-case-reminders-search-filters").val()),jQuery("#lookup-cases",t).val(jQuery("#case-subject","#legal-case-reminders-search-filters").val())),0<jQuery("#case-events-container").length)&&(jQuery("#lookup-cases",t).val(jQuery("#legal-case-subject","#case-events-container").val()),jQuery("#lookup-case-id",t).val(jQuery("#legal-case","#case-events-container").val())),n&&0<jQuery("#reminders-grid").length&&(jQuery("#lookup-contract-id",t).val(jQuery("#contractIdInPage","#gridFormContent").val()),jQuery("#lookup-contract",t).val(jQuery("#contract-full-name","#gridFormContent").val())),"postpone"===r?(jQuery("form#reminder-form :input",t).attr("disabled",!0),jQuery("input[type=hidden]",t).removeAttr("disabled"),jQuery("#remind-on-date-input",t).removeAttr("disabled"),jQuery("#remind-on-time",t).removeAttr("disabled"),jQuery("#remind-me",t).hide(),jQuery(".users-lookup-icon",t).addClass("disabled"),commonModalDialogEvents(t),jQuery("#form-submit",t).click(function(){reminderFormSubmit(a,t,"postpone",i)}),jQuery(t).find("input").keypress(function(e){13==e.which&&reminderFormSubmit(a,t,"postpone",i)})):commonModalDialogEvents(t,reminderFormValidate,i),reminderFormEvents(t)),void 0===e.status||e.status||pinesMessage({ty:"error",m:_lang.invalid_record})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function reminderFormEvents(e){var t;initializeModalSize(e),jQuery(".select-picker",e).selectpicker({dropupAuto:!1}),0<jQuery(".hijri-date-picker","#remind-on-date").length?makeFieldsHijriDatePicker({fields:["remind-on-date-input"]}):setDatePicker("#remind-on-date",e),0<jQuery(".hijri-date-picker","#repeat-until-date").length?makeFieldsHijriDatePicker({fields:["repeat-until-date-input"]}):setDatePicker("#remind-on-date-recurrence",e),jQuery(".time-picker",e).timepicker({timeFormat:"H:i"}),jQuery("#recurring-type",e).change(function(){this.value?jQuery("#recurrence-stop-date-container",e).removeClass("d-none"):(jQuery("#recurrence-stop-date-container",e).addClass("d-none"),jQuery("#repeat-until-date-input",e).val(""))}),lookUpUsers(jQuery("#lookup-user-to-remind",e),jQuery("#user-to-remind-id",e),"user_id",jQuery(".user-to-remind-container",e),e),lookUpCases(jQuery("#lookup-cases",e),jQuery("#lookup-case-id",e),"legal_case_id",e),lookUpContacts({lookupField:jQuery("#lookup-contacts",e),errorDiv:"contact_id",hiddenId:"#lookup-contact-id",resultHandler:"reminderContactResultHandler"},e),t={lookupField:jQuery("#lookup-companies",e),errorDiv:"companies_contacts",hiddenId:"#lookup-company-id",isBoxContainer:!1},lookUpCompanies(t,e),lookUpTasks({lookupField:jQuery("#lookup-tasks",e),hiddenId:jQuery("#lookup-task-id",e),errorDiv:"task_id"},e),lookUpContracts({lookupField:jQuery("#lookup-contract",e),hiddenId:jQuery("#lookup-contract-id",e),errorDiv:"contract_id"},e)}function reminderContactResultHandler(e,t){var a=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#lookup-contact-id",t).val(e.id),jQuery("#lookup-contacts",t).val(a),jQuery(".twitter-typeahead",t).length&&(jQuery("#lookup-contacts",t).typeahead("destroy"),lookUpContacts({lookupField:jQuery("#lookup-contacts",t),errorDiv:"contact_id",hiddenId:"#lookup-contact-id",resultHandler:"reminderContactResultHandler"},t))}function reminderFormValidate(e,t){t=t||!1;var a,r=jQuery("#reminder-id",e).val(),o=jQuery("#recurrence-id",e).val(),n=jQuery(".modal",e),i=jQuery("form",n).data("serialize"),n=jQuery("form",n).serialize(),s=!1;r&&o&&i!=n?jQuery("#recurrence-options-container").length<=0&&(jQuery('<div id="recurrence-options-container"></div>').appendTo("body"),(a=jQuery("#recurrence-options-container")).html(jQuery("#recurrence-options",e).html()),jQuery(".tooltip-title",a).tooltipster(),jQuery(".modal-container",a).addClass("modal"),commonModalDialogEvents(a),jQuery("#form-submit",a).click(function(){jQuery("#recurrence-modification",e).val(1==jQuery("input[type=radio]:checked",a).val()?"yes":"no"),jQuery(".modal",a).modal("hide"),reminderFormSubmit(r,e,!1,t)})):s=!0,s&&reminderFormSubmit(r,e,!1,t)}function reminderFormSubmit(e,t,a,r){a=a||!1,r=r||!1;var o=jQuery("form#reminder-form",t).serializeArray();for(index=0;index<o.length;++index)"remindDate"==o[index].name&&0<jQuery(".hijri-date-picker","#remind-on-date").length?(convertToGregorianPrePost(jQuery("#remind-on-date-input"),jQuery("#remindDate-gregorian")),o[index].value=jQuery("#remindDate-gregorian","#reminder-date-hijri-container").val()):"recurrence[stop_date]"==o[index].name&&0<jQuery(".hijri-date-picker","#repeat-until-date").length&&(convertToGregorianPrePost(jQuery("#repeat-until-date-input"),jQuery("#repeat-until-date-input-gregorian")),o[index].value=jQuery("#repeat-until-date-input-gregorian","#recurrence-stop-date-container").val());jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".modal-save-btn",t).attr("disabled","disabled")},data:o,dataType:"JSON",type:"POST",url:getBaseURL()+"reminders/"+(a||(e?"edit":"add")),success:function(e){if(jQuery(".inline-error",t).addClass("d-none"),e.result)jQuery(".modal",t).modal("hide"),pinesMessage({ty:"success",m:e.message}),void 0!==e.display_message&&pinesMessage({ty:"warning",m:e.display_message}),loadUserLatestReminders("refresh"),reminderCallBack(),0<jQuery("#my-dashboard").length&&loadDashboardData("reminders"),0<jQuery("#related-reminders-grid").length&&jQuery("#related-reminders-grid").data("kendoGrid").dataSource.read(),isFunction(r)&&r();else{if(e.validation_errors)return displayValidationErrors(e.validation_errors,t),!1;pinesMessage({ty:"error",m:_lang.saveRecordFailed.sprintf([_lang.newReminder])})}},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function commonModalDialogEvents(t,a,r,e){a=a||!1,r=r||!1,e=e||!1,licensePackageAccessCheck(),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery("#pendingReminders").parent().popover("hide"),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal",t).on("shown.bs.modal",function(e){""==jQuery(".first-input",t).val()&&jQuery(".first-input",t).focus()}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",t).modal("hide")}),jQuery(".modal",t).on("hidden.bs.modal",function(){jQuery(".datepicker-dropdown").css("display","none"),e&&isFunction(e)&&e(),destroyModal(t)}),a&&(jQuery("#form-submit",t).click(function(){r?a(t,r):a(t)}),jQuery(t).find("input").keypress(function(e){13==e.which&&(e.preventDefault(),r?a(t,r):a(t))})),jQuery(".search").attr("autocomplete","off"),jQuery(".lookup").attr("autocomplete","off")}function addMe(e){(e=e||!1).hidden_id.val(authIdLoggedIn).trigger("change"),e.lookup_field.val(userLoggedInName),jQuery(".inline-error",e.lookup_container).addClass("d-none"),destroyUserLookup(e)}function destroyUserLookup(e){jQuery(".twitter-typeahead",e.lookup_container).length&&(e.lookup_field.typeahead("destroy"),lookUpUsers(e.lookup_field,e.hidden_id,"user_id",e.lookup_container,e.container))}function showHideCloneUsers(e){jQuery("#clone-users").is(":checked")?(jQuery("#cloned-users-container").removeClass("d-none"),lookupPrivateUsers(jQuery("#lookup-clone-users",e),"cloned_users","#selected-users","cloned-users-container",e)):(jQuery("#cloned-users-container").addClass("d-none"),jQuery("#lookup-clone-users").html(""))}function lookUpTasks(a,r,o){o=o||!1;var e=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("title")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL()+"tasks/autocomplete?term=%QUERY",cache:!1,wildcard:"%QUERY"}});e.initialize(),a.lookupField.typeahead({hint:!1,highlight:!0,minLength:2},{source:e.ttAdapter(),display:function(e){return getTaskSuggestionsDisplayName(e)},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return'<div title="'+e.title+'">'+getTaskSuggestionsDisplayName(e)+"</div>"}}}).on("typeahead:selected",function(e,t){a.lookupField.attr("title",t.title),jQuery("#task-subject",r).removeClass("d-none"),jQuery("#task-link",r).attr("onclick","taskForm('"+t.id+"')"),void 0!==a.callback&&a.callback(t),o.callback&&isFunction(o.callback)&&o.callback(t,r)}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",r).removeClass("loading")}),a.lookupField.on("input",function(e){""==a.lookupField.val()&&(a.lookupField.removeAttr("title"),jQuery("#task-subject",r).addClass("d-none"))}),isFunction(o.onEraseLookup)&&o.onEraseLookup||(o.onEraseLookup=!1),lookupCommonFunctions(a.lookupField,a.hiddenId,a.errorDiv,r,o.onEraseLookup)}function getTaskLookUpDisplayName(e){return"T"+e.taskId+": "+e.taskSubject}function getTaskSuggestionsDisplayName(e){return 50<e.title.length?e.task_id+": "+e.title.substring(0,50)+"...":e.task_id+": "+e.title}function displayValidationErrors(e,t,a){var r;for(i in a=a||!1,jQuery(".inline-error",t).removeClass("validation-error"),jQuery(".input-warning",t).removeClass("input-warning"),e)(r=0<jQuery("div",t).find("[data-field="+i+"]").length?jQuery("div",t).find("[data-field="+i+"]"):0<jQuery("td",t).find("[data-field="+i+"]").length&&jQuery("td",t).find("[data-field="+i+"]"))?(r.removeClass("d-none").html(e[i]).addClass("validation-error"),jQuery("input[data-field="+i+"]",t).each(function(){""===this.value&&jQuery(this).addClass("input-warning")})):a||pinesMessageV2({ty:"error",m:e[i]});scrollToValidationError(t)}function reminderCallBack(){return!0}function fixGridPaginationList(){(-1<navigator.userAgent.indexOf("Chrome")||-1<navigator.userAgent.indexOf("Edge"))&&jQuery(".k-dropdown").replaceWith('<select style= "padding: 4px;margin-top: -2px;margin: 0 .4em 0;border-color: #ccc;width: 3.5em;border-radius: 4px;cursor: pointer;overflow: visible;vertical-align: middle;background-color: #ffffff !important;" >'+jQuery(".k-dropdown select").html()+"</select>")}function administrationForm(r,o,n,i){n=n||!1,i=i||!1,jQuery.ajax({url:(i?getBaseURL(i):getBaseURL())+r+(o?"/edit/"+o:"/add"),type:"GET",data:{add_edit_form:!0},dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&(t="#administration-form-container",jQuery(t).length<=0)&&(jQuery("<div id='administration-form-container'></div>").appendTo("body"),(a=jQuery(t)).html(e.html),commonModalDialogEvents(a),jQuery(".select-picker",a).selectpicker(),jQuery("#form-submit",a).click(function(){n?n():administrationFormSubmit(o,a,i)}),jQuery(a).find("input").keypress(function(e){13==e.which&&(n?n(r,a):administrationFormSubmit(o,a,i))}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function administrationFormSubmit(t,a,r){r=r||!1;var e=jQuery("#field-type","#administration-type-container").val();jQuery.ajax({url:(r?getBaseURL(r):getBaseURL())+e+(t?"/edit/"+t:"/add"),type:"POST",data:jQuery("form#administration-form",a).serialize(),dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){if(jQuery(".inline-error",a).addClass("d-none"),e.result)jQuery(".modal",a).modal("hide"),updateRecords(t?"edit":"add",e,r);else{for(i in jQuery(".inline-error",a).removeClass("validation-error"),e.validationErrors)jQuery("div",a).find("[data-field="+i+"]").removeClass("d-none").html(e.validationErrors[i]).addClass("validation-error"),showMoreFields(jQuery("#administration-form"),jQuery(".hide-rest-fields","#administration-form")),""==jQuery("#"+i).val()&&jQuery("#"+i).val(jQuery("#name_"+_lang.languageSettings.langName.substring(0,2)).val());scrollToValidationError(a)}},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function updateRecords(e,a,t){var r,o;t=t||"","delete"===e?(jQuery("#administration-type-record-"+a,"#administration-type-container").remove(),0==jQuery("#administration-type-table tbody","#administration-type-container").children().length&&jQuery("#administration-type-table","#administration-type-container").addClass("d-none"),o=jQuery("#rows-number","#administration-type-container").val()-1,jQuery("#rows-number","#administration-type-container").val(o),jQuery("#total-records","#administration-type-container").html(o)):(jQuery("#administration-type-table").removeClass("d-none"),r='<tr id="administration-type-record-'+a.id+'">',jQuery.each(a.records,function(e,t){jQuery("#lang-"+e,"#administration-type-table").length&&(r+='<td title="'+a.records[e]+'">'+a.records[e]+"</td>")}),a.records_keys&&jQuery.each(a.records_keys,function(e,t){jQuery("#"+e,"#administration-type-table").length&&(r+="<td>"+a.records_keys[e]+"</td>")}),r+='<td><a href="javascript:;" onclick="administrationForm(\''+a.type+"',"+a.id+", false, '"+t+'\');"><i class="fa fa-edit fa-lg"></i></a></td><td><a href="javascript:;" onclick="confirmationDialog(\'confirm_delete_record\',{resultHandler: deleteAdministrationRecord, parm: \''+a.id+"', module: '"+t+'\'});"><i class="fa fa-trash fa-lg"></i></a></td></tr>',"add"===e?(jQuery("#administration-type-table tbody").append(r),o=parseInt(jQuery("#rows-number","#administration-type-container").val(),10)+1,jQuery("#rows-number","#administration-type-container").val(o),jQuery("#total-records","#administration-type-container").html(o)):jQuery("#administration-type-record-"+a.id).replaceWith(r))}function deleteAdministrationRecord(t,e){e=e||!1;var a=jQuery("#field-type","#administration-type-container").val();jQuery.ajax({url:(e?getBaseURL(e):getBaseURL())+a+"/delete",type:"POST",data:{id:t},dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result?(updateRecords("delete",t),pinesMessage({ty:"success",m:e.feedback_message})):pinesMessage({ty:"warning",m:e.feedback_message})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function recordRelatedExpense(r,o,n,i){o=o||"case",n=n||!1,i=i||!1,jQuery.ajax({url:getBaseURL()+"cases/add_client_and_update_case",type:"GET",data:{case_id:r},dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.result?window.location=getBaseURL("money")+"vouchers/"+o+"_expenses_add/"+r+(n?"/"+n:"")+(i?"/true":""):e.html?(t="#case-client-form-container",jQuery(t).length<=0&&(jQuery("<div id='case-client-form-container'></div>").appendTo("body"),(a=jQuery(t)).html(e.html),clientInitialization(a),commonModalDialogEvents(a),jQuery("#client-type",a).selectpicker(),jQuery("#form-submit",a).click(function(){recordClientExpense(a,o,n)}),jQuery(a).find("input").keypress(function(e){13==e.which&&recordClientExpense(a,o,n)}))):pinesMessage({ty:"error",m:_lang.invalid_record})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function recordClientExpense(t,a,r){a=a||"case",r=r||!1;var e=jQuery("#case-client-form",t).serialize();jQuery.ajax({url:getBaseURL()+"cases/add_client_and_update_case",type:"POST",data:e,dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result?window.location=getBaseURL("money")+"vouchers/"+a+"_expenses_add/"+e.case_id+(r?"/"+r:""):displayValidationErrors(e.validation_errors,t)},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function copyAddressFromCompany(e,t,a){a=a||!1,jQuery("#copyAddressFromLookup",t).val(""),jQuery("#address1",t).focus().val(e.address),jQuery("#city",t).val(e.city),a?jQuery("#country_id",t).val(e.country).selectpicker("refresh"):jQuery("#country_id",t).val(e.country).trigger("chosen:updated"),jQuery("#state",t).val(e.state),jQuery("#zip",t).val(e.zip),jQuery("#street_name",t).val(e.street_name),jQuery("#additional_street_name",t).val(e.additional_street_name),jQuery("#building_number",t).val(e.building_number),jQuery("#address_additional_number",t).val(e.address_additional_number),jQuery("#district_neighborhood",t).val(e.district_neighborhood),setTimeout(function(){toggleCopyAddressFrom(t)},100)}function cloneAddress(e,t){t=t||!1;var a=jQuery("div.address-details:last",e).attr("id"),r="address-details-container-",a=a.substring(r.length,a.length),a=parseInt(a)+1,o=jQuery("#address-details-container-1",e).clone().attr("id",r+a);o.insertAfter(jQuery("div.address-details:last",e)),jQuery("input",o).val(""),jQuery("#adddress-seperator",o).removeClass("d-none"),jQuery("#remove-address",o).removeClass("d-none"),jQuery("#remove-address a",o).attr("onclick","").click(function(e){e.preventDefault(),o.remove()}),t?(o.find(".bootstrap-select").parent().append(jQuery("#country_id",o).clone()),o.find(".bootstrap-select").remove(),jQuery("#country_id",o).selectpicker()):(jQuery("#copyAddressFromContainer",o).addClass("d-none"),jQuery("#country_id_chosen",o).remove(),jQuery(".country-id",o).val("").chosen({no_results_text:_lang.no_results_matched,placeholder_text:_lang.chooseCountry,width:"100%"}),jQuery(".copyAddressFromLink",o).attr("onclick",""),jQuery(".copyAddressFromLink",o).click(function(e){e.preventDefault(),toggleCopyAddressFrom(o)}),copyAddressFromLookup(o))}function notifyMeBefore(e){jQuery("#notify-me-before-container",e).removeClass("d-none"),jQuery("#notify-me-before-link",e).addClass("d-none"),jQuery("input",jQuery("#notify-me-before-container",e)).removeAttr("disabled"),jQuery("select",jQuery("#notify-me-before-container",e)).removeAttr("disabled"),jQuery("#notify-me-before-time-type",jQuery("#notify-me-before-container",e)).removeAttr("disabled").selectpicker("refresh"),jQuery("#notify-me-before-type",jQuery("#notify-me-before-container",e)).removeAttr("disabled").selectpicker("refresh")}function hideRemindMeBefore(e){jQuery("#notify-me-before-container",e).addClass("d-none"),jQuery("#notify-me-before-link",e).removeClass("d-none"),jQuery("input",jQuery("#notify-me-before-container",e)).attr("disabled",!0),jQuery("select",jQuery("#notify-me-before-container",e)).attr("disabled",!0),jQuery("#notify-me-before-time-type",jQuery("#notify-me-before-container",e)).attr("disabled",!0),jQuery("#notify-me-before-type",jQuery("#notify-me-before-container",e)).attr("disabled",!0)}function notifyMeBeforeEvent(t,a,e){(e=e||!1)&&jQuery("#"+t.inputContainer,a).on("changeDate",function(e){""!==jQuery("#"+t.input,a).val()?jQuery("#notify-me-before-container",a).hasClass("d-none")&&jQuery("#notify-me-before-link",a).removeClass("d-none"):(hideRemindMeBefore(a),jQuery("#notify-me-before-link",a).addClass("d-none"))}),jQuery("#"+t.input,a).on("blur",function(){""!==this.value?jQuery("#notify-me-before-container",a).hasClass("d-none")&&jQuery("#notify-me-before-link",a).removeClass("d-none"):(hideRemindMeBefore(a),jQuery("#notify-me-before-link",a).addClass("d-none"))})}function deleteIPRecord(e){jQuery.ajax({url:getBaseURL()+"intellectual_properties/delete/"+e,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery("#loader-global").hide(),e.status?(pinesMessage({ty:"information",m:e.messsage}),0<jQuery("#intellectualPropertyGrid").length?jQuery("#intellectualPropertyGrid").data("kendoGrid").dataSource.read():window.location=getBaseURL()+"intellectual_properties/"):pinesMessage({ty:"error",m:e.messsage||_lang.recordNotDeleted})},error:defaultAjaxJSONErrorsHandler})}function displayColHeaderPlaceholder(){jQuery("th[col-header-placeholder]").each(function(){jQuery(this).attr("title",jQuery(this).attr("col-header-placeholder"))})}function showToolTip(){jQuery(".tooltip-title").tooltipster()}function lookUpClients(a,r){var e=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("name")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL("money")+"clients/autocomplete?term=%QUERY",filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});e.initialize(),a.lookupField.typeahead({hint:!1,highlight:!0,minLength:3},{source:e.ttAdapter(),display:function(e){return e.name},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return"<div>"+e.name+"</div>"}}}).on("typeahead:selected",function(e,t){void 0!==a.callBackFunction&&a.callBackFunction(r)}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(e,t){jQuery(".loader-submit",r).removeClass("loading")}),lookupCommonFunctions(a.lookupField,a.hiddenId,a.errorDiv,r)}function clientStatusesEvents(e){jQuery(".widget-data",e).each(function(e,t){jQuery(t).tooltipster({content:jQuery(".popover-content",t).html(),contentAsHTML:!0,timer:22800,animation:"grow",delay:200,theme:"tooltipster-default",touchDevices:!1,trigger:"hover",maxWidth:350,interactive:!0,repositionOnScroll:!0,position:"bottom"})})}function clientTransactionsBalance(e,r,t,a){a=a||!1,e.client&&jQuery("#system-client-currency",r).val()?(a||(jQuery(".widget-data",r).removeClass("disable").tooltipster("destroy"),jQuery(".help-sign",r).addClass("d-none"),jQuery("span.warning-msg",jQuery(".popover-content",r)).addClass("d-none"),jQuery("span.help-msg",jQuery(".popover-content",r)).removeClass("d-none"),clientStatusesEvents(jQuery("#client-account-status"))),a={case_id:e.case,client_id:e.client},void 0!==e.organization&&(a.organization=e.organization),jQuery.ajax({url:getBaseURL()+t+"/load_client_widgets/",dataType:"JSON",data:a,type:"GET",success:function(e){var t,a;e.account_transactions&&(jQuery(".amount",jQuery("#paid-container",r)).length||jQuery(".details",jQuery("#paid-container",r)).append('<span class="amount"></span>'),jQuery(".amount",jQuery("#balance-due-container",r)).length||jQuery(".details",jQuery("#balance-due-container",r)).append('<span class="amount"></span>'),jQuery(".amount",jQuery("#paid-container",r)).html(e.account_transactions.paid_balance),jQuery(".amount",jQuery("#balance-due-container",r)).html(e.account_transactions.due_balance)),e.amount&&(jQuery(".amount",jQuery("#trust-container",r)).length||jQuery(".details",jQuery("#trust-container",r)).append('<span class="amount"></span>'),jQuery(".amount",jQuery("#trust-container",r)).html(e.amount)),e.billable&&(t=e.billable.logs,jQuery(".amount",jQuery("#billable-container",r)).length||jQuery(".details",jQuery("#billable-container",r)).append('<span class="amount"></span>'),jQuery("#details-table",jQuery("#billable-container",r)).removeClass("d-none"),void 0!==t.organizations&&t.organizations&&t.organization_id&&(a="",activeOrganizations=t.organizations,a=1<Object.keys(t.organizations).length?t.organizations[t.organization_id]+', <a href="javascript:;" onclick="moneyEntities( '+t.organization_id+');">'+_lang.clickToChange+"</a>":t.organizations[t.organization_id],jQuery("span",jQuery("#billable-container",r)).html(_lang.popoverClientBillableStatus.sprintf([a]))),jQuery(".amount",jQuery("#billable-container",r)).html(e.billable.total),jQuery("#expenses-amount",jQuery("#billable-container",r)).html(e.billable.expenses),jQuery("#logs-amount",jQuery("#billable-container",r)).html(t.amount),jQuery("#billable-container",r).tooltipster("content",jQuery(".popover-content",jQuery("#billable-container",r)).html())),e.capping?(e.capping,jQuery(".capping-amount",jQuery("#capping-container",r)).length||jQuery(".details",jQuery("#capping-container",r)).append('<span class="capping-amount"></span>'),jQuery("#details-table",jQuery("#capping-container",r)).removeClass("d-none"),jQuery(".capping-amount",jQuery("#capping-container",r)).html(e.capping.capping_amount),jQuery("#expenses-amount",jQuery("#capping-container",r)).html(e.capping.cap_expenses_amount),jQuery("#logs-amount",jQuery("#capping-container",r)).html(e.capping.cap_time_logs_amount),jQuery("#remaining-cap-amount",jQuery("#capping-container",r)).html(e.capping.remaining_cap_amount),jQuery("#capping-container",r).tooltipster("content",jQuery(".popover-content",jQuery("#capping-container",r)).html())):(a=jQuery(".widget-columns",jQuery("#client-account-status")),jQuery("#cap-amount-container",jQuery("#client-account-status")).addClass("d-none"),a.each(function(e,t){jQuery(this).removeClass("col-sm-5ths col-md-5ths"),jQuery(this).addClass("col-sm-3 col-md-3")}))},complete:function(){jQuery(".loader-submit").remove()},error:defaultAjaxJSONErrorsHandler})):(jQuery(".widget-data",r).addClass("disable"),e.client&&!jQuery("#system-client-currency",r).val()&&jQuery(".widget-data",r).tooltipster("content",_lang.feedback_messages.caseCurrencyNotSet.sprintf(["system_preferences"])))}function clientCaseForm(e){jQuery.ajax({url:getBaseURL()+"cases/add_client_and_update_case",type:"GET",data:{case_id:e},dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?(jQuery(".widget-data","#client-account-status").tooltipster("hide"),t="#case-client-form-container",jQuery(t).length<=0&&(jQuery("<div id='case-client-form-container'></div>").appendTo("body"),(t=jQuery(t)).html(e.html),clientInitialization(t),jQuery("#client-type",t).selectpicker(),commonModalDialogEvents(t,clientCaseFormSubmit))):pinesMessage({ty:"error",m:_lang.invalid_record})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function clientCaseFormSubmit(r){var e=jQuery("#case-client-form",r).serialize();jQuery.ajax({url:getBaseURL()+"cases/add_client_and_update_case",type:"POST",data:e,dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.result?(pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),(jQuery("#newCaseFormDialog").length||jQuery("#ipEditForm").length)&&(t=jQuery("#newCaseFormDialog").length?jQuery("#newCaseFormDialog"):jQuery("#ipEditForm"),a="contact"===jQuery("#client-type",r).val()?"contacts":"companies",jQuery("#clientType",t).val(a),jQuery("#contact_company_id",t).val(jQuery("#contact-company-id",r).val()),jQuery("#clientLookup",t).val(jQuery("#client-lookup",r).val()),clientTransactionsBalance({case:jQuery("#id",t).val(),client:e.client_id},jQuery("#client-account-status"),jQuery("#controller","#object-header").val())),jQuery(".modal",r).modal("hide")):displayValidationErrors(e.validation_errors,r)},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function moneyEntities(a){jQuery(".widget-data","#client-account-status").tooltipster("hide");var r='<select class="select-picker" id="organizations-list">',t=(jQuery.each(activeOrganizations,function(e,t){r+='<option value="'+e+'" '+(e==a?'selected = "selected" ':"")+" >"+activeOrganizations[e]+"</option>"}),r+="</select>","#money-entities-form-container");jQuery(t).length<=0&&(jQuery("<div id='money-entities-form-container' class='primary-style'><div class='modal fade modal-container modal-resizable'><div class='modal-dialog'><div class='modal-content'>\n                <div class='modal-header'><h4 id='title' class='modal-title'>"+_lang.chooseEntity+"</h4><button type='button' class='close' data-dismiss='modal' aria-hidden='true'></button></div>\n                <div class='modal-body form-horizontal overflow-unset'><div class='form-group row col-md-12 col-xs-12 padding-10'><label class='control-label col-md-4 col-xs-5'>"+_lang.relatedEntity+"</label><div class='col-md-6'>"+r+"</div></div></div>\n                <div class='modal-footer'><span class='loader-submit'></span><div class='btn-group'><button id='save-btn' type='button' class='btn btn-save btn-add-dropdown modal-save-btn'>"+_lang.ok+"</button></div><button type='button' class='btn btn-link' data-dismiss='modal'></button></div></div>\n                </div></div></div></div>").appendTo("body"),jQuery(".select-picker",t).selectpicker(),initializeModalSize(t,.4,.2),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",t).modal("hide")}),jQuery(".modal",t).on("hidden.bs.modal",function(){destroyModal(jQuery(t))}),jQuery("#save-btn",t).click(function(){clientTransactionsBalance({case:jQuery("#case-id","#object-header").val(),client:jQuery("#case-client-id","#object-header").val(),organization:jQuery("#organizations-list",t).find(":selected").val()},jQuery("#client-account-status"),jQuery("#controller","#object-header").val()),jQuery(".modal",t).modal("hide")}))}function disableAutocomplete(e){jQuery(e).find("input").not(".lookup").not("[type=hidden]").each(function(){jQuery(this).removeAttr("autocomplete"),jQuery(this).attr("data-rand-autocomplete")?jQuery(this).attr("autocomplete","stop-"+jQuery(this).attr("name")+"-"+parseInt(999*Math.random()+1)):jQuery(this).attr("autocomplete","off"),jQuery(this).closest("form").attr("autocomplete","off")})}function applyExportingModuleMethod(e){jQuery("#exporting-module").modal("show"),jQuery("#export-module-btn").attr("onClick",jQuery(e).data("callexport"))}function loadExportModalRanges(e,t,a){for(var r="",o=t||1,n=a||1e4,i=Math.ceil(e/n),s=1;s<=i;s++)r+=1===s?"<li><input type='radio' name='num-of-records' value='"+s+"' style='height: 10px;' checked><span style='padding-left: 5px;'>"+number_format(o,0,".",",")+" <b>-</b> "+number_format(n,0,".",",")+"</span></li><br>":s===i?"<li><input type='radio' name='num-of-records' value='"+s+"' style='height: 10px;'><span style='padding-left: 5px;'>"+number_format(o,0,".",",")+" <b>-</b> "+number_format(e,0,".",",")+"</span></li><br>":"<li><input type='radio' name='num-of-records' value='"+s+"' style='height: 10px;'><span style='padding-left: 5px;'>"+number_format(o,0,".",",")+" <b>-</b> "+number_format(n,0,".",",")+"</span></li><br>",o+=n,n+=n;jQuery("#exporting-module-body ul").html(r)}function archiveUnarchiveCase(e,t){confirmationDialog("no"==t?"confirmation_message_to_archive_case":"confirmation_message_to_unarchive_case",{resultHandler:archiveUnarchiveCaseSubmission,parm:e})}function archiveUnarchiveCaseSubmission(t){jQuery.ajax({url:getBaseURL()+"cases/archive_unarchive_cases",type:"POST",dataType:"JSON",data:{case_id:t},success:function(e){pinesMessageV2(e.status?{ty:"information",m:_lang.feedback_messages.caseArchivedSuccessfully}:{ty:"error",m:_lang.feedback_messages.caseArchiveFailed}),jQuery("#id","#newCaseFormDialog").length?jQuery("#archive-unarchive-btn","#newCaseFormDialog").attr("onclick","archiveUnarchiveCase('"+t+"', '"+e.archived+"')").text("yes"==e.archived?_lang.unarchive:_lang.archive):$legalCaseGrid.data("kendoGrid").dataSource.read()},error:defaultAjaxJSONErrorsHandler})}function disabledUnArchiveBtn(){jQuery("#unarchivedButtonId").addClass("disabled");var e=jQuery("#archive_tooltip").attr("data-title");jQuery("#archive_tooltip").attr("title",e)}function disabledArchiveBtn(){jQuery("#archivedButtonId").addClass("disabled");var e=jQuery("#archive_tooltip_litigation").attr("data-title"),t=jQuery("#archive_tooltip_matter").attr("data-title");jQuery("#archive_tooltip_litigation").attr("title",e),jQuery("#archive_tooltip_matter").attr("title",t)}function fetchCaseRelatedDataToHearingFrom(e,a){jQuery.ajax({url:getBaseURL()+"cases/hearings",type:"POST",dataType:"json",data:{caseId:e.id,action:"fetchRelatedCaseData"},error:defaultAjaxJSONErrorsHandler,success:function(e){e&&(e.hearingLawyers&&jQuery.each(e.hearingLawyers,function(e,t){setNewBoxElement("#selected-assignees","assignees-container","#"+a.attr("id"),{id:e,value:t,name:"Hearing_Lawyers"}),lookupBoxContainerDesign(jQuery(".assignees-container",a))}),e.judgmentValue)&&jQuery("#hearing-judgment-value",a).val(e.judgmentValue)}}),matterStageMetadata(a,e.id)}function litigationStageDataEvents(e,t){jQuery("#stage-div",t).html(e),jQuery("#remove-related-stage",t).removeClass("d-none"),"case-event-form-container"===t.attr("id")&&(jQuery("#case-stage-container",t).removeClass("col-md-12 no-padding"),jQuery("label",jQuery("#case-stage-container",t)).removeClass("col-md-3").addClass("col-md-3 col-xs-7")),jQuery("#relate-to-case-stage-link",t).on("click",function(){showLitigationStages(t)}),jQuery("#remove-related-stage",t).on("click",function(){removeStage(t)}),jQuery(".select-picker","#stage-div").selectpicker(),jQuery("#show-stage-details",t).tooltipster({content:jQuery("#stage-card-div",t).html(),contentAsHTML:!0,timer:22800,animation:"grow",delay:200,theme:"tooltipster-default",touchDevices:!1,trigger:"hover",maxWidth:350,interactive:!0,repositionOnScroll:!0,position:"bottom"}),jQuery("form",t).data("serialize",jQuery("form",t).serialize())}function showLitigationStages(r){var e=jQuery('input[data-field="case_id"]',r).val();jQuery.ajax({url:getBaseURL()+"cases/return_litigation_stages",type:"POST",dataType:"json",data:{caseId:e},error:defaultAjaxJSONErrorsHandler,success:function(e){var t,a;e.html&&(t="#litigation-stages-form-container",jQuery(t).length<=0)&&(jQuery("<div id='litigation-stages-form-container'></div>").appendTo("body"),(a=jQuery(t)).html(e.html),commonModalDialogEvents(a),jQuery("#form-submit",a).click(function(){relateLitigationStage(a,r)}),jQuery(a).find("input").keypress(function(e){13==e.which&&relateLitigationStage(a,r)}),initializeModalSize(a),""!==jQuery("#stage-id",r).val())&&jQuery("input[type=radio]",jQuery("#stage-container-"+jQuery("#stage-id").val(),a)).prop("checked",!0)}})}function changeAttendStatus(e){"mandatory"==jQuery("#attend_status_"+e).data("type")?(jQuery("#attend_status_"+e).data("type","optional"),jQuery("#attend_status_"+e+" img").attr("src","assets/images/icons/mark_mandatory.png"),jQuery("#input_attend_status_"+e).val("1"),runTooltipMeeting("#attend_status_"+e+" img",_lang.mark_optional)):(jQuery("#attend_status_"+e).data("type","mandatory"),jQuery("#attend_status_"+e+" img").attr("src","assets/images/icons/mark_optional.png"),jQuery("#input_attend_status_"+e).val("0"),runTooltipMeeting("#attend_status_"+e+" img",_lang.mark_required))}function changeParticipantStatus(e){0==jQuery("#input_participant_"+e).val()?(jQuery("#input_participant_"+e).val("1"),jQuery("#participant_status_"+e).removeClass("d-none"),jQuery("#participant_status_"+e+"  .tooltipTable").tooltipster("content",_lang.mark_non_participant)):(jQuery("#input_participant_"+e).val("0"),jQuery("#participant_status_"+e+"  .tooltipTable").tooltipster("content",_lang.mark_participant),jQuery("#participant_status_"+e).addClass("d-none"))}function runTooltipMeeting(e,t){jQuery(e).hasClass("tooltipstered")?jQuery(e).tooltipster("content",t):jQuery(e).tooltipster({content:t,contentAsHTML:!0,animation:"grow",theme:"tooltipster-default",touchDevices:!1,trigger:"hover"})}function showParticipant(e){0==jQuery("#input_participant_"+e).val()&&jQuery("#participant_status_"+e).removeClass("d-none")}function checkParticipant(e){0==jQuery("#input_participant_"+e).val()?jQuery("#participant_status_"+e).addClass("d-none"):jQuery("#participant_status_"+e).removeClass("d-none")}function matterStageMetadata(t,e,a){a=a||!1,e?jQuery.ajax({url:getBaseURL()+"cases/matter_stage_metadata/"+e+(a?"/"+a:""),success:function(e){e.html?litigationStageDataEvents(e.html,t):jQuery("#stage-div",t).html("")},error:defaultAjaxJSONErrorsHandler}):jQuery("#stage-div").html("")}function relateLitigationStage(e,t){var a=jQuery("input[type=radio]:checked",e).attr("data-id"),r=(jQuery("#stage-id",t).val(a),jQuery('input[data-field="case_id"]',t).val());""!==r&&(matterStageMetadata(t,r,a),jQuery(".modal",e).modal("hide"))}function removeStage(e){jQuery("#show-stage-details",e).addClass("d-none"),jQuery("#stage-name-label",e).addClass("d-none"),jQuery("#show-stage-details",e).addClass("d-none"),jQuery("#remove-related-stage",e).addClass("d-none"),jQuery("#relate-to-case-stage-link",e).removeClass("d-none"),jQuery("#stage-id",e).val("")}function caseContainerForm(e,a){e=e||!1,a=a||!1,jQuery.ajax({url:getBaseURL()+"case_containers/"+(e?"edit/"+e:"add"),type:"GET",dataType:"json",error:defaultAjaxJSONErrorsHandler,success:function(e){var t;e.html?(t="#case-container-form-div",jQuery(t).length<=0&&(jQuery("<div id='case-container-form-div'></div>").appendTo("body"),(t=jQuery(t)).html(e.html),a&&(jQuery("#subject",t).val(a),jQuery("#legal-case-id",t).val(jQuery("#legal-case-id","#containerForm").val())),caseContainerFormEvents(t),opponentsInitialization(jQuery("#opponents-container",t)))):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})}})}function caseContainerFormEvents(t){jQuery(".select-picker",t).selectpicker({dropupAuto:!1}),setDatePicker("#arrival-date-add-new",t),0<jQuery(".visualize-hijri-date",t).length&&getHijriDate(jQuery("#arrival-date-add-new",t),jQuery("#arrival-date-container",t)),setDatePicker("#closedOn-add-new",t),0<jQuery(".visualize-hijri-date",t).length&&getHijriDate(jQuery("#closedOn-add-new",t),jQuery("#closedOn-container",t)),initializeModalSize(t),clientInitialization(t),lookUpContacts({lookupField:jQuery("#lookup-requested-by",t),errorDiv:"requestedBy",hiddenId:"#requested-by",resultHandler:setRequestedByToForm},t),jQuery("#user-id",t).change(function(){"quick_add"==jQuery("#user-id",t).val()&&(jQuery("#user-id",t).val("").selectpicker("refresh"),addUserToTheProviderGroup(jQuery("#provider-group-id",t).val(),"user-id",!0))}),jQuery("#provider-group-id",t).change(function(){reloadUsersListByProviderGroupSelected(jQuery("#provider-group-id",t).val(),jQuery("#user-id",t),!0)}),jQuery("#case-submit",t).click(function(){caseContainerFormSubmit(t)}),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&(jQuery(".date-picker",t).bootstrapDP("remove"),jQuery(".modal",t).modal("hide"))}),jQuery(t).find("input").keypress(function(e){13==e.which&&caseContainerFormSubmit(t)}),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t),companyContactFormMatrix.commonLookup={}}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#subject",t).focus()})}function caseContainerFormSubmit(t){var a=!!jQuery("#id",t).val()&&jQuery("#id",t).val(),e=jQuery("#case-container-form",t).serializeArray();jQuery("#legal-case-id",t).val()&&e.push({name:"action",value:"addRelatedCaseContainer"}),jQuery.ajax({url:getBaseURL()+"case_containers/"+(a?"edit/"+a:"add"),type:"POST",dataType:"json",data:e,error:defaultAjaxJSONErrorsHandler,success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(a?pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}):pinesMessage({ty:"success",m:_lang.feedback_messages.addedNewContainerSuccessfully.sprintf([getBaseURL()+"case_containers/edit/"+e.id,e.ID])}),a||"function"!=typeof caseContainerCallBack?0<jQuery("#container-display-fields","#caseContainerContainer").length?loadContainerFields():0<jQuery("#containerGrid").length&&jQuery("#containerGrid").data("kendoGrid").dataSource.read():caseContainerCallBack(),0<jQuery("#my-dashboard").length&&(loadDashboardData("containers"),pieCharts()),jQuery(".modal",t).modal("hide")):e.validation_errors?displayValidationErrors(e.validation_errors,t):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})}})}function fixDateTimeFieldDesign(e){jQuery(".date-picker",e).each(function(){jQuery(".time-picker",this).remove(),jQuery(".time",this).remove()}),jQuery(".time-container",e).each(function(){jQuery(".date",this).remove()})}function dialogObjectAttachFile(e,t){attachmentCount++,jQuery("#"+e+"-attachments",t).append('<div class="col-md-11 d-flex"><div class="col-md-9 p-0"><input id="'+e+"-attachment-"+attachmentCount+'" name="'+e+"_attachment_"+attachmentCount+'" type="file" class="margin-top"/></div><div class="col-md-2 p-0"><button class="remove-record-icon" type="button" onclick="jQuery(this).parent().parent().remove();"></button><input name="'+e+'_attachments[]" type="hidden" value="'+e+"_attachment_"+attachmentCount+'"/></div></div>'),jQuery("#"+e+"-attachments input:last").focus()}function loadCustomFieldsEvents(u,c){jQuery("[id^="+u+"]",c).each(function(){var e=jQuery(this).attr("id"),t=e.substring(u.length,e.length);switch(jQuery(this).attr("field-type")){case"date":setDatePicker(jQuery(this).parent(),c,datePickerOptionsBottom);break;case"date_time":jQuery(this).parent().hasClass("date-picker")&&setDatePicker(jQuery(this).parent(),c,datePickerOptionsBottom),jQuery(this).hasClass("time")&&jQuery(this).timepicker({timeFormat:"H:i"});break;case"list":case"public_list":jQuery(this).selectpicker();break;case"lookup":var a=jQuery(this).attr("display-segments").split(","),r=jQuery(this).attr("display-format-single-segment"),o=jQuery(this).attr("display-format-double-segment"),n=jQuery(this).attr("display-format-triple-segment"),i=jQuery(this).attr("field-type-data");jQuery(this).selectize({plugins:["remove_button"],placeholder:_lang.startTyping,valueField:"id",labelField:a[0],searchField:[a[0],a[1]],create:!1,render:{option:function(e,t){return"<div><span>"+(void 0!==n?null!=e[a[2]]?n.sprintf([t(e[a[0]]),t(e[a[1]]),t(e[a[2]])]):null!=e[a[1]]?t(e[a[0]])+" "+t(e[a[1]]):t(e[a[0]]):void 0!==o?null!=e[a[1]]?o.sprintf([t(e[a[0]]),t(e[a[1]])]):t(e[a[0]]):r.sprintf([t(e[a[0]])]))+"</span></div>"},item:function(e,t){return"<div>"+(void 0!==n?null!=e[a[2]]?n.sprintf([t(e[a[0]]),t(e[a[1]]),t(e[a[2]])]):null!=e[a[1]]?t(e[a[0]])+" "+t(e[a[1]]):t(e[a[0]]):void 0!==o?null!=e[a[1]]&&"companies"!==i?o.sprintf([t(e[a[0]]),t(e[a[1]])]):t(e[a[0]]):r.sprintf([t(e[a[0]])]))+"</div>"}},load:function(e,t){if(!e.length)return t();jQuery.ajax({url:getBaseURL()+jQuery("#"+this.$input[0].id).attr("field-type-data")+"/autocomplete"+("users"==i?"/active":""),type:"GET",data:{term:encodeURIComponent(e)},dataType:"json",error:function(){t()},success:function(e){t(e)}})}});break;case"single_lookup":var s=this,i=jQuery(s).attr("field-type-data"),l=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("")},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:getBaseURL()+jQuery(this).attr("field-type-data")+"?term=%QUERY",filter:function(e){return e},replace:function(e,t){return e.replace("%QUERY",t)},cache:!1,wildcard:"%QUERY"}});l.initialize(),jQuery(this).typeahead({hint:!1,highlight:!0,minLength:2},{source:l.ttAdapter(),display:function(e){return getDisplayOptions(e,s)},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return"<div>"+getDisplayOptions(e,s)+"</div>"}}}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",c).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",c).removeClass("loading")}),lookupCommonFunctions(jQuery(s),jQuery("#hidden-field-"+t,c),t,c);break;case"lookup_per_type":var s=this,l=jQuery("#"+t+"-company-contact-type",jQuery(s).parent()).val(),d={lookupField:jQuery(this,c),hiddenInput:jQuery("#hidden-field-"+t,c),errorDiv:t};jQuery(".select-picker",jQuery(s).parent()).selectpicker().change(function(){jQuery("#hidden-field-"+t,c).val(""),jQuery(s,c).val(""),jQuery("div",c).find("[data-field="+t+"]").addClass("d-none"),jQuery(s,c).typeahead("destroy"),lookupCompanyContactType(d,c,jQuery(this).val())}),lookupCompanyContactType(d,c,l);break;case"multiple_lookup_per_type":multipleFieldsInitialization(jQuery("#fields-with-multiple-values",c));break;case"multiple_lookup":lookupPrivateUsers(jQuery(this,c),"multiple_records["+t+"]","#selected-"+t,t+"-container",c),checkBoxContainersValues({container:jQuery("#selected-"+t,c)},c)}})}function gregorianToHijri(e,t){return t=t||!1,e&&t?(dateParts=e.split(" - "),"Invalid date"!==(m=moment(dateParts[0])).locale("en").format("YYYY-MM-DD")?m.format("iYYYY-iMM-iDD")+" - "+dateParts[1]:""):"Invalid date"!==(m=moment(e)).locale("en").format("YYYY-MM-DD")?m.format("iYYYY-iMM-iDD"):""}function screenTransitionForm(t,a,r){if(a=a||!1,!(t=t||!1)||!a)return pinesMessage({ty:"error",m:_lang.invalid_record}),!1;jQuery.ajax({url:getBaseURL()+r+"/transition_screen_fields/"+t+"/"+a,type:"GET",dataType:"json",error:defaultAjaxJSONErrorsHandler,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result?e.html?screenTransitionFormEvents(t,a,e.html,r,!1,!1,getBaseURL()+r+"/transition_screen_fields/"):(jQuery(".form-submit-loader").show(),pinesMessage({ty:"success",m:e.display_message}),window.location=window.location.href):void 0!==e.display_message&&pinesMessage({ty:"error",m:e.display_message})},complete:function(){jQuery("#loader-global").hide()}})}function screenTransitionFormEvents(t,a,e,r,o,n,i){o=o||!1,n=n||!1;var s,l="#screen-fields-form-container";jQuery(l).length<=0&&(jQuery("<div id='screen-fields-form-container'></div>").appendTo("body"),(s=jQuery(l)).html(e),"undefined"!=typeof caseBoards?commonModalDialogEvents(s,!1,!1,function(){caseBoards.quickFilters()}):commonModalDialogEvents(s,!1,!1),jQuery("#form-submit",s).click(function(){screenTransitionFormSubmit(t,a,s,r,o,n,i)}),jQuery(s).find("input").keypress(function(e){13==e.which&&screenTransitionFormSubmit(t,a,s,r,o,n,i)}),initializeModalSize(s),fixDateTimeFieldDesign(s),loadCustomFieldsEvents("screen-field-",s),loadCustomFieldsEvents("custom-field-",s),0<jQuery("#screen-field-provider_group_id",s).length)&&0<jQuery("#screen-field-user_id",s).length&&jQuery("#screen-field-provider_group_id",s).change(function(){reloadUsersListByAssignedTeam(jQuery("#screen-field-provider_group_id",s).val(),jQuery("#screen-field-user_id",s),!0)})}function screenTransitionFormSubmit(e,t,a,r,o,n,i){if(t=t||!1,o=o||!1,n=n||!1,!(e=e||!1)||!t)return pinesMessage({ty:"error",m:_lang.invalid_record}),!1;var s=jQuery("#transition-screen-fields-form",a).serializeArray();jQuery.ajax({url:i+e+"/"+t,type:"POST",dataType:"json",data:s,error:defaultAjaxJSONErrorsHandler,beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery(".modal-save-btn",a).attr("disabled","disabled")},success:function(e){jQuery(".inline-error",a).addClass("d-none"),e.result?(jQuery(".form-submit-loader").show(),jQuery(".modal",a).modal("hide"),pinesMessage({ty:"success",m:e.display_message}),n||(window.location=window.location.href)):(void 0!==e.display_message&&pinesMessage({ty:"error",m:e.display_message}),void 0!==e.validation_errors&&displayValidationErrors(e.validation_errors,a),o&&isFunction(o)&&o())},complete:function(){jQuery(".modal-save-btn",a).removeAttr("disabled"),jQuery(".loader-submit",a).removeClass("loading")}})}function getDisplayOptions(e,t){var a=jQuery(t).attr("display-segments").split(","),r=jQuery(t).attr("display-format-single-segment"),o=jQuery(t).attr("display-format-double-segment"),t=jQuery(t).attr("display-format-triple-segment");return void 0!==t?e[a[0]]&&e[a[1]]&&e[a[2]]?t.sprintf([e[a[0]],e[a[1]],e[a[2]]]):e[a[0]]&&e[a[a.length-1]]?e[a[0]]+" "+e[a[a.length-1]]:e[a[0]]:void 0!==o?null!=e[a[1]]?o.sprintf([e[a[0]],e[a[1]]]):e[a[0]]:r.sprintf([e[a[0]]])}function reloadUsersListByAssignedTeam(e,a){jQuery.ajax({url:getBaseURL()+"users/autocomplete/active",dataType:"JSON",data:{join:["provider_groups_users"],more_filters:{provider_group_id:e},term:""},success:function(e){var t='<option value="">'+_lang.chooseUsers+"</option>";if(void 0!==e&&null!=e&&0<e.length)for(i in e)t+='<option value="'+e[i].id+'">'+e[i].firstName+" "+e[i].lastName+"</option>";a.html(t).selectpicker("refresh")},error:defaultAjaxJSONErrorsHandler})}function multipleFieldsInitialization(e){var t=jQuery("#fields-count",e).val(),a=1;jQuery(".field-div",e).each(function(){t<a||(multipleFieldsEvents(jQuery(this)),a++)})}function multipleFieldsEvents(e){var t=jQuery(e).parent().attr("id"),t=t.substring("-fields-container".length,t.length),a={lookupField:jQuery(".field-lookup",e),hiddenInput:jQuery(".field-member-id",e),errorDiv:t};jQuery(".field-member-type",e).selectpicker().change(function(){jQuery(".field-lookup",e).val(""),jQuery(".field-member-id",e).val(""),jQuery(".inline-error",e).html(""),jQuery(".field-lookup",e).typeahead("destroy"),lookupCompanyContactType(a,e,jQuery(this).val())}),jQuery(".field-lookup",e).typeahead("destroy"),lookupCompanyContactType(a,e,jQuery(".field-member-type option:selected",e).val())}function multipleFieldsAddContainer(e,t,a=0){var r,o,n;"#opponent-fields-container"==e&&jQuery(".field-div",e).length==a?pinesMessage({ty:"information",m:_lang.caseMaxOpponentsInfo.sprintf([a]),d:1e4}):(a=jQuery(e,"#fields-with-multiple-values"),r=parseInt(jQuery("#fields-count",a).val()),jQuery(".field-member-type",jQuery(".field-div",a).last()).selectpicker("destroy"),jQuery("#screen-field-opponent-position",jQuery(".field-div",a).last()).selectpicker("destroy"),n="#field-"+(o=r+1),jQuery(".field-div",a).last().clone().insertAfter(jQuery(".field-div",a).last()).attr("id","field-"+o),jQuery(".field-member-type",jQuery("#field-"+r,a)).selectpicker(),jQuery("#fields-count",a).val(o),jQuery(".delete-field",jQuery(n,a)).attr("onclick","multipleFieldsDelete("+o+",'"+e+"' , event)"),jQuery(".count-number",jQuery(n,a)).html(" ("+o+")"),jQuery(".field-member-id",jQuery(n,a)).val(""),jQuery(".field-lookup",jQuery(n,a)).val(""),jQuery("#screen-field-opponent-position",jQuery(n,a)).attr("data-field-id","opponent-position-"+o),jQuery("#screen-field-opponent-position",jQuery(n,a)).find("option").removeAttr("selected"),jQuery("#screen-field-opponent-position",jQuery(".field-div",a)).selectpicker(),jQuery(".field-member-type",jQuery(n,a)).find("option").removeAttr("selected"),jQuery(".delete-icon",jQuery(n,a)).removeClass("d-none"),1==r&&jQuery(".delete-icon",jQuery("#field-"+r,a)).removeClass("d-none"),multipleFieldsEvents(jQuery(n,a)),t.preventDefault())}function multipleFieldsUpdateLabels(e){var t=jQuery(e,"#fields-with-multiple-values"),a=jQuery("#fields-count",t).val(),r=1;jQuery(".count-number",t).each(function(){if(!(r<=a))return!0;jQuery(this).html(" ("+r+")"),r++}),r=1,jQuery(".field-div",t).each(function(){if(!(r<=a))return!0;jQuery(this).attr("id","field-"+r),r++}),r=1,jQuery(".delete-field",t).each(function(){if(!(r<=a))return!0;jQuery(this).attr("onclick","multipleFieldsDelete("+r+",'"+e+"' , event)"),r++}),multipleFieldsInitialization(e)}function multipleFieldsDelete(e,t,a){var r=jQuery("#fields-count",t).val();1<r?(jQuery("#field-"+e,t).remove(),jQuery("#fields-count",t).val(r-1),multipleFieldsUpdateLabels(t),1==jQuery("#fields-count",t).val()&&jQuery(".delete-icon",t).addClass("d-none")):pinesMessage({ty:"warning",m:_lang.invalid_request}),a.preventDefault()}function TimerForm(y,m,p,j){if(licenseHasExpired)return alertLicenseExpirationMsg(),!1;var f,g,Q=Math.round(Math.random()*(upperBound-lowerBound)+lowerBound);m=m||!1,(y=y||!1)&&m?(g={action:m,id:y,html:!0},"pauseform"!=m&&(f=!0)):g={action:m},jQuery.ajax({dataType:"JSON",url:getBaseURL()+"timers/"+(y?"edit/"+y:"add"),data:g,type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a,r,o,n,i,s,l,d,u,c;e.status&&(t="#timer-dialog-"+Q,jQuery('<div id="timer-dialog-'+Q+'"></div>').appendTo("body"),a=jQuery(t),jQuery(t).html(e.html),y||selectTimeLogRelation(jQuery("input:radio[name=timer-type]:checked",t)),f&&jQuery("#action",t).val("end"),emptyInputTimer("#task , #legal-caselookup",jQuery("#add-edit-timer")),p||j||(o=(e=window.location.href).search("cases/edit"),n=e.search("cases/tasks"),i=e.search("cases/reminders"),s=e.search("cases/documents"),l=e.search("cases/expenses"),d=e.search("cases/time_logs"),u=e.search("cases/related"),c=e.search("cases/related_contracts"),r=e.search("cases/settings"),e=e.search("tasks/view"),(0<o||0<n||0<i||0<s||0<l||0<d||0<u||0<c||0<r)&&(o=jQuery(".matter"),n=jQuery(".matter-code",o).attr("data-id"),i=jQuery(".matter-code",o).text(),s=jQuery(".matter-subject",o).text().trim(),jQuery("#legal-caselookup",a).val(i+": "+s),jQuery("#legal-caselookup-id",a).val(n)),0<e&&(l=jQuery(".task"),d=jQuery(".task-id",l).val(),u=jQuery(".task-subject",l).text(),jQuery("input:radio[name=timer-type][value=task]").attr("checked","checked"),selectTimeLogRelation(jQuery("input:radio[name=timer-type][value=task]",t)),jQuery("#task",a).val(u),jQuery("#task-id",a).val(d))),p&&(checkIfStringIsURIEncoded(p.subject)&&(p.subject=decodeURIComponent(p.subject)),jQuery("#legal-caselookup",a).val(replaceHtmlCharacter(p.subject)),jQuery("#legal-caselookup-id",a).val(p.legal_case_id)),j&&(checkIfStringIsURIEncoded(j.subject)&&(j.subject=decodeURIComponent(j.subject)),jQuery("input:radio[name=timer-type][value=task]").attr("checked","checked"),selectTimeLogRelation(jQuery("input:radio[name=timer-type][value=task]",t)),jQuery("#task",a).val(getTaskLookUpDisplayName(j)),jQuery("#task-id",a).val(j.taskId)),jQuery("#task",t).length&&jQuery("#task",t).val(replaceHtmlCharacter(jQuery("#task",t).val())),c={callback:onTimerCaseLookup},jQuery("#legal-caselookup",t).val(replaceHtmlCharacter(jQuery("#legal-caselookup",t).val())),lookUpCases(jQuery("#legal-caselookup",t),jQuery("#legal-caselookup-id",t),"legal_case_id",t,!1,c),lookUpTasks({lookupField:jQuery("#task",t),hiddenId:jQuery("#task-id",t),errorDiv:"task_id",callback:onTimerTaskSelection},t),clientLookup({lookupField:jQuery("#client-name","#add-edit-timer"),hiddenField:jQuery("#client-id","#add-edit-timer")}),commonModalDialogEvents(a),initializeModalSize(a),jQuery("#add-timer-dialog-submit").on("click",function(){TimerFormSubmit(m,t)}),jQuery("#add-timer-dialog-cancel").on("click",function(){TimerFormCancel(m,t)}),jQuery("#timer-time-type",a).change(function(){jQuery.ajax({url:getBaseURL().concat("time_types/get_record_by_id/").concat(jQuery(this).val()),data:g,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.status&&e.data.default_comment&&(jQuery("#summary",a).val()?confirmationDialog("replace_comment",{resultHandler:function(){jQuery("#summary",a).val(e.data.default_comment)}}):jQuery("#summary",a).val(e.data.default_comment))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}),"add"!=m)&&timerList()},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function TimerFormSubmit(t,a,e,r){r=e?r:(e=jQuery("form",jQuery(a)).serializeArray().map(function(e){return"legalCase"!=e.name&&"task"!=e.name||(e.value=escapeHtml(e.value)),e}),jQuery.param(e)),a=a||jQuery("#add-edit-timer"),jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",a).addClass("loading")},data:r,dataType:"JSON",type:"POST",url:getBaseURL()+"timers/"+("add"==t?"add":"edit"),success:function(e){jQuery(".inline-error",a).addClass("d-none"),e.status?(timerList(),jQuery(".modal",a).modal("hide"),e.endtimer&&pinesMessage({ty:"success",m:e.message}),e.warning&&pinesMessage({ty:"error",m:e.warning}),e.message&&e.cancel_time&&pinesMessage({ty:"success",m:e.message})):(e.validationErrors&&(0==e.validationErrors.length?pinesMessage({ty:"error",m:_lang.timer_can_not_start}):displayValidationErrors(e.validationErrors,a)),e.display_message&&jQuery.each(e.display_message,function(e,t){pinesMessage({ty:"error",m:t})}),e.message&&pinesMessage({ty:"error",m:e.message}),e.total_validation&&confirmationDialog("validation_less_one_min",{resultHandler:function(){jQuery("#cancel-time-log").val(!1),jQuery("#less-one-min").val(!0),TimerFormSubmit(t,a)},onCloseHandler:function(){jQuery("#cancel-time-log").val(!1),jQuery("#less-one-min").val(!1)}}))},complete:function(){jQuery(".loader-submit",a).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function timerList(){if(jQuery(".popover").popover("hide"),licenseHasExpired)return alertLicenseExpirationMsg(),!1;jQuery.ajax({dataType:"JSON",url:getBaseURL()+"timers/index",type:"POST",data:{action:"list_timers"},success:function(e){e.html&&(jQuery(".dropdown-menu-timer").html(e.html),430<jQuery(".dropdown-menu-timer").height()&&jQuery(".dropdown-menu-timer").css("overflow-y","scroll"),jQuery(".stopwatch").each(function(){timerActions(jQuery(this).attr("id").replace("timer-",""),e.serverTime)}),e.timer_active_status?jQuery(".timer-up .header-timer-icon").addClass("timer-active-icon"):jQuery(".timer-up .header-timer-icon").removeClass("timer-active-icon"))},error:defaultAjaxJSONErrorsHandler})}function timerActions(e,n){var i,s,l,d,t=jQuery("#timer-"+e),a=t.data("autostart"),o=t.find(".hours"),u=t.find(".minutes"),c=t.find(".seconds"),y=t.find(".milliseconds"),r=jQuery(".start-text"),m=(t.data("pausetext"),t.data("resumetext")),p=t.data("starttime"),j=t.data("status");function f(e,t){for(e=""+(0|e);e.length<t;)e="0"+e;return e}function g(e,t,a,r){o.text(f(e,2)),u.text(f(t,2)),c.text(f(a,2)),y.text(f(r,3))}function Q(){var t=i,a=s,r=l,o=d;setInterval(function(){var e=(n+=25)-1e3*p;g(i=e/36e5+t,s=(e/6e4+a)%60,l=(e/1e3+r)%60,d=(e+o)%1e3)},25)}function h(){"paused"==j?timerSwitch("run",e):(a=!0,Q())}function v(){a=!1,clearTimeout(void 0),r.html(m),v=!0,TimerForm(e,"pauseform")}t.on("click",function(e){e.preventDefault(),(a?v:h)()}),a&&(a=!1,g(i=s=l=d=0,s,l,d),h())}function timerSwitch(e,t){if(licenseHasExpired)return alertLicenseExpirationMsg(),!1;jQuery.ajax({dataType:"JSON",url:getBaseURL()+"timers/switch_timer",type:"POST",data:{action:e,id:t},success:function(e){e.status&&(timerList(),jQuery(".dropdown-menu-timer").animate({scrollTop:jQuery(".navbar-header").offset().top},"slow"))}})}function emptyInputTimer(e,t){jQuery(e,t).focusout(function(){""==jQuery(this).val()&&(jQuery("#"+jQuery(this).attr("id")+"-id").val(""),("task"==jQuery(this).attr("id")?jQuery("#task-description"):jQuery("#legal-case-subject")).text(""),jQuery("[data-field='task_or_matter']",t).addClass("d-none"))})}function taskStatusForm(r,o){r=r||!1,o=o||!1,jQuery.ajax({url:getBaseURL()+"task_statuses/"+(r?"edit/"+r:"add"),type:"GET",dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;e.html&&(t="#task-status-container",jQuery(t).length<=0)&&(jQuery("<div id='task-status-container'></div>").appendTo("body"),(a=jQuery(t)).html(e.html),commonModalDialogEvents(a),jQuery("#form-submit",a).click(function(){taskStatusFormSubmit(r,o,a)}),jQuery(a).find("input").keypress(function(e){13==e.which&&(e.preventDefault(),taskStatusFormSubmit(r,o,a))}),resizeMiniModal(a),jQuery(window).bind("resize",function(){resizeMiniModal(a)}),showToolTip())},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function taskStatusFormSubmit(e,t,a){e=e||!1,t=t||!1;var r=jQuery("#task-status-form",a).serializeArray();t&&r.push({name:"workflow_id",value:t}),jQuery.ajax({url:getBaseURL()+"task_statuses/"+(e?"edit/"+e:"add"),type:"POST",dataType:"json",data:r,error:defaultAjaxJSONErrorsHandler,beforeSend:function(){jQuery(".loader-submit",a).addClass("loading"),jQuery(".modal-save-btn",a).attr("disabled","disabled")},success:function(e){jQuery(".inline-error",a).addClass("d-none"),e.result?(jQuery(".modal",a).modal("hide"),pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),window.location=getBaseURL()+"task_workflows/index/"+t):displayValidationErrors(e.validation_errors,a)},complete:function(){jQuery(".modal-save-btn",a).removeAttr("disabled"),jQuery(".loader-submit",a).removeClass("loading")}})}function hearingAttachFile(){hearingAttachmentCount++,jQuery("#hearing-attachments").append('<div class="row no-margin col-md-9 no-padding"><div class="col-md-10 no-padding"><input id="hearing-attachment-'+hearingAttachmentCount+'" name="attachment_'+hearingAttachmentCount+'" type="file" class="margin-top"/></div><button class="remove-record-icon margin-top" type="button" onclick="jQuery(this).parent().remove();"></button><input name="hearing_attachments[]" type="hidden" value="hearing_attachment_'+hearingAttachmentCount+'"/></div>'),jQuery("#hearing-attachments input:last").focus()}function deleteHearingDocument(e,t,a){a=a||!1,moduleController="cases",confirm(_lang.confirmationDeleteFile)&&_deleteHearingDocument(e,t,a,moduleController)}function _deleteHearingDocument(t,e,a,r,o){o=o||!1,jQuery.ajax({url:getBaseURL()+r+"/delete_document_hearing",type:"POST",dataType:"JSON",data:{document_id:e,type:"hearing",hearing_id:t},success:function(e){pinesMessage({ty:e.status?"information":"error",m:e.message}),e.status&&(jQuery("#document-item-"+t).remove(),o)&&updateDocCount(o)},error:defaultAjaxJSONErrorsHandler})}function _deleteCommentDocument(t,e,a,r){a=a||!1,jQuery.ajax({url:getBaseURL()+r+"/delete_document_comment",type:"POST",dataType:"JSON",data:{document_id:e,id:t,newest_version:!0},success:function(e){pinesMessage({ty:e.status?"information":"error",m:e.message}),e.status&&(jQuery("#document-item-"+t).remove(),a)&&updateDocCount(a)},error:defaultAjaxJSONErrorsHandler})}function updateDocCount(e){var t,e=jQuery("#document-item-count-"+e);e&&(1<(t=e.data("count"))?(e.html('<a href="javascript:;">'+(t-1)+" "+_lang.documents+"</a>"),e.data("count",t-1)):(e.attr("onclick",""),e.html("0 "+_lang.documents),jQuery(".modal",jQuery("#document-dialog-container")).modal("hide")))}function targetDialogOpen(){var e=document.body;new MutationObserver(function(e){e.forEach(function(e,t){"childList"==e.type&&jQuery(e.addedNodes).hasClass("ui-dialog")&&disableAutocomplete(e.addedNodes)})}).observe(e,{attributes:!0,childList:!0,subtree:!0})}function initializeSelectPermissions(e){jQuery(".users-selectized",e).selectize({plugins:["remove_button"],valueField:"id",labelField:"name",searchField:["name"],options:availableUsers,createOnBlur:!0,groups:[{value:"user",label:"Users"},{value:"user_group",label:"User Groups"}],optgroupField:"class"}),jQuery(".user-groups-selectized",e).selectize({plugins:["remove_button"],valueField:"id",labelField:"name",searchField:["name"],options:availableUserGroups,createOnBlur:!0,groups:[{value:"user",label:"Users"},{value:"user_group",label:"User Groups"}],optgroupField:"class"})}function dropDownPosition(t){jQuery(".dropdown-toggle",t).on("click",function(){jQuery(this).each(function(){var e=(jQuery(t).offset().top+jQuery(t).height())/1.5;jQuery(this).offset().top>e&&"arabic"!=_lang.languageSettings.langName&&(e=400<10*jQuery(".select-picker .dropdown-menu.open",t).height()/100?13.4:10*jQuery(".select-picker .dropdown-menu.open",t).height()/100,jQuery(".bs-container.btn-group.bootstrap-select.select-picker.open").css({top:jQuery(this).offset().top-e,left:jQuery(this).offset().left+jQuery(this).width()+parseInt(jQuery(this).css("borderLeftWidth"))+parseInt(jQuery(this).css("padding-left"))+parseInt(jQuery(this).css("padding-right"))}))})})}function redirectToTab(e,t){sessionStorage.setItem("tab",t),window.location=e}function hearingJudgedEvent(e,t){var a=jQuery(e).is(":checked");jQuery(e,t).val(a?"yes":""),a?(jQuery("#judged-container").removeClass("d-none"),jQuery("input[name=judgment_date]",t).val(jQuery("input[name=startDate]",t).val())):(jQuery("#judged-container").addClass("d-none"),jQuery("input[name=judgment_date]",t).val(""))}function hearingSetJudgment(e,a,r){a=a||0,r=r||!1,(e=e||0)&&a?jQuery.ajax({url:getBaseURL()+"cases/hearings/"+a,type:"POST",dataType:"JSON",data:{hearingId:e,action:"hearingSetJudgment"},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?(jQuery('<div id="hearing-judgment-form-container"></div>').appendTo("body"),(t=jQuery("#hearing-judgment-form-container")).html(e.html),commonModalDialogEvents(t),setDatePicker("#sentence-date",t),makeFieldsHijriDatePicker({fields:["sentence-date-hijri"]}),jQuery("#sentence-date-hijri").val(gregorianToHijri(jQuery("#sentence-date-gregorian","#sentence-date-hijri-container").val())),jQuery(".select-picker",t).selectpicker(),initializeModalSize(t),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery("#form-submit",t).click(function(){hearingSubmitJudgment(t,a,r)}),jQuery(t).find("input").keypress(function(e){13==e.which&&hearingSubmitJudgment(t,a,r)})):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler}):pinesMessage({ty:"error",m:_lang.invalid_record})}function hearingSubmitJudgment(t,e,a){a=a||!1;var r=new FormData(document.getElementById(jQuery("form",t).attr("id")));r.append("action","hearingSubmitJudgment"),jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".modal-save-btn",t).attr("disabled","disabled")},data:r,type:"POST",url:getBaseURL()+"cases/hearings/"+e,contentType:!1,cache:!1,processData:!1,success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(jQuery("#hearingsGrid").length&&jQuery("#hearingsGrid").data("kendoGrid").dataSource.read(),jQuery("#hearing-judged-label").html(e.judged_label),jQuery("#hearing-judged-icon").attr("src","assets/images/icons/judged-yes.svg"),jQuery(".modal",t).modal("hide"),pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),a&&isFunction(a)&&a()):void 0!==e.validationErrors&&e.validationErrors?displayValidationErrors(e.validationErrors,t):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function quickAddStageStatus(e,t){jQuery.ajax({url:getBaseURL()+"stage_statuses/add/",dataType:"JSON",type:"GET",data:{add_edit_form:!0},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html&&jQuery("#stage-status-form-container").length<=0&&(jQuery("<div id='stage-status-form-container'></div>").appendTo("body"),(t=jQuery("#stage-status-form-container")).html(e.html),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",t).modal("hide")}),jQuery(".modal",t).modal({keyboard:!1,show:!0,backdrop:"static"}),resizeMiniModal(t),jQuery(window).bind("resize",function(){resizeMiniModal(t)}),jQuery("#form-submit",t).click(function(){var e=jQuery("form#stage-status-form",t).serializeArray();jQuery.ajax({beforeSend:function(){jQuery("#loader-global").show()},data:e,dataType:"JSON",type:"POST",url:getBaseURL()+"stage_statuses/add",success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(jQuery(".modal",t).modal("hide"),updateStageStatusLanguageRecords(t,e)):displayValidationErrors(e.validationErrors,t)},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}),jQuery("input",t).keypress(function(e){13==e.which&&(e.preventDefault(),jQuery("#form-submit",t).click())}),jQuery(".modal-body",t).on("scroll",function(){jQuery(".bootstrap-select.open").removeClass("open")}),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery(".modal").on("shown.bs.modal",function(e){jQuery("#field-name",t).focus()}),ctrlS(function(){jQuery("#form-submit",t).click()}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function updateStageStatusLanguageRecords(e,t){jQuery(".modal",e).modal("hide");e=jQuery("body").find("[data-field=administration-stage_statuses]");e.append(jQuery("<option/>",{value:t.id,text:t.name})),e.val(t.id),e.selectpicker("refresh")}function getCookie(e){var t=document.cookie,e=e+"=",a=t.indexOf("; "+e);if(-1==a){if(0!=(a=t.indexOf(e)))return null}else{a+=2;var r=document.cookie.indexOf(";",a);-1==r&&(r=t.length)}return decodeURI(t.substring(a+e.length,r))}function updateHiddenFields(e,t){jQuery(t).val(jQuery(e).is(":checked")?1:0)}function assignmentPerType(e,t,a,r){if(!e)return!1;jQuery.ajax({url:getBaseURL()+"assignments/return_rules",type:"GET",dataType:"JSON",data:{type:e,category:t},success:function(e){"task"===t?e.data?(jQuery("#user-relation",a).val(e.data.user.id),jQuery("#assignment-id",a).val(e.data.id),1==e.data.visible_assignee?jQuery(".assignee-container",a).removeClass("d-none"):jQuery(".assignee-container",a).addClass("d-none"),jQuery("#assignedToId",a).val(e.data.user.id),jQuery("#assignedToLookUp",a).val(e.data.user.name)):(jQuery(".assignee-container",a).removeClass("d-none"),jQuery("#assignedToId",a).val(""),jQuery("#assignedToLookUp",a).val(""),destroyUserLookup({hidden_id:jQuery("#assignedToId","#task-form"),lookup_field:jQuery("#assignedToLookUp","#task-form"),lookup_container:jQuery(".assignee-container","#task-form"),container:jQuery("#task-form")}),jQuery("#assignment-id",a).val(""),jQuery("#user-relation",a).val("")):e.data&&(jQuery("#user-relation",a).val(e.data.user_id),jQuery("#assignment-relation",a).val(e.data.assignment_relation),jQuery("#related-assigned-team",a).val(e.data.assigned_team),jQuery("#assignment-id",a).val(e.data.id),1==e.data.visible_assigned_team?jQuery("#assigned-team-container",a).removeClass("d-none"):jQuery("#assigned-team-container",a).addClass("d-none"),1==e.data.visible_assignee?jQuery("#assignee-container",a).removeClass("d-none"):jQuery("#assignee-container",a).addClass("d-none"),e.data.assigned_team&&r?(jQuery("#provider-group-id",a).val(e.data.assigned_team).selectpicker("refresh"),reloadUsersListByProviderGroupSelected(jQuery("#provider-group-id",a).val(),jQuery("#user-id",a),!0),jQuery("#user-id",a).val(e.data.user_id).selectpicker("refresh")):e.data.assigned_team&&jQuery("#provider-group-id",a).val()==e.data.assigned_team&&jQuery("#user-id",a).val(e.data.user_id).selectpicker("refresh"))},error:defaultAjaxJSONErrorsHandler})}function validateHumanReadableTime(e){e=e.val();e=(e=e.toLowerCase()).replace(/\s/g,"");if(!/^([0-9]+h?|[0-9]+h[0-9]m|[0-9]+h[0-5][0-9]m|^[0-9]m|[0-5][0-9]m|^[+-]?((\d+(\.\d*)?)|(\.\d+))h?$)$/i.test(e))return _lang.invalidFormat}function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return 0<t?parseInt(e.substring(t+5,e.indexOf(".",t)),10):0<e.indexOf("Trident/")?(t=e.indexOf("rv:"),parseInt(e.substring(t+3,e.indexOf(".",t)),10)):0<(t=e.indexOf("Edge/"))&&parseInt(e.substring(t+5,e.indexOf(".",t)),10)}function initializeSelectNotifications(e){jQuery(".select-picker",e).selectpicker({dropupAuto:!1}),jQuery("#notify-to",e).selectize({plugins:["remove_button"],placeholder:_lang.usersExternalEmails,delimiter:";",persist:!1,maxItems:null,valueField:"email",labelField:"email",searchField:["email"],createOnBlur:!0,options:availableEmails,items:externalToEmails,render:{item:function(e,t){return"<div>"+(e.email?'<span class="email">'+t(e.email)+"</span>":"")+"</div>"}},createFilter:function(e){var t=new RegExp("^"+REGEX_EMAIL+"$","i"),e=e.match(t);return!!e&&!this.options.hasOwnProperty(e[0])},create:function(e){return new RegExp("^"+REGEX_EMAIL+"$","i").test(e)?{email:e}:(alert("Invalid email address."),!1)}}),jQuery("#notify-cc",e).selectize({plugins:["remove_button"],placeholder:_lang.usersExternalEmails,delimiter:";",persist:!1,maxItems:null,valueField:"email",labelField:"email",searchField:["email"],createOnBlur:!0,options:availableEmails,items:externalCCEmails,render:{item:function(e,t){return"<div>"+(e.email?'<span class="email">'+t(e.email)+"</span>":"")+"</div>"}},createFilter:function(e){var t=new RegExp("^"+REGEX_EMAIL+"$","i"),e=e.match(t);return!!e&&!this.options.hasOwnProperty(e[0])},create:function(e){return new RegExp("^"+REGEX_EMAIL+"$","i").test(e)?{email:e}:(alert("Invalid email address."),!1)}})}function collapseExpandRows(e){jQuery("i.first-grouping",e).click(function(){$this=jQuery(this),$targetParent=$this.parent().parent(),($target=$targetParent.find("table.first-grouping")).is(":visible")?($target.hide(),$this.removeClass("fa-solid fa-angle-down"),$this.addClass("fa-solid fa-angle-right")):($target.show(),$this.removeClass("fa-solid fa-angle-right"),$this.addClass("fa-solid fa-angle-down"))})}function onchangeOperatorsFiltersToEmpty(e,t){t=jQuery("#"+t),e=jQuery(e).val(),t=jQuery(".empty-value-field",t);"empty"===e||"not_empty"===e?(t.hide(),t.val("null")):(t.show(),t.val(""))}function showMatterInCustomerPortal(e,t){preventFormPropagation(t),jQuery.ajax({dataType:"JSON",url:getBaseURL()+"cases/show_hide_matter_in_customer_portal/"+e,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?((t=document.getElementById("show-customer-dialog"))&&t.remove(),jQuery('<div id="show-customer-dialog"></div>').appendTo("body"),(t=jQuery("#show-customer-dialog")).html(e.html),jQuery(".select-picker",t).selectpicker(),initializeModalSize(t,.25,"auto"),commonModalDialogEvents(t,function(){})):e.result?(pinesMessageV2({ty:"success",m:_lang.hideInCustomerPortalSuccess.sprintf("Litigation"===e.category?[_lang.litigation.toLowerCase()]:[_lang.matter.toLowerCase()])}),jQuery("#legalCaseGrid").length?jQuery("#legalCaseGrid").data("kendoGrid").dataSource.read():(t=jQuery("#legal-case-top-header-profile","#legal-case-top-header-container"),jQuery("#cp-icon","#legal-case-top-header-container").removeClass(e.visible?"client-portal-grey":"client-portal-blue").addClass(e.visible?"client-portal-blue":"client-portal-grey"),t.removeClass(e.visible?"label-normal-style":"light_green").addClass(e.visible?"light_green":"label-normal-style"),jQuery("#visibleToCP",jQuery("#legalCaseAddForm")).val(e.visible?1:0),jQuery("#show-hide-btn","#edit-legal-case-container").text(e.visible?_lang.hideInCustomerPortal:_lang.showInCustomerPortal),t.tooltipster("destroy"),t.attr("title",e.visible?_lang.matterVisibleFromCP:_lang.hiddenInCP).tooltipster({contentAsHTML:!0,timer:22800,animation:"grow",delay:200,theme:"tooltipster-default",touchDevices:!1,trigger:"hover",maxWidth:350,interactive:!0}))):pinesMessageV2({ty:e.info?"information":"error",m:e.error||e.info,d:e.error?3e3:1e4})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function recommendMatterClosure(e,t){preventFormPropagation(t),jQuery.ajax({dataType:"JSON",url:getBaseURL()+"cases/recommend_case_closure/"+e,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?((t=document.getElementById("show-case-closure-dialog"))&&t.remove(),jQuery('<div id="show-case-closure-dialog"></div>').appendTo("body"),(t=jQuery("#show-case-closure-dialog")).html(e.html),jQuery(".select-picker",t).selectpicker(),initializeModalSize(t,.25,"auto"),commonModalDialogEvents(t,function(){})):e.result?(pinesMessageV2({ty:"success",m:_lang.hideInCustomerPortalSuccess.sprintf("Litigation"===e.category?[_lang.litigation.toLowerCase()]:[_lang.matter.toLowerCase()])}),jQuery("#legalCaseGrid").length&&jQuery("#legalCaseGrid").data("kendoGrid").dataSource.read()):pinesMessageV2({ty:e.info?"information":"error",m:e.error||e.info,d:e.error?3e3:1e4})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function addContactEmail(e,t){var a=t.val(),r=validateEmail(t);!0===r?jQuery.ajax({url:getBaseURL()+"contacts/add_email",method:"post",data:{contact_id:e,email:a},dataType:"json",success:function(e){e.status?(addContactEmailRow(e.contact_email.id,a,jQuery("#selected-emails")),t.val(null),pinesMessage({ty:"success",m:_lang.recordAddedSuccessfully})):pinesMessage({ty:"error",m:e.error_message})},beforeSend:function(){jQuery("#loader-global").show()},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler}):pinesMessage({ty:"error",m:r})}function disableFields(e){e="string"==typeof e?jQuery("#"+e):e,jQuery(".form-control, .btn, .btn-action",e).each(function(e,t){jQuery(this).attr("disabled","disabled")})}function disableAnchors(e){e="string"==typeof e?jQuery("#"+e):e,jQuery(".disable-anchor",e).each(function(e,t){jQuery(this).addClass("disabled-anchor"),jQuery(this).css("pointer-events","none")})}function showHideContainerInCp(a){jQuery.ajax({url:getBaseURL()+"case_containers/show_hide_container_in_cp/",type:"POST",dataType:"JSON",data:{id:a},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;jQuery("#loader-global").hide(),e.html?(jQuery("<div id='share-matters-container'></div>").appendTo("body"),(t=jQuery("#share-matters-container")).html(e.html),commonModalDialogEvents(t),initializeModalSize(t,.8),initializeSelectAllCheckbox(t),jQuery("#submit-actions",t).on("click",function(){var e=jQuery("form#shared-matters-form",t).serializeArray();jQuery.ajax({url:getBaseURL()+"case_containers/show_hide_container_in_cp/",dataType:"json",type:"POST",data:{id:a,form_data:e,submit_form:1},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.validation_errors?(t=jQuery("#share-matters-container"),jQuery(".inline-error").addClass("d-none"),displayValidationErrors(e.validation_errors,t)):!e.result&&e.info?pinesMessage({ty:"information",m:e.info}):(jQuery(".modal",t).modal("hide"),pinesMessage({ty:e.result?"success":"error",m:e.message}),updateContainerCpFlag(e))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})})):pinesMessage(e.result?{ty:"success",m:e.message}:{ty:e.info?"information":"error",m:e.error||e.info}),updateContainerCpFlag(e)},error:defaultAjaxJSONErrorsHandler})}function updateContainerCpFlag(e){e.result&&(0<jQuery("#caseContainerContainer").length?(jQuery(e.visible?".circle.gray":".circle.green","#caseContainerContainer").removeClass(e.visible?"gray":"green").addClass(e.visible?"green":"gray").attr("title",e.visible?_lang.containerVisibleFromCP:_lang.hiddenInCP),jQuery("#visible_in_cp","#caseContainerContainer").val(e.visible),jQuery("#show-hide-btn","#caseContainerContainer").text(e.visible?_lang.hideInCustomerPortal:_lang.showInCustomerPortal)):jQuery("#containerGrid").data("kendoGrid").dataSource.read())}function initializeSelectAllCheckbox(e){jQuery("#select-all",e).click(function(){jQuery('[data-field="record-checkbox"]',e).each(function(){this.checked=!!jQuery("#select-all",e).is(":checked")})})}function dismissAllNotification(){var t=jQuery("#notificationsListLatest");jQuery.ajax({url:getBaseURL()+"notifications/dismiss_all",type:"POST",dataType:"JSON",success:function(e){e.status?(t.empty(),t.html("<p>"+_lang.noLatestNotifications+"</p>"),pinesMessage({ty:"success",m:_lang.dismissAllSuccessfully}),jQuery("h3.popover-header",jQuery("#notificationsContainer").parent().parent()).html(_lang.notificationsCounter.sprintf([0])+notificationsPopoverIconClose)):e.empty?pinesMessage({ty:"information",m:_lang.noLatestNotifications}):pinesMessage({ty:"error",m:_lang.feedback_messages.updatesFailed})},error:defaultAjaxJSONErrorsHandler})}function selectTimeLogRelation(e){var t=jQuery("#add-edit-timer"),a=jQuery("#case-input-container",t),r=jQuery("#task-input-container",t),o=jQuery("#task",t),n=jQuery("#legal-caselookup",t);n.typeahead("val",""),o.typeahead("val",""),jQuery("#legal-caselookup-id",t).val(""),jQuery("#task-id",t).val(""),jQuery("#client-name",t).attr("readonly",!1),clearTimerTaskUnbindCase(!0),"case"===jQuery(e).val()?(r.addClass("d-none"),a.removeClass("d-none"),o.attr("disable",!0),n.attr("disable",!1)):(a.addClass("d-none"),r.removeClass("d-none"),o.attr("disable",!1),n.attr("disable",!0))}function selectTypeOfTransaction(e){var t=jQuery("#add-edit-timer"),a=jQuery("#client-input-container",t);"internal"===e?(disableClientInput(t,!0),a.addClass("d-none")):"case"===jQuery("input:radio[name=timer-type]:checked",t).val()||jQuery("#legal-caselookup-id",t).val()?(a.removeClass("d-none"),disableClientInput(t,!1)):(a.addClass("d-none"),disableClientInput(t,!0))}REGEX_EMAIL="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)","function"!=typeof String.prototype.parseDuration&&(String.prototype.parseDuration=function(e){var t,a;return/(^\dw|^\dd|^\d{1,2}h|^\d{1,2}m)/i.test(this)&&/\d[wdhm]$/.test(this)?this.toLowerCase().replace(/\s/g,"").replace(/w/g,"*"+$_systemDefaults.businessWeekEquals+"d").replace(/d/g,"*"+$_systemDefaults.businessDayEquals+" ").replace(/h/g,"/1 ").replace(/m/g,"/60 ").replace(/\s/g,"+")+"0":0<this.length?(t=(a=Math.floor(this)).toString().length,a=String(Math.floor(this))+"h "+String(Math.floor((this*Math.pow(10,t)-a*Math.pow(10,t))/Math.pow(10,t)*60))+"m",e?(e.addClass("label label-success").text(a),!1):a):(e&&e.removeClass("label label-success").text(""),"")}),jQuery(document).ready(function(){licensePackageAccessCheck();var e=jQuery.fn.removeClass,t={html:!0,trigger:"click",placement:"bottom",sanitize:!(jQuery.fn.removeClass=function(){return"modal-open"===arguments[0]&&1<jQuery(".modal.in").length?this:e.apply(this,arguments)}),content:'<div id="remindersListLatestContainer" style="width:220px;"><div class="reminders_list_latest loading" id="remindersListLatest">&nbsp;</div><p><a href="javascript:;" onclick="reminderForm();" class="btn btn-link" title="'+_lang.scheduleNewReminder+'">'+_lang.add+'</a><a href="'+getBaseURL()+'reminders/reminders_router" class=" btn btn-link" title="'+_lang.showAllReminders+'">'+_lang.showAll+"</a></p></div>"},a={html:!0,sanitize:!1,trigger:"click",placement:"bottom",content:'<div id="notificationsContainer"><div class="notifications_list_latest loading" id="notificationsListLatest">&nbsp;</div><p><a href="'+getBaseURL()+'notifications/broadcast" class="btn-notify btn-link" title="'+_lang.sendNotification+'">'+_lang.notify+'</a><a href="'+getBaseURL()+'notifications" class="btn-notify btn-link" title="'+_lang.showAllNotifications+'">'+_lang.showAll+'</a><span class="btn-notify btn-link" title="'+_lang.dismissAll+'" onclick="dismissAllNotification()">'+_lang.dismissAll+"</span></p></div>"};remindersPopoverIconClose="<a class=\"pull-right\" href=\"javascript:;\" onclick=\"jQuery('#pendingReminders').parent().popover('hide');if(remindersRefreshInterval!=''){refreshRemindersIntervalId = window.setInterval(function(){loadUserLatestReminders('refresh');}, remindersRefreshInterval);};return false;\"><span>x</span></a>",notificationsPopoverIconClose="<a class=\"pull-right\" href=\"javascript:;\" onclick=\"jQuery('#pendingNotifications').parent().popover('hide');if(notificationRefreshInterval!=''){refreshNotificationsIntervalId = window.setInterval(function(){loadLatestNotifications('refresh');}, notificationRefreshInterval);};return false;\"><span>x</span></a>",reminderPopoverAnchor=jQuery("#pendingReminders","#header_div").parent(),notificationPopoverAnchor=jQuery("#pendingNotifications").parent(),""!=remindersRefreshInterval&&(refreshRemindersIntervalId=window.setInterval(function(){loadUserLatestReminders("refresh")},remindersRefreshInterval)),reminderPopoverAnchor.attr("data-original-title",_lang.reminders+remindersPopoverIconClose).popover(t).on({click:function(e){e.preventDefault(),jQuery("#pendingNotifications").parent().popover("hide"),jQuery("#remindersListLatestContainer").parents().eq(1).hasClass("show")?loadUserLatestReminders("load_all"):jQuery("#remindersListLatest").addClass("loading").html("")}}),""!=notificationRefreshInterval&&(refreshNotificationsIntervalId=window.setInterval(function(){loadLatestNotifications("refresh")},notificationRefreshInterval)),notificationPopoverAnchor.attr("data-original-title",_lang.notifications+notificationsPopoverIconClose).popover(a).on({click:function(e){e.preventDefault(),jQuery("#pendingReminders").parent().popover("hide"),jQuery("#notificationsContainer").parents().eq(1).hasClass("show")?loadLatestNotifications("load_all"):jQuery("#notificationsListLatest").addClass("loading").html("")}}),jQuery(window).scroll(function(){100<jQuery(this).scrollTop()?jQuery(".scrollToTop").fadeIn():jQuery(".scrollToTop").fadeOut()}),jQuery(".scrollToTop").click(function(){return jQuery("html, body").animate({scrollTop:0},100),!1}),jQuery(".tooltipTable").each(function(e,t){jQuery(t).tooltipster({content:jQuery(t).attr("tooltipTitle"),contentAsHTML:!0,timer:22800,animation:"grow",delay:200,theme:"tooltipster-default",touchDevices:!1,trigger:"hover",maxWidth:350})}),jQuery(document).on("event","selector",function(){jQuery(this).parents("form:first").validationEngine("validate")?jQuery(".form-submit-loader").show():jQuery(".form-submit-loader").hide()}),jQuery("#main-container:has(.grid-header)").addClass("grid-main-container"),whatsNew(),jQuery(".dropdown-menu-timer").click(function(e){e.stopPropagation()}),jQuery(document).on("show.bs.modal",function(e){var t=jQuery(".modal",jQuery(this)).last();disableAutocomplete(t),t.not(".confirmation-dialog-modal")&&null==jQuery("form",t).data("serialize")&&setTimeout(function(){jQuery("form",t).data("serialize",jQuery("form",t).serialize())},200),jQuery('[data-dismiss="modal"]',t).on("click",function(e){var t=jQuery(this).closest("div.modal"),a=jQuery("form",t).data("serialize"),r=jQuery("form",t).serialize(),o=jQuery(".confirmation-dialog-container").length;if((a&&a.includes("clone")||a&&a.includes("trigger-create-task")||a&&a.includes("trigger-create-another"))&&(a=(a=(a=(a=(a=(a=a.replace("clone=no&","")).replace("clone=yes&","")).replace("trigger-create-task=yes&","")).replace("trigger-create-task=&","")).replace("trigger-create-another=yes&","")).replace("trigger-create-another=&",""),r=(r=(r=(r=(r=(r=r.replace("clone=no&","")).replace("clone=yes&","")).replace("trigger-create-task=yes&","")).replace("trigger-create-task=&","")).replace("trigger-create-another=yes&","")).replace("trigger-create-another=&","")),0==o&&null!=a&&a!==r&&!t.hasClass("esc-true"))return confirmationDialog("confirm_close_model",{resultHandler:null,modelOpen:t}),e.preventDefault(),e.stopImmediatePropagation(),!1})}),jQuery(document).on("keyup",function(e){if(27===(window.event?e.which:e.keyCode)&&jQuery("body").hasClass("modal-open")&&!jQuery('[data-dismiss="modal"]').last().closest("div.modal").hasClass("esc-true"))return jQuery('[data-dismiss="modal"]').last().click(),e.preventDefault(),e.stopImmediatePropagation(),!1}),targetDialogOpen(),helpers.onPageLoadEvents(),""!=userGuide&&isloggedIn,jQuery("a","#notificationsPageList").css("color","#6FD9C4"),jQuery("a","#notificationsPageList").hover(function(){jQuery(this).css({color:"#30CBAC","font-weight":700})},function(){jQuery(this).css({color:"#6FD9C4","font-weight":"normal"})}),jQuery(document).on("shown.bs.modal",".modal",function(){jQuery(this).find("[autofocus]").focus()})}),String.prototype.replaceAt=function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)};var onTimerTaskSelection=function(e){var t,a=jQuery("#add-edit-timer"),r=jQuery("input:radio[name=time-status]:checked",a).val();null!=e.legal_case_id?(jQuery("#legal-caselookup-id",a).val(e.legal_case_id),jQuery("#task-related-case-subject",a).html(e.description),showTimerTaskRelatedCaseSubject(e.caseSubject,a,e.category),t=jQuery("#client-input-container",a),jQuery("#client-id",a).val(e.client_id),jQuery("#client-name",a).val(e.client_name),"billable"===r?(t.removeClass("d-none"),null!=e.client_id?disableClientInput(a,!1,!0,!0):disableClientInput(a,!1,!0,!1)):(t.addClass("d-none"),null!=e.client_id?disableClientInput(a,!0,!0,!0):disableClientInput(a,!0,!0,!1))):clearTimerTaskUnbindCase(!1)};function showTimerTaskRelatedCaseSubject(e,t,a){e=_lang.relatedCase+": "+e+' <a target="_blank" href="'+getBaseURL()+(null==a||"IP"!=a?"cases":"intellectual_properties")+"/edit/"+jQuery("#legal-caselookup-id",t).val()+'">'+_lang.goTo+"</a>";jQuery("#task-related-case-subject",t).append("<br/>"+e)}function clearTimerTaskUnbindCase(e){e=e||!1;var t=jQuery("#add-edit-timer"),a=jQuery("#client-input-container",t);jQuery("input:radio[name=time-status]",t).prop("checked",!1),a.addClass("d-none"),jQuery("input:radio[name=time-status][value=internal]",t).prop("checked",!0),e&&jQuery("#task-id",t).val(""),jQuery("#legal-caselookup-id",t).val(""),jQuery("#task-related-case-subject",t).html(""),jQuery("#legal-caselookup-id",t).val(""),jQuery("#legal-caselookup",t).val(""),jQuery("#client-name",a).val("").attr("disable",!0)}var onTimerCaseLookup=function(e,t){var a=jQuery("#add-edit-timer"),r=jQuery("#client-input-container",a),o=jQuery("input:radio[name=time-status]:checked",a).val();jQuery("#client-id",a).val(e.client_id),jQuery("#client-name",a).val(e.clientName),"billable"===o?r.removeClass("d-none"):r.addClass("d-none"),null!=e.client_id?disableClientInput(a,!1,!0,!0):disableClientInput(a,!1,!0,!1)};function disableClientInput(e,t,a,r){a=a||!1,r=r||!1,jQuery("#client-id",e).attr("disable",t),jQuery("#client-name",e).attr("disable",t),a&&jQuery("#client-name",e).attr("readonly",r)}function contractFormEvents(e){jQuery(".select-picker",e).selectpicker({dropupAuto:!1}),setDatePicker("#contract-date",e),setDatePicker("#start-date",e),setDatePicker("#end-date",e),initializeModalSize(e),objectInitialization("parties",e),lookUpContacts(lookupDetails={lookupField:jQuery("#requester-lookup",e),hiddenId:"#requester-id",errorDiv:"requester_id",resultHandler:setRequesterToContract},jQuery(e)),lookUpUsers(jQuery("#authorized-signatory-lookup",e),jQuery("#authorized-signatory-id",e),"authorized_signatory",jQuery(".authorized-signatory-container",e),e),jQuery("#assignee-id",e).change(function(){"quick_add"==jQuery("#assignee-id",e).val()&&(jQuery("#assignee-id",e).val("").selectpicker("refresh"),addUserToTheProviderGroup(jQuery("#assigned-team-id",e).val(),"assignee-id",!0))}),jQuery("#assigned-team-id",e).change(function(){reloadUsersListByProviderGroupSelected(jQuery("#assigned-team-id",e).val(),jQuery("#assignee-id",e),!0)}),loadCustomFieldsEvents("custom-field-",e),lookupPrivateUsers(jQuery("#contributors-lookup",e),"contributors","#selected-contributors","contributors-container",e),jQuery("#type",e).change(function(){jQuery(this).val()&&contractTypeEvent(jQuery(this).val(),jQuery("#sub-type",e))})}function setRequesterToContract(e,t){var a=e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName;jQuery("#requester-lookup",t).val(a),jQuery("#requester-id",t).val(e.id),jQuery(".twitter-typeahead",t).length&&(jQuery("#requester-lookup",t).typeahead("destroy"),lookUpContacts(lookupDetails={lookupField:jQuery("#requester-lookup",t),hiddenId:"#requester-id",errorDiv:"requester_id",resultHandler:setRequesterToContract},jQuery(t)))}function setQuestionnairelookupValues(e,t){t=jQuery(t);var a=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName),r=e.name?"company":"contact";jQuery(".field-member-id",t).val(e.id),jQuery(".field-lookup",t).val(a),jQuery(".twitter-typeahead",t).length&&(jQuery(".field-lookup",t).typeahead("destroy"),e={lookupField:jQuery(".field-lookup",t),hiddenInput:jQuery(".field-member-id",t),errorDiv:jQuery(this).attr("data-lookup-type"),resultHandler:setQuestionnairelookupValues},lookupCompanyContactType(e,t,r))}function objectInitialization(e,t){var a=jQuery("#"+e+"-count",t).val(),r=1;jQuery("."+e+"-div",t).each(function(){a<r||(objectContainer=jQuery("#"+e+"-"+r,t),objectEvents(e,objectContainer),r++)})}function objectContainerClone(e,t,a){var r=jQuery("#"+e+"-container",t),o=parseInt(jQuery("#"+e+"-count",r).val()),n=(jQuery("#"+e+"-member-type",jQuery("."+e+"-div",r).last()).selectpicker("destroy"),jQuery("#"+e+"-category",jQuery("."+e+"-div",r).last()).selectpicker("destroy"),jQuery("."+e+"-div",r).last().clone()),i=o+1,s="#"+e+"-"+i;n.insertAfter(jQuery("."+e+"-div",r).last()).attr("id",e+"-"+i),jQuery("#"+e+"-member-type",jQuery("#"+e+"-"+o,r)).selectpicker(),jQuery("#"+e+"-category",jQuery("#"+e+"-"+o,r)).selectpicker(),jQuery("#"+e+"-count",r).val(i),jQuery(".delete-link-"+e,jQuery(s,r)).attr("onclick","objectDelete('"+e+"', "+i+",'"+t+"' , event)"),jQuery(".label-count",jQuery(s,r)).html(" ("+i+")"),jQuery("#"+e+"-member-id",jQuery(s,r)).val(""),jQuery("#"+e+"-lookup",jQuery(s,r)).val(""),jQuery("#"+e+"-member-type",jQuery(s,r)).find("option").removeAttr("selected"),jQuery("#"+e+"-category",jQuery(s,r)).find("option").removeAttr("selected"),jQuery(".delete-"+e,jQuery(s,r)).removeClass("d-none"),jQuery(".inline-error",jQuery(s,r)).attr("data-field",e+"_member_id_"+i).html(""),jQuery("#"+e+"-category",jQuery(s,r)).attr("data-field-id",e+"-category-"+i),jQuery("."+e+"-category-quick-add",jQuery(s,r)).removeAttr("onClick").click(function(){quickAdministrationDialog("party_categories",jQuery(t),!0,!1,!1,jQuery("[data-field-id="+e+"-category-"+i+"]"),!1,"contract")}),1==o&&jQuery(".delete-"+e,jQuery("#"+e+"-"+o,r)).removeClass("d-none"),objectEvents(e,jQuery(s,r)),a.preventDefault()}function objectEvents(e,t){var a=t.attr("id"),r="#"+a,a=a.charAt(a.length-1),o={lookupField:jQuery("#"+e+"-lookup",t),hiddenInput:jQuery("#"+e+"-member-id",t),errorDiv:e+"_member_id_"+a,resultHandler:setDataToObjectField};jQuery("#"+e+"-member-type",t).selectpicker().change(function(){jQuery("#"+e+"-lookup",t).val(""),jQuery("#"+e+"-member-id",t).val(""),jQuery(".inline-error",t).html(""),jQuery("#"+e+"-lookup",t).typeahead("destroy"),companyContactFormMatrix.commonLookup[r].lookupType=jQuery("select#"+e+"-member-type",t).val(),lookupCompanyContactType(o,t)}),jQuery("#"+e+"-category",t).selectpicker(),companyContactFormMatrix.commonLookup[r]={lookupType:jQuery("select#"+e+"-member-type",t).val(),referalContainerId:t},jQuery("#"+e+"-lookup",t).typeahead("destroy"),lookupCompanyContactType(o,t)}function setDataToObjectField(e,t){t=jQuery(t);var a=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName),r="parties";jQuery("#"+r+"-member-id",t).val(e.id),jQuery("#"+r+"-lookup",t).val(a),jQuery(".twitter-typeahead",t).length&&(jQuery("#"+r+"-lookup",t).typeahead("destroy"),e={lookupField:jQuery("#"+r+"-lookup",t),hiddenInput:jQuery("#"+r+"-member-id",t),errorDiv:r+"_member_id_"+t.attr("id").charAt(t.attr("id").length-1),resultHandler:setDataToObjectField},lookupCompanyContactType(e,t))}function objectUpdateLabels(e,t){var a=jQuery("#"+e+"-container",t),r=jQuery("#"+e+"-count",a).val(),o=1;jQuery("."+e+"-div",a).each(function(){if(!(o<=r))return!0;jQuery(this).attr("id",e+"-"+o),jQuery(".label-count",this).html(" ("+o+")"),jQuery(".inline-error",this).attr("data-field",e+"_member_id_"+o),jQuery(".delete-link-"+e,this).attr("onclick","objectDelete('"+e+"', "+o+",'"+t+"' , event)"),jQuery("[data-field=administration-party_categories]",this).attr("data-field-id","contract-categories-"+o),jQuery("."+e+"-category-quick-add",this).removeAttr("onClick").attr("onclick","quickAdministrationDialog('party_categories', "+t+"' , "+!0+", "+!1+", "+!1+", "+jQuery("[data-field-id="+e+"-category-"+o+"]")+")",!1,"contract"),o++}),objectInitialization(e,t)}function objectDelete(e,t,a,r){var o=jQuery("#"+e+"-container",a),n=jQuery("#"+e+"-count",o).val();1<n?(jQuery("#"+e+"-"+t,o).remove(),companyContactFormMatrix.commonLookup={},jQuery("#"+e+"-count",o).val(n-1),objectUpdateLabels(e,a),1==jQuery("#"+e+"-count",o).val()&&jQuery(".delete-"+e,o).addClass("d-none")):pinesMessage({ty:"warning",m:_lang.invalid_request}),r.preventDefault()}function zoomMeetingForm(){var a=Math.round(Math.random()*(upperBound-lowerBound)+lowerBound);jQuery.ajax({dataType:"JSON",type:"POST",url:getBaseURL()+"zoom_meetings/create_zoom_meeting",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html&&(t="#zoom-meeting-dialog-"+a,jQuery(t).length<=0)&&(jQuery('<div id="zoom-meeting-dialog-'+a+'"></div>').appendTo("body"),(t=jQuery(t)).html(e.html),jQuery("form",t).attr("id","contact-add-form-"+a),jQuery("#contact-add-form-"+a).validationEngine({validationEventTrigger:"submit",autoPositionUpdate:!0,promptPosition:"bottomRight",scroll:!1}),initializeModalSize(t,.5,.45),lookupPrivateUsers(jQuery("#lookup-participants",t),"participants","#selected-participants","participants-container",jQuery("#zoom-meeting-body")),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function hoursToMinutesHours(e){var t=(e%1).toFixed(2),a=0;return 0<(a=0<t?60*t:a)?0<Math.floor(e)?Math.floor(e)+"h "+parseFloat(a).toFixed(0)+"m":parseFloat(a).toFixed(0)+"m":0<Math.floor(e)?Math.floor(e)+"h":"0"}function submitManageMoneyAccounts(e,t,a){var r=jQuery("form#manage-money-accounts-form").serializeArray(),o=jQuery("#target-model","#manage-money-accounts-form").val();jQuery.ajax({beforeSend:function(){jQuery("#loader-global").show()},type:"POST",dataType:"JSON",data:r,success:function(e){e&&(jQuery("#loader-global").hide(),e.error?pinesMessage({ty:"information",m:e.error}):e.result?(e.result,jQuery(".modal",jQuery("#manage-money-accounts-dialog")).modal("hide")):pinesMessage({ty:"information",m:_lang.feedback_messages.updatesFailed}))},error:defaultAjaxJSONErrorsHandler,url:getBaseURL()+"contacts/manage_money_accounts/"+e+"/"+t+"/"+a+"/"+o})}function renewSubscription(){window.location=getBaseURL()+"subscription/details"}function upgradeSubscription(){window.location=getBaseURL()+"subscription/details"}function subscriptionAddUser(){jQuery.ajax({beforeSend:function(){jQuery("#loader-global").show()},type:"POST",dataType:"JSON",success:function(e){e&&(e.error?(jQuery("#loader-global").hide(),pinesMessage({ty:"information",m:e.error})):(jQuery(".modal",jQuery("#subscription-msg-dialog")).modal("hide"),document.getElementById("overlay-container").style.height="100%",$subscribeTempContainer=jQuery('<div id="adjust-temp-Form"></div>').addClass("d-none").appendTo("body").html(e.html),jQuery("form#subscribe-temp-form",$subscribeTempContainer).submit(),$subscribeTempContainer.remove()))},error:defaultAjaxJSONErrorsHandler,url:getBaseURL()+"subscription/add_user"})}function displaySubscriptionAdditionalUserForm(){jQuery.ajax({beforeSend:function(){jQuery("#loader-global").show()},type:"POST",dataType:"JSON",success:function(e){var t;e&&(jQuery("#loader-global").hide(),e.error?pinesMessage({ty:"information",m:e.error}):e.request_being_processed?pinesMessage({ty:"information",m:e.request_being_processed}):(jQuery("#subscription-msg-dialog").length||jQuery("<div id='subscription-msg-dialog'></div>").appendTo("body"),(t=jQuery("#subscription-msg-dialog")).html(e.html),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",t).modal("hide")})))},error:defaultAjaxJSONErrorsHandler,url:getBaseURL()+"subscription/add_user_window"})}function TimerFormCancel(e,t){confirmationDialog("cancel_timer_message",{resultHandler:function(){jQuery("#cancel-time-log").val(!0),jQuery("#less-one-min").val(!1),TimerFormSubmit(e,t)},onCloseHandler:function(){jQuery("#cancel-time-log").val(!1),jQuery("#less-one-min").val(!1)}})}function convertMinsToHrsMins(e){var t=e.val().toLowerCase().replace(" ",""),a=parseFloat(0),r=t.split("h"),o=t.split("m"),r=-1<r[0].indexOf("m")?"":r[0],n=r+"h",n=-1<o[0].indexOf("h")?o[0].replace(n,""):-1<t.indexOf("m")||-1<t.indexOf("h")?o[0]:"";r&&(a+=parseFloat(r)),n&&(t=n%60,0<(a+=Math.floor(n/60,2))?0<t?e.val(a+"h "+t+"m"):e.val(a+"h"):0<t?e.val(t+"m"):e.val(""))}var ajaxEvents={completeEventsAction:function(e,t,a,r,o){a=a||{},t=t||!1,r=r||_lang.save,o=o||_lang.saveAndDuplicate;var n=a.hasOwnProperty("duplicate_button")?"."+a.duplicate_button:".duplicate-button",a=a.hasOwnProperty("save_button")?"."+a.save_button:".save-button";jQuery("#loader-global").hide(),t?jQuery(n,e).html(o):jQuery(a,e).html(r),jQuery(n,e).attr("disabled",!1),jQuery(a,e).attr("disabled",!1)},beforeActionEvents:function(e,t,a){t=t||!1;var r=(a=a||{}).hasOwnProperty("duplicate-button")?"."+a.duplicate_button:".duplicate-button",a=a.hasOwnProperty("save-button")?"."+a.save_button:".save-button";jQuery("#loader-global").show(),jQuery(r,e).attr("disabled",!0),jQuery(a,e).attr("disabled",!0),(t?jQuery(r,e):jQuery(a,e)).html(saveHtml)},displayValidationError:function(e,t,a){jQuery(".inline-error",t).removeClass("validation-error"),jQuery(".input-warning",t).removeClass("input-warning");var r=0<jQuery("div",t).find("[data-field="+e+"]").length?jQuery("div",t).find("[data-field="+e+"]"):0<jQuery("td",t).find("[data-field="+e+"]").length&&jQuery("td",t).find("[data-field="+e+"]");r?(r.removeClass("d-none").html(a).addClass("validation-error"),jQuery("input[data-field="+e+"]",t).each(function(){""===this.value&&jQuery(this).addClass("input-warning")})):pinesMessage({ty:"error",m:_lang[a].sprintf([_lang[e]])})},onSuccessfulChange:function(e,t,a){a=a||{},(t=!(!t||!a.hasOwnProperty("change_on_duplicate"))&&a.change_on_duplicate)&&isFunction(t)&&a.change_on_duplicate()}},timeLogsDialog=(()=>{function o(e,t,a,r){a=a||"false",r=r||"false";var o=jQuery("#add-edit-time-log"),n=jQuery(t,o),t=jQuery(t+" :input",o);e?(n.addClass("d-none").fadeIn(500),t.prop("disabled",!0),t.prop("readonly",!0)):(n.removeClass("d-none").fadeOut(0).fadeIn(500),"false"!=r?t.prop("disabled",!0):t.prop("disabled",!1),"false"!=a?t.prop("readonly",!0):t.prop("readonly",!1))}function n(e){var t=jQuery("#add-edit-time-log"),a=jQuery("#log-options-menu",t).val();e?(o(!0,"#client-lookup-wrapper",!0),jQuery("#billable",t).parent().removeClass("pull-right"),jQuery("#billable",t).prop("checked",!0),jQuery("#billable",t).val("internal"),jQuery("#billable-id",t).val("internal"),jQuery("#split-time-link",t).addClass("d-none")):(jQuery("#billable",t).prop("checked",!1),!jQuery("#legal_case_id",t).val()||"null"!=jQuery("#client-id",t).val()&&""!=jQuery("#client-id",t).val()?o(!1,"#client-lookup-wrapper",!0):"case"==a?o(!1,"#client-lookup-wrapper","false"):o(!0,"#client-lookup-wrapper"),jQuery("#billable",t).parent().addClass("pull-right"),jQuery("#split-time-link",t).removeClass("d-none"),jQuery("#billable",t).prop("checked",!1),jQuery("#billable",t).val("billable"),jQuery("#billable-id",t).val("billable"))}function i(e){var t=jQuery("#add-edit-time-log");jQuery("#audit-id-lable",t).html(jQuery("#task_id",t).val()?_lang.taskId:_lang.caseId),jQuery("#audit-id",t).html(jQuery("#task_id",t).val()?e.task_id:e.caseID||e.legalCaseLookup),jQuery("#audit-modified-date",t).html(e.modifiedOn),jQuery("#audit-workflow",t).html(jQuery("#task_id",t).val()?e.taskStatus:e.status),jQuery("#created-by-audit",t).html(e.createdByName),jQuery("#created-on-audit",t).html(e.createdOn),jQuery("#modified-by-audit",t).html(e.modifiedByName)}function r(){var e=jQuery("#add-edit-time-log");jQuery("#client-id",e).val(""),jQuery("#client-name",e).typeahead("val",""),jQuery("#client-name",e).prop("readonly")}function s(t,a){var r=jQuery("#add-edit-time-log"),e=jQuery("form#userActivityLogForm",r).serializeArray().map(function(e){return"case_lookup"!=e.name&&"task_lookup"!=e.name&&"comments"!=e.name||(e.value=escapeHtml(e.value)),e}),o=(e.push({name:"duplicate",value:a}),jQuery("#id",r).val()),o=o?getBaseURL()+"time_tracking/"+t+"/"+o:getBaseURL()+"time_tracking/"+t;jQuery.ajax({dataType:"JSON",url:o,data:e,type:"POST",beforeSend:function(){ajaxEvents.beforeActionEvents(r,a)},success:function(e){switch(0<jQuery("#my-dashboard").length&&loadDashboardData("time_logs"),jQuery(".inline-error").addClass("d-none"),e.status){case"200":if(pinesMessageV2({ty:"success",m:e.msg}),e.warning&&pinesMessageV2({ty:"warning",m:e.warning}),a||jQuery(".modal","#time-log-dialog").modal("hide"),null!=$legalCaseGrid)try{$legalCaseGrid.data("kendoGrid").dataSource.read()}catch(e){}if(null!=$timeTrackingGrid)try{$timeTrackingGrid.data("kendoGrid").dataSource.read()}catch(e){}if(null!=$tasksGrid)try{$tasksGrid.data("kendoGrid").dataSource.read()}catch(e){}if(null!=$moneyTimeTrackingGrid)try{$moneyTimeTrackingGrid.data("kendoGrid").dataSource.read()}catch(e){}if(null!=$bulkTimeTrackingGrid)try{$bulkTimeTrackingGrid.data("kendoGrid").dataSource.read()}catch(e){}jQuery("#client-account-status","#object-header").length&&jQuery("#case-id","#object-header").val()==jQuery("#legal_case_id",r).val()&&!jQuery("#billable",r).is(":checked")&&clientTransactionsBalance({case:jQuery("#legal_case_id",r).val(),client:jQuery("#client-id",r).val()},jQuery("#client-account-status","#object-header"),jQuery("#controller","#object-header").val()),ajaxEvents.onSuccessfulChange(r,a,{change_on_duplicate:function(){jQuery("#effectiveEffortHour",r).val(""),jQuery("#form-action",r).val("add"),jQuery("#split_billable_time_value",r).val(""),jQuery("#split_none_billable_time_value",r).val(""),jQuery("#splited-time-value",r).html(""),jQuery("#split-time-link",r).addClass("d-none"),jQuery("#log-date",r).val(jQuery.datepicker.formatDate("yy-mm-dd",new Date)),jQuery("#id",r).val(""),jQuery("form#userActivityLogForm",r).attr("action",getBaseURL()+"time_tracking/add")}});break;case"400":"dates"in e?timeEntryConfirmation(e,t):displayValidationErrors(e.validationErrors,r);break;case"401":pinesMessageV2({ty:"error",m:_lang.you_do_not_have_enough_previlages_to_access_the_requested_page})}},complete:function(){ajaxEvents.completeEventsAction(r,a)},error:defaultAjaxJSONErrorsHandler})}function l(e,t){jQuery("#entity-time-log-wrapper").addClass("d-none").fadeOut(0).fadeIn(500),jQuery("#fixed-rate-input",t).val(""),e?(jQuery("#rate-time-log-lookup-wrapper").removeClass("d-none").fadeOut(0).fadeIn(500),jQuery("#related-entity").removeClass("d-none").fadeOut(0).fadeIn(500)):(o(!0,"#fixed-rate-time-wrapper"),jQuery("#rate-time-log-lookup-wrapper").addClass("d-none").fadeIn(500),jQuery("#related-entity").addClass("d-none").fadeIn(500),jQuery("#rate-time-log",t).selectpicker("val",""))}function d(){var t=jQuery("#add-edit-time-log"),e=jQuery("form#userActivityLogForm",t).serializeArray();jQuery.ajax({url:getBaseURL()+"cases/get_system_rate",data:e,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.status&&"system_rate"==jQuery("#rate-time-log").val()?jQuery("#fixed-rate-input",t).val(e.rate):jQuery("#fixed-rate-input",t).val()},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}return{changeTimeLogAction:function(e,t){t=t||!0;var a=jQuery("#add-edit-time-log");jQuery("#log-options-menu",a).trigger("logType:toggle"),jQuery("#task_id",a).val(""),jQuery("#task_lookup",a).typeahead("val",""),jQuery("#legal_case_id",a).val(""),jQuery("#case_lookup",a).typeahead("val",""),jQuery("#audit-info-toggle-link",a).addClass("d-none"),jQuery("#audit-info",a).addClass("d-none"),r(),"no"!==t&&d(),"task"==jQuery(e,a).val()?(o(!0,"#matter_lookup_wrapper"),o(!1,"#task_lookup_wrapper")):(o(!1,"#matter_lookup_wrapper"),o(!0,"#task_lookup_wrapper")),jQuery("#billable",a).is(":checked")?(o(!0,"#client-lookup-wrapper",!0),jQuery("#billable",a).parent().removeClass("pull-right")):(o(!1,"#client-lookup-wrapper",!0),jQuery("#billable",a).parent().addClass("pull-right"))},billableChecked:function(e){var t=jQuery("#add-edit-time-log"),a=jQuery("#task_id",t).val(),r=jQuery("#client-id",t).val();jQuery(e,t).is(":checked")?(n(!0),jQuery("#billable",t).val("internal"),jQuery("#billable-id",t).val("internal"),l(!1,t)):(!a||r?(n(!1),l(!0,t)):jQuery("#split-time-link",t).removeClass("d-none"),jQuery("#billable",t).val("billable"),jQuery("#billable-id",t).val("billable"))},repeatInput:function(e){var t=jQuery("#add-edit-time-log"),a=jQuery(e,t).parent();jQuery(e,t).is(":checked")?(jQuery("#to-date-wrapper",t).removeClass("d-none").fadeOut(0).fadeIn(500),a.addClass("pull-right"),e=new Date(jQuery("#log-date",t).val()),e=new Date(e.setDate(e.getDate()+1)),jQuery("#repeat-until-date-input",t).datepicker("option","setStartDate",e)):(a.removeClass("pull-right"),jQuery("#to-date-wrapper",t).addClass("d-none").fadeOut(500),jQuery("#repeat-until-date-input",t).val(""))},logTimeSave:function(e,t){var a=jQuery("#add-edit-time-log");jQuery("#is-repeat",a).is(":checked")&&""!==jQuery("#repeat-until-date-input",a).val()?confirmationDialog("multiple_time_logs_confirmation",{resultHandler:function(){s(e,t)}}):s(e,t)},onCaseLookup:function(e){var t=jQuery("#add-edit-time-log"),a=(d(),t),r=e;jQuery("#client-id",a).val(r.client_id),jQuery("#client-name",a).val(r.clientName),r.client_id?(jQuery("#client-name",a).prop("readonly"),jQuery("#client-name",a).prop("disabled"),jQuery("#client-id",a).prop("disabled"),o(!0,"#client-lookup-wrapper",!0)):(jQuery("#client-name",a).removeProp("readonly"),jQuery("#client-name",a).removeProp("disabled"),jQuery("#client-id",a).removeProp("disabled"),o(!1,"#client-lookup-wrapper",!0)),n(jQuery("#billable",a).is(":checked")),jQuery("#audit-info-toggle-link",t).removeClass("d-none"),i(e)},splitTime:function(){var o,e=jQuery("#add-edit-time-log"),t=jQuery("#effectiveEffortHour",e).val();timeValidation(t)?(jQuery(".inline-error",e).removeClass("validation-error"),jQuery('*[data-field="effectiveEffort"]',e).addClass("d-none"),t=t,o=jQuery("#add-edit-time-log"),t=getBaseURL().concat("time_tracking/split_time/").concat(t),jQuery.ajax({url:t,data:{},dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var a,r;e.status&&(jQuery('<div id="split-time-container"></div>').appendTo("body"),(a=jQuery("#split-time-container")).html(e.html),initializeModalSize(a,.35,"auto"),commonModalDialogEvents(a),r=jQuery("#original-time",a).val(),jQuery("#log-date",o).val()&&(jQuery("#split-date-wrapper span",a).html(jQuery("#log-date",o).val()),jQuery("#split-date-wrapper",a).removeClass("d-none")),jQuery("#effective-effort-hour-billable",a).keyup(function(){var e,t=convertTimeToDecimal(r);jQuery(this).val()&&(e=convertTimeToDecimal(jQuery(this).val()))&&jQuery("#effective-effort-hour-non-billable",a).val(convertDecimalToTime({time:(t-e).toFixed(2)}))}),jQuery("#split-time-dialog-submit",a).click(function(){var e=convertTimeToDecimal(jQuery("#effective-effort-hour-billable",a).val()),t=convertTimeToDecimal(r);jQuery("#effective-effort-hour-billable",a).val()?e?t<=e?ajaxEvents.displayValidationError("effective-effort-hour-billable",a,_lang.splitTimeMessage):(jQuery("#splited-time-value",o).html(_lang.BillableNonBillable.sprintf([convertDecimalToTime({time:e}),jQuery("#effective-effort-hour-non-billable",a).val()])),jQuery("#split-none-billable-time-value",o).val(jQuery("#effective-effort-hour-non-billable",a).val()),jQuery("#split-billable-time-value",o).val(jQuery("#effective-effort-hour-billable",a).val()),jQuery(".modal","#split-time-container").modal("hide")):ajaxEvents.displayValidationError("effective-effort-hour-billable",a,_lang.timeValidateFormat.sprintf([_lang.timeTrackingStatus.billable])):ajaxEvents.displayValidationError("effective-effort-hour-billable",a,_lang.validation_field_required.sprintf([_lang.timeTrackingStatus.billable]))}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})):ajaxEvents.displayValidationError("effectiveEffort",e,_lang.timeValidateFormat.sprintf([_lang.effort]))},onEraseCaseLookup:function(){var e=jQuery("#add-edit-time-log");r(),jQuery("#audit-info",e).addClass("d-none"),jQuery("#audit-info-toggle-link",e).addClass("d-none")},onErasetaskLookup:function(){jQuery("#rate-time-log",void 0).selectpicker("val",""),l(!1,void 0);var e=jQuery("#add-edit-time-log");r(),jQuery("#audit-info",e).addClass("d-none"),jQuery("#audit-info-toggle-link",e).addClass("d-none"),o(!0,"#rate-time-log-lookup-wrapper")},onTaskLookup:function(e){var t,a,r=jQuery("#add-edit-time-log");jQuery("#rate-time-log",r).selectpicker("val",""),l(!1,r),t=r,a=e,jQuery("#client-id",t).val(a.client_id),jQuery("#client-name",t).val(a.client_name),a.client_id?(jQuery("#client-name",t).prop("readonly"),jQuery("#client-name",t).prop("disabled"),jQuery("#client-id",t).prop("disabled"),o(!0,"#client-lookup-wrapper",!0),n(jQuery("#billable",t).is(":checked")),o(!1,"#rate-time-log-lookup-wrapper",!1)):(o(!0,"#client-lookup-wrapper"),o(!0,"#rate-time-log-lookup-wrapper"),jQuery("#billable",t).parent().removeClass("pull-right")),i(e),jQuery("#audit-info-toggle-link",r).removeClass("d-none")},setLookupValue:function(e,t,a){var r=jQuery("#add-edit-time-log");"task"===e?jQuery.isEmptyObject(t)||(jQuery("#task_id",r).val(t.taskId),jQuery("#task_lookup",r).typeahead("val",getTaskLookUpDisplayName(t)),jQuery("#audit-info-toggle-link",r).removeClass("d-none"),t.task_legal_case&&t.clientId&&t.clientName?(jQuery("#client-name",r).typeahead("val",t.clientName),jQuery("#client-id",r).val(t.clientId)):(o(!0,"#client-lookup-wrapper"),jQuery("#billable",r).parent().removeClass("pull-right")),i(t),jQuery.isEmptyObject(t)&&0==a&&(jQuery("#billable",r).val("billable"),jQuery("#billable-id",r).val("billable"),jQuery("#billable",r).prop("checked",!1))):(jQuery.isEmptyObject(t)||(jQuery("#legal_case_id",r).val(t.legalCaseLookupId),jQuery("#client-id",r).val(t.clientId),jQuery("#case_lookup",r).typeahead("val",t.legalCaseLookup+": "+t.legalCaseSubject),""!=t.clientName?(jQuery("#client-name",r).typeahead("val",t.clientName),o(!0,"#client-lookup-wrapper",!0)):o(!1,"#client-lookup-wrapper",!0),jQuery("#audit-info-toggle-link",r).removeClass("d-none"),i(t)),n("undefined"!=typeof timeTrackingBillable&&0!=timeTrackingBillable?0==timeTrackingBillable:!(0==a)))},addClientInput:n,taskLogTypeSelected:function(e,t){o(!1,"#rate-time-log-lookup-wrapper"),jQuery("#rate-time-log",t).selectpicker("val",""),jQuery("#fixed-rate-input",t).val("")},matterLogTypeSelected:function(e,t){o(!0,"#rate-time-log-lookup-wrapper"),o(!0,"#fixed-rate-time-wrapper"),jQuery("#entity-time-log-wrapper").addClass("d-none").fadeIn(500)},onChangeRate:function(e,t,a){t=t||!0,a=a||!0;var r=jQuery("#add-edit-time-log");getSystemRateValue?jQuery("#fixed-rate-input",r).val(""):getSystemRateValue=!0,"no"!==t&&d(),"fixed_rate"==jQuery(e).val()?(o(!1,"#fixed-rate-time-wrapper"),jQuery("#entity-time-log-wrapper",r).addClass("d-none").fadeIn(500),jQuery("#related-entity",r).addClass("d-none").fadeIn(500)):"system_rate"==jQuery(e).val()?(o(!1,"#fixed-rate-time-wrapper",!0),jQuery("#rate-section-time-log-wrapper",r).removeClass("d-none").fadeOut(0).fadeIn(500),jQuery("#entity-time-log-wrapper",r).addClass("d-none").fadeOut(0).fadeIn(500),jQuery("#related-entity",r).removeClass("d-none").fadeOut(0).fadeIn(500)):(jQuery("#rate-section-time-log-wrapper",r).addClass("d-none").fadeIn(500),jQuery("#entity-time-log-wrapper",r).addClass("d-none").fadeIn(500),jQuery("#related-entity",r).addClass("d-none").fadeIn(500),o(!0,"#fixed-rate-time-wrapper"),jQuery("#billable",r).is(":checked")?jQuery("#rate-time-log-lookup-wrapper",r).addClass("d-none").fadeIn(500):"noClient"!=a&&jQuery("#rate-time-log-lookup-wrapper",r).removeClass("d-none").fadeOut(0).fadeIn(500))},onChangeEntity:function(){d()},onUserLookupSelect:function(){getSystemRateValue&&d()},showEntity:function(){o(!1,"#entity-time-log-wrapper")}}})(),timeActions={get_next_date:function(e){var t=new Date(e);return(e=new Date(e)).setDate(t.getDate()+1),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)},get_next_week:function(e){var t=new Date(e);return(e=new Date(e)).setDate(t.getDate()+7),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)},get_previous_week:function(e){var t=new Date(e);return(e=new Date(e)).setDate(t.getDate()-7),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)},get_current_date:function(e){return(e=new Date(e)).getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)},get_previous_month:function(e){var t=new Date(e);return(e=new Date(e)).setMonth(t.getMonth()-1),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)},get_next_month:function(e){var t=new Date(e);return(e=new Date(e)).setMonth(t.getMonth()+1),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}},helpers={capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},getSettingGridTemplate:function(e){var a="";return Array.isArray(e)&&e.length&&jQuery.each(e,function(e,t){a+='<a class="dropdown-item" href="javascript:;" '+t[0]+">"+t[1]+"</a>"}),'<div class="dropdown"><a class="dropdown-toggle-new btn btn-default btn-sm dms-action-wheel" data-toggle="dropdown" href="##"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-three-dots-vertical" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>\n</svg></a><div class="dropdown-menu" role="menu" aria-labelledby="dLabel">'+a+"</div></div>"},numberWithCommas:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},getObjectFromArr:function(t,a,r,o){o=void 0===o.value?o:o.value;var n="";return jQuery.each(t,function(e){e=t[e];if(e[r]==o)return n=e[a],!0}),n},readonlyFieldsEnable:function(e,a){a=a||"false",e="string"==typeof e?jQuery("#"+e):e,jQuery(".form-control, .btn, select, .select-picker, .input-group-addon, .dropdown-toggle",e).each(function(e,t){jQuery(this).prop("readonly","false"===a)}),jQuery(".btn, input[type=checkbox], .duplicate-button",e).each(function(e,t){jQuery(this).attr("disabled","disabled")})},onPageLoadEvents:function(){jQuery(".notification-send-email").on("click",function(){var e=jQuery(this).find("input:checkbox");e.prop("checked")?e.val(1):e.val(0)});var e=jQuery(".active-title").parent().parent().siblings();e.hasClass("nav-link")&&e.addClass("opacity-title")}};function renewalEvents(e){if("unlimited_period"==jQuery("#renewal",e).val())return jQuery("#end-date-input",e).val(""),hideRemindMeBefore(e),jQuery("#notify-me-before-link",e).addClass("d-none"),!0;notifyMeBefore(e);var t,a,r=jQuery("#start-date-input",e).val();r&&""==jQuery("#end-date-input",e).val()&&(a=(r=new Date(r)).getFullYear(),t=r.getMonth(),r=r.getDate(),a=new Date(a+1,t,r),jQuery("#end-date-input").val(jQuery.datepicker.formatDate("yy-mm-dd",a))),renewalLookupsEvents(e)}function renewalLookupsEvents(e){jQuery("#notify-to-emails",e).selectize({plugins:["remove_button"],placeholder:_lang.usersExternalEmails,delimiter:";",persist:!1,maxItems:null,valueField:"email",labelField:"email",searchField:["email"],createOnBlur:!0,options:availableEmails,items:selectedEmails,render:{item:function(e,t){return"<div>"+(e.email?'<span class="email">'+t(e.email)+"</span>":"")+"</div>"}},createFilter:function(e){var t=new RegExp("^"+REGEX_EMAIL+"$","i"),e=e.match(t);return!!e&&!this.options.hasOwnProperty(e[0])},create:function(e){return new RegExp("^"+REGEX_EMAIL+"$","i").test(e)?{email:e}:(alert("Invalid email address."),!1)}}),jQuery("#notify-to-teams",e).selectize({plugins:["remove_button"],valueField:"id",labelField:"name",searchField:["name"],options:availableAssignedTeams})}function lookUpContracts(a,r,o,t){o=o||!1,t=t||!1;var e=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("name")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL("contract")+"contracts/autocomplete?term=%QUERY",filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});e.initialize(),a.lookupField.typeahead({hint:!1,highlight:!0,minLength:2},{source:e.ttAdapter(),display:function(e){return t?e.name:e.contract_id+": "+e.name},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return'<div title="'+e.name+'">'+e.contract_id+": "+e.name+"</div>"}}}).on("typeahead:selected",function(e,t){a.lookupField.attr("title",t.name),jQuery("#contract-name",r).removeClass("d-none"),jQuery("#contract-link",r).attr("onclick","contractForm('"+t.id+"')"),void 0!==a.callback&&a.callback(t),o.callback&&isFunction(o.callback)&&o.callback(t,r)}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(){jQuery(".loader-submit",r).removeClass("loading")}),a.lookupField.on("input",function(e){""==a.lookupField.val()&&(a.lookupField.removeAttr("title"),jQuery("#contract-name",r).addClass("d-none"))}),isFunction(o.onEraseLookup)&&o.onEraseLookup||(o.onEraseLookup=!1),lookupCommonFunctions(a.lookupField,a.hiddenId,a.errorDiv,r,o.onEraseLookup)}function findVersionDifferences(){var e=getBaseURL()+"docs/compare_file_versions",t=jQuery(".file-versions-checkboxes:checked").map(function(){var e=jQuery(this).val();return{version_id:e,version_name:jQuery("#file-version-"+e).val()}}).get();jQuery.ajax({url:e,data:{data:t},dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.status&&(jQuery("#file-versions-dialog").length||jQuery("<div id='file-versions-dialog'></div>").appendTo("body"),(t=jQuery("#file-versions-dialog")).html(e.html),jQuery(".modal",t).modal({keyboard:!1,backdrop:"static",show:!0}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function onSelectLookupCallback(){return!0}function docuSignGoLive(){jQuery.ajax({dataType:"JSON",type:"POST",url:getBaseURL("contract")+"docusign_integration/convert_to_live_process",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result?pinesMessage({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}):void 0!==e.needs_authenticate&&e.needs_authenticate?window.location.href=getBaseURL("contract")+"docusign_integration/authenticate":void 0!==e.display_message&&pinesMessage({ty:"warning",m:e.display_message})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function initTinyTemp(n,i,s){tinymce.remove(i+" #"+n),tinymce.init({selector:i+" #"+n,menubar:!1,statusbar:!1,branding:!1,height:200,resize:!1,relative_urls:!1,remove_script_host:!1,plugins:["link","lists","paste","image"],link_assume_external_targets:!0,paste_text_sticky:!0,apply_source_formatting:!0,toolbar:"formatselect | bold italic underline numlist bullist  | link | undo redo "+(-1==jQuery.inArray(s,["task","meeting"])?"| image code":""),block_formats:"Paragraph=p;Huge=h4;Normal=h5;Small=h6;",paste_word_valid_elements:"b,strong,i,em,h1,h2,span,br,div,p",paste_webkit_styles:"color font-size",paste_remove_styles:!1,paste_retain_style_properties:"all",formats:{underline:{inline:"u",exact:!0},alignleft:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",attributes:{align:"left"}},aligncenter:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",attributes:{align:"center"}},alignright:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",attributes:{align:"right"}},alignjustify:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",attributes:{align:"justify"}},p:{block:"p",styles:{"font-size":"10pt"}}},paste_preprocess:function(e,t){tinymce.activeEditor.windowManager.alert("Some of the pasted content will not stay with the same format")},setup:function(e){e.on("init",function(e){jQuery("#"+n+"_ifr",i).contents().find("body").attr("dir","auto"),e.pasteAsPlainText=!0,jQuery(".mce-i-image").parent().on("click",function(e){setTimeout(function(){jQuery('.mce-browsebutton input[type="file"]').attr("accept","*")},200)})})},images_upload_url:getBaseURL()+s+"/upload_file",images_upload_handler:function(e,t,a){var r,o=new XMLHttpRequest;o.withCredentials=!1,o.open("POST",getBaseURL()+s+"/upload_file"),o.onload=function(){var e=JSON.parse(o.responseText);0==e.status?a(e.message):e?(["tif","jpg","png","gif","jpeg","bmp","jfif"].includes(e.file.extension)?tinymce.activeEditor.execCommand("mceInsertContent",!1,'<img data-name="'+e.file.full_name+'" src="'+getBaseURL()+s+"/return_doc_thumbnail/"+e.file.id+'" width="100" height="100"  />'):tinymce.activeEditor.execCommand("mceInsertContent",!1,'<a href="'+getBaseURL()+s+"/download_file/"+e.file.id+'" >'+e.file.full_name+"</a>"),parent.tinymce.editors[0].windowManager.windows[0].close()):a("Invalid JSON: "+o.responseText)},(r=new FormData).append("uploadDoc",e.blob()),r.append("module_record_id",jQuery("#"+n,"#"+i).val()),r.append("module",s),r.append("dragAndDrop",!0),r.append("lineage",""),o.send(r)},init_instance_callback:function(e){e.on("click",function(e){jQuery(".bootstrap-select.open").removeClass("open")})}})}function addLatestDevTimeStamp(e,t){e=e||"#personal_info_div",t=t||"#latestDevelopment";var a=(new Date).toISOString().replace(/T/," ").replace(/\..+/,"");console.log(jQuery(t,e)),jQuery(t,e).val(jQuery(t).val()+(jQuery(t,e).val()?"\n[":"[")+a+"]:"),jQuery(t,e).length&&jQuery(t,e).scrollTop(jQuery(t,e)[0].scrollHeight-jQuery(t,e).height()),jQuery(t,e).focus()}function contractGenerate(a,e="contract"){if(contractLicenseHasExpired)return alertLicenseExpirationMsg(),!1;jQuery.ajax({dataType:"JSON",url:getBaseURL("contract")+"contracts/add",data:{option:a,step:1,commercial_service_category:e},type:"GET",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.result?e.html&&jQuery("#contract-generate-container").length<=0&&(jQuery('<div id="contract-generate-container" class="primary-style"></div>').appendTo("body"),(t=jQuery("#contract-generate-container")).html(e.html),initializeModalSize(t),commonModalDialogEvents(t),contractGenerateEvents(t,a)):void 0!==e.display_message&&pinesMessage({ty:"warning",m:e.display_message})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function isValidDate(e){var t,a;return!(!e.match(/^\d{4}-\d{2}-\d{2}$/)||!(a=(t=new Date(e)).getTime())&&0!==a||t.toISOString().slice(0,10)!==e)}function getExportInfoFilter(e){return filters=[],jQuery("#"+e).find(".form-group").each(function(){var e;if(jQuery(this).hasClass("form-group-filter")&&!jQuery(this).find(".chk-filter").is(":checked"))return;(filter={}).fieldTitle=jQuery(this).find("label.control-label").first().text(),jQuery(this).find(".sf-operator").hasClass("start-date-operator")?filter.fieldOperator=jQuery(this).find("select.sf-operator-list option:selected").first().text():filter.fieldOperator=jQuery(this).find("select.sf-operator option:selected").first().text(),filter.fieldValue="",jQuery(this).find(":input.sf-value").hasClass("multi-select")?(e=jQuery(this).find("select.sf-value option:selected").map(function(){if(jQuery(this).val().trim())return jQuery(this).text()}).get().join(", "),filter.fieldValue=e):jQuery(this).find(":input.sf-value").is("select")?jQuery(this).find("select.sf-value option:selected").val().trim()&&(filter.fieldValue=jQuery(this).find("select.sf-value option:selected").text()):filter.fieldValue=jQuery(this).find(":input.sf-value").val(),jQuery(this).find(".sf-value2").val()&&(filter.fieldValue=filter.fieldValue+" , "+jQuery(this).find(".sf-value2").val()),filter.fieldValue&&filter.fieldTitle&&filters.push(filter)}),filters}function contractGenerateEvents(r,a){var o,n,t,i,e,s,l,d,u,c,y,m=0;switch(a){case"add":jQuery("#form-submit",jQuery(".modal-footer",r)).removeClass("hide"),jQuery("#notification-div",jQuery(".modal-footer",r)).removeClass("hide"),jQuery("#type",jQuery("#fieldset1",r)).change(function(){jQuery("#type",jQuery("#fieldset2",r)).val(jQuery(this).val()).selectpicker("refresh"),jQuery(this).val()&&contractTypeEvent(jQuery(this).val(),jQuery("#sub-type",jQuery("#fieldset2",r)))}),contractFormEvents(jQuery("#form2",jQuery("#fieldset2",r))),jQuery("#type",jQuery("#fieldset2",r)).change(function(){addContractTypeCustomFields(jQuery(this).val()),jQuery("#type",jQuery("#fieldset1",r)).val(jQuery(this).val()).selectpicker("refresh")});break;case"choose":jQuery(".select-picker",r).selectpicker({dropupAuto:!1}),jQuery("#type",r).change(function(){jQuery(this).val()&&(contractTypeEvent(jQuery(this).val(),jQuery("#sub-type",r)),contractTemplateEvent(jQuery(this).val(),jQuery("#sub-type").val(),jQuery("#templates",r)))}),jQuery("#sub-type",r).change(function(){contractTemplateEvent(jQuery("#type",r).val(),jQuery(this).val(),jQuery("#templates",r))})}jQuery(".next").click(function(){if(l=parseInt(jQuery(".modal-footer",r).attr("data-field")),n=jQuery("#fieldset"+l,r),o=jQuery("form",n),s=!0,o)switch(!0){case 1==l:var e;jQuery(".inline-error",n).addClass("d-none").html(""),"choose"==a?(jQuery("#templates",o).val()||(jQuery("[data-field='templates']",n).removeClass("d-none").html(_lang.feedback_messages.templateRequired),s=!1),s&&(jQuery("#doc-name",o).val(jQuery("#doc-name-preffix",o).val()+jQuery("#doc-name-suffix",o).text()),d=l+1,i=jQuery("#fieldset"+d,r),t=jQuery("#form"+d,i),void 0===a||a&&a!==jQuery("#option","#form1").val()||a&&(0==m||!m))&&jQuery.ajax({url:getBaseURL("contract")+"contracts/add",dataType:"JSON",type:"GET",data:{option:a,step:d,template_id:jQuery("#templates",o).val()},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.result?(t.html(e.html),jQuery(".tooltip-title",t).tooltipster({contentAsHTML:!0,timer:22800,animation:"grow",delay:200,theme:"tooltipster-default",touchDevices:!1,trigger:"hover",maxWidth:350,interactive:!0}),jQuery("[id^='variable-']",t).each(function(){var e=jQuery("."+jQuery(this).attr("id"),r);switch(jQuery(this).attr("data-type")){case"date":setDatePicker(jQuery(this).parent(),r);break;case"date_time":jQuery(this).parent().hasClass("date-picker")&&setDatePicker(jQuery(this).parent(),r),jQuery(this).hasClass("time")&&jQuery(this).timepicker({timeFormat:"H:i"});break;case"list":jQuery(this).selectpicker();break;case"single_lookup":var t=jQuery(this).attr("data-lookup-type");lookUpContacts(a={lookupField:jQuery(this),hiddenId:".field-member-id",errorDiv:t,resultHandler:setQuestionnairelookupValues},e);break;case"multiple_lookup_per_type":var a={lookupField:jQuery(".field-lookup",e),hiddenInput:jQuery(".field-member-id",e),resultHandler:setQuestionnairelookupValues};jQuery(".field-member-type",e).selectpicker().change(function(){jQuery(".field-lookup",e).val(""),jQuery(".field-member-id",e).val(""),jQuery(".field-lookup",e).typeahead("destroy"),lookupCompanyContactType(a,e,jQuery(this).val())}),jQuery(".field-lookup",e).typeahead("destroy"),lookupCompanyContactType(a,e,jQuery(".field-member-type option:selected",e).val());break;case"multiple_fields_per_type":jQuery(this).selectpicker(),setDatePicker("#end-date",r)}}),e.pages?(c=e.pages,y=1,progressPerc=100/c,jQuery(".progress-bar",jQuery("#progress-bar",r)).css("width",progressPerc+"%").attr("progress",progressPerc),jQuery("#pages-count",jQuery("#progress-bar",r)).html(e.pages),1==e.pages&&(jQuery(".next",jQuery(".modal-footer",r)).addClass("d-none"),jQuery("#form-submit",jQuery(".modal-footer",r)).removeClass("d-none"),jQuery("#notification-div",jQuery(".modal-footer",r)).removeClass("d-none")),jQuery("#progress-bar",r).removeClass("d-none"),jQuery(".previous",jQuery(".modal-footer",r)).removeClass("d-none"),jQuery(".modal-header",r).addClass("progress-padding"),jQuery(".modal-footer",r).attr("data-field",d),n.hide(),i.show()):pinesMessage({ty:"error",m:_lang.feedback_messages.contractQuestionnairePagesError})):(s=!1,pinesMessage({ty:"warning",m:e.display_message}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})):(jQuery(".inline-error",o).addClass("hide"),e={},""==jQuery("input[type=file]",jQuery("#fieldset"+l,r)).val()&&(e.contract_document=_lang.validation_field_required.sprintf([_lang.contractDocument])),""==jQuery("#type",jQuery("#fieldset"+l,r)).val()&&(e.type_id=_lang.feedback_messages.fieldRequired),jQuery.isEmptyObject(e)?(d=l+1,i=jQuery("#fieldset"+d,r),jQuery(".modal-footer",r).attr("data-field",d),jQuery(".next",jQuery(".modal-footer",r)).addClass("hide"),jQuery(".previous",jQuery(".modal-footer",r)).removeClass("hide"),jQuery("#name",jQuery("#fieldset"+d,r)).val(jQuery("input[type=file]",jQuery("#fieldset"+l,r))[0].files[0].name.replace(/\.[^/.]+$/,"")),n.hide(),i.show()):displayValidationErrors(e,o));break;case 1<l:jQuery(".inline-error",o).addClass("d-none"),nextPageNb=parseInt(y)+1,d=l+1,contractGenerateEventCheckRequired(jQuery("[page-number="+y+"]",r))&&(jQuery("#current-page").html(nextPageNb),jQuery(".modal-footer",r).attr("data-field",d),lastProgress=jQuery(".progress-bar",r).attr("progress"),newProgress=parseInt(lastProgress)+parseInt(progressPerc),jQuery(".progress-bar",r).css("width",newProgress+"%").attr("progress",newProgress),jQuery("[page-number="+y+"]",r).addClass("d-none"),y=nextPageNb,jQuery("[page-number="+nextPageNb+"]",r).removeClass("d-none"),nextPageNb==c)&&(jQuery("#form-submit",jQuery(".modal-footer",r)).removeClass("d-none"),jQuery("#notification-div",jQuery(".modal-footer",r)).removeClass("d-none"),jQuery(".next",jQuery(".modal-footer",r)).addClass("d-none"))}}),jQuery(".previous",r).click(function(){l=parseInt(jQuery(".modal-footer",r).attr("data-field")),n=jQuery("#fieldset"+l,r),o=jQuery("form",n),u=l-1,e=jQuery("#fieldset"+u,r),m=parseInt(y)-1,"choose"==a&&1<l&&0<m?(previousStep=l-1,jQuery("#current-page").html(m),jQuery(".modal-footer",r).attr("data-field",previousStep),lastProgress=jQuery(".progress-bar",r).attr("progress"),newProgress=parseInt(lastProgress)-parseInt(progressPerc),jQuery(".progress-bar",r).css("width",newProgress+"%").attr("progress",newProgress),jQuery("[page-number="+y+"]",r).addClass("d-none"),y=m,jQuery("[page-number="+m+"]",r).removeClass("d-none"),jQuery("#form-submit",jQuery(".modal-footer",r)).addClass("d-none"),jQuery("#notification-div",jQuery(".modal-footer",r)).addClass("d-none"),jQuery(".next",jQuery(".modal-footer",r)).removeClass("d-none")):(n.hide(),e.show(),jQuery(".modal-footer",r).attr("data-field",u),jQuery(".next",jQuery(".modal-footer",r)).removeClass("d-none"),jQuery(".previous",jQuery(".modal-footer",r)).addClass("d-none"))}),jQuery("#form-submit",r).click(function(){var e,t;jQuery(".inline-error",o).addClass("d-none"),l=parseInt(jQuery(".modal-footer",r).attr("data-field")),n=jQuery("#fieldset"+l,r),o=jQuery("form",n),"add"==a&&(e={},1==l&&(""==jQuery("input[type=file]",jQuery("#fieldset"+l,r)).val()?e.contract_document=_lang.validation_field_required.sprintf([_lang.contractDocument]):jQuery("#name",jQuery("#fieldset"+(l+1),r)).val(jQuery("input[type=file]",jQuery("#fieldset"+l,r))[0].files[0].name.replace(/\.[^/.]+$/,"")),""==jQuery("#type",jQuery("#fieldset"+l,r)).val())&&(e.type_id=_lang.feedback_messages.fieldRequired),jQuery.isEmptyObject(e)?((t=new FormData(document.getElementById("form2"))).append("option",a),t.append("step",l),t.append("contract_attachment_0",jQuery("input[type=file]",jQuery("#fieldset1",r))[0].files[0]),jQuery.ajax({url:getBaseURL("contract")+"contracts/add",dataType:"JSON",type:"POST",contentType:!1,cache:!1,processData:!1,data:t,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery(".inline-error",o).addClass("d-none"),e.result?window.location.href=getBaseURL("contract")+"contracts/view/"+e.id:displayValidationErrors(e.validationErrors,o)},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})):displayValidationErrors(e,o)),"choose"==a&&contractGenerateEventCheckRequired(jQuery("[page-number="+y+"]",r))&&(t=jQuery("#form1, #form2, #form3").serialize(),jQuery.ajax({url:getBaseURL("contract")+"contracts/add",dataType:"JSON",type:"POST",data:t,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery(".inline-error",o).addClass("d-none"),e.result?window.location.href=getBaseURL("contract")+"contracts/view/"+e.id:displayValidationErrors(e.validationErrors,o)},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler}))})}function addContractTypeCustomFields(e){jQuery(".type-custum-fields-div","#custom_fields_div").html(""),e&&jQuery.ajax({url:getBaseURL("contract")+"contracts/add_contract_type_custom_fields",dataType:"JSON",data:{type_id:e},type:"GET",success:function(e){e.html&&(jQuery(".type-custum-fields-div","#custom_fields_div").html(e.html),loadCustomFieldsEvents("custom-field-",".type-custum-fields-div"))},error:defaultAjaxJSONErrorsHandler})}function initializeField(e,t){e.selectize({plugins:["remove_button"],valueField:"id",labelField:"name",searchField:["name"],options:t,createOnBlur:!0,groups:[],optgroupField:"class"})}function notifyMeBeforeRenewal(e){notifyMeBefore(e),renewalLookupsEvents(e)}function lookUpPartners(a,r){var e=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("name")},queryTokenizer:Bloodhound.tokenizers.whitespace,replace:function(e,t){return e+"#"+t},remote:{url:getBaseURL("money")+"accounts/lookup_partner?term=%QUERY",filter:function(e){return e},cache:!1,wildcard:"%QUERY"}});e.initialize(),a.lookupField.typeahead({hint:!1,highlight:!0,minLength:3},{source:e.ttAdapter(),display:function(e){return e.name+" - "+e.currencyCode},templates:{empty:['<div class="empty"> '+_lang.noMatchesFound+"</div>"].join("\n"),suggestion:function(e){return"<div>"+e.name+" - "+e.currencyCode+"</div>"}}}).on("typeahead:selected",function(e,t){void 0!==a.callBackFunction&&a.callBackFunction(r)}).on("typeahead:asyncrequest",function(){jQuery(".loader-submit",r).addClass("loading")}).on("typeahead:asynccancel typeahead:asyncreceive",function(e,t){jQuery(".loader-submit",r).removeClass("loading")}),lookupCommonFunctions(a.lookupField,a.hiddenId,a.errorDiv,r)}function contractGenerateEventCheckRequired(t){jQuery(".inline-error",t).addClass("d-none"),$next=!0,jQuery("[id^='variable-']",t).each(function(){var e=jQuery("."+jQuery(this).attr("id"),t);1!=(isRequired=jQuery(this).attr("is_required"))||jQuery(this).val()||($next=!1,jQuery("div",e).find("[data-field="+jQuery(this).attr("id")+"]").html(_lang.feedback_messages.fieldRequired).removeClass("d-none"),jQuery(".modal-body").scrollTo(e))});for(var e=jQuery(".radio_buttons",t),a=0;a<e.length;a++)isOneInputChecked(e[a],"radio")||($next=!1,jQuery(".inline-error",e[a]).html(_lang.feedback_messages.fieldRequired).removeClass("d-none"),jQuery(".modal-body").scrollTo(e[a]));for(var r=jQuery(".check_boxes",t),a=0;a<r.length;a++)isOneInputChecked(r[a],"checkbox")||($next=!1,jQuery(".inline-error",r[a]).html(_lang.feedback_messages.fieldRequired).removeClass("d-none"),jQuery(".modal-body").scrollTo(r[a]));return $next}function contractTypeEvent(e,a,r){r=r||0,jQuery.ajax({url:getBaseURL("contract")+"contracts/load_sub_contract_types",dataType:"JSON",data:{type_id:e},type:"GET",success:function(e){var t='<option value="0">'+_lang.none+"</option>";if(void 0!==e&&null!=e&&0<e.length)for(i in e)t+='<option value="'+e[i].id+'">'+e[i].name+"</option>";a.html(t).val(r).selectpicker("refresh")},error:defaultAjaxJSONErrorsHandler})}function deleteTaskLocationSelectedRow(r){confirm(_lang.confirmationDeleteSelectedRecord)&&jQuery.ajax({url:getBaseURL()+"task_locations/delete/"+r,type:"GET",dataType:"JSON",success:function(e){var t="error",a="";e.status?(t="information",a=e.message,jQuery("table").find("#tl_"+r).remove()):a=e.message,pinesMessage({ty:t,m:a})},error:defaultAjaxJSONErrorsHandler})}function change_invoice_status(e,t){var a="",r="";switch(t){case"open":a=getBaseURL("money")+"vouchers/convert_invoice_to_open",r=_lang.invoiceHasBeenConvertedToOpen,msg202=_lang.invalid_request;break;case"draft":a=getBaseURL("money")+"vouchers/set_invoice_as_draft",r=_lang.invoiceHasBeenSetAsDraft,msg202=_lang.you_can_not_set_paid_or_partially_paid_invoice_as_draft;break;case"cancel":a=getBaseURL("money")+"vouchers/cancel_invoice",r=_lang.invoiceHasBeenCancelled,msg202=_lang.you_can_not_cancel_any_paid_or_partially_paid_invoice}jQuery.ajax({url:a,type:"POST",dataType:"JSON",data:{voucherID:e},success:function(e){var t="error",a="";switch(e.status){case 101:t="success",a=r;break;case 102:t="warning",a=_lang.youHaveToSetTheDefaultSystemCommissionAccount.sprintf(['<a href="'+getBaseURL("money/setup/global_partner_shares_account")+'">'+_lang.here+"</a>"]);break;case 202:t="warning",a=msg202}pinesMessage({ty:t,m:a}),0<jQuery("#invoiceGrid").length&&jQuery("#invoiceGrid").data("kendoGrid").dataSource.read(),0<jQuery("#invoiceForm").length&&location.reload()},error:defaultAjaxJSONErrorsHandler})}function deleteInvoiceRecord(e){jQuery.ajax({url:getBaseURL("money")+"vouchers/delete_invoice/"+e,dataType:"json",data:{},success:function(e){e.status?(0<jQuery("#invoiceGrid").length&&jQuery("#invoiceGrid").data("kendoGrid").dataSource.read(),pinesMessage({ty:"success",m:_lang.deleteRecordSuccessfull})):pinesMessage({ty:"error",m:_lang.deleteRecordFailed}),0<jQuery("#invoiceForm").length&&(window.location=getBaseURL("money")+"vouchers/invoices_list")}})}function customerSupport(){jQuery(".popover").popover("hide"),jQuery(".dropdown-menu-customer-support").parent().hasClass("open")||jQuery.ajax({dataType:"JSON",url:getBaseURL()+"users/customer_support",type:"GET",success:function(a){if(a.result){let e={"x-api-key":a.apiKey},t=document.getElementById("customer-support");null!=t&&(t.onload=function(){t.contentWindow.postMessage({payload:e},"*")}),jQuery("#customer-support").attr("src",a.src)}},error:defaultAjaxJSONErrorsHandler})}function licensePackageAccessCheck(){"contract"==licensePackage?jQuery(".core-access").addClass("d-none"):"core"==licensePackage&&jQuery(".contract-access").addClass("d-none")}function getCurrentYearQuarterInHijri(){var e=moment().iMonth();return e<=2?{startOf:moment().locale("en").iMonth(0).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(2).endOf("iMonth").format("iYYYY-iMM-iDD")}:2<e&&e<=5?{startOf:moment().locale("en").iMonth(3).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(5).endOf("iMonth").format("iYYYY-iMM-iDD")}:5<e&&e<=8?{startOf:moment().locale("en").iMonth(6).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(8).endOf("iMonth").format("iYYYY-iMM-iDD")}:8<e&&e<=11?{startOf:moment().locale("en").iMonth(9).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(11).endOf("iMonth").format("iYYYY-iMM-iDD")}:void 0}function getPreviousYearQuarterInHijri(){var e=moment().iMonth();return e<=2?{startOf:moment().locale("en").iMonth(-3).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(-1).endOf("iMonth").format("iYYYY-iMM-iDD")}:2<e&&e<=5?{startOf:moment().locale("en").iMonth(0).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(2).endOf("iMonth").format("iYYYY-iMM-iDD")}:5<e&&e<=8?{startOf:moment().locale("en").iMonth(3).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(5).endOf("iMonth").format("iYYYY-iMM-iDD")}:8<e&&e<=11?{startOf:moment().locale("en").iMonth(6).startOf("iMonth").format("iYYYY-iMM-iDD"),endOf:moment().locale("en").iMonth(8).endOf("iMonth").format("iYYYY-iMM-iDD")}:void 0}function contractTemplateEvent(e,t,a){jQuery.ajax({url:getBaseURL("contract")+"contracts/load_templates_per_contract_types",dataType:"JSON",data:{type_id:e,sub_type_id:t},type:"GET",success:function(e){var t='<option value="">'+_lang.choose+"</option>";if(void 0!==e.templates&&null!=e.templates)for(i in e.templates)t+='<option value="'+i+'">'+e.templates[i]+"</option>";a.html(t).selectpicker("refresh")},error:defaultAjaxJSONErrorsHandler})}function toggleCheckbox(e,t){e.val(t.is(":checked")?"1":"0")}function toolsActionsContract(e,t){if("fromSelection"==e){switch(contracts_ids=[],jQuery('input[name="contract-ids"]:checked').each(function(){contracts_ids.push(this.value)}),t){case"archive":confirmationMessage="confirmation_archive_selected_contracts",resultHandler=archiveUnarchiveContractSubmission,parm=[t,contracts_ids];break;case"unarchive":confirmationMessage="confirmation_unarchive_selected_contracts",resultHandler=archiveUnarchiveContractSubmission,parm=[t,contracts_ids];break;case"delete":confirmationMessage="confim_delete_all_contract_action",resultHandler=contractDelete,parm=[contracts_ids]}confirmationDialog(confirmationMessage,{resultHandler:resultHandler,parm:parm})}else confirmationDialog("no"==(archived=document.getElementById(t).name)?"confirmation_message_to_archive_contract":"confirmation_message_to_unarchive_contract",{resultHandler:archiveUnarchiveContractSubmission,parm:e})}function archiveUnarchiveContractSubmission(e){jQuery.ajax({url:getBaseURL("contract")+"contracts/archive_unarchive_contracts",type:"POST",dataType:"JSON",data:{contracts_ids:e},success:function(e){pinesMessageV2(e.status?{ty:"information",m:_lang.feedback_messages.contractArchivedSuccessfully}:{ty:"error",m:_lang.feedback_messages.contractArchiveFailed}),jQuery("#contracts-details").length?(jQuery("#archive-unarchive-btn",".contract-container").attr("name","yes"==e.archived?"yes":"no"),jQuery("#archive-unarchive-btn",".contract-container").text("yes"==e.archived?_lang.unarchive:_lang.archive),jQuery("#archive-unarchive-btn",".contract-container").attr("title","yes"==e.archived?_lang.unarchive:_lang.archive),jQuery(".archived-flag",".contract-container").html("yes"==e.archived?"("+_lang.archived+")":"")):(jQuery("#"+gridId).data("kendoGrid").dataSource.read(),jQuery("#unarchive-button-id","#"+gridId).addClass("disabled"),jQuery("#archive-button-id","#"+gridId).addClass("disabled"),jQuery("#delete-all-button-id","#"+gridId).addClass("disabled"))},error:defaultAjaxJSONErrorsHandler})}function checkUncheckCheckboxes(e,t){"all"==t&&jQuery("tbody input[type='checkbox']","#"+gridId).attr("checked",e.checked),1<=jQuery("tbody input[type='checkbox']","#"+gridId).filter(":checked").length?(jQuery("#unarchive-button-id").removeClass("disabled"),jQuery("#archive-button-id").removeClass("disabled"),jQuery("#delete-all-button-id").removeClass("disabled")):(jQuery("#unarchive-button-id").addClass("disabled"),jQuery("#archive-button-id").addClass("disabled"),jQuery("#delete-all-button-id").addClass("disabled"))}function addRemoveMatterContributor(e,t,a){t=t||"confirm_message",jQuery.ajax({dataType:"JSON",type:"POST",url:getBaseURL()+"system_preferences/add_remove_matter_contributors_from_trigger",data:{step:t,trigger:e,action:a},beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.html&&(jQuery("#remove-matter-contributor-dialog").remove(),jQuery("#remove-matter-contributor-dialog").length<=0&&(jQuery('<div id="remove-matter-contributor-dialog"></div>').appendTo("body"),jQuery("#remove-matter-contributor-dialog").html(e.html)),jQuery(".modal",jQuery("#remove-matter-contributor-dialog")).modal({keyboard:!1,show:!0,backdrop:"static"}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}let userGuideObject=(()=>{function r(t,e,a,r){t=t||!1,a=a||!1,r=firstSignIn||!1;var o=getBaseURL().concat("users/user_guide/"),r=t?{submit:!0,module:t}:{submit:!0,firstSignIn:r};jQuery.ajax({url:o,data:r,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.status&&a&&jQuery(".modal").modal("hide"),t||(userGuide=timeActions.get_current_date(new Date))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function o(){var e=getBaseURL().concat("users/initial_setup/");jQuery.ajax({url:e,data:{},dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.status&&(jQuery('<div id="user-guide-wrapper"></div>').appendTo("body"),(t=jQuery("#user-guide-wrapper")).html(e.html),initializeModalSize(t,.35,"auto"),commonModalDialogEvents(t,function(){userGuideObject.submitInitialSetup(),jQuery(".modal").modal("hide")}),jQuery(".modal",t).on("hidden.bs.modal",function(){jQuery(".modal").modal("hide")}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}return{enableWalkthrough:function(e){var t=getBaseURL().concat("users/user_guide/");jQuery.ajax({url:t,data:{clear_all:!0,module:!0},dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){pinesMessageV2({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),e.status&&(workthrough=[],jQuery(".modal").modal("hide"))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})},manageWalkthrough:function(){var e=getBaseURL().concat("users/user_guide/");jQuery.ajax({url:e,data:{manage:!0,module:!0},dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html?(jQuery('<div id="walkthrough-settings-container"></div>').appendTo("body"),(t=jQuery("#walkthrough-settings-container")).html(e.html),commonModalDialogEvents(t),initializeModalSize(t),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)})):e.error&&pinesMessage({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})},submitManageWalkthrough:function(t){var e=jQuery("form#walkthroughSettings",t).serializeArray(),a=(e.push({name:"manage",value:!0},{name:"module",value:!0},{name:"submit",value:!0}),getBaseURL().concat("users/user_guide/"));jQuery.ajax({url:a,data:e,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){pinesMessageV2({ty:"success",m:_lang.feedback_messages.updatesSavedSuccessfully}),e.status&&(e.workthrough&&(workthrough=e.workthrough),jQuery(".modal",t).modal("hide"))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})},userGuideSetup:function(a){a=a||!1;var e=getBaseURL().concat("users/user_guide/");jQuery.ajax({url:e,data:{},dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.status&&(jQuery('<div id="user-guide-wrapper"></div>').appendTo("body"),(t=jQuery("#user-guide-wrapper")).html(e.html),initializeModalSize(t,.35,"auto"),commonModalDialogEvents(t,function(){jQuery(".modal",t).modal("hide"),""===firstSignIn&&setTimeout(function(){o()},500),a||r(!1,0,!0)}),jQuery(".modal",t).on("hidden.bs.modal",function(){jQuery(".modal",t).modal("hide"),""===firstSignIn&&setTimeout(function(){o()},500),a||r(!1,0,!0)}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})},nextGuidePage:function(e,t){t=parseInt(t),jQuery(".pages-guide").addClass("d-none"),jQuery(e).closest(".modal-content").find(".pages-guide").eq(t-1).removeClass("d-none");var e=t+1,a=t-1,r=t+" of 5";jQuery("#back-guide-page").attr("onclick","userGuideObject.nextGuidePage(this, '"+e+"')"),jQuery("#next-guide-page").attr("onclick","userGuideObject.nextGuidePage(this, '"+a+"')"),jQuery("#guides-nbs").html(r),1==t?jQuery("#next-guide-page").addClass("d-none"):jQuery("#next-guide-page").removeClass("d-none"),5==t?(jQuery("#back-guide-page").html(helpers.capitalizeFirstLetter(_lang.done)),jQuery("#back-guide-page").attr("onclick","userGuideObject.submitGuide(false, false, true)")):(jQuery("#back-guide-page").html(helpers.capitalizeFirstLetter(_lang.next)),jQuery("#back-guide-page").attr("onclick","userGuideObject.nextGuidePage(this, '"+e+"')"))},submitGuide:r,initialSetup:o,submitInitialSetup:function(){var e=jQuery("#user-guide-wrapper"),e=jQuery("#initial-setup-form",e).serialize(),t=getBaseURL().concat("users/initial_setup/");jQuery.ajax({url:t,data:e,dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){jQuery(".modal").modal("hide")},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}}})();function uploadDirectoryNotAllowed(){pinesMessage({ty:"error",m:_lang.uploadDirectoryNotAllowed})}function addUserDiablog(){var e=getBaseURL().concat("users/add");jQuery.ajax({url:e,data:{},dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.status&&(jQuery('<div id="add-user-dialog"></div>').appendTo("body"),(t=jQuery("#add-user-dialog")).html(e.html),initializeModalSize(t,.35,"auto"),commonModalDialogEvents(t),jQuery("#user-group-id",t).selectpicker(),jQuery("#seniority-level-id",t).selectpicker(),jQuery("#add-user-dialog-submit",t).on("click",function(){helpers.emailValid(jQuery(jQuery("#email-input",t)).val())?(jQuery(".inline-error",t).addClass("d-none"),jQuery("#generated-password-input",t).val().length<7?ajaxEvents.displayValidationError("password",t,_lang.shortPasswordMsg.sprintf([8])):addUserFormSubmit()):(jQuery(".inline-error",t).addClass("d-none"),console.log(jQuery("#generated-password-input",t).val().length),jQuery("#generated-password-input",t).val().length<7&&ajaxEvents.displayValidationError("password",t,_lang.shortPasswordMsg.sprintf([8])),ajaxEvents.displayValidationError("email",t,_lang.invalidFormat))}),jQuery("#add-timer-duplicate-button",t).on("click",function(){helpers.emailValid(jQuery(jQuery("#email-input",t)).val())?(jQuery(".inline-error",t).addClass("d-none"),jQuery("#generated-password-input",t).val().length<7?ajaxEvents.displayValidationError("password",t,_lang.shortPasswordMsg.sprintf([8])):addUserFormSubmit(!0)):(jQuery(".inline-error",t).addClass("d-none"),jQuery("#generated-password-input",t).val().length<7&&ajaxEvents.displayValidationError("password",t,_lang.shortPasswordMsg.sprintf([8])),ajaxEvents.displayValidationError("email",t,_lang.invalidFormat))}))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function addUserFormSubmit(t){t=t||!1;var e=getBaseURL().concat("users/add"),a=jQuery("#add-user-dialog");jQuery.ajax({url:e,data:jQuery("form#add-user-dialog-form",a).serializeArray(),dataType:"JSON",type:"POST",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.status?(jQuery(".modal",a).modal("hide"),pinesMessageV2({ty:"success",m:e.message}),t&&(window.location.href=getBaseURL().concat("users/edit/").concat(e.id))):(console.log(e.validationErrors),void 0!==e.validationErrors.status?displayValidationErrors(e.validationErrors,a):displayValidationErrors(e.validationErrors,a,!0))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function generatePassword(){var e=getBaseURL().concat("users/add");jQuery.ajax({url:e,data:{generate_pass:!0},dataType:"JSON",type:"POST",beforeSend:function(){},success:function(e){var t;e.status&&(t=jQuery("#add-user-dialog"),jQuery("#generated-password-input",t).val(e.random_password))},complete:function(){},error:defaultAjaxJSONErrorsHandler})}function systemSettingDropDown(){jQuery("#user-dropdown-list").hasClass("user-dropdown-list-hide")?jQuery("#user-dropdown-list").toggle():jQuery("#user-dropdown-list").addClass("user-dropdown-list-hide")}function changePasswordType(e,t){t=jQuery(t),t=jQuery(".fa-eye-pass",t);"password"==jQuery(e).attr("type")?(jQuery(e).attr("type","text"),t.removeClass("fa-eye"),t.addClass("fa-eye-slash")):(jQuery(e).attr("type","password"),t.addClass("fa-eye"),t.removeClass("fa-eye-slash"))}function initApiAccessToken(t,r){if(!_tokenGlobal)return!1;localStorage.getItem("api-access-token")?void 0!==t&&t&&t():(r=r||"",jQuery.ajax({url:getBaseURL()+"api/v2/money?token="+_tokenGlobal,dataType:"json",type:"GET",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){e.access_token?(localStorage.setItem("api-access-token",e.access_token),void 0!==t&&t&&t()):(pinesMessageV2({ty:"error",m:_lang.access_denied}),""!=r&&setTimeout(()=>window.location=r,700))},complete:function(e){jQuery("#loader-global").hide()},error:function(e,t,a){pinesMessageV2({ty:"error",m:e.responseJSON&&e.responseJSON.message?e.responseJSON.message:_lang.feedback_messages.error+": "+a}),""!=r&&setTimeout(()=>window.location=r,700)}}))}function uploadDirectoryNotAllowed(){pinesMessage({ty:"error",m:_lang.uploadDirectoryNotAllowed})}function getContractDesciption(e){return null!=e&&""!=e?"<span class='tooltip-title' title='"+e+"'>"+helpers.truncate(e,50,!0,"rtl"===_lang.languageSettings.langDirection)+"</span>":""}function trimHtmlTags(e){return e&&0<e.length?e.replace(/<[^>]*>?/gm,""):""}function timeEntryConfirmation(e,t){var a=new Date(e.dates.last_date),r=new Date(e.dates.log_date),r=Math.abs(r-a),a=Math.ceil(r/864e5),r=e.allow_go_to_settings,o="#time-entry-confirmation-container",n=jQuery("#add-edit-time-log");jQuery(o).length<=0&&(jQuery("<div id='time-entry-confirmation-container' class='primary-style'>\n                    <div class='modal fade modal-container modal-resizable'>\n                        <div class='modal-dialog'>\n                            <div class='modal-content'>\n                                <div class='modal-header'>\n                                    <h4 id='title' class='modal-title'>"+_lang.timeEntryRuleMessageTitle+"</h4><button type='button' class='close' data-dismiss='modal' aria-hidden='true'></button>\n                                </div>\n                                <div class='modal-body form-horizontal overflow-unset'>\n                                    <div class='row mx-0'>\n                                        <i class='fa fa-exclamation-triangle col-md-1' style='font-size: 2rem'></i>\n                                        <p class='col-md-11'>"+_lang.periodWithNoTimeEntries.sprintf([a,jQuery("#user-lookup",n).val()])+"</p>\n                                        <p class='offset-md-1 col-md-11'>"+_lang.timeEntryLoggingRuleMessage+"</p>\n                                    </div>\n                                </div>\n                                <div class='modal-footer'>\n                                    <span class='loader-submit'></span>\n                                    <button id='settings-btn' type='button' class='btn link-style-with-underline hide'>"+_lang.goToSettings+"</button>\n                                    <button id='cancel-btn' type='button' class='btn link-style-with-underline'>"+_lang.cancel+"</button>\n                                    <button id='add-btn' type='button' class='btn btn-save btn-add-dropdown modal-save-btn'>"+_lang.addBulkTimeEntires+"</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>").appendTo("body"),r&&(jQuery("#settings-btn",o).removeClass("hide"),jQuery("#cancel-btn",o).addClass("hide")),initializeModalSize(o,.35,.15),jQuery(".modal",o).modal({keyboard:!1,backdrop:"static",show:!0}),jQuery(document).keyup(function(e){27==e.keyCode&&jQuery(".modal",o).modal("hide")}),jQuery(".modal",o).on("hidden.bs.modal",function(){destroyModal(jQuery(o))}),jQuery("#add-btn",o).click(function(){"add"===t?(jQuery("#log-date",n).val(e.dates.last_date),jQuery("#repeat-until-date-input",n).val(e.dates.log_date),jQuery("#is-repeat",n).prop("checked",!0),timeLogsDialog.repeatInput("#is-repeat")):(jQuery(".modal","#time-log-dialog").modal("hide"),jQuery(".modal-backdrop").remove(),logActivityDialog(!1,{},!1,!1,!1,e.dates)),jQuery(".modal",o).modal("hide")}),jQuery("#settings-btn",o).click(function(){window.open("system_preferences#SystemValues","_blank").focus()}),jQuery("#cancel-btn",o).click(function(){jQuery(".modal",o).modal("hide")}))}function collapseDownUp(e,t,a){a=a||"fast",jQuery("#"+t).hasClass("rotate-origin")?jQuery("#"+t).removeClass("rotate-origin"):jQuery("#"+t).addClass("rotate-origin"),jQuery("#"+e).slideToggle(a)}function loadCorrespondenceForm(){jQuery.ajax({url:getBaseURL()+"front_office/add",dataType:"JSON",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t,a;jQuery("#correspondence-dialog-container").remove(),e.html?(jQuery('<div id="correspondence-dialog-container"></div>').appendTo("body"),(t=jQuery("#correspondence-dialog-container")).html(e.html),correspondenceAddFormEvents(t),a=jQuery("#id",t).val(),jQuery(".modal").on("hidden.bs.modal",function(){destroyModal(t)}),jQuery("#correspondence-form-submit",t).click(function(){correspondenceFormSubmit(t,a)}),jQuery(t).find("input").keypress(function(e){13==e.which&&correspondenceFormSubmit(container,id)})):void 0!==e.error&&e.error&&pinesMessageV2({ty:"error",m:e.error})},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function correspondenceAddFormEvents(e){setDatePicker("#form-document-date",e),setDatePicker("#form_date_recieved",e),setDatePicker("#form-date_dispatched",e),setDatePicker("#form-due_date",e),setDatePicker("#form-record_date",e),commonModalDialogEvents(e),initializeModalSize(e),senderInitialization(e),recipientInitialization(e,{onselect:onCorrespondenceAddresseeTypeChange}),jQuery(".select-picker",e).selectpicker(),lookUpUsers(jQuery("#assignedToLookUp",e),jQuery("#assignedToId",e),"assigned_to",jQuery(".assignee-container",e),e),jQuery("#assignedToId",e).change(function(){0<jQuery("#user-relation",e).val()&&0<jQuery("#assignedToId",e).val()&&jQuery("#user-relation",e).val()!==jQuery("#assignedToId",e).val()&&pinesMessage({ty:"warning",m:_lang.feedback_messages.assignmentChangeForAssignee})})}function correspondenceFormSubmit(t,e,a){a=a||!1;var r=new FormData(document.getElementById(jQuery("form#correspondence-form",t).attr("id")));jQuery.ajax({beforeSend:function(){jQuery(".loader-submit",t).addClass("loading"),jQuery(".modal-save-btn",t).attr("disabled","disabled")},data:r,dataType:"JSON",type:"POST",contentType:!1,cache:!1,processData:!1,url:getBaseURL()+"front_office/add",success:function(e){jQuery(".inline-error",t).addClass("d-none"),e.result?(jQuery(".modal",t).modal("hide"),pinesMessage({ty:"success",m:_lang.feedback_messages.addedSuccessfully||"Correspondence added successfully."}),"function"==typeof a&&a(e,t)):void 0!==e.validationErrors&&e.validationErrors?displayValidationErrors(e.validationErrors,t):e.message&&pinesMessage({ty:"error",m:e.message})},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled"),jQuery(".loader-submit",t).removeClass("loading")},error:defaultAjaxJSONErrorsHandler})}function senderInitialization(e,t){t=t||!1;var a="#"+e.attr("id"),r=((companyContactFormMatrix=companyContactFormMatrix||{}).commonLookup=companyContactFormMatrix.commonLookup||{},companyContactFormMatrix.commonLookup[a]={lookupType:jQuery("select#sender-type",e).val()},{lookupField:jQuery("#lookup-sent-by",e),hiddenInput:jQuery("#sent-by",e),errorDiv:"sender_id",resultHandler:setDataToSenderField,callback:t});companyContactFormMatrix.commonLookup[a].callback=t,lookupCompanyContactType(r,e),jQuery("#sender-type",e).change(function(){lookupCompanyContactType(r,e)})}function setDataToSenderField(e,t){var a="#"+jQuery(t).attr("id"),r=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery("#sent-by",t).val(e.id),jQuery("#lookup-sent-by",t).val(r),"undefined"!=typeof companyContactFormMatrix&&companyContactFormMatrix.commonLookup&&companyContactFormMatrix.commonLookup[a]&&"function"==typeof companyContactFormMatrix.commonLookup[a].callback&&companyContactFormMatrix.commonLookup[a].callback("",e,t)}function recipientInitialization(e,t){t=t||!1;var a="#"+e.attr("id"),r=((companyContactFormMatrix=companyContactFormMatrix||{}).commonLookup=companyContactFormMatrix.commonLookup||{},companyContactFormMatrix.commonLookup[a]={lookupType:jQuery("select#addressee-type",e).val()},{lookupField:jQuery("#addressee-lookup",e),hiddenInput:jQuery("#addressee_id",e),errorDiv:"addressee_id",resultHandler:setDataToRecipientField,callback:t});companyContactFormMatrix.commonLookup[a].callback=t,lookupCompanyContactType(r,e),jQuery("#addressee-type",e).change(function(){lookupCompanyContactType(r,e)})}function setDataToRecipientField(e,t){var a="#"+jQuery(t).attr("id"),r=e.name||(e.father?e.firstName+" "+e.father+" "+e.lastName:e.firstName+" "+e.lastName);jQuery("#addressee_id",t).val(e.id),jQuery("#addressee-lookupp",t).val(r),"undefined"!=typeof companyContactFormMatrix&&companyContactFormMatrix.commonLookup&&companyContactFormMatrix.commonLookup[a]&&"function"==typeof companyContactFormMatrix.commonLookup[a].callback&&companyContactFormMatrix.commonLookup[a].callback("",e,t)}function onCorrespondenceAddresseeTypeChange(e,t,a){var r,o=jQuery("select#addressee-type",a).val();0<t.id&&jQuery("#clientLinkId",a).length&&(r="","contact"==o?r="contacts/edit/":"Internal"===t.category?r="companies/tab_company/":"Group"===ui.item.record.category&&jQuery("#clientLinkId",a).addClass("d-none"),"Group"!==t.category)&&jQuery("#clientLinkId",a).attr("href",getBaseURL()+r+t.id).removeClass("d-none")}function loadRelationshipForm(e){jQuery.ajax({url:getBaseURL()+"front_office/load_relationship_form/"+e,dataType:"JSON",beforeSend:function(){showLoader(!0)},success:function(e){var t;jQuery("#relationship-dialog-container").remove(),e.html&&(jQuery('<div id="relationship-dialog-container"></div>').appendTo("body"),(t=jQuery("#relationship-dialog-container")).html(e.html),jQuery(".select-picker",t).selectpicker(),commonModalDialogEvents(t),initializeModalSize(t),initializeAutocompleteField({inputSelector:"#target_lookup",hidden_idSelector:"#target_id",controller:"front_office",nameProperty:"subject"}),jQuery("#relationship-form-submit",t).click(function(){relationshipFormSubmit(t)}))},complete:function(){showLoader(!1)},error:defaultAjaxJSONErrorsHandler})}function relationshipFormSubmit(t){var e=jQuery("form#relationship-link-form",t)[0],e=new FormData(e);jQuery.ajax({url:getBaseURL()+"front_office/save_relationship",type:"POST",data:e,dataType:"JSON",processData:!1,contentType:!1,beforeSend:function(){jQuery(".modal-save-btn",t).attr("disabled","disabled").text("Linking...")},success:function(e){e.result?(jQuery(".modal",t).modal("hide"),pinesMessage({ty:"success",m:"Relationship created successfully."}),"function"==typeof refreshRelationshipsTab&&refreshRelationshipsTab()):e.validationErrors&&displayValidationErrors(e.validationErrors,t)},complete:function(){jQuery(".modal-save-btn",t).removeAttr("disabled").text("Save Link")},error:defaultAjaxJSONErrorsHandler})}function unlinkrelationship(e,t){url=getBaseURL()+"front_office/unlink_relationship",e?("correspondence"===t&&(url=getBaseURL()+"front_office/unlink_relationship"),confirm("Are you sure you want to remove this link? The actual records will not be deleted.")&&jQuery.ajax({url:url,type:"POST",data:{id:e},dataType:"JSON",beforeSend:function(){showLoader(!0)},success:function(e){e.result?(pinesMessage({ty:"success",m:e.display_message}),"function"==typeof refreshRelatedItems?refreshRelatedItems():location.reload()):pinesMessage({ty:"error",m:e.display_message})},complete:function(){showLoader(!1)},error:defaultAjaxJSONErrorsHandler})):pinesMessage({ty:"error",m:"Invalid relationship ID."})}function refreshRelatedItems(){var e=jQuery("#id").val();jQuery.ajax({url:getBaseURL()+"front_office/load_relationships/"+e,type:"GET",dataType:"JSON",success:function(e){e.html&&jQuery("#relationship-list-container").html(e.html)}})}function suretyForm(a,e,t,r){e=e||!1,(data=[{name:"contract_id",value:a}]).push({name:"mode",value:t}),e&&data.push({name:"suretyId",value:e}),jQuery.ajax({dataType:"JSON",url:getBaseURL("contract")+"contracts/related_sureties/"+a,type:"GET",data:data,beforeSend:function(){jQuery("#loader-global").show()},success:function(e){var t;e.html&&(jQuery("#surety-form-container").length<=0&&(jQuery('<div id="surety-form-container"></div>').appendTo("body"),(t=jQuery("#surety-form-container")).html(e.html),jQuery(".select-picker",t).selectpicker(),commonModalDialogEvents(t),initializeModalSize(t,.5,.6),jQuery("#form-submit",t).click(function(){suretyFormFormSubmit(t,r,a)}),jQuery(t).find("input").keypress(function(e){13==e.which&&(e.preventDefault(),suretyFormFormSubmit(t,r,a))})),e.notification_available)&&notifyMeBefore(jQuery("#milestone-form-container"))},complete:function(){jQuery("#loader-global").hide()},error:defaultAjaxJSONErrorsHandler})}function suretyFormFormSubmit(t,a,r){var e=jQuery("form#suretyBondForm",t)[0],e=new FormData(e);let o=t.find("#form-submit");o.prop("disabled",!0).text("Saving..."),jQuery.ajax({url:getBaseURL("contract")+"contracts/related_sureties",type:"POST",data:e,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){jQuery("#loader-global").show()},success:function(e){"success"===e.status?(a&&(pinesMessageV2({ty:"success",m:e.message||"Surety bond saved successfully."}),relatedSuretiesTab(r)),jQuery(".modal",t).modal("hide")):displayValidationErrors(e.validation_errors,t)},error:defaultAjaxJSONErrorsHandler,complete:function(){jQuery("#loader-global").hide(),o.prop("disabled",!1).text("Save Surety Bond")}})}function showLoader(e){e?jQuery("#loader-global").show():jQuery("#loader-global").hide()}function initializeAutocompleteField(e){let{inputSelector:t,hidden_idSelector:a,controller:r,nameProperty:o}=e,n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace(o||"name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:getBaseURL()+r+"/autocomplete?term=%QUERY",wildcard:"%QUERY"}});jQuery(t).typeahead(null,{name:r,display:o||"name",source:n,templates:{empty:['<div class="m-2">',' <i role="button" class="tt-quick-add" data-controller="'+r+'" data-module="'+r+'">No matches found.Click here to add</i>',"</div>"].join("\n"),suggestion:function(e){return"<div><strong>"+e[o||"name"]+"</strong></div>"}}}).on("typeahead:select",function(e,t){jQuery(a).val(t.id)}).on("typeahead:autocomplete",function(e,t){jQuery(a).val(t.id)}).on("change",function(){jQuery(this).typeahead("val")||jQuery(a).val("")})}