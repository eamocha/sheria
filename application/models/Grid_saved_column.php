<?php

if (!defined("BASEPATH")) {
    exit("No direct script access allowed");
}
class Grid_saved_column extends My_Model
{
    protected $modelName = "grid_saved_column";
    protected $_table = "grid_saved_columns";
    protected $_listFieldName = "";
    protected $_fieldsNames = ["id", "model", "user_id", "grid_details", "grid_saved_filter_id"];
    protected $models = ["Company", "Contact", "Matter", "Litigation", "IP", "Task", "Reminder", "User_Activity_Log", "Expense", "Invoice_Header", "Bill_Header", "User_Activity_Log_Money_Module", "Account", "Legal_Case_Hearing", "Quote_Header", "Matter_Container", "contract", "awaiting_approvals", "awaiting_signatures", "Opinion","Conveyancing_instrument","Correspondence","Surety_bond"];
    protected $models_columns = ["Company" => ["default_columns" => ["id", "name", "shortName", "company_category", "company_sub_category", "legalType", "nationality", "lawyer", "capital", "capitalCurrency", "registrationNb", "registrationTaxNb"], "all_columns" => ["id" => "ID", "name" => "name", "shortName" => "nickname", "company_category" => "category", "company_sub_category" => "sub-category", "foreignName" => "foreign_name", "legalType" => "legal_type", "majorParent" => "company_group", "nationality" => "nationality", "capital" => "capital", "capitalCurrency" => "capital_currency", "shareParValue" => "share_par_value", "registrationNb" => "registration_nb", "registrationTaxNb" => "registration_tax_nb", "registrationDate" => "registration_date", "lawyer" => "lawyer"], "show_custom_fields" => true],
        "Contact" => ["default_columns" => ["id", "fullName", "category", "email", "phone", "mobile", "jobTitle", "company", "subCategory", "additional_id_type", "additional_id_value"], "all_columns" => ["id" => "contact_id", "title" => "contact_title", "fullName" => "name", "jobTitle" => "job_title", "isLawyer" => "lawyer_?", "email" => "email", "phone" => "phone", "mobile" => "mobile", "company" => "company", "city" => "city", "country" => "country", "foreignLastName" => "foreign_last_name", "foreignFirstName" => "foreign_first_name", "category" => "category", "subCategory" => "sub-category", "tax_number" => "tax_number", "additional_id_type" => "additional_id_type", "additional_id_value" => "additional_id_value"]],
        "Matter" => ["default_columns" => ["id", "assignee", "clientName", "subject", "type", "status", "latest_development", "requestedByName", "caseValue", "providerGroup", "caseArrivalDate", "dueDate", "effectiveEffort", "arrivalDate"], "all_columns" => ["id" => "ID", "subject" => "subject_Case", "latest_development" => "latest_development", "providerGroup" => "provider_group", "assignee" => "assignee", "type" => "case_type", "priority" => "priority", "status" => "workflow_status", "statusComments" => "status_comments", "caseStage" => "matter_case_stage", "caseArrivalDate" => "arrival_date", "arrivalDate" => "filed_on", "dueDate" => "due_date", "clientName" => "client_name", "requestedByName" => "requestedByName", "estimatedEffort" => "est_effort", "effectiveEffort" => "eff_effort", "caseValue" => "caseValue", "internalReference" => "internalReference", "archivedCases" => "archived", "closedOn" => "closedOn","closure_requested_by" =>"closureRequestedBy", "closure_comments" => "closureComments", "closed_by" => "closedBy", "approval_step" => "approvalStep", "client_foreign_name" => "client_foreign_name"]],
        "correspondence" => ["default_columns" => ["reference_number", "title", "staff", "assignee", "correspondence_type", "transaction_type_name", "parties", "status", "date_received", "priority", "response_required", "response_deadline", "archived"], "all_columns" => ["id" => "id", "title" => "title", "assignee_id" => "assignee", "assignee_team_id" => "assignee_group", "correspondence_type_id" => "correspondence_type_id", "transaction_type" => "transaction_type", "parties" => "parties", "initiated_by" => "initiated_by", "staff_pf_no" => "staff_pf_no", "date_received" => "date_received", "date_initiated" => "date_initiated", "description" => "description", "external_reference" => "external_reference", "priority" => "priority", "response_required" => "response_required", "response_deadline" => "response_deadline", "createdOn" => "createdOn", "createdBy" => "createdBy", "modifiedOn" => "modifiedOn", "modifiedBy" => "modifiedBy", "archived" => "archived", "status" => "status", "reference_number" => "reference_number", "sender" => "sender", "recipient" => "recipient", "attachments" => "attachments", "notes" => "notes"]],
        "conveyancing_instrument" => ["default_columns" => ["conveyancing_id", "title", "staff","assignee", "instrument_type", "transaction_type_name", "parties", "status", "reference_number", "property_value","amount_requested","amount_approved", "archived"], "all_columns" => ["id" => "id", "title" => "title", "assignee_id" => "assignee","assignee_team_id"=>"assignee_group", "instrument_type_id" => "instrument_type_id", "transaction_type" => "transaction_type", "parties" => "parties", "initiated_by" => "initiated_by", "staff_pf_no" => "staff_pf_no", "date_initiated" => "initiated_on", "description" => "description", "external_counsel" => "external_counsel", "property_value" => "propertyValue", "amount_requested" => "amountRequested", "amount_approved" => "amountApproved", "createdOn" => "createdOn", "createdBy" => "createdBy", "modifiedOn" => "modifiedOn", "modifiedBy" => "modifiedBy", "archived" => "archived", "status" => "status", "reference_number" => "reference_number", "requested_by" => "requested_by"]],
        "Complaints" => ["default_columns" => ["id", "caseArrivalDate", "type", "subject",   "clientName", "opponentNames", "status",  "assignee", "caseStage","statusComments", "requestedByName",  "dueDate","closedOn"], "all_columns" => ["id" => "ID", "internalReference" => "internalReference", "subject" => "subject_Case", "latest_development" => "latest_development", "providerGroup" => "provider_group", "assignee" => "assignee", "type" => "case_type", "priority" => "priority", "status" => "workflow_status", "statusComments" => "status_comments", "caseStage" => "litigation_case_stage", "caseArrivalDate" => "arrival_date", "arrivalDate" => "filed_on", "dueDate" => "due_date", "clientName" => "client_name", "requestedByName" => "requestedByName", "caseClientPosition" => "client_position", "caseSuccessProbability" => "success_probability", "opponentNames" => "opponents", "estimatedEffort" => "est_effort",  "caseValue" => "caseValue", "judgmentValue" => "judgment_value", "recoveredValue" => "recovered_value", "archivedCases" => "archived", "closedOn" => "closedOn", "last_hearing" => "last_hearing", "sentenceDate" => "sentenceDate", "judgment" => "judgment", "client_foreign_name" => "client_foreign_name", "opponent_foreign_name" => "opponent_foreign_name", "court_type" => "court_type", "court_degree" => "court_degree", "court_region" => "court_region","closedOn","closure_requested_by" =>"closureRequestedBy", "closure_comments" => "closureComments", "closed_by" => "closedBy", "approval_step" => "approvalStep", "court" => "court"]],
        "Surveillance" => ["default_columns" => ["id", "caseArrivalDate", "subject",  "opponentNames", "type","statusComments", "latest_development",  "assignee", "status", "closedOn"], "all_columns" => ["id" => "ID", "internalReference" => "internalReference", "subject" => "subject_Case", "latest_development" => "latest_development", "providerGroup" => "provider_group", "assignee" => "assignee", "type" => "case_type", "priority" => "priority", "status" => "workflow_status", "statusComments" => "status_comments", "caseStage" => "litigation_case_stage", "caseArrivalDate" => "arrival_date", "arrivalDate" => "filed_on", "dueDate" => "due_date", "clientName" => "client_name", "requestedByName" => "requestedByName", "caseClientPosition" => "client_position", "caseSuccessProbability" => "success_probability", "opponentNames" => "opponents", "estimatedEffort" => "est_effort", "effectiveEffort" => "eff_effort", "judgmentValue" => "judgment_value", "recoveredValue" => "recovered_value", "archivedCases" => "archived", "closedOn" => "closedOn", "last_hearing" => "last_hearing", "sentenceDate" => "sentenceDate", "judgment" => "judgment", "client_foreign_name" => "client_foreign_name", "opponent_foreign_name" => "opponent_foreign_name", "court_type" => "court_type", "court_degree" => "court_degree", "court_region" => "court_region", "closedOn","closure_requested_by" =>"closureRequestedBy", "closure_comments" => "closureComments", "closed_by" => "closedBy", "approval_step" => "approvalStep", "court" => "court"]],
        "Investigation" => ["default_columns" => ["id","caseArrivalDate","opponentNames", "subject", "type","description","latest_development","statusComments", "assignee",  "status", "requestedByName","closedOn" ], "all_columns" => ["id" => "ID", "internalReference" => "internalReference", "subject" => "subject_Case", "latest_development" => "latest_development", "providerGroup" => "provider_group", "assignee" => "assignee", "type" => "case_type","description" => "description", "priority" => "priority", "status" => "workflow_status", "statusComments" => "status_comments", "caseStage" => "litigation_case_stage", "caseArrivalDate" => "arrival_date", "arrivalDate" => "filed_on", "dueDate" => "due_date", "clientName" => "client_name", "requestedByName" => "requestedByName", "caseClientPosition" => "client_position", "caseSuccessProbability" => "success_probability", "opponentNames" => "opponents", "caseValue" => "caseValue", "judgmentValue" => "judgment_value", "recoveredValue" => "recovered_value", "archivedCases" => "archived", "closedOn" => "closedOn", "last_hearing" => "last_hearing", "sentenceDate" => "sentenceDate", "judgment" => "judgment", "client_foreign_name" => "client_foreign_name", "opponent_foreign_name" => "opponent_foreign_name", "court_type" => "court_type", "court_degree" => "court_degree", "court_region" => "court_region", "closedOn","closure_requested_by" =>"closureRequestedBy", "closure_comments" => "closureComments", "closed_by" => "closedBy", "approval_step" => "approvalStep", "court" => "court"]],
        "Criminal" => ["default_columns" => ["id", "subject", "type", "caseStage", "assignee", "opponentNames", "status", "latest_development", "caseClientPosition", "caseValue", "providerGroup", "requestedByName", "caseArrivalDate", "judgmentValue", "effectiveEffort", "dueDate", "sentenceDate"], "all_columns" => ["id" => "ID", "internalReference" => "internalReference", "subject" => "subject_Case", "latest_development" => "latest_development", "providerGroup" => "provider_group", "assignee" => "assignee", "type" => "case_type", "priority" => "priority", "status" => "workflow_status", "statusComments" => "status_comments", "caseStage" => "litigation_case_stage", "caseArrivalDate" => "arrival_date", "arrivalDate" => "filed_on", "dueDate" => "due_date", "clientName" => "client_name", "requestedByName" => "requestedByName", "caseClientPosition" => "client_position", "caseSuccessProbability" => "success_probability", "opponentNames" => "opponents", "estimatedEffort" => "est_effort", "effectiveEffort" => "eff_effort", "caseValue" => "caseValue", "judgmentValue" => "judgment_value", "recoveredValue" => "recovered_value", "archivedCases" => "archived", "closedOn" => "closedOn", "last_hearing" => "last_hearing", "sentenceDate" => "sentenceDate", "judgment" => "judgment", "client_foreign_name" => "client_foreign_name", "opponent_foreign_name" => "opponent_foreign_name", "court_type" => "court_type", "court_degree" => "court_degree", "court_region" => "court_region", "closedOn","closure_requested_by" =>"closureRequestedBy", "closure_comments" => "closureComments", "closed_by" => "closedBy", "approval_step" => "approvalStep", "court" => "court"]],
        "Litigation" => ["default_columns" => ["id", "subject", "type", "caseStage", "assignee", "opponentNames", "status", "clientName", "latest_development", "caseClientPosition", "caseValue", "providerGroup", "requestedByName", "caseArrivalDate", "judgmentValue", "effectiveEffort", "dueDate", "sentenceDate"], "all_columns" => ["id" => "ID", "internalReference" => "internalReference", "subject" => "subject_Case", "latest_development" => "latest_development", "providerGroup" => "provider_group", "assignee" => "assignee", "type" => "case_type", "priority" => "priority", "status" => "workflow_status", "statusComments" => "status_comments", "caseStage" => "litigation_case_stage", "caseArrivalDate" => "arrival_date", "arrivalDate" => "filed_on", "dueDate" => "due_date", "clientName" => "client_name", "requestedByName" => "requestedByName", "caseClientPosition" => "client_position", "caseSuccessProbability" => "success_probability", "opponentNames" => "opponents", "estimatedEffort" => "est_effort", "effectiveEffort" => "eff_effort", "caseValue" => "caseValue", "judgmentValue" => "judgment_value", "recoveredValue" => "recovered_value", "archivedCases" => "archived", "closedOn" => "closedOn", "last_hearing" => "last_hearing", "sentenceDate" => "sentenceDate", "judgment" => "judgment", "client_foreign_name" => "client_foreign_name", "opponent_foreign_name" => "opponent_foreign_name", "court_type" => "court_type", "court_degree" => "court_degree", "court_region" => "court_region", "court" => "court","first_litigation_case_court_activity_purpose"=>"first_litigation_case_court_activity_purpose"]], "IP" => ["default_columns" => ["id", "subject", "intellectualPropertyRight", "ipClass", "ipSubcategory", "ipStatus", "description", "client", "providerGroup", "legalCaseAssignee", "registrationDate", "createdOn", "createdByName"], "all_columns" => ["id" => "ID", "subject" => "subject", "intellectualPropertyRight" => "ipRight", "ipClass" => "ip_class", "ipSubcategory" => "IP_subcategory", "ipName" => "ip_name", "ipStatus" => "ip_status", "statusComments" => "status_comments", "legalCaseAssignee" => "assignee", "providerGroup" => "provider_group", "countryName" => "country", "client" => "client_owner", "renewalExpiryDate" => "renewal_expiry_date", "renewalDate" => "renewal_date", "renewalUsersToRemind" => "users_to_remind", "agent" => "agent", "registrationReference" => "registration_reference", "arrivalDate" => "filed_on", "filingNumber" => "filing_nb", "acceptanceRejection" => "acceptance_rejection", "registrationDate" => "registration_date", "certificationNumber" => "certification_number", "description" => "description", "createdOn" => "created_on", "createdByName" => "created_by"]], "Task" => ["default_columns" => ["taskId", "title", "caseSubject", "taskType", "contract_name", "description", "assigned_to", "due_date", "taskStatus", "priority"], "all_columns" => ["taskId" => "ID", "title" => "title", "taskType" => "type", "taskStatus" => "workflow_status", "contract_name" => "related_contract", "description" => "description", "caseId" => "case_id", "caseSubject" => "case_subject", "priority" => "priority", "location" => "location", "reporter" => "requested_by", "assigned_to" => "assigned_to", "estimated_effort" => "est_effort", "effectiveEffort" => "eff_effort", "effectiveEffortHours" => "eff_effort_hrs", "due_date" => "due_date", "createdBy" => "created_by", "createdOn" => "created_on", "modifiedByName" => "modified_by", "modifiedOn" => "modified_on", "archivedTasks" => "archived", "contributors" => "contributors"], "show_custom_fields" => true, "show_custom_fields_as_defaults" => true], "Reminder" => ["default_columns" => ["remindDate", "remindTime", "summary", "type", "status", "remindUser", "legal_case", "contract", "company", "contact", "task","opinion"], "all_columns" => ["remindDate" => "remind_on", "remindTime" => "time", "summary" => "summary", "type" => "type", "status" => "status", "remindUser" => "remind_user", "legal_case" => "related_case", "contract" => "related_contract", "company" => "related_company", "contact" => "related_contact", "task" => "related_task", "createdByName" => "created_by", "createdOn" => "created_on"]], "User_Activity_Log" => ["default_columns" => ["logDate", "worker", "seniorityLevel", "legalCaseSummary", "taskTitle", "taskSummary", "effectiveEffort", "timeTypeName", "timeInternalStatusName", "requestedBy", "comments"], "all_columns" => ["logDate" => "date", "worker" => "user", "seniorityLevel" => "seniority_level", "legalCaseId" => "case_id", "legalCaseSummary" => "case_subject", "matterInternalReference" => "internalReference", "taskId" => "task_id", "taskTitle" => "task_title", "taskSummary" => "task_description", "clientName" => "client", "effectiveEffort" => "eff_effort", "effectiveEffortHours" => "eff_effort_hrs", "requestedBy" => "requestedBy", "comments" => "description", "timeTypeName" => "time_type", "timeInternalStatusName" => "time_internal_status", "timeStatus" => "time_status", "inserter" => "created_by", "createdOn" => "created_on"]], "Expense" => ["default_columns" => ["dated", "expenseID", "referenceNum", "expenseCategory", "amount", "paymentMethod", "paidThroughAccount", "paid_through_account_number", "supplier", "billingStatus", "status", "clientName", "clientAccount", "client_account_number", "caseID", "caseSubject", "description", "createdByName", "createdOn", "modifiedByName", "modifiedOn"], "all_columns" => ["dated" => "paid_on", "expenseID" => "expense_id", "referenceNum" => "reference_number", "expenseCategory" => "expense_category", "amount" => "expense_amount", "client_account_number" => "client_account_number", "paymentMethod" => "payment_method", "paidThroughAccount" => "paid_through", "supplier" => "supplier_name", "billingStatus" => "billing_status", "clientName" => "client_name_money", "clientAccount" => "client_account", "paid_through_account_number" => "paid_through_account_number", "caseID" => "case_id", "caseSubject" => "case_subject", "task_id" => "task", "hearing" => "hearing", "event" => "event", "description" => "comments", "createdByName" => "created_by", "createdOn" => "created_on", "modifiedByName" => "modified_by", "modifiedOn" => "modified_on", "status" => "status", "totalTax" => "total_tax", "subTotal" => "sub_total", "taxNumber" => "tax_number"]], "Invoice_Header" => ["default_columns" => ["invoiceID", "clientAccount", "account_number", "total", "payemntsMade", "balanceDue", "clientCurrency", "paidStatus", "dated", "dueOn", "purchaseOrder", "refNum", "case_id", "caseSubject", "assignee", "createdByName", "createdOn", "modifiedByName", "modifiedOn"], "all_columns" => ["invoiceID" => "invoiceNbr", "total" => "total", "totalBaseCurrency" => "total_base_currency", "payemntsMade" => "payments_made", "dated" => "invoice_date", "dueOn" => "due_on", "paidStatus" => "status", "clientAccount" => "client_account", "clientCurrency" => "currency", "balanceDue" => "balance_due", "purchaseOrder" => "purchaseOrder", "refNum" => "invoice_ref", "case_id" => "case_id", "caseSubject" => "case_subject", "assignee" => "assignee", "createdByName" => "created_by", "createdOn" => "created_on", "modifiedByName" => "modified_by", "modifiedOn" => "modified_on", "account_number" => "client_account_number", "exchangeRate" => "exchange_rate", "totalDiscount" => "total_discount", "totalDiscountBaseCurrency" => "total_discount_base_currency", "totalTax" => "total_tax", "totalTaxBaseCurrency" => "total_tax_base_currency", "subTotal" => "sub_total", "subTotalBaseCurrency" => "sub_total_base_currency", "taxNumber" => "tax_number", "taxable" => "taxable", "nonTaxable" => "nonTaxable", "sub_total_after_discount" => "sub_total_after_discount", "sub_total_after_discount_base_currency" => "sub_total_after_discount_base_currency", "practice_area" => "case_type"]], "Quote_Header" => ["default_columns" => ["quoteID", "clientAccount", "account_number", "total", "clientCurrency", "paidStatus", "dated", "dueOn", "purchaseOrder", "refNum", "case_id", "caseSubject", "createdByName", "createdOn", "modifiedByName", "modifiedOn"], "all_columns" => ["quoteID" => "quoteNbr", "total" => "total", "dated" => "quote_date", "dueOn" => "due_on", "paidStatus" => "status", "clientAccount" => "client_account", "clientCurrency" => "currency", "purchaseOrder" => "purchaseOrder", "refNum" => "quote_ref", "case_id" => "case_id", "caseSubject" => "case_subject", "createdByName" => "created_by", "createdOn" => "created_on", "modifiedByName" => "modified_by", "modifiedOn" => "modified_on", "account_number" => "client_account_number", "totalDiscount" => "total_discount", "totalTax" => "total_tax", "subTotal" => "sub_total", "taxNumber" => "tax_number", "taxable" => "taxable", "nonTaxable" => "nonTaxable", "sub_total_after_discount" => "sub_total_after_discount"]], "Bill_Header" => ["default_columns" => ["dated", "supplierAccount", "account_number", "total", "payemntsMade", "balanceDue", "dueDate", "billStatus", "referenceNum", "caseID", "caseSubject", "clientName", "description", "createdByName", "createdOn", "modifiedByName", "modifiedOn"], "all_columns" => ["dated" => "bill_date", "supplierAccount" => "supplier_account", "account_number" => "supplier_account_number", "total" => "total", "payemntsMade" => "payments_made", "balanceDue" => "balance_due", "dueDate" => "due_date", "billStatus" => "status", "referenceNum" => "bill_refNum", "caseID" => "case_id", "caseSubject" => "case_subject", "clientName" => "client_name_money", "description" => "note", "createdByName" => "created_by", "createdOn" => "created_on", "modifiedByName" => "modified_by", "modifiedOn" => "modified_on", "totalTax" => "total_tax", "subTotal" => "sub_total", "taxNumber" => "tax_number"]], "User_Activity_Log_Money_Module" => ["default_columns" => ["logDate", "worker", "legalCaseId", "legalCaseSummary", "matterInternalReference", "taskId", "taskTitle", "taskSummary", "clientName", "effectiveEffort", "billingStatus", "comments", "timeTypeId", "timeInternalStatusName", "timeStatus", "ratePerHour", "inserter", "createdOn"], "all_columns" => ["logDate" => "date", "worker" => "user", "legalCaseId" => "case_id", "legalCaseSummary" => "case_subject", "taskId" => "task_id", "taskTitle" => "task_title", "taskSummary" => "task_description", "clientName" => "client_money", "effectiveEffort" => "eff_effort", "effectiveEffortHours" => "eff_effort_hrs", "comments" => "description", "timeTypeId" => "time_type", "timeInternalStatusName" => "time_internal_status", "timeStatus" => "time_status", "inserter" => "created_by", "createdOn" => "created_on", "matterInternalReference" => "internalReference", "billingStatus" => "billing_status_time_logs", "ratePerHour" => "rate"]], "Account" => ["default_columns" => ["name", "account_number", "accountCategoryType", "currencyCode", "foreignAmount", "systemAccount"], "all_columns" => ["name" => "account_name", "account_number" => "account_number", "accountCategoryType" => "account_type", "currencyCode" => "currency", "foreignAmount" => "balance", "systemAccount" => "system_account"]], "Legal_Case_Hearing" => ["default_columns" => ["day", "startDate", "reference", "stage_name", "caseSubject", "court", "courtDegree", "summary", "summaryToClient", "latest_development", "type_name", "lawyers", "previousHearingDate"], "all_columns" => ["hearingID" => "hearing_id", "startDate" => "hearing_date", "caseSubject" => "litigation_case_subject", "type_name" => "hearing_type", "stage_name" => "hearing_case_stage", "lawyers" => "lawyers_for_hearing", "reference" => "external_reference", "latest_development" => "latest_development", "verifiedSummary" => "verified", "judged" => "judged", "judgment" => "judgment", "clients" => "client", "clientPosition" => "client_position", "opponents" => "opponents", "court" => "court_name", "courtDegree" => "court_degree", "courtRegion" => "court_region", "courtType" => "court_type", "summary" => "summary_by_lawyer", "summaryToClient" => "summaryToClient", "caseID" => "related_litigation_case", "caseReference" => "internalReference", "previousHearingDate" => "previousHearingDate", "comments" => "hearing_comments", "reasons_of_postponement" => "reasons_of_postponement", "containerID" => "containerID", "areaOfPractice" => "case_type", "client_foreign_name" => "client_foreign_name", "opponent_foreign_name" => "opponent_foreign_name", "createdByName" => "created_by", "createdOn" => "created_on", "day" => "day"]], "Matter_Container" => ["default_columns" => ["id", "containerSubject", "type", "status", "clientName", "caseClientPosition", "requested_by_name", "opponentNames", "providerGroup", "assignee", "caseArrivalDate"], "all_columns" => ["id" => "ID", "internalReference" => "internalReference", "containerSubject" => "containerSubject", "providerGroup" => "provider_group", "assignee" => "assignee", "type" => "type", "status" => "status", "caseArrivalDate" => "arrival_date", "clientName" => "client_name", "caseClientPosition" => "client_position", "requested_by_name" => "requestedByName", "opponentNames" => "opponents", "createdBy" => "createdBy", "createdOn" => "createdOn", "modifiedBy" => "modifiedBy", "modifiedOn" => "modifiedOn", "containerClosedOn" => "closed_on", "containerComments" => "comments", "client_foreign_name" => "client_foreign_name", "opponent_foreign_name" => "opponent_foreign_name"]],
        "contract" => ["default_columns" => ["id","reference_number", "parties", "name","description","currency", "value","amount_paid_so_far","balance_due",  "contract_status", "type", "status", "contract_date", "start_date", "end_date", "contract_duration", "requester", "assigned_team", "assignee",  "priority", "amendment_of_name"], "all_columns" => ["id" => "ID", "name" => "contract_name", "description" => "description","currency" => "currency", "value" => "contract_value", "department", "contract_status" => "status", "type" => "contract_type", "status" => "contract_status", "contract_date" => "contract_date", "start_date" => "start_date", "end_date" => "end_date", "renewal" => "renewal", "reference_number" => "reference_number", "requester" => "requester", "assigned_team" => "provider_group", "assignee" => "assignee", "parties" => "parties", "priority" => "priority", "amendment_of_name" => "amendment_of", "amount_paid_so_far"=>"amount_paid_so_far" ,"balance_due"=>"balance_due" ,"country" => "country", "applicable_law" => "applicable_law", "createdByName" => "createdBy", "createdOn" => "createdOn", "modifiedByName" => "modifiedBy", "modifiedOn" => "modifiedOn", "archived" => "archived"], "show_custom_fields" => true],
        "awaiting_approvals" => ["default_columns" => ["id","reference_number", "parties", "name","description","currency", "value","amount_paid_so_far","balance_due",  "contract_status", "type", "status", "contract_date", "start_date", "end_date", "contract_duration", "requester", "assigned_team", "assignee",  "priority", "amendment_of_name"], "all_columns" => ["id" => "ID", "name" => "contract_name", "description" => "description", "value" => "contract_value", "currency" => "currency", "department","approvers" => "approvers", "type" => "contract_type", "status" => "contract_status", "contract_date" => "contract_date", "start_date" => "start_date", "end_date" => "end_date", "reference_number" => "reference_number", "requester" => "requester", "assigned_team" => "provider_group", "assignee" => "assignee", "parties" => "parties", "priority" => "priority", "archived" => "archived"], "show_custom_fields" => true],
        "awaiting_signatures" => ["default_columns" => ["id","reference_number", "parties", "name","description","currency", "value","amount_paid_so_far","balance_due","department",  "contract_status", "type", "status", "contract_date", "start_date", "end_date", "contract_duration", "requester", "assigned_team", "assignee",  "priority", "amendment_of_name"], "all_columns" => ["id" => "ID", "name" => "contract_name", "description" => "description", "value" => "contract_value", "currency" => "currency", "signees" => "signees", "type" => "contract_type", "status" => "contract_status", "contract_date" => "contract_date", "start_date" => "start_date", "end_date" => "end_date", "reference_number" => "reference_number", "requester" => "requester", "assigned_team" => "provider_group", "assignee" => "assignee", "parties" => "parties", "priority" => "priority", "archived" => "archived"], "show_custom_fields" => true],
        "surety_bond" => ["default_columns" => ["bond_number", "bond_type", "bond_amount", "currency_id", "surety_provider", "effective_date", "expiry_date", "bond_status", "contract_id"], "all_columns" => ["id" => "id", "contract_id" => "contract_id", "bond_type" => "bond_type", "bond_amount" => "bond_amount", "currency_id" => "currency_id", "surety_provider" => "surety_provider", "bond_number" => "bond_number", "effective_date" => "effective_date", "expiry_date" => "expiry_date", "released_date" => "released_date", "bond_status" => "bond_status", "document_id" => "document_id", "remarks" => "remarks", "createdOn" => "createdOn", "createdBy" => "createdBy", "modifiedOn" => "modifiedOn", "modifiedBy" => "modifiedBy"]],
        "Opinion" => ["default_columns" => ["opinionId","opinionType", "title", "detailed_info","caseSubject",  "contract_name",  "assigned_to", "due_date", "opinionStatus", "priority"], "all_columns" => ["opinionId" => "ID", "title" => "title", "legal_question" => "legal_question", "detailed_info" => "detailed_info","background_info" => "background_info","opinionType" => "type", "opinionStatus" => "workflow_status", "contract_name" => "related_contract",  "caseId" => "case_id", "caseSubject" => "case_subject", "priority" => "priority", "location" => "location", "reporter" => "requested_by", "requester"=>"requester","assigned_to" => "assigned_to", "estimated_effort" => "est_effort", "effectiveEffort" => "eff_effort", "effectiveEffortHours" => "eff_effort_hrs", "due_date" => "due_date", "createdBy" => "created_by", "createdOn" => "created_on", "modifiedByName" => "modified_by", "modifiedOn" => "modified_on", "archivedOpinions" => "archived", "contributors" => "contributors"], "show_custom_fields" => true, "show_custom_fields_as_defaults" => true]];
    public function __construct()
    {
        parent::__construct();
        $this->validate = ["model" => ["required" => true, "allowEmpty" => false, "rule" => ["inList", $this->models], "message" => sprintf($this->ci->lang->line("required_list_values"), implode(", ", $this->models))]];
    }
    public function get_grid_saved_column($model)
    {
        $query = ["select" => "id , grid_details", "where" => ["model", $model]];
        $query_data = $this->load_all($query);
        return !empty($query_data) ? $query_data : false;
    }
    public function get_user_grid_details($model, $grid_saved_filter_id = NULL)
    {
        $query = ["select" => ["grid_details", false], "where" => [["model", $model]]];
        if (empty($grid_saved_filter_id)) {
            $query["where"][] = ["user_id", $this->ci->is_auth->get_user_id()];
            $query["where"][] = ["grid_saved_filter_id IS NULL"];
        } else {
            $query["where"][] = ["grid_saved_filter_id", $grid_saved_filter_id];
        }
        $query_data = $this->load_all($query);
        $response["grid_saved_details"] = isset($query_data[0]) ? unserialize($query_data[0]["grid_details"]) : false;
        $response["grid_columns"] = $this->models_columns[$model];
        $common_core_contract_models = ["Task", "Reminder", "User_Activity_Log"];
        if ($this->ci->license_package == "contract" && in_array($model, $common_core_contract_models)) {
            $columns_to_remove = ["caseId", "caseSubject", "legal_case", "legalCaseId", "legalCaseSummary"];
            foreach ($columns_to_remove as $column) {
                if ($response["grid_columns"]["default_columns"]) {
                    $key = array_search($column, $response["grid_columns"]["default_columns"]);
                    if ($key) {
                        unset($response["grid_columns"]["default_columns"][$key]);
                    }
                }
                if ($response["grid_saved_details"]["selected_columns"]) {
                    $key = array_search($column, $response["grid_saved_details"]["selected_columns"]);
                    if ($key) {
                        unset($response["grid_saved_details"]["selected_columns"][$key]);
                    }
                }
                unset($response["grid_columns"]["all_columns"][$column]);
            }
        }
        $custom_fields_columns = $cutsom_fields_ids = [];
        if (isset($this->models_columns[$model]["show_custom_fields"]) && $this->models_columns[$model]["show_custom_fields"]) {
            if (empty($this->ci->custom_field)) {
                $this->ci->load->model("custom_field", "custom_fieldfactory");
                $this->ci->custom_field = $this->ci->custom_fieldfactory->get_instance();
            }
            $custom_fields = $this->ci->custom_field->load_list_per_language($model);
            foreach ($custom_fields as $field) {
                $custom_fields_columns["custom_field_" . $field["id"]] = $field["customName"];
                $cutsom_fields_ids[] = "custom_field_" . $field["id"];
            }
            $response["grid_columns"]["all_columns"] = array_merge($response["grid_columns"]["all_columns"], $custom_fields_columns);
            $response["grid_columns"]["custom_fields"] = $custom_fields_columns;
        }
        if (!empty($response["grid_saved_details"]["selected_columns"])) {
            $response["selected_columns"] = $response["grid_saved_details"]["selected_columns"];
        } else {
            if (isset($this->models_columns[$model]["show_custom_fields_as_defaults"]) && $this->models_columns[$model]["show_custom_fields_as_defaults"]) {
                $response["selected_columns"] = array_merge($response["grid_columns"]["default_columns"], $cutsom_fields_ids);
            } else {
                $response["selected_columns"] = array_merge($response["grid_columns"]["default_columns"]);
            }
        }
        return $response;
    }
    public function save($data = NULL)
    {
        $response = $grid_details = [];
        if (empty($data)) {
            $data = $this->ci->input->post(NULL);
        }
        $query["where"] = [["model", $data["model"]]];
        if (empty($data["grid_saved_filter_id"])) {
            $query["where"][] = ["user_id", $this->ci->is_auth->get_user_id()];
            $query["where"][] = ["grid_saved_filter_id IS NULL"];
        } else {
            $query["where"][] = ["grid_saved_filter_id", $data["grid_saved_filter_id"]];
            $this->ci->load->model("grid_saved_filter", "grid_saved_filterfactory");
            $this->ci->grid_saved_filter = $this->ci->grid_saved_filterfactory->get_instance();
            $this->ci->grid_saved_filter->fetch($data["grid_saved_filter_id"]);
            if (!$this->ci->session->userdata("AUTH_is_grid_admin") && $this->ci->is_auth->get_user_id() != $this->ci->grid_saved_filter->get_field("user_id")) {
                $grid_modification_forbidden = true;
            }
        }
        $grid_saved_column = $this->load($query);
        if (empty($grid_saved_column)) {
            $grid_saved_column["model"] = $data["model"];
            $grid_saved_column["user_id"] = $this->ci->is_auth->get_user_id();
            if (!empty($data["grid_saved_filter_id"])) {
                $grid_saved_column["grid_saved_filter_id"] = $data["grid_saved_filter_id"];
            }
        } else {
            $old_saved_grid_details = unserialize($grid_saved_column["grid_details"]);
        }
        if (empty($grid_modification_forbidden)) {
            $grid_details["pageSize"] = isset($data["pageSize"]) ? $data["pageSize"] : (isset($old_saved_grid_details["pageSize"]) ? $old_saved_grid_details["pageSize"] : "");
            $old_sorts_modified = "";
            if (isset($old_saved_grid_details) && isset($data["columns"])) {
                $old_sorts_modified = $this->overwrite_old_sorts($old_saved_grid_details["sort"], $data["columns"]);
            }
            $grid_details["sort"] = isset($data["sortData"]) ? $data["sortData"] : (isset($old_saved_grid_details["sort"]) ? $old_sorts_modified : "");
            if (empty($data["restore_default_columns"])) {
                if (!empty($data["columns"])) {
                    $current_columns = $selected_columns = $existant_columns_keys = [];
                    if (isset($old_saved_grid_details["selected_columns"])) {
                        $current_columns = $old_saved_grid_details["selected_columns"];
                    } else {
                        $models_columns = $this->get("models_columns");
                        $current_columns = $models_columns[$data["model"]]["default_columns"];
                    }
                    foreach ($data["columns"] as $column_key => $column) {
                        $column_position = array_search($column, $current_columns);
                        if ($column_position !== false) {
                            $selected_columns[$column_position] = $column;
                            $existant_columns_keys[] = $column_key;
                        }
                    }
                    foreach ($existant_columns_keys as $key) {
                        unset($data["columns"][$key]);
                    }
                    ksort($selected_columns);
                    $selected_columns = array_values($selected_columns);
                    foreach ($data["columns"] as $column) {
                        $selected_columns[] = $column;
                    }
                    $grid_details["selected_columns"] = $selected_columns;
                } else {
                    if (!empty($data["ordered_columns"])) {
                        $grid_details["selected_columns"] = explode(",", $data["ordered_columns"]);
                    } else {
                        if (!empty($old_saved_grid_details["selected_columns"])) {
                            $grid_details["selected_columns"] = $old_saved_grid_details["selected_columns"];
                        } else {
                            $grid_details["selected_columns"] = NULL;
                        }
                    }
                }
            } else {
                $grid_details["selected_columns"] = NULL;
            }
            $grid_saved_column["grid_details"] = serialize($grid_details);
            $this->set_fields($grid_saved_column);
            if (empty($old_saved_grid_details)) {
                $response["result"] = $this->insert();
            } else {
                $response["result"] = $this->update();
            }
        } else {
            $response["feedbackMessage"] = ["ty" => "warning", "m" => $this->ci->lang->line("grid_modification_not_allowed")];
            $response["result"] = false;
        }
        return $response;
    }
    private function overwrite_old_sorts($old_sorts_encoded, $current_selected_columns)
    {
        $old_sorts_modified = [];
        $old_sorts = json_decode($old_sorts_encoded, true) ?? [];
        foreach ($old_sorts as $old_sort) {
            if (in_array($old_sort["field"], $current_selected_columns)) {
                array_push($old_sorts_modified, $old_sort);
            }
        }
        return json_encode($old_sorts_modified);
    }
}
